var e=Object.defineProperty,a=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,l=(a,t,o)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[t]=o;import{u as i}from"./components.d5e25037.js";import{k as n,$ as s,A as c,o as d,t as r,B as u,K as m,N as p,O as g,a5 as f,f as h,g as y,y as b,m as _,D as v,w,n as L,U as x,I as M,S,a6 as k,ar as C,_ as P}from"./vendor.9695fe57.js";import{u as j,c as I,a as A}from"./location.e56e878e.js";import{u as D}from"./dashboard.73bd0b4f.js";import{_ as V,b as q,e as T,d as U,f as B,S as F,P as N,u as E,ao as $,a9 as O,g as z}from"./index.dcc9fc55.js";import{C as R}from"./card.323f324c.js";import{_ as Z}from"./badge.b1ac8285.js";import{_ as H}from"./fieldset.7eca078e.js";import{c as K}from"./status.6f59bf91.js";import{_ as W}from"./attention.c511405b.js";import{_ as Y}from"./unlock.29bb9197.js";import"./LoadingCard.d443bc39.js";import"./date.f86face7.js";import"./setting.7b680124.js";const G=n({name:"ManageLocationTotalBilledLocation",props:{total:{type:Number,default:0},loading:{type:Boolean,default:!1}},setup:()=>({})}),J={class:"billed-location"},Q={class:"billed-location__total"};const X=n({components:{Card:R,Button:q,Checkbox:T,Modal:U,Input:B,Select:F,Pagination:N,Badge:Z,Fieldset:H,TotalBilledLocation:V(G,[["render",function(e,a,t,o,l,i){const n=s("loading");return c((d(),r("div",J,[a[1]||(a[1]=u("div",null,[u("img",{class:"billed-location__icon",src:"/assets/location-billed.440f486b.svg",draggable:"false"})],-1)),u("div",null,[a[0]||(a[0]=u("p",{class:"billed-location__description"}," Total Number of Billed Locations ",-1)),u("p",Q,m(e.total),1)])])),[[n,e.loading]])}],["__scopeId","data-v-cc1d670a"]])},async setup(e,{emit:i}){const n=p(),s=g(),c=f(),{data:d,dataLocation:r,state:u,loading:m,modal:_,isShowSwitchLocationModal:v,isShowEnableMailinModal:w,selected:L,locationList:x,unsetData:M,openModal:S,actionAll:k,actionDelete:C,actionMailLocation:V}=j(),{stateFiltered:q,locations:T,loading:U,query:B}=D(),{linkedStatuses:F,loading:N,actionRequestFranchisee:R,actionCancelFranchisee:Z,actionUnlinkFranchisee:H}=I(),{me:W,action:Y}=E(),{loading:G,billingCycleType:J,refundedProrateAmount:Q,getRefundedProrateAmount:X}=A(),ee=h(!1),ae=y((()=>q.value.data?q.value.data.filter((e=>e.id!==parseInt(L.value))):[])),te=y((()=>u.value.franchisor_code||null)),oe=y((()=>{var e;return(null==(e=u.value)?void 0:e.mailin_location)||null})),le=y((()=>{var e;return null==(e=q.value)?void 0:e.is_mailin_available})),ie=y((()=>null===oe.value?"":oe.value.address_text)),ne=y({set:e=>{r.new_store_id=e},get:()=>r.new_store_id}),se=y((()=>1==c.query["switch-mailin"])),ce=y((()=>se.value)),de=y((()=>ee.value?"Confirm Delete Location":"This location will be permanently deleted")),re=y((()=>ee.value?"By deleting your Mail-in location, you will lose access to all your Mail-in buybacks data and all the Mail-in features. We recommend exporting the data before proceeding. Are you sure you want to lose access to the Mail-in buybacks data?":" However, to proceed, you must transfer its data to another location. Please select the destination for the data transfer from the options below."));b((()=>({limit:d.limit,search:d.search})),(()=>{d.page=1}),{deep:!0}),b((()=>((e,i)=>{for(var n in i||(i={}))t.call(i,n)&&l(e,n,i[n]);if(a)for(var n of a(i))o.call(i,n)&&l(e,n,i[n]);return e})({},d)),z((async()=>{await k(n.state.user.me.id)}),500),{deep:!0}),b((()=>({search:B.search})),(()=>{B.page=1})),b((()=>({search:B.search,page:B.page})),z((async()=>{await T((()=>{}),n.state.user.me.id)}),500));const ue=(e,a)=>S(e,(()=>{L.value=a.id})),me=async()=>{var e;await V({is_enable:se.value?1:1==(null==(e=oe.value)?void 0:e.is_enable_mailin)?0:1},(async()=>{P({type:"success",message:"Mail-In location status updated"}),await Promise.all([Y(),k(n.state.user.me.id),T((()=>{}),n.state.user.me.id)])})),w.value=!1,s.push({name:"settingManageLocationStoreLocations",query:{}})};return await Promise.all([k(n.state.user.me.id),T((()=>{}),n.state.user.me.id)]),{data:d,me:W,dataLocation:r,store:n,state:u,stateLocation:q,listLocation:ae,selectedLocation:ne,loading:m,modal:_,isShowSwitchLocationModal:v,isShowEnableMailinModal:w,isShowSwitchMailinModal:ce,unsetData:M,loadingFranchisee:N,loadingLocations:U,loadingAdditionalPrice:G,color:K,lowerCase:$,linkedStatuses:F,query:B,isMailAvailable:le,currentMailInLocation:oe,currentMailInLocationAddress:ie,phoneNumber:O,locationList:x,refundedProrateAmount:Q,isMailinCurrentSelectedLocation:ee,popupTitleDeleteLocation:de,popupDescriptionDeleteLocation:re,billingCycleType:J,deleteLocation:async()=>{ee.value?await V({is_enable:0},(async e=>{var a,t;if(e)return console.warn("Error deleting mail-in location: ",e);_.delete=!1,M(),await Promise.allSettled([k(null==(a=n.state.user.me)?void 0:a.id),T((()=>{}),null==(t=n.state.user.me)?void 0:t.id)])})):(await C(),await T((()=>{}),n.state.user.me.id))},openModalSelected:ue,handleRequestFranchisee:async e=>{if(e.franchisor_code===te.value)return P({type:"error",message:"You won't be able to enter your own access code"});const a={location_id:e.id,franchisor_code:e.franchisor_code?e.franchisor_code:""};await R(a,(async()=>{await Promise.all([k(n.state.user.me.id),T((()=>{}),n.state.user.me.id)])}))},handleCancelFranchisee:async e=>await Z(e,(async()=>{P({type:"success",message:"Request canceled"}),await k(n.state.user.me.id)})),handleUnlinkFranchisee:async e=>await H(e,(async()=>{P({type:"success",message:"Location unlinked"}),await k(n.state.user.me.id)})),handleUpdateLocationStatus:async()=>{if(!le.value)return;const e=!!u.value.is_popup_switch_location_type&&1==oe.value.is_enable_mailin,a=u.value.package_detail.is_popup_paid_location&&0==oe.value.is_enable_mailin;e?v.value=!0:a?s.push({name:"settingManageLocationEdit",params:{locationId:oe.value.id},query:{"switch-mailin":0}}):await me()},handleSwitchLocationType:()=>{const e=1==oe.value.is_enable_mailin?oe.value.id:u.value.data[0].id;v.value=!1,s.push({name:"settingManageLocationSwitchLocation",params:{locationId:e}})},handleUpdateMailInLocationStatus:me,handleDeleteLocation:async e=>{var a;const t=e.id===(null==(a=oe.value)?void 0:a.id);ee.value=t,await X();!u.value.is_popup_switch_location_type?ue("delete",e):v.value=!0},censorLocationName:e=>{if(!e)return e;let a=e;return a=a.replace(/(?:\d[\s.-]?){5,}/g,(e=>{const a=e.replace(/\D/g,"");return a.length<=4?"*".repeat(a.length):`${a.slice(0,4)}${"*".repeat(a.length-4)}`})),a=a.replace(/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g,(e=>`${e[0]}${"*".repeat(e.length-1)}`)),a=a.replace(/\b(call us|contact us|email us|text us)\b/gi,(e=>"*".repeat(e.length))),a}}}}),ee={class:"grid grid-cols-4 mb-6"},ae={class:"col-span-4"},te={class:"flex"},oe={class:"text-teal-04 font-semibold"},le={class:"lg:opacity-0 group-hover:opacity-100 transition-opacity"},ie={class:"text-center py-6"},ne={class:"mt-8 mb-10"},se={class:"mb-2 text-2xl"},ce={class:"text-grey-03 mb-8"},de={class:"mb-4"},re={key:0,class:"flex gap-4 py-2 px-4 rounded-lg text-left",style:{"background-color":"rgba(0, 0, 0, 0.03)"}},ue={class:"mt-1"},me={class:"font-semibold"},pe={class:"px-4 py-4 w-full"},ge={class:"px-4 py-4 w-full flex flex-col"},fe={class:"flex flex-col items-center justify-center my-4"},he={class:"text-center text-grey-04"},ye={class:"flex items-center justify-center my-6"},be={class:"flex flex-col items-center justify-center my-4"},_e={class:"text-center text-grey-04"},ve={class:"flex items-center justify-center my-6"};var we=V(X,[["render",function(e,a,t,o,l,i){const n=_("TotalBilledLocation"),p=_("Input"),g=_("TableColumn"),f=_("Button"),h=_("Table"),y=_("Pagination"),b=_("Select"),P=_("Modal"),j=_("RouterView"),I=s("loading");return d(),r("div",null,[u("div",ee,[u("div",ae,[v(n,{loading:e.loading.all,total:e.state.total_location},null,8,["loading","total"])])]),u("div",te,[v(p,{modelValue:e.data.search,"onUpdate:modelValue":a[0]||(a[0]=a=>e.data.search=a),placeholder:"Search",class:"w-full mb-5",icon:""},{icon:w((()=>a[12]||(a[12]=[u("span",{class:"material-icons"},"search",-1)]))),_:1},8,["modelValue"])]),c((d(),r("div",null,[v(h,{data:e.locationList},{default:w((()=>[v(g,{label:"Location Name",width:"300"},{default:w((({row:a})=>[u("p",oe,[u("span",null,m(e.censorLocationName(a.name)),1)])])),_:1}),v(g,{label:"Email",prop:"email"}),v(g,{label:"Address",prop:"address_text"}),v(g,{label:"Phone Number",width:"150"},{default:w((({row:a})=>[u("p",null,m(e.phoneNumber(a.phone)),1)])),_:1}),v(g,{label:"Purchasing Method",width:"150"},{default:w((({row:a})=>{var t;return[u("p",null,m((null==(t=e.currentMailInLocation)?void 0:t.id)===(null==a?void 0:a.id)?"Mail-In":"In-Store"),1)]})),_:1}),v(g,{label:"",width:"450"},{default:w((({row:t})=>[u("div",le,[v(f,{class:"mr-4",color:"teal",to:{name:"settingManageLocationEdit",params:{locationId:t.id}},link:"",dense:""},{default:w((()=>a[13]||(a[13]=[u("span",{class:"material-icons"},"edit",-1)]))),_:2},1032,["to"]),e.state.total_location>1?(d(),L(f,{key:0,onClick:a=>e.handleDeleteLocation(t),loading:e.loadingAdditionalPrice,color:"red",dense:""},{default:w((()=>a[14]||(a[14]=[u("span",{class:"material-icons text-xl"},"delete",-1)]))),_:2},1032,["onClick","loading"])):x("",!0)])])),_:1})])),_:1},8,["data"]),v(y,{page:e.data.page,"onUpdate:page":a[1]||(a[1]=a=>e.data.page=a),limit:e.data.limit,"onUpdate:limit":a[2]||(a[2]=a=>e.data.limit=a),data:e.state,class:"mt-4"},null,8,["page","limit","data"])])),[[I,e.loading.all]]),v(P,{size:"sm",modelValue:e.modal.delete,"onUpdate:modelValue":a[7]||(a[7]=a=>e.modal.delete=a),title:"Delete Location",onClose:e.unsetData,"hide-header":"","hide-footer":""},{default:w((()=>[u("div",ie,[a[21]||(a[21]=u("img",{class:"mb-10 mx-auto",src:W,alt:"Icon"},null,-1)),u("div",ne,[u("h6",se,m(e.popupTitleDeleteLocation),1),u("div",ce,[u("p",de,m(e.popupDescriptionDeleteLocation),1),e.refundedProrateAmount?(d(),r("div",re,[a[17]||(a[17]=u("i",{class:"material-icons"},"info",-1)),u("p",ue,[a[15]||(a[15]=M(" A prorated refund of ")),u("span",me,m(e.refundedProrateAmount),1),a[16]||(a[16]=M(" will be credited to your account and applied to your next billing cycle. "))])])):x("",!0)]),e.isMailinCurrentSelectedLocation?x("",!0):(d(),L(b,{key:0,modelValue:e.dataLocation.new_store_id,"onUpdate:modelValue":a[5]||(a[5]=a=>e.dataLocation.new_store_id=a),placeholder:"Choose location",by:"id",name:"name",items:e.listLocation,loading:e.loadingLocations.all,"max-height":"200px",block:""},{prepend:w((()=>[u("div",pe,[v(p,{modelValue:e.query.search,"onUpdate:modelValue":a[3]||(a[3]=a=>e.query.search=a),placeholder:"Search Location",class:"w-full",block:"",icon:""},{icon:w((()=>a[18]||(a[18]=[u("span",{class:"material-icons"},"search",-1)]))),_:1},8,["modelValue"])])])),item:w((({item:e})=>[M(m(e.name),1)])),append:w((()=>[u("div",ge,[v(y,{page:e.query.page,"onUpdate:page":a[4]||(a[4]=a=>e.query.page=a),"hide-show-entries":"",small:"",data:e.stateLocation},null,8,["page","data"])])])),_:1},8,["modelValue","items","loading"]))]),v(f,{color:"red",class:"mr-5",loading:e.loading.delete||e.loading.mailin_location,disabled:(e.loading.delete||null===e.dataLocation.new_store_id)&&!e.isMailinCurrentSelectedLocation,onClick:e.deleteLocation},{default:w((()=>a[19]||(a[19]=[M(" Delete Location ")]))),_:1},8,["loading","disabled","onClick"]),v(f,{color:"white",disabled:e.loading.delete,onClick:a[6]||(a[6]=a=>e.modal.delete=!1)},{default:w((()=>a[20]||(a[20]=[M(" Cancel ")]))),_:1},8,["disabled"])])])),_:1},8,["modelValue","onClose"]),v(P,{modelValue:e.isShowSwitchLocationModal,"onUpdate:modelValue":a[9]||(a[9]=a=>e.isShowSwitchLocationModal=a),size:"xs","hide-footer":""},{default:w((()=>[u("div",fe,[a[23]||(a[23]=u("img",{class:"mb-4 w-28",src:Y,alt:"unlock icon"},null,-1)),a[24]||(a[24]=u("h2",{class:"text-3xl font-bold my-4"},"Turned off Location",-1)),u("p",he,m(1==e.currentMailInLocation.is_enable_mailin?"Mail-in locations would change into In-store locations after you\n          turned off.":" In-store locations would change into Mail-in locations after you\n          turned off."),1),u("div",ye,[u("a",{class:"px-8 py-4 mr-4",onClick:a[8]||(a[8]=S((a=>e.isShowSwitchLocationModal=!1),["prevent"]))},"Cancel"),v(f,{color:"orange",onClick:e.handleSwitchLocationType},{default:w((()=>a[22]||(a[22]=[M(" Proceed ")]))),_:1},8,["onClick"])])])])),_:1},8,["modelValue"]),v(P,{"model-value":e.isShowSwitchMailinModal,onClose:a[11]||(a[11]=a=>e.$router.push({name:"settingManageLocationStoreLocations",query:{}})),size:"xs","hide-footer":""},{default:w((()=>[u("div",be,[a[28]||(a[28]=u("img",{class:"mb-4 w-28",src:Y,alt:"unlock icon"},null,-1)),a[29]||(a[29]=u("h2",{class:"text-center text-3xl font-bold my-4"}," Pay to Enable Location ",-1)),u("p",_e,[a[25]||(a[25]=M(" Pay ")),u("b",null,"$"+m(e.state.package_detail.additional_location_price)+" per month",1),a[26]||(a[26]=M(" to enable mail-in location on your account "))]),u("div",ve,[u("a",{class:"px-8 py-4 mr-4",onClick:a[10]||(a[10]=S((a=>e.$router.push({name:"settingManageLocationStoreLocations",query:{}})),["prevent"]))},"Cancel"),v(f,{loading:e.loading.mailin_location,color:"orange",onClick:e.handleUpdateMailInLocationStatus},{default:w((()=>a[27]||(a[27]=[M("Proceed")]))),_:1},8,["loading","onClick"])])])])),_:1},8,["model-value"]),v(j,null,{default:w((({Component:e})=>[e?(d(),L(C,{key:0},{default:w((()=>[(d(),L(k(e)))])),_:2},1024)):x("",!0)])),_:1})])}]]),Le=n({setup(){const{genSuspense:e}=i();return()=>e(we)}});export{Le as default};
