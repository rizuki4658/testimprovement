import{u as e}from"./components.dd762bd4.js";import{_ as a,b as t,f as l,e as i,Z as o,r as s}from"./index.6438e939.js";import{h as n,c as d,i as r,j as m}from"./setting.1af98a84.js";import{u as c}from"./index.f40e4a9e.js";import{c as u}from"./index.6b6f6369.js";import{r as p}from"./index.54844a74.js";import{k as f,o as w,t as g,B as v,K as b,q as h,r as _,f as y,y as x,g as T,m as E,D as k,w as C,I as j,a1 as S,a2 as P,_ as V}from"./vendor.9695fe57.js";import{C as U}from"./card.33d29bf3.js";import{B as D}from"./Breadcrumb.cb17adf4.js";import{_ as B}from"./group-container.9c0955c9.js";import{S as M}from"./select.94a9f057.js";import{E as R}from"./expandable-panel.2290ff34.js";import{M as $}from"./MultipleEmailInput.4f716641.js";import{T as I,c as O}from"./TextEditor.2633fc04.js";import{P as q}from"./PreviewEmailTemplate.330a337c.js";import"./LoadingCard.6426fb93.js";import"./breadcrumb.0bf6764a.js";import"./IframeRender.46e71567.js";const N=f({props:{section:[Number,String]}}),L={class:"flex space-x-4"},A={class:"flex w-11 h-11 bg-teal-04 rounded-full text-white font-semibold"},G={class:"my-auto mx-auto"},K={class:"text-lg text-teal-04 my-auto"};const H=f({components:{SectionTitle:a(N,[["render",function(e,a,t,l,i,o){return w(),g("div",null,[v("div",L,[v("div",A,[v("div",G,b(e.section),1)]),v("h6",K,[h(e.$slots,"default")])])])}]]),Card:U,Button:t,Breadcrumb:D,GroupContainer:B,Input:l,Select:M,Checkbox:i,ExpandablePanel:R,MultipleEmailInput:$,TextEditor:I,PreviewEmail:q},async setup(){const{loading:e,actionShow:a,actionUpdate:t,actionUpdateStatus:l,state:i,stateUpdate:f,stateUpdateStatus:w}=n(),{data:g,actionShow:v,loading:b}=d(),{formData:h,loading:E,actionShow:k,actionUpdate:C}=r("review-email"),{emailBody:j,isPreview:S,previewedTemplate:P,loading:U,actionReviewEmail:D}=m(),B=_({payment_method:{},email_wording:{textinfo:"",initialTextinfo:"",subject:"",bcc:[]},web_link:"",is_rmail_on:0,valid:!1}),M=async()=>{if(await a(),i.value){const e=s(i.value);Object.assign(B,e),B.valid=""!==B.web_link,B.email_wording.initialTextinfo=B.email_wording.textinfo}};await M();const R=y(null),$={web_link:{required:u.withMessage("Link is required",p)},email_wording:{subject:{required:u.withMessage("Subject is required",p)}}},I=c($,B,{$lazy:!0}),q=async()=>await I.value.$validate()&&!I.value.$invalid;x((()=>i.value),(e=>{if(e){const a=s(e);Object.assign(B,a)}}),{deep:!0});const N=_({editor:O.exports.Editor,config:{htmlSupport:{allow:[{styles:!0,classes:!0}]}}}),L=["Digital Payouts","Bank Transfers & Virtual Cards","Cash & Manual Payouts","Other"],A=T((()=>Object.keys(B.payment_method).sort(((e,a)=>L.indexOf(e)-L.indexOf(a)))));return await Promise.all([v(),k()]),{loading:e,breadcrumb:[{text:"Settings",to:{name:"setting"}},{text:"Notifications",to:{name:"settingEmailTemplate",query:{filter:1}}},{text:"Edit Notification"}],data:B,update:async()=>{e.update=!0;if(!R.value.isEditorReady)return;if(!(await R.value.forceSave()))return;if(!q())return;const a={payment_methods:JSON.stringify(B.payment_method),textinfo:B.email_wording.textinfo,web_link:B.web_link,subject:B.email_wording.subject,bcc:B.email_wording.bcc};await t(a),"updated"===f.value&&(V.success("Data has been saved!"),await M()),e.update=!1},switchStatus:async e=>{await(async()=>{const e=1===B.is_rmail_on?"1":"0";await l({is_rmail_on:e}),"updated"===w.value&&V.success("1"===e?"Review Email Activated!":"Review Email Deactivated!")})()},items:[{name:"Days",value:"D"},{name:"Hours",value:"H"},{name:"Minutes",value:"M"}],filterNumber:o,validation:I,validate:q,formDataCompany:g,actionShowCompany:v,loadingCompany:b,handleBccUpdate:e=>{B.email_wording.bcc=e},formDataEmailTemplate:h,refTextEditor:R,handleUpdateEmailTemplateTheme:async()=>{await C((()=>{V({type:"success",message:"Review email theme updated"})}))},handlePreviewEmailTemplate:async()=>{j.value=B.email_wording.textinfo,await D()},loadingEmailTemplateTheme:E,loadingPreviewEmailTemplate:U,ckeditor:N,isPreview:S,previewedTemplate:P,handleCopyText:e=>{navigator.clipboard.writeText(e).then((()=>{V({type:"success",message:"Text copied to clipboard"})}))},sortedGroups:A,groupOrder:L,groupDescriptions:{"Digital Payouts":"Payouts made through apps, gift cards, and/or digital platforms.","Bank Transfers & Virtual Cards":"Payouts made through bank transfer and/or virtual cards.","Cash & Manual Payouts":"Payouts made through cash and/or checks.",Other:"All other payout methods that do no fit into the main categories."},handleResetEmailTemplate:()=>{B.email_wording.textinfo=B.email_wording.initialTextinfo}}}}),z={class:"flex justify-between items-center mb-8"},F={class:"space-y-6"},J={class:"md:ml-16 space-y-6"},W=["onClick"],Z={class:"col-span-4 md:col-span-1 flex gap-x-4 items-center"},Q={class:"font-semibold"},X={class:"col-span-4 md:col-span-3"},Y={class:"flex items-center gap-4"},ee=["src","alt"],ae={class:"flex flex-wrap sm:flex-nowrap items-center gap-2"},te={class:"md:ml-16"},le={class:"flex items-center gap-2 mb-2"},ie={class:"md:ml-16"},oe={class:"mb-3 mt-3 w-full md:w-1/2"},se={class:"mt-4 col-span-4"},ne={class:"flex items-center lg:ml-auto"},de={class:"flex"},re={class:"mr-2"},me=["onClick"];var ce=a(H,[["render",function(e,a,t,l,i,o){const s=E("Breadcrumb"),n=E("Button"),d=E("SectionTitle"),r=E("TableColumn"),m=E("Input"),c=E("Select"),u=E("Table"),p=E("ExpandablePanel"),f=E("Tooltip"),h=E("MultipleEmailInput"),_=E("Checkbox"),y=E("TextEditor"),x=E("Card"),T=E("PreviewEmail");return w(),g(S,null,[v("div",z,[k(s,{pageTitle:"Edit Notification",backTo:{name:"settingEmailTemplate",query:{filter:1}},items:e.breadcrumb},null,8,["items"]),k(n,{color:"teal",loading:e.loading.update,onClick:e.update},{default:C((()=>a[6]||(a[6]=[j("Save Changes")]))),_:1},8,["loading","onClick"])]),k(x,null,{default:C((()=>[v("div",F,[k(d,{section:"1"},{default:C((()=>a[7]||(a[7]=[j("Set Trigger")]))),_:1}),v("div",J,[a[9]||(a[9]=v("div",{class:"text-md"}," Set a trigger to automatically send review emails for offers that have been marked completed, based on the payout methods you offer (select all that apply). ",-1)),(w(!0),g(S,null,P(e.sortedGroups,(t=>(w(),g("div",{key:t},[k(p,null,{header:C((({toggle:l,isExpanded:i})=>[v("div",{onClick:l,class:"grid grid-cols-4 items-center cursor-pointer"},[v("div",Z,[a[8]||(a[8]=v("div",{class:"el-table__expand-icon"},[v("i",{class:"el-icon-arrow-right"})],-1)),v("p",Q,b(t),1)]),v("p",X,b(e.groupDescriptions[t]),1)],8,W)])),default:C((()=>[k(u,{data:e.data.payment_method[t]},{default:C((()=>[k(r,{label:"Payout Method",width:"200"},{default:C((e=>[v("div",Y,[v("img",{src:e.row.icon,class:"w-9",alt:e.row.name},null,8,ee),v("p",null,b(e.row.name),1)])])),_:1}),k(r,{label:"Trigger Time"},{default:C((a=>[v("div",ae,[k(m,{modelValue:a.row.review_delay,"onUpdate:modelValue":e=>a.row.review_delay=e,onKeypress:e.filterNumber,dense:"",class:"sm:w-14"},null,8,["modelValue","onUpdate:modelValue","onKeypress"]),k(c,{modelValue:a.row.delay_type,"onUpdate:modelValue":e=>a.row.delay_type=e,items:e.items,name:"name",by:"value",class:"w-56 sm:w-28",dense:""},null,8,["modelValue","onUpdate:modelValue","items"])])])),_:1})])),_:2},1032,["data"])])),_:2},1024)])))),128))]),k(d,{section:"2"},{default:C((()=>a[10]||(a[10]=[j("Set Review Link")]))),_:1}),v("div",te,[v("div",le,[a[13]||(a[13]=v("p",{class:"font-semibold"}," Link ",-1)),k(f,{placement:"top"},{content:C((()=>a[11]||(a[11]=[v("div",{style:{maxWidth:"300px"}}," Add the Url that directs customers to your business's review page, where they can leave feedback about their experiences. ",-1)]))),default:C((()=>a[12]||(a[12]=[v("i",{class:"material-icons cursor-default",style:{"line-height":"1!important"}}," info ",-1)]))),_:1})]),k(m,{modelValue:e.data.web_link,"onUpdate:modelValue":a[0]||(a[0]=a=>e.data.web_link=a),type:"text",class:"w-full md:w-1/2",view:e.validation.web_link.$invalid?"danger":"default"},null,8,["modelValue","view"]),(w(!0),g(S,null,P(e.validation.web_link.$errors,((e,a)=>(w(),g("small",{class:"text-red-base block",key:a},b(e.$message)+". ",1)))),128))]),k(d,{section:"3"},{default:C((()=>a[14]||(a[14]=[j("Set Email Template")]))),_:1}),v("div",ie,[k(m,{modelValue:e.formDataCompany.email_sender,"onUpdate:modelValue":a[1]||(a[1]=a=>e.formDataCompany.email_sender=a),class:"mb-4 w-full md:w-1/2",label:"From",disabled:""},null,8,["modelValue"]),v("div",oe,[a[15]||(a[15]=v("label",null,"BCC",-1)),k(h,{onEmailChange:e.handleBccUpdate,suggestion:!1,emails:e.data.email_wording.bcc},null,8,["onEmailChange","emails"])]),k(m,{modelValue:e.data.email_wording.subject,"onUpdate:modelValue":a[2]||(a[2]=a=>e.data.email_wording.subject=a),label:"Subject",class:"w-full md:w-1/2",view:e.validation.email_wording.subject.$invalid?"danger":"default"},null,8,["modelValue","view"]),(w(!0),g(S,null,P(e.validation.email_wording.subject.$errors,((e,a)=>(w(),g("small",{class:"text-red-base block",key:a},b(e.$message)+". ",1)))),128)),a[19]||(a[19]=v("label",{class:"block mb-2 mt-4"},"Logo",-1)),v("div",null,[k(_,{modelValue:e.formDataEmailTemplate.is_review_mail_logo_show,"onUpdate:modelValue":a[3]||(a[3]=a=>e.formDataEmailTemplate.is_review_mail_logo_show=a),onInput:e.handleUpdateEmailTemplateTheme,loading:e.loadingEmailTemplateTheme.update,type:"toggle",id:"logo",value:1,"value-off":0},{default:C((()=>a[16]||(a[16]=[v("span",{class:"font-medium"},"Show company logo",-1)]))),_:1},8,["modelValue","onInput","loading"])]),v("div",se,[k(y,{ref:"refTextEditor",modelValue:e.data.email_wording.textinfo,"onUpdate:modelValue":a[4]||(a[4]=a=>e.data.email_wording.textinfo=a),options:e.ckeditor},{toolbar:C((()=>[v("div",ne,[k(n,{color:"teal",loading:e.loadingEmailTemplateTheme.update||e.loadingPreviewEmailTemplate,onClick:e.handleResetEmailTemplate,disabled:e.data.email_wording.textinfo===e.data.email_wording.initialTextinfo,dense:"",view:"smooth"},{default:C((()=>a[17]||(a[17]=[v("i",{class:"material-icons mr-1"},"refresh",-1),j(" Reset ")]))),_:1},8,["loading","onClick","disabled"]),k(n,{class:"ml-2",onClick:e.handlePreviewEmailTemplate,loading:e.loadingPreviewEmailTemplate||e.loadingEmailTemplateTheme.update,color:"teal",view:"outlined",dense:""},{default:C((()=>a[18]||(a[18]=[v("i",{class:"material-icons mr-1"},"visibility",-1),j(" Preview ")]))),_:1},8,["onClick","loading"])])])),_:1},8,["modelValue","options"])]),k(u,{data:e.data.email_wording.sort_code,class:"mt-6"},{default:C((()=>[k(r,{label:"Code"},{default:C((a=>[v("div",de,[v("span",re,b(a.row.code),1),v("i",{class:"material-symbols-outlined text-lg text-teal-04",onClick:t=>e.handleCopyText(a.row.code)}," content_copy ",8,me)])])),_:1}),k(r,{prop:"description",label:"Description"})])),_:1},8,["data"])])])])),_:1}),k(T,{show:e.isPreview,"onUpdate:show":a[5]||(a[5]=a=>e.isPreview=a),body:e.previewedTemplate},null,8,["show","body"])],64)}]]),ue=f({setup(){const{genSuspense:a}=e();return()=>a(ce)}});export{ue as default};
