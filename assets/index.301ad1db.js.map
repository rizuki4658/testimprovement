{"version":3,"file":"index.301ad1db.js","sources":["../../src/views/buyback/local/create/Breadcrumb.vue","../../src/views/buyback/local/create/index.js"],"sourcesContent":["<template>\n  <Breadcrumb\n    class=\"mt-4 mb-8\"\n    pageTitle=\"Create Buyback\"\n    :backTo=\"{ name: 'buybackLocal' }\"\n    :items=\"breadcrumb\">\n    <template v-if=\"$slots.buttonStep\" #right>\n      <slot name=\"buttonStep\" />\n    </template>\n  </Breadcrumb>\n</template>\n\n<script>\nimport { defineComponent } from 'vue'\nimport Breadcrumb from 'components/Breadcrumb.vue'\n\nexport default defineComponent({\n  components: {\n    Breadcrumb\n  },\n  setup(props) {\n    const breadcrumb = [{\n      text: 'In-Store Buyback',\n      to: {\n        name: 'buybackLocal'\n      }\n    }, {\n      text: 'Create Buyback'\n    }]\n    return {\n      breadcrumb\n    }\n  }\n})\n</script>\n","import { defineComponent, h, ref } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { useSuspense } from 'composable/components'\nimport { useCreate } from 'composable/buyback'\nimport { usePaymentMethods, useCreate as useCreateCustomer } from 'composable/customer'\nimport Button from 'bbUi/components/button/button.vue'\nimport Card from 'bbUi/components/card/card.vue'\nimport Stepper from 'bbUi/components/stepper/stepper.vue'\nimport PaymentMethod from 'components/PaymentMethod.vue'\nimport Device from 'components/Device.vue'\nimport Customer from 'components/Customer'\nimport Breadcrumb from './Breadcrumb.vue'\nimport { ElMessage } from 'element-plus'\n\nexport default defineComponent({\n  components: {\n    PaymentMethod,\n    Device\n  },\n  setup() {\n    const router = useRouter()\n    const { genSuspense } = useSuspense()\n    const step = ref(1)\n    const { dataCustomer, dataPaymentMethod, dataDevice, loading, action: createBuyback } = useCreate('local')\n    const { state: statePaymentMethods, action: actionPaymentMethods } = usePaymentMethods()\n    const { data: newCustomerData, action: actionCreateCustomer, loading: loadingCustomer } = useCreateCustomer()\n    const isNewCustomer = ref(false)\n    const isPayoutSelected = ref(false)\n    const refPaymentMethod = ref(false)\n    const refCustomer = ref(false)\n\n    const selectCustomer = async (customer) => {\n      dataCustomer.customer_id = customer.customer_id || customer.id\n      dataCustomer.customer_email = customer.email\n      dataCustomer.customer_firstname = customer.first_name\n      dataCustomer.customer_lastname = customer.last_name\n      await actionPaymentMethods(customer.customer_id)\n      step.value = 2\n    }\n    const setNewCustomer = (data) => {\n      Object.assign(newCustomerData, data)\n    }\n    const registerNewCustomer = async () => {\n      const isValid = refCustomer.value.refChildComponent.validate && refCustomer.value.refChildComponent.validate() || false\n      if( isValid ){\n        await actionCreateCustomer(async (newCustomer) => {\n          await selectCustomer(newCustomer)\n        })\n      }\n    }\n    const genCustomerButton = () => {\n      return h(Button, {\n        color: 'teal',\n        loading: loadingCustomer.value,\n        onClick: () => registerNewCustomer()\n        },{\n          default: () => 'Continue'\n      })\n    }\n\n    const genStepComponent = () => {\n      if(step.value === 1) return [h(Customer, {\n        onData: setNewCustomer,\n        onChoose: selectCustomer,\n        ref: refCustomer,\n        choose: true,\n        onChange: (tab) => isNewCustomer.value = tab === 'CustomerForm'\n      }), h('div', {\n        class: ['flex', 'items-center', 'justify-end']\n      })]\n      else {\n        let genChild\n        if(step.value === 2) genChild = h(PaymentMethod, {\n          data: dataPaymentMethod.value,\n          items: statePaymentMethods.value,\n          ref: refPaymentMethod,\n          autoSelect: isPayoutSelected.value,\n          showTip: true,\n          'onUpdate:data': data => {\n            dataPaymentMethod.value = data\n          }\n        })\n        else if(step.value === 3) genChild = genSuspense({\n          component: Device,\n          props: {\n            data: dataDevice.value,\n            'onUpdate:data': data => {\n              dataDevice.value = data\n            }\n          },\n          buybackType: 'instore'\n        })\n\n        return [\n          h(Card, {\n            class: 'mb-4'\n          }, {\n            default: () => genChild\n          })\n        ]\n      }\n    }\n    const genButtonPrevButton = () => {\n      return h(Button, {\n        view: 'outlined',\n        color: 'teal',\n        onClick: () => {\n          if( step.value === 2 ) dataPaymentMethod.value = null\n          step.value--\n        }\n      }, {\n        default: () => 'Back'\n      })\n    }\n\n    const genButtonStepBread = () => {\n      if (step.value === 1) {\n         return isNewCustomer.value && genCustomerButton() || ''\n      }\n\n      if (step.value === 2) {\n        return h('div', {\n          class: 'flex items-center justify-between gap-x-2'\n        }, {\n          default: () => [\n            genButtonPrevButton(),\n            h(\n              Button,\n              {\n                color: 'teal',\n                loading: loading.value,\n                onClick: () => {\n                  isPayoutSelected.value = true\n                  const isValidated = (refPaymentMethod?.value?.refChildComponent?.validate && refPaymentMethod?.value.refChildComponent?.validate()) ?? false\n                  if( isValidated ) step.value++\n                }\n              },\n              {\n                default: () => 'Continue'\n              }\n            )\n          ]\n        })\n      }\n\n      if (step.value === 3) {\n        return h('div', {\n          class: 'flex items-center justify-between gap-x-2'\n        }, {\n          default: () => [\n            genButtonPrevButton(),\n            h(\n              Button,\n              {\n                color: 'teal',\n                loading: loading.value,\n                onClick: async () => {\n                  if( !dataDevice.value ){\n                    ElMessage({\n                      message: `Please add at least one item first`,\n                      type: 'warning'\n                    })\n                    return false\n                  }\n                  dataDevice.value = dataDevice.value.map((item) => {\n                    const isCustomProduct = item.device.is_custom == 1\n                    if(isCustomProduct) return ({\n                      category: item.device.category_name,\n                      category_id: item.device.category_id,\n                      product_name: item.product.name,\n                      condition: item.device.condition.name,\n                      condition_id: item.device.condition.id,\n                      price: item.device.price,\n                      qty: item.device.qty,\n                      is_mac: item.device.is_mac,\n                      imei_sn: item.device.imei_sn,\n                      is_custom: 1,\n                      notes: item.device.notes,\n                      ...(\n                        item.device &&\n                        item.device.bbb_diagnostic_result && {\n                          bbb_diagnostic_result: item.device.bbb_diagnostic_result\n                        }\n                      ),\n                      ...(item.device.custom_color ? ({\n                        custom_color: item.device.custom_color,\n                        color_id: null\n                      }) : ({\n                        color_id: item.device.color?.id || null\n                      }))\n                    })\n                    return ({\n                      unique_id: `${new Date().getTime()}_${item.product.id}_${item.device.condition.id}`,\n                      brand: item.product.brand ? item.product.brand : item.product.name,\n                      category: item.product.category ? item.product.category : item.product.name,\n                      product_id: item.product.id,\n                      condition_id: item.device.condition.id,\n                      price: item.device.price,\n                      qty: item.device.qty,\n                      is_mac: item.device.is_mac,\n                      imei_sn: item.device.imei_sn,\n                      is_custom: 0,\n                      notes: item.device.notes,\n                      ...(\n                          item.device &&\n                          item.device.bbb_diagnostic_result && {\n                            bbb_diagnostic_result: item.device.bbb_diagnostic_result\n                          }\n                        ),\n                      ...(item.device.golf_specs),\n                      ...(item.device.custom_color ? ({\n                        custom_color: item.device.custom_color,\n                        color_id: null\n                      }) : ({\n                        color_id: item.device.color?.id || null\n                      })),\n\t\t\t\t\t\t\t\t\t\t\tquestions: item.device.questions.reduce((previousValue, currentValue) => {\n\t\t\t\t\t\t\t\t\t\t\t\tif (typeof currentValue.answer_id === 'object') {\n\t\t\t\t\t\t\t\t\t\t\t\t\tcurrentValue.answer.forEach((answer) => previousValue.push({\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tquestion_id: currentValue.question_id,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tanswer_id: answer.id\n\t\t\t\t\t\t\t\t\t\t\t\t\t}))\n\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\telse if (!!currentValue.answer_id) previousValue.push({\n\t\t\t\t\t\t\t\t\t\t\t\t\tquestion_id: currentValue.question_id,\n\t\t\t\t\t\t\t\t\t\t\t\t\tanswer_id: currentValue.answer.id\n\t\t\t\t\t\t\t\t\t\t\t\t})\n\n\t\t\t\t\t\t\t\t\t\t\t\treturn previousValue\n\t\t\t\t\t\t\t\t\t\t\t}, [])\n                    })\n                  })\n                  await createBuyback(response => {\n                    router.push({\n                      name: 'buybackLocalDetail',\n                      params: {\n                        buybackId: response.data.box_id\n                      }\n                    })\n                  })\n                }\n              },\n              {\n                default: () => 'Continue'\n              }\n            )\n          ]\n        })\n      }\n\n      return [\n        h('span')\n      ]\n    }\n\n    return () => [\n      h(Breadcrumb, {}, {\n        buttonStep: () => genButtonStepBread(),\n      }),\n      h(Card, {}, {\n        default: () => [\n          h(Stepper, {\n            activeStep: step.value,\n            steps: ['Customer', 'Payout', 'Item'],\n            class: 'mb-16',\n            color: 'teal'\n          }),\n          genStepComponent()\n        ]\n      })\n    ]\n  }\n})\n"],"names":["defineComponent","components","Breadcrumb","setup","props","breadcrumb","text","to","name","_createBlock","_component_Breadcrumb","class","pageTitle","backTo","_createSlots","_","_withCtx","index","PaymentMethod","Device","[object Object]","router","useRouter","genSuspense","useSuspense","step","ref","dataCustomer","dataPaymentMethod","dataDevice","loading","action","createBuyback","useCreate","state","statePaymentMethods","actionPaymentMethods","usePaymentMethods","data","newCustomerData","actionCreateCustomer","loadingCustomer","useCreateCustomer","isNewCustomer","isPayoutSelected","refPaymentMethod","refCustomer","selectCustomer","async","customer","customer_id","id","customer_email","email","customer_firstname","first_name","customer_lastname","last_name","value","setNewCustomer","Object","assign","genCustomerButton","h","Button","color","onClick","refChildComponent","validate","newCustomer","registerNewCustomer","default","genStepComponent","Customer","onData","onChoose","choose","onChange","tab","genChild","items","autoSelect","showTip","onUpdate:data","component","buybackType","Card","genButtonPrevButton","view","genButtonStepBread","_d","_b","_a","_c","_u","message","type","map","item","device","is_custom","__spreadValues","category","category_name","category_id","product_name","product","condition","condition_id","price","qty","is_mac","imei_sn","notes","bbb_diagnostic_result","custom_color","color_id","unique_id","Date","getTime","brand","product_id","golf_specs","questions","reduce","previousValue","currentValue","answer_id","answer","forEach","push","question_id","response","params","buybackId","box_id","buttonStep","Stepper","activeStep","steps"],"mappings":"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"}