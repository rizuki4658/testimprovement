var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,r=(t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,i=(e,t)=>{for(var a in t||(t={}))l.call(t,a)&&r(e,a,t[a]);if(s)for(var a of s(t))o.call(t,a)&&r(e,a,t[a]);return e},n=(e,s)=>t(e,a(s));import{C as u}from"./card.0f43ecfb.js";import{j as d,g as c,f as m,a5 as p,h as f,r as y,y as v,s as b,m as g,o as _,t as h,B as x,D as k,ap as S,U as $,w,I as C,K as I,n as O,a3 as V,a1 as T,a2 as j,S as L,F as U,_ as B,O as P,W as D,z as A,$ as R,A as E}from"./vendor.9695fe57.js";import{z as q,X as M,u as F,h as N,f as z,e as J,b as Y,ad as G,_ as W,y as K,r as X,d as H,a4 as Q,P as Z,g as ee}from"./index.73ae30fa.js";import{F as te}from"./FilterDropdown.6c73673f.js";import{C as ae,a as se}from"./CustomTableExport.fe9a0e1f.js";import{f as le}from"./date.f86face7.js";import{a as oe}from"./dymo.843c8f66.js";import{S as re,B as ie}from"./BulkStatusesForm.97b83b87.js";import{B as ne}from"./BTable.3e5ccc4b.js";import{_ as ue}from"./tab.74a5b4bb.js";import{S as de}from"./SelectableChip.993cede8.js";import{_ as ce}from"./badge.809b6147.js";import{_ as me}from"./BuybackNotesWarning.ab08dc78.js";import{c as pe}from"./status.6f59bf91.js";import{_ as fe}from"./ExpeditedIcon.e915b9ec.js";import{u as ye}from"./notes.6c148e05.js";import"./BDropdown.85a0a8cb.js";import"./index.f40e4a9e.js";import"./index.6b6f6369.js";import"./vue-draggable-next.esm-bundler.4467bcb1.js";import"./fieldset.1864b72f.js";import"./attention.c511405b.js";import"./Table.76db6025.js";const ve=d("easyOffer",{state:()=>({order:{data:null,isLoading:!1},orderStatus:{isLoading:!1,result:null},statusOptions:{isLoading:!1,result:null},export:{isLoading:!1,extension:"csv"},filters:{buyback:"easy-offer",page:1,limit:10,search:"",sort_by:"",order_by:"",date:null,from:"",to:"",is_require_file:0,is_expired:0,barcode:"",referral_source:null,item_condition:[],selling_type:[],payout_method:[],buyback_source:[],shipping_courier:[]},loading:{print:{address_label:!1},bulkStatus:!1,delete:!1,restore:!1,updateStatus:!1,exportCsv:!1,exportPaypallMass:!1,exportCsvTremendous:!1,exportCsvDots:!1},customTable:{data:null,isLoading:!1},referralSource:{data:null,isLoading:!1},conditions:{data:null,isLoading:!1},payoutMethods:{data:null,isLoading:!1},couriers:{data:null,isLoading:!1},fileRequired:{data:null,isLoading:!1}}),actions:{$clearFilters(){this.filters={buyback:"easy-offer",page:1,limit:10,search:"",date:null,from:"",to:"",sort_by:"",order_by:"",is_expired:0,barcode:"",referral_source:null,item_condition:[],selling_type:[],payout_method:[],buyback_source:[],shipping_courier:[]}},async $getOrderStatus(e){this.$state.orderStatus.isLoading=!0;try{const t=await q({url:"v1/pos/order/order-status",method:"get",params:i({status_id:e},this.filters)});return this.$state.orderStatus.result=t,t}catch(t){return console.log(t),null}finally{this.$state.orderStatus.isLoading=!1}},async $getStatusOptions(){try{this.$state.statusOptions.isLoading=!0;const e=await q({url:"/v1/pos/order/order-status",method:"get",params:{type:"option",buyback:"easy-offer"}});return this.$state.statusOptions.result=e,e}catch(e){return console.log(e),null}finally{this.$state.statusOptions.isLoading=!1}},async $getCustomTable(e){try{this.$state.customTable.isLoading=!0;const t=await q({url:"/v1/pos/custom-table",method:"get",params:{type_table:"easy-offer",status:e}});return this.$state.customTable.data=t,t}catch(t){return console.log(t),null}finally{this.$state.customTable.isLoading=!1}},async $getReferralSource(e){try{this.$state.referralSource.isLoading=!0;const t=await q({url:"/v1/pos/easy-offer/filter/referral-source",method:"get",params:e});return this.$state.referralSource.data=t.map((e=>e.name)),t}catch(t){return console.log(t),null}finally{this.$state.referralSource.isLoading=!1}},async $getItemCondition(e){try{this.$state.conditions.isLoading=!0;const t=await q({url:"/v1/pos/easy-offer/filter/item-condition",method:"get",params:e});return this.$state.conditions.data=t.map((e=>e.name)),t}catch(t){return console.log(t),null}finally{this.$state.conditions.isLoading=!1}},async $getPayoutMethod(){try{this.$state.payoutMethods.isLoading=!0;const e=await q({url:"/v1/pos/easy-offer/payment-method",method:"get"});return this.$state.payoutMethods.data=e,e}catch(e){return console.log(e),null}finally{this.$state.payoutMethods.isLoading=!1}},async $getShippingCourier(e){try{this.$state.couriers.isLoading=!0;const t=await q({url:"/v1/pos/easy-offer/filter/courier",method:"get",params:e});return this.$state.couriers.data=t.map((e=>e.name)),t}catch(t){return console.log(t),null}finally{this.$state.couriers.isLoading=!1}},async $getOrder(e){const t=Object.assign({},this.$state.filters);t.from=t.date&&le(t.date[0])||null,t.to=t.date&&le(t.date[1])||null,delete t.date;try{this.$state.order.isLoading=!0;const a=await q({url:"v2/pos/easy-offer",method:"get",params:i({status_id:e},t)});return this.$state.order.data=a,a}catch(a){return console.log(a),null}finally{this.$state.order.isLoading=!1}},async $actionBatchPrintAddressLabel(e){try{this.$state.loading.print.address_label=!0;const t=JSON.stringify(e.map((e=>e.offer_id))),a=Object.assign({},{ids:t}),s=await q({url:"/v1/pos/print/batch-address-label",method:"post",data:a});let l=[];s.forEach(((e,t)=>{l[t]={fullname:"",addressComponent:""},l[t].fullname=`${e.billing_firstname||""} ${e.billing_lastname||""}`,l[t].address_component=`${e.billing_address1?e.billing_address1.toUpperCase():""}\n${e.billing_city?e.billing_city.toUpperCase():""} ${e.billing_state?e.billing_state.toUpperCase():""} ${e.billing_zip?e.billing_zip.toUpperCase():""}`,l[t].imb=e.imb||""})),oe(l)}finally{this.$state.loading.print.address_label=!1}},async $actionDelete(e){try{this.$state.loading.delete=!0;return await q({url:"/v1/pos/order/delete/bulk",method:"delete",data:{selected_order_id:JSON.stringify(e)}})}finally{this.$state.loading.delete=!1}},async $actionRestore(e){try{this.$state.loading.restore=!0;return await q({url:"/v1/pos/order/restore/bulk",method:"post",data:{selected_order_id:JSON.stringify(e)}})}finally{this.$state.loading.restore=!1}},async $actionUpdate(e){this.$state.loading.bulkStatus=!0;try{const t=e.transaction_id.reduce(((e,t)=>(e[t.box_id]=t.transaction_id,e)),{}),a=Object.assign({},n(i({},e),{transaction_id:JSON.stringify(t)}));return await q({url:"/v1/pos/order/bulk-status",method:"post",data:n(i({},a),{_method:"PUT"})})}finally{this.$state.loading.bulkStatus=!1}},async $actionExportCsv(e){const t=i({},this.$state.filters);delete t.limit,delete t.page;try{this.$state.loading.exportCsv=!0;return await q({url:"/v1/pos/order/generate-csv",method:"get",params:n(i(i({},e),t),{buyback_type:4,extension:this.$state.export.extension}),responseType:"blob"})}finally{this.$state.loading.exportCsv=!1}},async $actionExportCSVTremendous(){try{this.$state.loading.exportCsvTremendous=!0;const e=await q({url:"/v1/pos/order/tremendous-failures/download",method:"get",params:{buyback_type:4}});return M(e,"CSV Tremendous","text/csv"),e}finally{this.$state.loading.exportCsvTremendous=!1}},async $actionExportCSVDOTS(e={},t="CSV DOTS"){try{this.$state.loading.exportCsvDots=!0;const a=await q({url:"/v1/pos/order/masspay",method:"get",params:n(i({},e),{buyback_type:4}),responseType:"blob"});return M(a,`${t} ${e.delivery_method||""}`,`text/${e.extension}`),a}catch(a){return console.log(a),null}finally{this.$state.loading.exportCsvDots=!1}},async $actionExportPaypalMass(e,t,a){var s;try{loading.exportPaypalMass=!0;const l={status_id:e,payment_method:(null==(s=a.payouts)?void 0:s.map((e=>e.name)))||data.payment_method,is_affiliate:0,is_expired:t,limit:data.limit,buyback_type:"local"===buyback?2:null,extension:a.extension},o=await q({url:"/v1/pos/order/paypal-mass",method:"get",params:l,responseType:"blob"});M(o,"Payouts Info",l.payment_method.length>1?"application/zip":`text/${a.extension}`)}finally{loading.exportPaypalMass=!1}},async $actionGetFileRequired(){try{this.$state.fileRequired.isLoading=!0;const e=await q({url:"/v1/pos/easy-offer/required-file-upload",method:"get"});return this.$state.fileRequired.data=e.is_required_file_easy_offer,e}finally{this.$state.fileRequired.isLoading=!1}},async $actionUpdateFileRequired(e){try{this.$state.fileRequired.isLoading=!0;return await q({url:"/v1/pos/easy-offer/required-file-upload",method:"put",data:e})}finally{this.$state.fileRequired.isLoading=!1}}}}),be={class:"flex flex-col xl:flex-row"},ge={class:"flex flex-wrap flex-grow xl:mr-3 xl:mb-0 mb-3 my-2"},_e={key:0,class:"flex-auto mr-2 my-2"},he={class:"flex-auto mr-2 my-2"},xe={class:"xl:flex-auto mr-2 my-2"},ke={class:"text-grey-03"},Se={key:0},$e={class:"flex flex-col p-3"},we=["onClick"],Ce={class:"inline-flex flex-wrap xl:flex-grow-0 flex-grow items-center my-2"},Ie={key:0},Oe=["onClick"],Ve={key:1,class:"opacity-50"},Te=["onClick"],je={key:1},Le={class:"flex flex-start flex-row mb-4"},Ue=["onClick"],Be={key:0,class:"inline-block mx-2"},Pe={__name:"EasyOfferTableFilters",props:{table:{type:Object,default:()=>({})},tabStatuses:{type:Array,default:()=>[]}},emits:["update:customTable"],setup(e,{emit:t}){var a,s;const l=e,o=t,{me:r,dateByTimezone:i}=F(),n=ve(),{exportDataOffersProgress:u,resetExportDataOffersProgress:d}=N(),P=c((()=>{var e;return(null==(e=n.$state.referralSource)?void 0:e.data)||[]})),D=c((()=>{var e;return(null==(e=n.$state.conditions)?void 0:e.data)||[]})),A=c((()=>{var e;return(null==(e=n.$state.payoutMethods)?void 0:e.data)||[]})),R=c((()=>{var e;return(null==(e=n.$state.couriers)?void 0:e.data)||[]})),{buyback:E}=re,q=m(!1),M=m(!1),W=m(!1),K=c((()=>["all","1","2"].includes(Q.params.statusId))),X=m("1"==(null==(a=l.table)?void 0:a.is_csv_download)),H=m("1"==(null==(s=l.table)?void 0:s.is_csv_download)),Q=p(),Z=c((()=>{var e,t;return[{id:"payment_method",name:"Payout Method",value:n.filters.payment_method?n.filters.payment_method.join(", "):null,default:[]},{id:"date",name:"Date",value:n.filters.date?`${f(n.filters.date[0]).format((null==(e=r.value)?void 0:e.date_format)||"")} - ${f(n.filters.date[1]).format((null==(t=r.value)?void 0:t.date_format)||"")}`:null,default:null},{id:"shipping_courier",name:"Courier",value:n.filters.shipping_courier?n.filters.shipping_courier.join(", "):null,default:[]},{id:"buyback_source",name:"Buyback Source",value:n.filters.buyback_source?n.filters.buyback_source.join(", "):null},{id:"referral_source",name:"Referral Source",value:n.filters.referral_source,default:null},{id:"item_condition",name:"Item Condition",value:n.filters.item_condition?n.filters.item_condition.join(", "):null,default:[]}]})),ee=c((()=>Z.value.filter((e=>e.value)).length>0)),oe=e=>{e&&"date"===e.key&&De()},ie=async e=>{(e=>{if(!n.filters.hasOwnProperty(e.id))return!1;n.filters[e.id]=e.default})(e),await ne(),ce.value&&(W.value=!1)},ne=async()=>{M.value=!0,W.value=!0,o("update:customTable"),M.value=!1},ue=async()=>{M.value=!0,W.value=!1,(()=>{for(let e of Z.value)n.filters[e.id]=e.default})(),o("update:customTable"),M.value=!1},de=[{name:"Select Date",key:"date",count_selected:0},{name:"Item Condition",key:"condition",count_selected:(n.filters.item_condition||[]).length||0},{name:"Referral Source",key:"referral_source",count_selected:0},{name:"Payout Method",key:"payout_method",count_selected:(n.filters.payment_method||[]).length||0},{name:"Source",key:"source",count_selected:(n.filters.buyback_source||[]).length||0},{name:"Courier",key:"courier",count_selected:n.filters.shipping_courier.length||[]}],ce=c((()=>0===Z.value.filter((e=>!!e.value)).length)),me=()=>n.order.isLoading||n.orderStatus.isLoading,pe=e=>"date"===e.key,fe=m(null),ye=y({disabledDate:e=>e.getTime()>i.value.getTime()}),Pe=c((()=>{const e={from:null,to:null},[t,a]=n.filters.date||[];return!t||!a||(e.from=le(t)||null,e.to=le(a)||null),e})),De=()=>{q.value?q.value=!1:(q.value=!0,fe.value.focus())},Ae=async()=>{o("update:customTable")},Re=c((()=>{var e,t,a,s,o,r;const i="active"!==(null==(t=null==(e=Q.params.category)?void 0:e.toLowerCase)?void 0:t.call(e)),n="expired"===Q.params.subStatusId;if(i)return"Archive";if(n)return"Expired";if("all"===Q.params.statusId)return"All";if(Q.params.statusId&&Q.params.subStatusId){const e=null==(a=l.tabStatuses)?void 0:a.find((e=>e.id==Q.params.statusId));if(!e)return"";const t=e.sub;return t&&(null==(s=t.find((e=>e.id==Q.params.subStatusId)))?void 0:s.short_name)||""}return(null==(r=null==(o=l.tabStatuses)?void 0:o.find((e=>e.id==Q.params.statusId)))?void 0:r.short_name)||""})),Ee=c((()=>{const e=Re.value,[t,a]=n.filters.date||[];if(!(t&&a))return e;return`${e} ${t?le(t):""} to ${a?le(a):""}`})),qe=c((()=>n.loading.exportCsv||n.loading.exportPaypallMass||n.loading.exportCsvTremendous||n.loading.exportCsvDots)),Me=async e=>{n.export.extension=(null==e?void 0:e.extension)||(null==e?void 0:e.ext)||e,e.isTremendous?await n.$actionExportCSVTremendous():(await n.$actionExportCsv({status_id:Q.params.subStatusId?Q.params.subStatusId:Q.params.statusId||Q.params.category,from:Pe.value.from,to:Pe.value.to,is_grouped:null==e?void 0:e.grp}),B({type:"success",message:"Your export data request is processing, it will be delivered to your email when the process is completed."}),X.value=!0,n.export.extension="csv")},Fe=async e=>{const t={payment_method:e.payouts.map((e=>e.name)),delivery_method:e.dots,extension:e.extension};await n.$actionExportCSVDOTS(t,`${e.extension.toUpperCase()} DOTS`),B({type:"success",message:"Your export data has been sent"}),H.value=!0},Ne=async e=>{await n.$actionExportPaypalMass(Q.params.statusId,"expired"===Q.params.category?"1":"0",e)};return v((()=>u.value),(async e=>{var t,a;const s=(null==(t=null==Q?void 0:Q.params)?void 0:t.subStatusId)&&""!==Q.params.subStatusId.trim()?Q.params.subStatusId:null==(a=null==Q?void 0:Q.params)?void 0:a.statusId;"easy-offer"===(null==e?void 0:e.type)&&1===(null==e?void 0:e.status_export)&&(null==e?void 0:e.status_id)===s&&(X.value=0!=(null==e?void 0:e.is_csv_download),await b(),d())}),{deep:!0,immediate:!0}),v((()=>JSON.stringify(l.table)),(e=>{X.value=1==e})),(e,t)=>{const a=g("DatePicker"),s=g("Popover"),l=g("DropdownItem"),o=g("DropdownMenu"),r=g("Dropdown");return _(),h(T,null,[x("div",be,[x("div",ge,[K.value?(_(),h("div",_e,[k(z,{modelValue:S(n).filters.barcode,"onUpdate:modelValue":t[0]||(t[0]=e=>S(n).filters.barcode=e),placeholder:"Scan barcode/tracking #",block:"",icon:""},null,8,["modelValue"])])):$("",!0),x("div",he,[k(z,{modelValue:S(n).filters.search,"onUpdate:modelValue":t[1]||(t[1]=e=>S(n).filters.search=e),placeholder:"Search Everything",block:"",icon:""},{icon:w((()=>t[9]||(t[9]=[x("span",{class:"material-icons"},"search",-1)]))),_:1},8,["modelValue"])]),x("div",xe,[k(te,{onItemClick:oe,onApplyFilter:ne,onResetFilter:ue,onCollapse:t[7]||(t[7]=e=>q.value=!1),filters:de,"item-loading":me,"item-disable-hover":pe,loading:M.value,"reset-disabled":!W.value},{label:w((({item:e})=>[x("div",null,[x("p",ke,[C(I(e.name)+" ",1),e.meta.count_selected>0?(_(),h("span",Se," ("+I(e.meta.count_selected)+") ",1)):$("",!0)]),"date"===e.key?(_(),O(a,V({key:0,modelValue:S(n).filters.date,"onUpdate:modelValue":t[2]||(t[2]=e=>S(n).filters.date=e)},ye,{placement:"right",type:"daterange",ref_key:"filterDateRef",ref:fe,class:"hide-picker"}),null,16,["modelValue"])):$("",!0)])])),dropdown:w((({filter:e,collapse:a})=>[x("div",$e,["condition"===e.key?(_(!0),h(T,{key:0},j(D.value,(e=>(_(),O(J,{modelValue:S(n).filters.item_condition,"onUpdate:modelValue":t[3]||(t[3]=e=>S(n).filters.item_condition=e),key:e,value:e,color:"teal",class:"my-2 font-normal"},{default:w((()=>[C(I(e),1)])),_:2},1032,["modelValue","value"])))),128)):$("",!0),"referral_source"===e.key?(_(!0),h(T,{key:1},j(P.value,((e,t)=>(_(),h("a",{onClick:L((()=>{S(n).filters.referral_source=e,a()}),["prevent"]),key:t,href:"",class:U(["text-grey-03","p-3","block","hover:bg-grey-lighten",S(n).filters.referral_source===e&&"font-semibold"])},[x("p",null,I(e),1)],10,we)))),128)):$("",!0),"payout_method"===e.key?(_(!0),h(T,{key:2},j(A.value,(e=>(_(),O(J,{modelValue:S(n).filters.payment_method,"onUpdate:modelValue":t[4]||(t[4]=e=>S(n).filters.payment_method=e),key:e.id,value:e.name,color:"teal",class:"my-2 font-normal"},{default:w((()=>[C(I(e.name),1)])),_:2},1032,["modelValue","value"])))),128)):$("",!0),"source"===e.key?(_(!0),h(T,{key:3},j(S(E),(e=>(_(),O(J,{modelValue:S(n).filters.buyback_source,"onUpdate:modelValue":t[5]||(t[5]=e=>S(n).filters.buyback_source=e),key:e.value,value:e.value,color:"teal",class:"my-2 font-normal"},{default:w((()=>[C(I(e.name),1)])),_:2},1032,["modelValue","value"])))),128)):$("",!0),"courier"===e.key?(_(!0),h(T,{key:4},j(R.value,(e=>(_(),O(J,{modelValue:S(n).filters.shipping_courier,"onUpdate:modelValue":t[6]||(t[6]=e=>S(n).filters.shipping_courier=e),key:e,value:e,color:"teal",class:"my-2 font-normal"},{default:w((()=>[C(I(e),1)])),_:2},1032,["modelValue","value"])))),128)):$("",!0)])])),_:1},8,["loading","reset-disabled"])])]),x("div",Ce,[k(ae,{onUpdateTable:Ae,type:"easy-offer",status:S(Q).params.subStatusId||S(Q).params.statusId||S(Q).params.category,class:"mr-2"},null,8,["status"]),k(se,{modelValue:S(n).export.extension,"onUpdate:modelValue":t[8]||(t[8]=e=>S(n).export.extension=e),onExport:Me,onExportPayout:Ne,onExportDots:Fe,loading:qe.value,"export-filename":Ee.value,"with-payout":7==S(Q).params.statusId,payouts:A.value,class:"w-max",grouped:""},{default:w((({openModal:e,openModalPayout:a})=>[7==S(Q).params.statusId?(_(),h("div",Ie,[k(r,{trigger:"click",size:"medium",placement:"bottom-end","hide-on-click":!0,disabled:qe.value||S(n).loading.exportCsv},{dropdown:w((()=>[k(o,null,{default:w((()=>[k(l,null,{default:w((()=>[k(s,{width:"400",trigger:"hover",disabled:!X.value},{reference:w((()=>[X.value?(_(),h("span",Ve,"Current Table View")):(_(),h("span",{key:0,onClick:t=>e()},"Current Table View",8,Oe))])),default:w((()=>[t[11]||(t[11]=x("div",{class:"w-full h-full flex justify-center items-center"},[x("span",{class:"whitespace-pre-line"}," Export data is being processed ")],-1))])),_:2},1032,["disabled"])])),_:2},1024),k(l,null,{default:w((()=>[x("span",{onClick:a},"Only Payout Info",8,Te)])),_:2},1024),k(l,{onClick:t=>e(!0)},{default:w((()=>t[12]||(t[12]=[C("Tremendous")]))),_:2},1032,["onClick"])])),_:2},1024)])),default:w((()=>[k(Y,{loading:qe.value||S(n).loading.exportCsv,color:"white"},{default:w((()=>t[10]||(t[10]=[x("div",{class:"flex items-center justify-between gap-x-2"},[x("span",{class:"text-grey-03 text-base"},[x("i",{class:"material-icons"},"download"),C(" Export ")]),x("i",{class:"material-icons text-grey-03"},"arrow_drop_down")],-1)]))),_:1},8,["loading"])])),_:2},1032,["disabled"])])):(_(),h("div",je,[k(s,{width:"400",trigger:"hover",disabled:!X.value},{reference:w((()=>[x("div",null,[k(Y,{onClick:t=>e(),color:"white",block:"",loading:qe.value||S(n).loading.exportCsv,disabled:X.value},{default:w((()=>t[13]||(t[13]=[x("span",{class:"text-grey-03"},[x("i",{class:"material-icons text-lg"}," file_download "),C(" Export ")],-1)]))),_:2},1032,["onClick","loading","disabled"])])])),default:w((()=>[t[14]||(t[14]=x("div",{class:"w-full h-full flex justify-center items-center"},[x("span",{class:"whitespace-pre-line"}," Export data is being processed ")],-1))])),_:2},1032,["disabled"])]))])),_:1},8,["modelValue","loading","export-filename","with-payout","payouts"])])]),x("div",Le,[W.value?(_(),h(T,{key:0},[(_(!0),h(T,null,j(Z.value,((e,t)=>(_(),h("div",{class:"inline-block",key:t},[e.value?(_(),O(Y,{key:0,color:"grey",view:"smooth",dense:"",class:"mx-1"},{default:w((()=>[x("b",null,I(e.name)+":",1),C(" "+I("Referral Source"===e.name?e.value:S(G)(e.value)),1),x("i",{class:"material-icons text-sm ml-2",onClick:t=>ie(e)},"close",8,Ue)])),_:2},1024)):$("",!0)])))),128)),ee.value?(_(),h("div",Be,[k(Y,{onClick:ue,color:"teal",view:"smooth",dense:""},{default:w((()=>t[15]||(t[15]=[x("i",{class:"material-icons text-sm mr-1"},"close",-1),C("Clear all ")]))),_:1})])):$("",!0)],64)):$("",!0)])],64)}}};const De={class:"flex flex-row items-center justify-center"},Ae={class:"block"},Re={key:0,class:"p-3 ml-4 bg-teal-04 text-white rounded-full flex items-center justify-center box-border",style:{"min-width":"3rem"}},Ee={key:1,class:"flex flex-col md:flex-row mb-6"},qe={class:"flex flex-wrap items-center"},Me={class:"ml-2"};var Fe=W({__name:"EasyOfferTab",props:{currentTabId:{type:[String,Number],required:!0},statusId:{type:[String,Number],default:"all"},tabStatuses:{type:Array,default:()=>[]}},setup(e){const t=e,a=p(),s=P(),l=c((()=>[K({id:0,short_name:"Active"},"easyOfferTab",{category:"active",statusId:t.statusId||"all"},"id","short_name"),K({id:2,short_name:"Archive"},"easyOfferTab",{category:"archive"},"id","short_name")])),o=c((()=>{var e;return[K({id:0,short_name:"All"},"easyOfferTab",{statusId:"all"},"id","short_name")].concat(null==(e=t.tabStatuses)?void 0:e.map((e=>n(i({},K(e,"easyOfferTab",{statusId:e.id},"id","short_name")),{data:e}))))})),r=c((()=>{const e=X(t.tabStatuses).find((e=>1001==e.id)),a=e?e.sub:null;return a?a.map((e=>"Abandoned Buyback"===e.status_name?n(i({},e),{color:"orange",subStatusId:e.id}):"Active Leads"===e.status_name?n(i({},e),{color:"green",subStatusId:e.id}):"Expired"===e.status_name?n(i({},e),{color:"red",subStatusId:"expired"}):n(i({},e),{color:"teal",subStatusId:e.id}))):[]})),u=e=>{s.push({name:"easyOfferTab",params:{statusId:a.params.statusId,category:a.params.category,subStatusId:e}})};return(t,s)=>(_(),h(T,null,[k(ue,{view:"smooth",color:"teal",class:"mt-14 md:m-0",items:l.value,"active-id":e.currentTabId},null,8,["items","active-id"]),"active"===S(a).params.category?(_(),O(ue,{key:0,class:"mt-4",view:"smooth",items:o.value},{title:w((e=>{var t,s;return[x("div",De,[x("span",Ae,I(e.item.name),1),"customerDetail"===S(a).name||[6,3].includes(null==(t=e.item.data)?void 0:t.id)||["all","test order"].includes(e.item.name.toLowerCase())?$("",!0):(_(),h("div",Re,I(null==(s=e.item.data)?void 0:s.total),1))])]})),_:1},8,["items"])):$("",!0),1001==S(a).params.statusId?(_(),h("div",Ee,[k(de,{modelValue:S(a).params.subStatusId,onChange:u,"color-key":"color",by:"subStatusId",name:"status_name",items:r.value,class:"substatus-chip"},{label:w((({item:e})=>[x("div",qe,[x("span",Me,I(e.status_name),1),null!==e.total?(_(),h("span",{key:0,class:U(["substatus-counter","flex","items-center","justify-center","p-3","bg-grey-03","rounded-full","text-white","ml-4",e.color&&`--color-${e.color}`]),style:{"min-width":"3rem"}},I(e.total),3)):$("",!0)])])),_:1},8,["modelValue","items"])])):$("",!0)],64))}},[["__scopeId","data-v-5261c153"]]);const Ne={__name:"BulkStatusModal",props:{modelValue:{type:Boolean,default:!1},bulkStatusData:{type:Object,required:!0},stateOptionStatuses:{type:Array,default:()=>[]},isBulkStatusLargeModal:{type:Boolean,default:!1},bulkStatusLoading:{type:Boolean,default:!1}},emits:["update:modelValue","update:bulkStatusData","close","updateStatus"],setup(e,{emit:t}){const a=t,s=m(null),l=()=>{a("close")},o=()=>{s.value.validate&&s.value.validate()&&a("updateStatus")},r=e=>{a("update:bulkStatusData",e)};return(t,a)=>(_(),O(H,{"model-value":e.modelValue,"onUpdate:modelValue":a[0]||(a[0]=e=>t.$emit("update:modelValue",e)),title:"Change Status",onClose:l,size:e.isBulkStatusLargeModal?"lg":"sm"},{default:w((()=>[k(ie,{ref_key:"refBulkStatusForm",ref:s,statuses:e.stateOptionStatuses,data:e.bulkStatusData,"onUpdate:data":r},null,8,["statuses","data"])])),footer:w((()=>[k(Y,{color:"teal",onClick:o,loading:e.bulkStatusLoading},{default:w((()=>a[1]||(a[1]=[C("Save")]))),_:1},8,["loading"])])),_:1},8,["model-value","size"]))}},ze={class:"py-10"},Je={class:"mt-8 mb-10"},Ye={class:"mb-4 text-center"},Ge={key:0},We={class:"text-center mb-4"},Ke={key:0},Xe={class:"text-center"},He={__name:"BulkArchiveModal",props:{modelValue:{type:Boolean,default:!1},selectedBuybacks:{type:Array,default:()=>[]}},emits:["update:modelValue","archive"],setup(e,{emit:t}){const a=t,s=()=>{a("update:modelValue",!1)},l=()=>{a("archive"),a("update:modelValue",!1)};return(t,a)=>(_(),O(H,{size:"xs","model-value":e.modelValue,"onUpdate:modelValue":a[0]||(a[0]=e=>t.$emit("update:modelValue",e)),title:"Archive Offer","hide-header":"","hide-footer":"",onClose:s},{default:w((()=>[x("div",ze,[a[6]||(a[6]=x("img",{class:"mb-10 mx-auto",src:Q,alt:"Success Icon"},null,-1)),x("div",Je,[x("h5",Ye,[C("Archiving "+I(e.selectedBuybacks.length)+" Offer",1),e.selectedBuybacks.length>1?(_(),h("span",Ge,"s")):$("",!0)]),x("p",We,[C(" Are you sure you want to archive "+I(e.selectedBuybacks.length)+" offer",1),e.selectedBuybacks.length>1?(_(),h("span",Ke,"s")):$("",!0),a[1]||(a[1]=C(" ? ")),a[2]||(a[2]=x("br",null,null,-1)),a[3]||(a[3]=C(' Once archived offers can be removed from the "Archived" menu '))])]),x("div",Xe,[k(Y,{view:"outlined",color:"teal",class:"bg-white",onClick:s},{default:w((()=>a[4]||(a[4]=[C("Cancel")]))),_:1}),k(Y,{color:"orange",class:"ml-3",onClick:l},{default:w((()=>a[5]||(a[5]=[C("Yes, Archive")]))),_:1})])])])),_:1},8,["model-value"]))}},Qe={class:"py-10"},Ze={class:"mt-8 mb-10"},et={class:"mb-4 text-center"},tt={key:0},at={class:"text-center mb-4"},st={key:0},lt={class:"text-center"},ot={__name:"BulkUnarchiveModal",props:{modelValue:{type:Boolean,default:!1},selectedBuybacks:{type:Array,default:()=>[]}},emits:["update:modelValue","restore"],setup(e,{emit:t}){const a=t,s=()=>{a("update:modelValue",!1)},l=()=>{a("restore"),a("update:modelValue",!1)};return(t,a)=>(_(),O(H,{size:"xs","model-value":e.modelValue,"onUpdate:modelValue":a[0]||(a[0]=e=>t.$emit("update:modelValue",e)),title:"Restore Order","hide-header":"","hide-footer":"",onClose:s},{default:w((()=>[x("div",Qe,[a[5]||(a[5]=x("img",{class:"mb-10 mx-auto",src:Q,alt:"Success Icon"},null,-1)),x("div",Ze,[x("h5",et,[C("Restoring "+I(e.selectedBuybacks.length)+" Order",1),e.selectedBuybacks.length>1?(_(),h("span",tt,"s")):$("",!0)]),x("p",at,[C(" Are you sure you want to restore "+I(e.selectedBuybacks.length)+" order",1),e.selectedBuybacks.length>1?(_(),h("span",st,"s")):$("",!0),a[1]||(a[1]=C(" ? ")),a[2]||(a[2]=x("br",null,null,-1))])]),x("div",lt,[k(Y,{view:"outlined",color:"teal",class:"bg-white",onClick:s},{default:w((()=>a[3]||(a[3]=[C("Cancel")]))),_:1}),k(Y,{color:"orange",class:"ml-3",onClick:l},{default:w((()=>a[4]||(a[4]=[C("Yes, Restore")]))),_:1})])])])),_:1},8,["model-value"]))}},rt={class:"flex items-center"},it={class:"flex items-center flex-row my-4 float-left"},nt={key:0,class:"inline-block mx-2"},ut={key:1,class:"inline-block"},dt={key:2,class:"inline-block mx-2"},ct={key:3,class:"inline-block mx-2"},mt={key:0,class:"font-semibold"},pt={class:"flex items-center"},ft={key:1},yt={key:2},vt={class:"list"},bt={key:0},gt={class:"text-grey-03"},_t={key:0,style:{"list-style-type":"none"},class:"my-2 text-grey-03"},ht={key:3},xt={key:4},kt={key:0,class:"w-max flex items-center gap-2 bg-green-lighten text-green-04 py-2 px-4 rounded-full text-sm"},St={key:1},$t={key:5},wt={__name:"index",setup(e){const t=ye(),a=y({selected_ids:[],selected_box_id:null,transaction_id:null,notes:null,status_id:1,is_send_email:!1}),s=p(),l=P(),o=ve(),r=m([]),i=m([]),n=c((()=>s.params.category)),d=m(!1),f=m(!1),b=m(!1),V=m(!1),L=m(!1),U=()=>{f.value=!0},q=()=>{b.value=!0},M=async()=>{await o.$actionBatchPrintAddressLabel(i.value)},F=async()=>{if(!L.value){L.value=!0;try{const e="expired"===s.params.subStatusId?1:s.params.subStatusId||s.params.statusId||s.params.category;"expired"===s.params.subStatusId&&(o.filters.is_expired=1);const t=o.filters.is_expired,a="1001"==s.params.statusId,l=!!s.params.subStatusId;a&&!l&&(s.params.subStatusId="1");const i=await Promise.all([o.$getOrderStatus(e),o.$getStatusOptions(),o.$getOrder(e),o.$getReferralSource({status_id:e,is_expired:t}),o.$getItemCondition({status_id:e,is_expired:t}),o.$getCustomTable(e),o.$getPayoutMethod(),o.$getShippingCourier({status_id:e,is_expired:t}),o.$actionGetFileRequired()]);r.value=i[0]}finally{L.value=!1}}},N=()=>{Object.assign(a,{selected_box_id:null,transaction_id:null,notes:null,status_id:1,is_send_email:!1})},z=async()=>{var e,s;if([3,7].includes(a.status_id)&&(o.$state.loading.bulkStatus=!0,t.warningNotes.ids=i.value.map((e=>e.order_id)),!t.warningNotes.isReviewed&&await t.$getNotesUnread(a.transaction_id.map((e=>e.box_id))),null==(s=null==(e=t.warningNotes)?void 0:e.notes)?void 0:s.length))return t.warningNotes.modal=!0,void(o.$state.loading.bulkStatus=!1);await o.$actionUpdate(a).then((async()=>{i.value=[],d.value=!1,B({type:"success",message:"Success update status"}),await F()}))},G=c((()=>{const e=i.value;return!!e.length&&e.every((t=>[9,15].includes(e[0].status_id)?[9,15].includes(t.status_id):[12,13].includes(e[0].status_id)?[12,13].includes(t.status_id):t.status_id===e[0].status_id))})),W=c((()=>0===[...i.value].filter((e=>e.is_readonly)).length)),K=c((()=>[7].includes(a.status_id))),X=()=>{var e,t;a.selected_box_id=i.value.map((e=>e.offer_id)).join(","),a.transaction_id=i.value.map((e=>({box_id:e.offer_id,transaction_id:""}))),d.value=!0;const l=(null==(e=i.value)?void 0:e.length)>0?null==(t=i.value[0])?void 0:t.status_id:1;"all"===s.params.statusId?a.status_id=l:a.status_id=s.params.subStatusId?parseInt(s.params.subStatusId):parseInt(s.params.statusId)},H=c((()=>null==o?void 0:o.order.data)),Q=async()=>{const e=i.value.map((e=>e.order_id)).join(",");"deleted"===await o.$actionDelete([e])&&(B({type:"success",message:"Success archiving offer"}),i.value=[],await F())},te=async()=>{const e=i.value.map((e=>e.order_id)).join(",");await o.$actionRestore([e]),B({type:"success",message:"Success restoring offer"}),i.value=[],await F()},ae=e=>{l.push({name:"easyOfferDetail",params:{buybackId:e.offer_id}})},se=async e=>{try{await o.$actionUpdateFileRequired({is_required:e})}catch(t){console.log(t)}finally{B({type:"success",message:"Success update required file upload"}),await o.$actionGetFileRequired()}};let le=null;v((()=>({category:s.params.category,statusId:s.params.statusId,subStatusId:s.params.subStatusId})),((e,t)=>{le&&clearTimeout(le),"expired"===t.subStatusId&&"expired"!==e.subStatusId&&(o.filters.is_expired=0),le=setTimeout((()=>{F()}),10)}),{deep:!0});let oe=null;return v((()=>({page:o.filters.page,limit:o.filters.limit,search:o.filters.search,barcode:o.filters.barcode,is_require_file:o.filters.is_require_file,is_expired:o.filters.is_expired})),ee(((e,t)=>{oe&&clearTimeout(oe);["search","barcode","limit","status_id","is_expired","buyback"].some((a=>e[a]!==t[a]))&&(o.filters.page=1),"expired"===s.params.subStatusId&&1!==o.filters.is_expired&&(o.filters.is_expired=1),oe=setTimeout((()=>{JSON.stringify(e)!==JSON.stringify(t)&&F()}),10)}),500),{deep:!0}),D((()=>{F()})),A((()=>{le&&clearTimeout(le),oe&&clearTimeout(oe)})),(e,t)=>{const l=g("Tooltip"),c=g("Popover"),m=R("loading");return _(),h(T,null,[t[20]||(t[20]=x("div",{class:"flex items-center gap-4 mb-6"},[x("h5",null,"Easy Offer"),x("div",{class:"px-3 py-1 bg-teal-04 text-white rounded-full flex items-center justify-center box-border text-xs"}," API ")],-1)),k(u,null,{default:w((()=>{var e,a,u,d;return[k(Fe,{currentTabId:n.value,statusId:S(s).params.statusId||"all",tabStatuses:r.value},null,8,["currentTabId","statusId","tabStatuses"]),k(Pe,{"onUpdate:customTable":F,table:H.value,tabStatuses:r.value},null,8,["table","tabStatuses"]),x("div",rt,[k(J,{modelValue:S(o).fileRequired.data,"onUpdate:modelValue":[t[0]||(t[0]=e=>S(o).fileRequired.data=e),se],value:"1","value-off":"0",loading:S(o).fileRequired.isLoading,type:"toggle"},{default:w((()=>t[8]||(t[8]=[C(" Require File Upload ")]))),_:1},8,["modelValue","loading"]),k(l,{placement:"top"},{content:w((()=>t[9]||(t[9]=[x("div",{class:"text-sm w-64"},"When it’s turned on, your customers must include a file when creating an EasyOffer on your front end.",-1)]))),default:w((()=>t[10]||(t[10]=[x("i",{class:"material-icons text-teal-04"},"info",-1)]))),_:1})]),x("div",it,["active"===S(s).params.category&&i.value.length>0&&G.value&&W.value?(_(),h("div",nt,[k(Y,{color:"teal",dense:"",onClick:X},{default:w((()=>t[11]||(t[11]=[C("Change Status")]))),_:1})])):$("",!0),"active"===S(s).params.category&&i.value.length>0?(_(),h("div",ut,[k(Y,{color:"teal",dense:"",onClick:M,loading:S(o).$state.loading.print.address_label},{default:w((()=>t[12]||(t[12]=[x("i",{class:"material-icons text-lg mr-2"},"print",-1),C(" Print Batch Address Label ")]))),_:1},8,["loading"])])):$("",!0),"active"==S(s).params.category&&i.value.length>0?(_(),h("div",dt,[k(Y,{color:"red",dense:"",onClick:U},{default:w((()=>t[13]||(t[13]=[x("i",{class:"material-icons text-lg mr-2"},"archive",-1),C(" Archive All Selected")]))),_:1})])):$("",!0),"archive"==S(s).params.category&&i.value.length>0?(_(),h("div",ct,[k(Y,{color:"teal",dense:"",onClick:q},{default:w((()=>t[14]||(t[14]=[x("i",{class:"material-icons text-lg mr-2"},"restore",-1),C(" Restore All Selected")]))),_:1})])):$("",!0)]),E((_(),O(ne,{selected:i.value,"onUpdate:selected":t[1]||(t[1]=e=>i.value=e),items:(null==(e=H.value)?void 0:e.data)||[],headers:(null==(a=H.value)?void 0:a.header_table)||[],"clickable-row":!0,onRowClick:ae,"item-value":"offer_id",selectable:"",class:"my-4"},{column:w((({row:e,column:a,key:o})=>["offer_id"===o?(_(),h("td",mt,[x("div",pt,[C(I(a)+" ",1),0==e.shipping_label&&1==S(s).params.statusId?(_(),O(c,{key:0,trigger:"hover"},{reference:w((()=>t[15]||(t[15]=[x("div",{class:"text-center ml-2"},[x("i",{class:"material-icons text-orange-04 text-center"},"warning")],-1)]))),default:w((()=>[t[16]||(t[16]=x("span",null,"Shipping label failed to generate",-1))])),_:1})):$("",!0),2==e.shipping_label_status?(_(),O(l,{key:1,placement:"top"},{content:w((()=>t[17]||(t[17]=[x("div",{style:{"max-width":"200px"}}," Unable to generate shipping label due to an error. ",-1)]))),default:w((()=>[t[18]||(t[18]=x("div",{class:"text-center ml-2"},[x("i",{class:"material-icons text-red-base text-center"},"warning")],-1))])),_:1})):$("",!0)])])):"status"===o?(_(),h("td",ft,[k(ce,{color:S(pe)(a)},{default:w((()=>[C(I(a),1)])),_:2},1032,["color"])])):Array.isArray(a)?(_(),h("td",yt,[x("ul",vt,[(_(!0),h(T,null,j(a,(e=>(_(),h(T,null,[e?(_(),h("li",bt,[x("span",gt,I(e),1)])):$("",!0)],64)))),256)),e[`${o}_has_more`]?(_(),h("li",_t," ... and more ")):$("",!0)])])):"age_of_order"===o?(_(),h("td",ht,I([a||0,"Day(s)"].join(" ")),1)):"expedited_payout"===o?(_(),h("td",xt,[a?(_(),h("div",kt,[k(fe,{class:"text-green-04"}),t[19]||(t[19]=x("span",null,"Expedited Payout",-1))])):(_(),h("span",St,"-"))])):(_(),h("td",$t,I(a||"-"),1))])),_:1},8,["selected","items","headers"])),[[m,null==(d=null==(u=S(o))?void 0:u.order)?void 0:d.isLoading]]),H.value&&H.value.total>S(o).filters.limit?(_(),O(Z,{key:0,page:S(o).filters.page,"onUpdate:page":t[2]||(t[2]=e=>S(o).filters.page=e),limit:S(o).filters.limit,"onUpdate:limit":t[3]||(t[3]=e=>S(o).filters.limit=e),data:H.value},null,8,["page","limit","data"])):$("",!0)]})),_:1}),k(Ne,{ref_key:"refBulkStatusForm",ref:V,"model-value":d.value,"onUpdate:modelValue":t[4]||(t[4]=e=>d.value=e),"bulk-status-data":a,"onUpdate:bulkStatusData":t[5]||(t[5]=e=>a=e),"state-option-statuses":S(o).$state.statusOptions.result,"is-bulk-status-large-modal":K.value,"bulk-status-loading":S(o).$state.loading.bulkStatus,onClose:N,onUpdateStatus:z},null,8,["model-value","bulk-status-data","state-option-statuses","is-bulk-status-large-modal","bulk-status-loading"]),k(He,{"model-value":f.value,"onUpdate:modelValue":t[6]||(t[6]=e=>f.value=e),"selected-buybacks":i.value,onArchive:Q},null,8,["model-value","selected-buybacks"]),k(ot,{"model-value":b.value,"onUpdate:modelValue":t[7]||(t[7]=e=>b.value=e),"selected-buybacks":i.value,onRestore:te},null,8,["model-value","selected-buybacks"]),k(me,{onProceed:z})],64)}}};export{wt as default};
