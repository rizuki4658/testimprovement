{"version":3,"file":"index.aa4327d9.js","sources":["../../src/views/integration/shipmondo/index.vue"],"sourcesContent":["<template>\n  <Modal\n    size=\"md\"\n    :modelValue=\"true\"\n    :hide-footer=\"isHideFooter\"\n    @click-close=\"handleCloseForm\"\n    without-transition\n  >\n    <template #header>\n      <div class=\"flex justify-between\">\n        <span>Shipmondo Settings</span>\n        <Button\n          v-if=\"isShowEditCredential\"\n          @click=\"handleEditCredential\"\n          color=\"teal\"\n          dense\n        >\n          <div class=\"flex flex-auto items-center\">\n            <i class=\"material-icons icon-xxs\">edit</i>\n            <span class=\"ml-1\"> Edit Account</span>\n          </div>\n        </Button>\n      </div>\n    </template>\n    <template #default>\n      <template v-if=\"status.is_ready == 0\">\n        <div\n          class=\"flex items-center bg-orange-lighten text-orange-04 p-4 rounded-lg w-full mx-auto my-4\"\n        >\n          <i class=\"material-icons mr-4 self-start\">info</i>\n          <span\n            >Please activate Mail-in location and complete all forms.\n            <router-link\n              class=\"font-semibold text-orange-04\"\n              :to=\"{ name: 'settingManageLocation' }\"\n            >\n              Mail-In Settings\n            </router-link>\n            .</span\n          >\n        </div>\n      </template>\n      <RouterView v-slot=\"{ Component, route }\">\n        <template v-if=\"Component\">\n          <Transition\n            name=\"slide-fade\"\n            :key=\"route.matched[route.matched.length - 2].name\"\n          >\n            <KeepAlive>\n              <Suspense>\n                <template #default>\n                  <component ref=\"refComponent\" :is=\"Component\"></component>\n                </template>\n                <template #fallback>\n                  <div class=\"w-full flex items-center justify-center\">\n                    <BaseLoading />\n                  </div>\n                </template>\n              </Suspense>\n            </KeepAlive>\n          </Transition>\n        </template>\n      </RouterView>\n    </template>\n    <template #footer>\n      <Tooltip\n        placement=\"top\"\n        content=\"Please choose a shipping courier first\"\n        :disabled=\"!isNotSelectedCarrier\"\n      >\n        <div class=\"w-max ml-auto\">\n          <Button\n            @click=\"handleSave\"\n            color=\"teal\"\n            :disabled=\"\n              loading.shippingProvider.fetchAll ||\n              loading.shippingKit.fetch ||\n              loadingConfig.integrationChecks ||\n              status.is_ready == 0 ||\n              isNotSelectedCarrier\n            \"\n            :loading=\"\n              loading.shippingProvider.updateCarrier ||\n              loadingShippingKit.update ||\n              loadingStatus\n            \"\n            >Save</Button\n          >\n        </div>\n      </Tooltip>\n    </template>\n  </Modal>\n</template>\n\n<script>\nimport { defineComponent, ref } from 'vue'\nimport { useRouter, useRoute } from 'vue-router'\nimport {\n  useShippingProvider,\n  useShippingKit,\n  useConfig,\n  useStatus\n} from 'composable/integration/shipmondo'\n\nimport Modal from 'bbUi/components/modal/modal.vue'\nimport Tab from 'bbUi/components/tab/tab.vue'\nimport Button from 'bbUi/components/button/button.vue'\nimport ShippingKitForm from 'components/Integration/ShippingKitForm.vue'\nimport BaseLoading from 'components/BaseLoading.vue'\n\nimport { computed } from '@vue/reactivity'\nimport { ElMessage } from 'element-plus'\n\nexport default defineComponent({\n  name: 'Shipmondo',\n  components: {\n    Modal,\n    Button,\n    Tab,\n    ShippingKitForm,\n    BaseLoading\n  },\n  async setup() {\n    const route = useRoute()\n    const router = useRouter()\n    const { loading, updateCarrier, resetSelectedCarrier, selectedCarrier } =\n      useShippingProvider()\n    const { loading: loadingShippingKit, updateShippingKit } = useShippingKit()\n    const { loading: loadingConfig } = useConfig()\n    const { loading: loadingStatus, status } = useStatus()\n    const refComponent = ref(null)\n\n    const isHideFooter = computed(() =>\n      route.matched.length > 0\n        ? route.matched.find(\n            (eachRoute) => eachRoute.name === 'integrationShipmondoConfig'\n          ) === undefined\n        : false\n    )\n    const isShowEditCredential = computed(() => !isHideFooter.value)\n    const isOnShippingKitSection = computed(\n      () => route.name === 'integrationShipmondoConfigShippingKit'\n    )\n    const isNotSelectedCarrier = computed(\n      () => selectedCarrier.value.carrier_uuid === null\n    )\n\n    const handleCloseForm = () => {\n      router.push({\n        name: 'integration',\n        query: {\n          reload: 1\n        }\n      })\n    }\n    const handleSave = async () => {\n      if (isOnShippingKitSection.value) {\n        const isValid =\n          await refComponent.value?.componentElement?.shippingKitFormElement?.validate?.()\n        if (!isValid) return\n      }\n      let isError = {\n        carrier: false,\n        shippingKit: false\n      }\n      await Promise.all([\n        updateCarrier((err) => (isError.carrier = err)),\n        updateShippingKit((err) => (isError.shippingKit = err))\n      ])\n      if (isError.carrier || isError.shippingKit) {\n        resetSelectedCarrier()\n        return\n      }\n      ElMessage({\n        type: 'success',\n        message: 'Changes saved'\n      })\n      router.push({\n        name: 'integration',\n        query: {\n          reload: 1\n        }\n      })\n    }\n    const handleEditCredential = () => {\n      router.push({\n        name: 'integrationShipmondoConnect'\n      })\n    }\n\n    return {\n      route,\n      refComponent,\n      loading,\n      loadingShippingKit,\n      loadingConfig,\n      isHideFooter,\n      isShowEditCredential,\n      isNotSelectedCarrier,\n      loadingStatus,\n      status,\n      handleCloseForm,\n      handleSave,\n      handleEditCredential\n    }\n  }\n})\n</script>\n<style lang=\"scss\" scoped>\n.loading-logo {\n  animation: rotate 0.8s infinite linear;\n}\n@keyframes rotate {\n  from {\n    transform: rotate(0deg);\n  }\n  to {\n    transform: rotate(-360deg);\n  }\n}\n</style>\n"],"names":["_sfc_main","defineComponent","name","components","Modal","Button","Tab","ShippingKitForm","BaseLoading","[object Object]","route","useRoute","router","useRouter","loading","updateCarrier","resetSelectedCarrier","selectedCarrier","useShippingProvider","loadingShippingKit","updateShippingKit","useShippingKit","loadingConfig","useConfig","loadingStatus","status","useStatus","refComponent","ref","isHideFooter","computed","matched","length","find","eachRoute","isShowEditCredential","value","isOnShippingKitSection","isNotSelectedCarrier","carrier_uuid","handleCloseForm","push","query","reload","handleSave","async","_d","_c","_b","_a","componentElement","shippingKitFormElement","validate","call","isError","carrier","shippingKit","Promise","all","err","_u","type","message","handleEditCredential","key","_hoisted_3","class","_openBlock","_createBlock","_component_Modal","size","modelValue","hide-footer","_ctx","onClickClose","header","_withCtx","_createElementVNode","_hoisted_1","_cache","onClick","color","default","is_ready","_createElementBlock","_hoisted_2","_createTextVNode","_createVNode","_component_router_link","_createCommentVNode","Component","_Transition","_KeepAlive","_Suspense","fallback","_component_Tooltip","placement","content","_hoisted_4","_component_Button","disabled","shippingProvider","fetchAll","fetch","integrationChecks","update"],"mappings":"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"}