import{k as a,N as e,O as o,ay as i,f as l,g as n,W as t,m as s,o as d,t as r,D as c,w as m,B as u,I as g,K as f,S as p,_ as h}from"./vendor.9695fe57.js";import{o as y}from"./setting.70ebc1f0.js";import{u as v}from"./dashboard.9cadbe3e.js";import{a as b,u as L,s as C}from"./location.a69d5692.js";import{_ as w,j as x,b as _,d as A}from"./index.73ae30fa.js";import{C as j}from"./card.0f43ecfb.js";import{B as M}from"./Breadcrumb.8a4b1e47.js";import{M as k}from"./Form.5f511ca7.js";import{_ as S}from"./success.3f91e874.js";import{_ as B}from"./error-circle.966becfe.js";import"./date.f86face7.js";import"./breadcrumb.fd540912.js";import"./InputPhone.a467eb84.js";import"./SelectCountry.db8fda5d.js";import"./countries.62f07ce8.js";import"./index.54844a74.js";import"./index.6b6f6369.js";import"./index.f40e4a9e.js";const P=a({components:{Alert:x,Button:_,Card:j,Modal:A,ManageLocationForm:k,Breadcrumb:M},setup(){const a=e(),s=o(),{data:d,loading:r,modal:c,currentMailinLocationId:m,actionCreate:u,actionUpdate:g}=y(),{locations:f}=v(),{loading:p,chargedProrateAmount:w,getChargedProrateAmount:x,billingCycleType:_}=b(),{loading:A,actionMailLocation:j}=L(),{state:M,actionAll:k,loading:S}=C,B=i(k),P=i(S),E=i(M,{}),F=l(null),O=l(!1),V=l(!1),I=l(!1),N=l(!1),R=n((()=>{var e,o;return 1==(null==(o=null==(e=a.state.setting.manageLocation.all)?void 0:e.mailin_location)?void 0:o.is_enable_mailin)})),U=n((()=>{var a;return null==(a=F.value)?void 0:a.hasEmptyRequiredField})),q=async()=>{await s.push({name:"settingManageLocation"}),await Promise.allSettled([f((()=>{}),a.state.user.me.id),B(a.state.user.me.id)]),V.value=!1,h({type:"success",message:"New Mail-in Location has been added"})},T=a=>{console.warn("Error adding location: ",a),I.value=!0},Y=async a=>{var e,o;if(!a)return(null==(o=null==(e=E.value)?void 0:e.package_detail)?void 0:o.is_popup_paid_location)?(V.value=!0,void(I.value=!1)):void(await q());T()},z=async()=>{1==d.is_mailin?await(async()=>{if(!m.value)return console.warn("Mail-in location id is empty"),void h({message:"Unable to create Mail-In location",type:"error"});await g(m.value,(a=>{if(a)return T();j({is_enable:1},Y)}))})():await(async()=>{await u(Y,{closeOnSuccess:!1})})()};return t((()=>O.value=!0)),{stateLocation:E,store:a,data:d,loading:r,loadingLocation:A,loadingLegacyLocation:P,loadingAdditionalPrice:p,modal:c,breadcrumb:[{text:"Settings",to:{name:"setting"}},{text:"Manage Locations",to:{name:"settingManageLocation"}},{text:"New Location"}],refComponent:F,isShowModal:O,isAddedLocation:V,isErrorAddingLocation:I,isLoadingBilling:N,chargedProrateAmount:w,hasActiveMailinLocation:R,hasEmptyRequiredField:U,billingCycleType:_,handleSubmitAddLocation:z,handleConfirmAddLocation:async()=>{var a,e,o,i;(null==(e=null==(a=F.value)?void 0:a.validate)?void 0:e.call(a))&&((null==(i=null==(o=E.value)?void 0:o.package_detail)?void 0:i.is_popup_paid_location)?(await x(),c.form=!0):await z())},handleCloseModal:()=>{O.value=!1,c.form=!1,s.push({name:"settingManageLocation"})},handleCloseOnSuccess:q,handleOpenBilling:async()=>{N.value=!0,s.push({name:"settingBilling"})}}}}),E={class:"grid grid-cols-1"},F={class:"flex justify-between"},O={key:0,class:"flex flex-col items-center justify-center my-6"},V={class:"text-center text-grey-03"},I={key:1,class:"flex flex-col items-center justify-center my-6"},N={class:"text-center text-grey-03"},R={class:"flex flex-wrap items-center gap-4"},U={key:2,class:"flex flex-col items-center justify-center my-4"},q={class:"text-center text-grey-03"},T={class:"font-semibold"},Y={class:"flex items-center gap-4 mt-8 mb-4"};var z=w(P,[["render",function(a,e,o,i,l,n){const t=s("ManageLocationForm"),h=s("Button"),y=s("Modal");return d(),r("div",null,[c(y,{modelValue:a.isShowModal,"onUpdate:modelValue":e[0]||(e[0]=e=>a.isShowModal=e),title:"Add Location",onClose:a.handleCloseModal},{footer:m((()=>{var o;return[u("div",F,[c(h,{onClick:a.handleCloseModal,color:"white",class:"btn-white--borderless"},{default:m((()=>e[4]||(e[4]=[g(" Cancel ")]))),_:1},8,["onClick"]),c(h,{onClick:a.handleConfirmAddLocation,color:"teal",disabled:a.hasEmptyRequiredField,loading:a.loading.form||(null==(o=a.loadingLegacyLocation)?void 0:o.all)||a.loadingAdditionalPrice||a.loadingLocation.mailin_location},{default:m((()=>e[5]||(e[5]=[g(" Add Location ")]))),_:1},8,["onClick","disabled","loading"])])]})),default:m((()=>[u("div",E,[c(t,{ref:"refComponent",data:a.data,"is-mailin-available":a.hasActiveMailinLocation},null,8,["data","is-mailin-available"])])])),_:1},8,["modelValue","onClose"]),c(y,{modelValue:a.modal.form,"onUpdate:modelValue":e[3]||(e[3]=e=>a.modal.form=e),size:a.isAddedLocation||a.isErrorAddingLocation?"xs":"sm","hide-footer":"","hide-header":""},{default:m((()=>{var o,i;return[u("div",null,[a.isAddedLocation?(d(),r("div",O,[e[7]||(e[7]=u("img",{class:"mb-4 w-28",src:S,alt:"company icon"},null,-1)),e[8]||(e[8]=u("h2",{class:"text-2xl my-4 font-medium"}," New Location Successfully Added! ",-1)),u("p",V," You have been charged a prorated amount of "+f(a.chargedProrateAmount)+" until the start of your billing cycle. ",1),c(h,{onClick:a.handleCloseOnSuccess,class:"my-6",color:"white"},{default:m((()=>e[6]||(e[6]=[g(" Close ")]))),_:1},8,["onClick"])])):a.isErrorAddingLocation?(d(),r("div",I,[e[12]||(e[12]=u("img",{class:"mb-4 w-28",src:B,alt:"company icon"},null,-1)),e[13]||(e[13]=u("h2",{class:"text-2xl my-4 font-medium"}," Payment Failed! ",-1)),u("p",N,[e[9]||(e[9]=g(" Your payment was unsuccessful. Please try again. If the problem persists, go to ")),u("a",{href:"#!",class:"underline",onClick:e[1]||(e[1]=p((()=>!a.isLoadingBilling&&a.handleOpenBilling()),["prevent"]))},"Plans & Billing Settings")]),u("div",R,[c(h,{onClick:a.handleCloseModal,loading:a.isLoadingBilling,class:"my-6 btn-white--borderless",color:"white"},{default:m((()=>e[10]||(e[10]=[g(" Close ")]))),_:1},8,["onClick","loading"]),c(h,{onClick:a.handleSubmitAddLocation,color:"teal",view:"outlined",loading:a.loading.form||a.loadingAdditionalPrice||a.loadingLocation.mailin_location||a.isLoadingBilling},{default:m((()=>e[11]||(e[11]=[g(" Retry "),u("i",{class:"material-icons"},"refresh",-1)]))),_:1},8,["onClick","loading"])])])):(d(),r("div",U,[e[17]||(e[17]=u("img",{class:"mb-4 w-28",src:"/assets/location-add.d94e4939.svg",alt:"company icon"},null,-1)),e[18]||(e[18]=u("h2",{class:"text-2xl my-4 font-medium"},"Pay to Add Location",-1)),u("p",q,[e[14]||(e[14]=g(" By clicking 'Subscribe,' you agree to an additional charge of ")),u("span",T,f(null==(i=null==(o=a.stateLocation)?void 0:o.package_detail)?void 0:i.additional_location_price)+" "+f(a.billingCycleType),1),g(", prorated from the subscription start date. You will be charged a prorated amount of "+f(a.chargedProrateAmount)+" today, which will cover the period until your next billing cycle begins. ",1)]),u("div",Y,[c(h,{onClick:e[2]||(e[2]=e=>a.modal.form=!1),color:"white",class:"btn-white--borderless"},{default:m((()=>e[15]||(e[15]=[g(" Cancel ")]))),_:1}),c(h,{loading:a.loading.form||a.loadingAdditionalPrice||a.loadingLocation.mailin_location,color:"teal",onClick:a.handleSubmitAddLocation},{default:m((()=>e[16]||(e[16]=[g(" Subscribe ")]))),_:1},8,["loading","onClick"])])]))])]})),_:1},8,["modelValue","size"])])}]]);export{z as default};
