var e=Object.defineProperty,l=Object.defineProperties,a=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,s=(l,a,o)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[a]=o,d=(e,l)=>{for(var a in l||(l={}))t.call(l,a)&&s(e,a,l[a]);if(o)for(var a of o(l))i.call(l,a)&&s(e,a,l[a]);return e},n=(e,o)=>l(e,a(o));import{k as r,r as p,m,o as c,t as u,D as f,w as v,B as g,I as h,K as b,a2 as w,a3 as _,F as U,S as y,T as B,Q as S,U as C,f as I,g as k,n as F,y as V,h as D,a0 as N,A as M,a5 as x,O as j}from"./vendor.f1efedad.js";import{ar as T,_ as R,d as P,b as E,j as q,ap as z,u as O,h as A}from"./index.e231b017.js";import{p as L}from"./setting.86482221.js";import{C as Y}from"./card.de1f0319.js";import{B as H}from"./Breadcrumb.e5dd1515.js";import{F as $}from"./FileUpload.81606ef6.js";import"./breadcrumb.e60df23d.js";const K=r({name:"BookIsbnFileUpload",components:{FileUpload:$},props:{files:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["completed","error","uploading","remove"],setup:(e,{emit:l})=>({fileUploadConfig:p({url:"/v1/pos/pricing/upload-pricing",method:"post",field:"csv"}),handleCompleteUpload:(e=[])=>{l("completed",e)},handleErrorUpload:(e=[])=>{l("error",e)},handleRemovedFile:(e=null)=>{l("remove",e)},fileSizeFormat:T})}),Q={class:"block mt-4"},W={key:0},G={class:"relative w-full"},J={class:"flex items-center"},X={class:"file-list__file-name"},Z={class:"file-list__file-size"},ee={class:"file-list__file-remove pl-6"},le={key:1,class:"px-4 py-4"},ae={class:"relative w-full"},oe={class:"flex items-center"},te={class:"file-list__file-name"},ie={class:"file-list__file-size"},se={class:"file-list__file-remove pl-6"},de=["onClick"];const ne=r({name:"BookIsbnModalUpload",components:{Modal:P,Button:E,Alert:q,BookIsbnFileUpload:R(K,[["render",function(e,l,a,o,t,i){const s=m("FileUpload");return c(),u("div",null,[f(s,{accept:["csv"],config:e.fileUploadConfig,files:e.files,"single-upload":"",onCompleted:e.handleCompleteUpload,onError:e.handleErrorUpload,onUploading:l[1]||(l[1]=l=>e.$emit("uploading",l)),onRemove:e.handleRemovedFile},{types:v((({acceptedFileTypes:e})=>[g("small",Q,[l[2]||(l[2]=g("span",{class:"font-semibold"},"File:",-1)),h(" "+b(e)+" ",1),l[3]||(l[3]=g("span",{class:"font-semibold"},"Format:",-1)),l[4]||(l[4]=h(" ISBN, Title, Bid, Publisher "))])])),"file-list":v((({files:a,removeFile:o,isEmptyFiles:t})=>{var i;return[g("div",null,[t&&(null==(i=e.files)?void 0:i.length)>0?(c(),u("div",W,[(c(!0),u(w,null,_(e.files,(a=>(c(),u("div",{key:a.name,class:U(["file-list__item"])},[l[6]||(l[6]=g("div",{class:"file-list__file-icon pr-6"},[g("i",{class:"material-icons"},"insert_drive_file")],-1)),g("div",G,[g("div",J,[g("div",X,b(a.name),1),g("div",Z,b(e.fileSizeFormat(a.size)),1)])]),g("div",ee,[g("a",{onClick:l[0]||(l[0]=y((l=>e.handleRemovedFile(null)),["prevent"]))},l[5]||(l[5]=[g("i",{class:"material-icons"},"cancel",-1)]))])])))),128))])):t?C("",!0):(c(),u("div",le,[(c(!0),u(w,null,_(a,(e=>(c(),u("div",{key:e.name,class:U(["file-list__item",e.status.progress<100?"file-list__item--onprogress":""])},[l[8]||(l[8]=g("div",{class:"file-list__file-icon pr-6"},[g("i",{class:"material-icons"},"insert_drive_file")],-1)),g("div",ae,[g("div",oe,[g("div",te,b(e.name),1),g("div",ie,b(e.size),1)]),f(B,{name:"fade"},{default:v((()=>[e.status.progress<100?(c(),u("div",{key:0,class:"file-list__progress-bar",style:S({width:`${e.status.progress}%`})},null,4)):C("",!0)])),_:2},1024)]),g("div",se,[g("a",{onClick:y((l=>o(e.id)),["prevent"])},l[7]||(l[7]=[g("i",{class:"material-icons"},"cancel",-1)]),8,de)])],2)))),128))]))])]})),_:1},8,["config","files","onCompleted","onError","onRemove"])])}]])},props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","completed"],setup(e,{emit:l}){const{state:a,loading:o,getLatestUploadedFile:t,deleteUploadedFile:i,downloadTemplateFile:s,processUploadedFile:d}=z(),n=I(!1),r=I(!1),p=k({set:e=>l("update:modelValue",e),get:()=>e.modelValue}),m=k((()=>!a.latestUploadedFile.pricing_data_real_filename||n.value)),c=k((()=>a.latestUploadedFile.pricing_data_real_filename?[{name:a.latestUploadedFile.pricing_data_real_filename||"",size:a.latestUploadedFile.pricing_data_files_size||0}]:[]));return{state:a,loading:o,isShowModal:p,isDisabledCSVUpload:m,isUploading:r,latestISBNUploadedFile:c,handleDownloadCSVTemplate:async()=>await s(),handleUploadCompleted:async()=>{n.value=!1,await t()},handleUploadError:()=>{n.value=!0},handleUploading:(e=!1)=>{r.value=e},handleRemovedFile:async e=>{var l,o;const s=!!(null==e?void 0:e.status)&&(100===(null==(l=e.status)?void 0:l.progress)&&!1===(null==(o=e.status)?void 0:o.error));if(null===e||s)return a.latestUploadedFile.pricing_data_real_filename=null,await i(),void(await t());n.value=!1},handleProcessUploadedFile:async()=>{await d(),l("completed",!0)}}}}),re={class:"flex justify-between items-center"};var pe=R(ne,[["render",function(e,l,a,o,t,i){const s=m("Button"),d=m("Alert"),n=m("BookIsbnFileUpload"),r=m("Modal");return c(),F(r,{title:"Upload ISBN",modelValue:e.isShowModal,"onUpdate:modelValue":l[0]||(l[0]=l=>e.isShowModal=l)},{header:v((()=>[g("div",re,[l[2]||(l[2]=g("div",null,[g("h2",{class:"text-xl font-semibold"},"Upload ISBN")],-1)),g("div",null,[f(s,{onClick:e.handleDownloadCSVTemplate,loading:e.loading.downloadTemplateFile,color:"teal",dense:""},{default:v((()=>l[1]||(l[1]=[g("span",null,[g("i",{class:"material-icons mr-2"},"download"),h("Template CSV")],-1)]))),_:1},8,["onClick","loading"])])])])),default:v((()=>[g("div",null,[f(d,{color:"blue",view:"smooth",class:"mb-5",dense:""},{left:v((()=>l[3]||(l[3]=[g("span",{class:"material-icons text-4xl"},"info",-1)]))),default:v((()=>[l[4]||(l[4]=h(" In the template, items priced at $0 wonâ€™t appear in the Widget after upload, and any blank price cells or formatting issues will trigger a validation error. Your upload will continue, and you will see a validation report listing any errors once it is complete. "))])),_:1}),f(n,{files:e.latestISBNUploadedFile,onCompleted:e.handleUploadCompleted,onError:e.handleUploadError,onUploading:e.handleUploading,onRemove:e.handleRemovedFile},null,8,["files","onCompleted","onError","onUploading","onRemove"])])])),footer:v((()=>[f(s,{onClick:e.handleProcessUploadedFile,disabled:e.isDisabledCSVUpload,loading:e.loading.processUploadedFile||e.isUploading,color:"teal"},{default:v((()=>l[5]||(l[5]=[g("span",null,[g("i",{class:"material-icons mr-2"},"upload"),h(" Update Existing ISBNs")],-1)]))),_:1},8,["onClick","disabled","loading"])])),_:1},8,["modelValue"])}]]);const me=r({name:"BookIsbnModalUpload",components:{Modal:P,Button:E,Alert:q},props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:l}){const{state:a,loading:o,getInvalidData:t}=z(),{me:i}=O(),s=k({set:e=>l("update:modelValue",e),get:()=>e.modelValue});return V((()=>s.value),(async e=>{e&&await t()})),{state:a,loading:o,isShowModal:s,me:i,moment:D,handleDownloadInvalidCSV:()=>{window.open(a.invalidData.fileUrl,"_blank","noreferrer noopener")}}}}),ce={class:"flex justify-between items-center"},ue={class:"my-4"},fe={class:"text-right my-6"},ve={key:0,class:"p-4 border border-grey-01 rounded-lg mb-4"};const ge=r({components:{Card:Y,Button:E,Breadcrumb:H,BookISBNModal:pe,BookISBNInvalidModal:R(me,[["render",function(e,l,a,o,t,i){const s=m("Button"),d=m("Alert"),n=m("TableColumn"),r=m("Table"),p=m("Modal"),_=N("loading");return c(),F(p,{title:"Upload ISBN",modelValue:e.isShowModal,"onUpdate:modelValue":l[0]||(l[0]=l=>e.isShowModal=l),"hide-footer":"",size:"md"},{header:v((()=>[g("div",ce,[l[2]||(l[2]=g("div",null,[g("h2",{class:"text-xl font-semibold"},"Invalid Format Data")],-1)),g("div",null,[f(s,{onClick:e.handleDownloadInvalidCSV,loading:e.loading.getInvalidData,color:"teal",dense:""},{default:v((()=>l[1]||(l[1]=[g("span",null,[g("i",{class:"material-icons mr-2"},"download"),h("CSV")],-1)]))),_:1},8,["onClick","loading"])])])])),default:v((()=>[M((c(),u("div",null,[f(d,{class:"mb-4",color:"red",view:"smooth",dense:""},{default:v((()=>[g("p",ue,[l[3]||(l[3]=h(" We identified ")),g("b",null,b(e.state.invalidData.total),1),l[4]||(l[4]=h(" rows of data that don't meet the specified format requirements. "))]),e.state.invalidData.total>99?(c(),u(w,{key:0},[l[6]||(l[6]=g("p",{class:"my-4"}," To assist you, you can download a CSV file containing only the data that does not meet the required format. This file will help you identify and correct the formatting issues. ",-1)),f(s,{onClick:e.handleDownloadInvalidCSV,class:"mb-4",color:"teal",view:"outlined",dense:""},{default:v((()=>l[5]||(l[5]=[g("i",{class:"material-icons"},"download",-1),h(" CSV")]))),_:1},8,["onClick"])],64)):C("",!0)])),left:v((()=>l[7]||(l[7]=[g("span",{class:"material-icons mt-3"},"warning",-1)]))),_:1}),g("div",fe,[g("p",null,[l[8]||(l[8]=h(" Last Update: ")),g("b",null,b(e.state.invalidData.lastUpdatedAt?e.moment(e.state.invalidData.lastUpdatedAt,"YYYY-MM-DD HH:mm:ss").format(e.me.datetime_format):""),1)])]),e.state.invalidData.total<99||e.state.invalidData.rows.length>0?(c(),u("div",ve,[f(r,{data:e.state.invalidData.rows,height:"500"},{default:v((()=>[f(n,{prop:"ISBN",label:"ISBN"}),f(n,{prop:"Title",label:"Title",width:"250"}),f(n,{prop:"Bid",label:"Bid"}),f(n,{prop:"PUBLISHER",label:"Publisher"}),f(n,{prop:"Reason",label:"Reason"})])),_:1},8,["data"])])):C("",!0)])),[[_,e.loading.getInvalidData]])])),_:1},8,["modelValue"])}]])},async setup(){const e=x(),l=j(),{actionCategories:a}=L(),{state:o,getLatestUploadedFile:t}=z(),{openNotification:i}=A(),s=k({get:()=>{var l,a,o;return"books"===(null==(o=null==(a=null==(l=e.params)?void 0:l.category)?void 0:a.toLowerCase)?void 0:o.call(a))&&"update"===e.query.isbn},set:a=>{!1===a&&l.push(n(d({},e),{query:{}}))}}),r=k({get:()=>{var l,a,o;return"books"===(null==(o=null==(a=null==(l=e.params)?void 0:l.category)?void 0:a.toLowerCase)?void 0:o.call(a))&&"invalid"===e.query.isbn},set:a=>{!1===a&&l.push(n(d({},e),{query:{}}))}});return await t(),{stateISBN:o,isShowISBNUpdateModal:s,isShowISBNInvalidModal:r,breadcrumb:[{text:"Settings",to:{name:"setting"}},{text:"Catalog"}],handleRequestDevice:()=>{window.open("https://forms.clickup.com/8427959/f/816dq-50276/FKAAVUJSUQ7G44BNOD","_blank","noreferrer noopener")},handleISBNProcessing:async()=>{await l.push({name:"settingBuybackDeviceTab",params:{category:"books"},query:{}}),await a(),i("NotificationPricingBooks")}}}}),he={class:"flex justify-between items-center mb-8"};var be=R(ge,[["render",function(e,l,a,o,t,i){const s=m("Breadcrumb"),d=m("router-view"),n=m("BookISBNModal"),r=m("BookISBNInvalidModal"),p=m("Card"),b=m("Button");return c(),u("div",null,[g("div",he,[f(s,{pageTitle:"Catalog",backTo:{name:"setting"},items:e.breadcrumb},null,8,["items"])]),f(p,null,{default:v((()=>[f(d),f(n,{modelValue:e.isShowISBNUpdateModal,"onUpdate:modelValue":l[0]||(l[0]=l=>e.isShowISBNUpdateModal=l),onCompleted:e.handleISBNProcessing,style:{"z-index":"2000"}},null,8,["modelValue","onCompleted"]),f(r,{modelValue:e.isShowISBNInvalidModal,"onUpdate:modelValue":l[1]||(l[1]=l=>e.isShowISBNInvalidModal=l),style:{"z-index":"2000"}},null,8,["modelValue"])])),_:1}),f(p,{class:"mt-4",whitelabel:"remove"},{default:v((()=>[l[3]||(l[3]=h(" Can't find an item? Let us know and we will add it to our catalog. ")),f(b,{class:"ml-2",color:"teal",onClick:e.handleRequestDevice,dense:""},{default:v((()=>l[2]||(l[2]=[h("Request Item")]))),_:1},8,["onClick"])])),_:1})])}]]);export{be as default};
