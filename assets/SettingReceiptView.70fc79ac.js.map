{"version":3,"file":"SettingReceiptView.70fc79ac.js","sources":["../../src/components/Features/Setting/SettingReceipt/SettingReceiptForm.vue","../../src/components/Features/Setting/SettingReceipt/SettingReceiptView.vue"],"sourcesContent":["<script setup async>\nimport { reactive, watch, useTemplateRef, computed } from 'vue'\nimport { deepClone } from 'utils/deep-clone'\nimport { useVuelidate } from '@vuelidate/core'\nimport { useRouter, onBeforeRouteLeave } from 'vue-router'\nimport { useSettingReceiptStore } from 'store/pinia/setting/receipt'\n\n// Components\nimport { Editor as ClassicEditor } from '@erdeprsty/ckeditor5-custom-build'\nimport { ElMessage } from 'element-plus'\nimport VuePdf from 'vue3-pdf-app'\nimport Modal from 'bbUi/components/modal/modal.vue'\nimport Button from 'bbUi/components/button/button.vue'\nimport Checkbox from 'bbUi/components/checkbox/checkbox.vue'\nimport Card from 'bbUi/components/card/card.vue'\nimport TextEditor from '@/components/TextEditor.vue'\nimport { tryCatchRequest } from 'utils/request'\n\nconst props = defineProps({\n\tbuybackType: String\n})\n\nconst settingReceiptStore = useSettingReceiptStore()\nconst router = useRouter()\nconst state = reactive({\n\tinitData: {},\n\tpendingNavigation: undefined,\n\tisModalOpen: {\n\t\tpreview: false,\n\t\treset: false,\n\t\tdiscard: false\n\t},\n\tisDirty: false\n})\nconst ckEditorConfig = {\n\teditor: ClassicEditor,\n\tconfig: {\n\t\thtmlSupport: {\n\t\t\tallow: [\n\t\t\t\t{\n\t\t\t\t\tstyles: true,\n\t\t\t\t\tclasses: true\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t}\n}\nconst pdfViewerConfig = {\n\ttoolbar: {\n\t\ttoolbarViewerRight: false\n\t},\n\tsecondaryToolbar: false\n}\nconst validation = useVuelidate({}, settingReceiptStore, {\n\t$lazy: true\n})\nconst refTextEditor = useTemplateRef('text-editor')\nconst refTextEditorAdditional = useTemplateRef('text-editor-additional')\n\nconst requestParams = computed(() => ({ buyback_type: props.buybackType }))\n\nconst validate = async () => {\n\tconst isReadyEditor =\n\t\trefTextEditor.value.isEditorReady &&\n\t\t(settingReceiptStore.$state.form.is_custom_addtional_provision !== '1' ||\n\t\t\t(refTextEditorAdditional.value && refTextEditorAdditional.value.isEditorReady))\n\n\tif (!isReadyEditor) return false\n\n\tconst savePromises = [refTextEditor.value.forceSave()]\n\n\tif (settingReceiptStore.$state.form.is_custom_addtional_provision === '1')\n\t\tsavePromises.push(refTextEditorAdditional.value.forceSave())\n\n\tconst saveResults = await Promise.all(savePromises)\n\tconst isSaved = saveResults.every(result => result)\n\n\tif (!isSaved) return false\n\n\tvalidation.value.$validate()\n\n\treturn !validation.value.$invalid\n}\nconst onDiscard = () => {\n\tif (state.pendingNavigation) state.pendingNavigation()\n\n\tstate.isModalOpen.discard = false\n}\nconst onContinue = () => {\n\tstate.isModalOpen.discard = false\n}\nconst onCopyText = text => {\n\tnavigator.clipboard.writeText(text).then(() => {\n\t\tElMessage({\n\t\t\ttype: 'success',\n\t\t\tmessage: 'Text copied to clipboard'\n\t\t})\n\t})\n}\nconst onPreview = async () => {\n\tawait tryCatchRequest(settingReceiptStore.$state.preview, () =>\n\t\tsettingReceiptStore\n\t\t\t.$preview({\n\t\t\t\tdata: settingReceiptStore.$state.form,\n\t\t\t\tparams: requestParams.value\n\t\t\t})\n\t\t\t.then(() => {\n\t\t\t\tstate.isModalOpen.preview = true\n\t\t\t})\n\t)\n}\nconst onReset = async () => {\n\tawait tryCatchRequest(settingReceiptStore.$state.reset, () =>\n\t\tsettingReceiptStore\n\t\t\t.$reset({\n\t\t\t\tdata: settingReceiptStore.$state.form,\n\t\t\t\tparams: requestParams.value\n\t\t\t})\n\t\t\t.then(response => {\n\t\t\t\tsettingReceiptStore.$state.form.receipt.textinfo = response.receipt.textinfo\n\t\t\t\tstate.isModalOpen.reset = false\n\n\t\t\t\tElMessage({\n\t\t\t\t\ttype: 'success',\n\t\t\t\t\tmessage: 'Receipt template has been reset'\n\t\t\t\t})\n\t\t\t})\n\t)\n}\nconst onSubmit = async () => {\n\tconst isValid = validate()\n\n\tif (isValid)\n\t\tawait tryCatchRequest(settingReceiptStore.$state.update, () =>\n\t\t\tsettingReceiptStore\n\t\t\t\t.$update({ data: settingReceiptStore.$state.form, params: requestParams.value })\n\t\t\t\t.then(() => {\n\t\t\t\t\tstate.isDirty = false\n\n\t\t\t\t\tElMessage({\n\t\t\t\t\t\ttype: 'success',\n\t\t\t\t\t\tmessage: 'Receipt has been saved'\n\t\t\t\t\t})\n\t\t\t\t\trouter.push({\n\t\t\t\t\t\tname: 'settingReceipt'\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t)\n}\n\nonBeforeRouteLeave((_, __, next) => {\n\tif (state.isDirty) {\n\t\tstate.isModalOpen.discard = true\n\t\tstate.pendingNavigation = () => {\n\t\t\tstate.isDirty = false\n\t\t\tnext()\n\t\t}\n\t} else next()\n})\nwatch(\n\t() => settingReceiptStore.$state.form,\n\tvalue => {\n\t\tif (state.initData) state.isDirty = JSON.stringify(value) !== JSON.stringify(state.initData)\n\t},\n\t{ deep: true }\n)\n\ndefineExpose({\n\tstate,\n\tonSubmit,\n\tonPreview\n})\n\nawait settingReceiptStore.$get({\n\tparams: requestParams.value\n})\n\nif (settingReceiptStore.$state.get.result) {\n\tstate.initData = deepClone(settingReceiptStore.$state.get.result)\n\tObject.assign(settingReceiptStore.$state.form, deepClone(settingReceiptStore.$state.get.result))\n}\n</script>\n\n<template>\n\t<Card class=\"my-6\">\n\t\t<template #header>\n\t\t\t<h5>Receipt</h5>\n\t\t</template>\n\t\t<template #default>\n\t\t\t<TextEditor\n\t\t\t\tv-model=\"settingReceiptStore.$state.form.receipt.textinfo\"\n\t\t\t\t:options=\"ckEditorConfig\"\n\t\t\t\tref=\"refTextEditor\">\n\t\t\t\t<template #toolbar>\n\t\t\t\t\t<Button\n\t\t\t\t\t\tview=\"smooth\"\n\t\t\t\t\t\tcolor=\"teal\"\n\t\t\t\t\t\tclass=\"ml-auto\"\n\t\t\t\t\t\t@click=\"state.isModalOpen.reset = true\"\n\t\t\t\t\t\tdense>\n\t\t\t\t\t\t<span class=\"material-icons mr-1\">refresh</span>\n\t\t\t\t\t\tReset\n\t\t\t\t\t</Button>\n\t\t\t\t</template>\n\t\t\t</TextEditor>\n\t\t\t<Table :data=\"settingReceiptStore.$state.form.receipt.sort_code\" class=\"mt-6\">\n\t\t\t\t<TableColumn label=\"Code\">\n\t\t\t\t\t<template #default=\"scope\">\n\t\t\t\t\t\t<div class=\"flex\">\n\t\t\t\t\t\t\t<span class=\"mr-2\">{{ scope.row.code }}</span>\n\t\t\t\t\t\t\t<i class=\"material-icons text-lg text-teal-04\" @click=\"onCopyText(scope.row.code)\">\n\t\t\t\t\t\t\t\tcontent_copy\n\t\t\t\t\t\t\t</i>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t</TableColumn>\n\t\t\t\t<TableColumn prop=\"description\" label=\"Description\" />\n\t\t\t</Table>\n\t\t</template>\n\t</Card>\n\t<Card>\n\t\t<template #header>\n\t\t\t<h5>Additional Provisions</h5>\n\t\t</template>\n\t\t<template #default>\n\t\t\t<p class=\"mb-4\">\n\t\t\t\tIncorporate additional provisions into your terms and conditions to ensure better\n\t\t\t\tcompliance.\n\t\t\t</p>\n\t\t\t<Checkbox\n\t\t\t\tv-model=\"settingReceiptStore.$state.form.is_custom_addtional_provision\"\n\t\t\t\tcolor=\"teal\"\n\t\t\t\tvalue=\"1\"\n\t\t\t\tvalue-off=\"0\"\n\t\t\t\tclass=\"mb-6\">\n\t\t\t\tCustom Additional Provisions\n\t\t\t</Checkbox>\n\t\t\t<TextEditor\n\t\t\t\tv-model=\"settingReceiptStore.$state.form.addtional_provision.textinfo\"\n\t\t\t\tv-if=\"settingReceiptStore.$state.form.is_custom_addtional_provision === '1'\"\n\t\t\t\t:options=\"ckEditorConfig\"\n\t\t\t\tref=\"refTextEditorAdditional\" />\n\t\t\t<Table :data=\"settingReceiptStore.$state.form.addtional_provision.sort_code\" class=\"mt-6\">\n\t\t\t\t<TableColumn label=\"Code\">\n\t\t\t\t\t<template #default=\"scope\">\n\t\t\t\t\t\t<div class=\"flex\">\n\t\t\t\t\t\t\t<span class=\"mr-2\">{{ scope.row.code }}</span>\n\t\t\t\t\t\t\t<i class=\"material-icons text-lg text-teal-04\" @click=\"onCopyText(scope.row.code)\">\n\t\t\t\t\t\t\t\tcontent_copy\n\t\t\t\t\t\t\t</i>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</template>\n\t\t\t\t</TableColumn>\n\t\t\t\t<TableColumn prop=\"description\" label=\"Description\" />\n\t\t\t</Table>\n\t\t</template>\n\t</Card>\n\t<Modal\n\t\tv-model=\"state.isModalOpen.preview\"\n\t\ttitle=\"Preview Receipt\"\n\t\tsize=\"lg\"\n\t\tstyle=\"z-index: 1001\"\n\t\thide-footer\n\t\tno-padding>\n\t\t<template #default>\n\t\t\t<VuePdf\n\t\t\t\t:pdf=\"settingReceiptStore.$state.preview.result\"\n\t\t\t\t:config=\"pdfViewerConfig\"\n\t\t\t\tstyle=\"height: 60vh\"\n\t\t\t\ttheme=\"dark\" />\n\t\t</template>\n\t</Modal>\n\t<Modal v-model=\"state.isModalOpen.reset\" hide-header hide-footer size=\"xs\" style=\"z-index: 1001\">\n\t\t<template #default>\n\t\t\t<div class=\"text-center\">\n\t\t\t\t<img\n\t\t\t\t\tclass=\"w-32 mx-auto my-10\"\n\t\t\t\t\tsrc=\"@/assets/icon/attention-warning.svg\"\n\t\t\t\t\talt=\"Warning icon\" />\n\t\t\t\t<p class=\"text-center my-10 text-grey-04\">\n\t\t\t\t\tAll changes will be reset to original template.\n\t\t\t\t\t<br />\n\t\t\t\t\tAre you sure to reset to default?\n\t\t\t\t</p>\n\t\t\t\t<div class=\"flex items-center justify-center my-10\">\n\t\t\t\t\t<Button\n\t\t\t\t\t\t@click=\"onReset\"\n\t\t\t\t\t\t:loading=\"settingReceiptStore.$state.reset.isLoading\"\n\t\t\t\t\t\tclass=\"mx-2\"\n\t\t\t\t\t\tcolor=\"orange\"\n\t\t\t\t\t\tview=\"outlined\">\n\t\t\t\t\t\tYes, Reset\n\t\t\t\t\t</Button>\n\t\t\t\t\t<Button\n\t\t\t\t\t\t:loading=\"settingReceiptStore.$state.reset.isLoading\"\n\t\t\t\t\t\tclass=\"mx-2\"\n\t\t\t\t\t\tcolor=\"teal\"\n\t\t\t\t\t\t@click=\"state.isModalOpen.reset = false\">\n\t\t\t\t\t\tCancel\n\t\t\t\t\t</Button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</template>\n\t</Modal>\n\t<Modal v-model=\"state.isModalOpen.discard\" hide-header hide-footer size=\"xs\">\n\t\t<template #default>\n\t\t\t<div class=\"flex flex-col gap-6 items-center my-6\">\n\t\t\t\t<img src=\"@/assets/icon/error-circle.svg\" />\n\t\t\t\t<h6 class=\"text-3xl font-medium\">Discard Changes?</h6>\n\t\t\t\t<p class=\"text-grey-02 text-center\">\n\t\t\t\t\tYou have made changes that haven't been saved yet.\n\t\t\t\t\t<br />\n\t\t\t\t\tAre you sure to discard changes?\n\t\t\t\t</p>\n\t\t\t\t<div class=\"flex flex-wrap items-center justify-center gap-14\">\n\t\t\t\t\t<Button color=\"red\" @click=\"onDiscard\">Discard Changes</Button>\n\t\t\t\t\t<Button color=\"teal\" view=\"smooth\" @click=\"onContinue\">Continue Editing</Button>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t</template>\n\t</Modal>\n</template>\n\n<style>\n.ck-editor__editable {\n\theight: 300px;\n}\n.pdf-app.dark {\n\t--pdf-toolbar-color: #393939 !important;\n\t--pdf-app-background-color: #393939 !important;\n\t--pdf-overlay-container-dialog-color: #393939 !important;\n\t--pdf-sidebar-content-color: #393939 !important;\n}\n</style>\n","<script setup>\nimport { computed, useTemplateRef } from 'vue'\nimport { useSettingReceiptStore } from '@/store/pinia/setting/receipt'\n\n// Components\nimport Button from 'bbUi/components/button'\nimport Card from 'bbUi/components/card'\nimport Breadcrumb from '@/components/Breadcrumb.vue'\nimport Loading from '@/components/Base/Loading/Loading.vue'\nimport SettingReceiptForm from './SettingReceiptForm.vue'\n\ndefineProps({\n\ttitle: String,\n\tbackTo: Object,\n\tbuybackType: String,\n\tbreadcrumb: { type: Array, default: () => [] }\n})\n\nconst settingReceiptStore = useSettingReceiptStore()\nconst refForm = useTemplateRef('form')\n\nconst isSubmitDisabled = computed(\n\t() =>\n\t\t(refForm.state ? !refForm.state.isDirty : false) || settingReceiptStore.$state.preview.isLoading\n)\n\nconst onPreview = () => {\n\trefForm.value.onPreview()\n}\nconst onSubmit = () => {\n\trefForm.value.onSubmit()\n}\n</script>\n\n<template>\n\t<div>\n\t\t<div class=\"flex justify-between items-center mt-2 mb-8\">\n\t\t\t<Breadcrumb\n\t\t\t\t:pageTitle=\"$props.title\"\n\t\t\t\t:backTo=\"$props.backTo\"\n\t\t\t\t:items=\"$props.breadcrumb\"\n\t\t\t\tclass=\"w-full\">\n\t\t\t\t<template #right>\n\t\t\t\t\t<div class=\"flex gap-4\">\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t:loading=\"settingReceiptStore.$state.preview.isLoading\"\n\t\t\t\t\t\t\t:disabled=\"settingReceiptStore.$state.update.isLoading\"\n\t\t\t\t\t\t\tcolor=\"teal\"\n\t\t\t\t\t\t\tview=\"outlined\"\n\t\t\t\t\t\t\t@click=\"onPreview\">\n\t\t\t\t\t\t\t<i class=\"material-icons\">visibility</i>\n\t\t\t\t\t\t\tPreview\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\tcolor=\"teal\"\n\t\t\t\t\t\t\t:loading=\"settingReceiptStore.$state.update.isLoading\"\n\t\t\t\t\t\t\t:disabled=\"isSubmitDisabled\"\n\t\t\t\t\t\t\t@click=\"onSubmit\">\n\t\t\t\t\t\t\tSave Changes\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t</div>\n\t\t\t\t</template>\n\t\t\t</Breadcrumb>\n\t\t</div>\n\t\t<suspense>\n\t\t\t<SettingReceiptForm :buyback-type=\"$props.buybackType\" ref=\"form\" />\n\t\t\t<template #fallback>\n\t\t\t\t<Card>\n\t\t\t\t\t<Loading />\n\t\t\t\t</Card>\n\t\t\t</template>\n\t\t</suspense>\n\t</div>\n</template>\n"],"names":["props","__props","settingReceiptStore","useSettingReceiptStore","router","useRouter","state","reactive","initData","pendingNavigation","isModalOpen","preview","reset","discard","isDirty","ckEditorConfig","editor","ClassicEditor","exports","Editor","config","htmlSupport","allow","styles","classes","pdfViewerConfig","toolbar","toolbarViewerRight","secondaryToolbar","validation","useVuelidate","$lazy","refTextEditor","useTemplateRef","refTextEditorAdditional","requestParams","computed","buyback_type","buybackType","onDiscard","onContinue","onCopyText","text","navigator","clipboard","writeText","then","_u","type","message","onReset","async","tryCatchRequest","$state","$reset","data","form","params","value","response","receipt","textinfo","onBeforeRouteLeave","_","__","next","watch","JSON","stringify","deep","__expose","onSubmit","isEditorReady","is_custom_addtional_provision","savePromises","forceSave","push","Promise","all","every","result","$validate","$invalid","validate","update","$update","name","onPreview","$preview","__temp","__restore","_withAsyncContext","$get","get","deepClone","Object","assign","refForm","isSubmitDisabled","isLoading"],"mappings":"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"}