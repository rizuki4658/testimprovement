var a=Object.defineProperty,e=Object.defineProperties,t=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,r=(e,t,s)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,n=(a,e)=>{for(var t in e||(e={}))l.call(e,t)&&r(a,t,e[t]);if(s)for(var t of s(e))o.call(e,t)&&r(a,t,e[t]);return a},c=(a,s)=>e(a,t(s));import{u as d}from"./components.41c6afd8.js";import{r as i,f as u,y as m,W as p,o as g,t as h,B as y,k as b,g as f,m as _,a0 as v,D as x,w as C,K as D,a2 as j,I as w,S as Y,A as k,h as S}from"./vendor.f1efedad.js";import{s as O,o as M,v as B,_ as I,b as T,u as A,T as V,d as E,g as P}from"./index.e231b017.js";import{C as $}from"./card.de1f0319.js";import{_ as L}from"./group-container.4951adfc.js";import{S as F}from"./select.04e4ee62.js";import{B as U}from"./Breadcrumb.e5dd1515.js";import{C as G}from"./Currency.3768e3b3.js";import{p as K}from"./chartjs-plugin-zoom.esm.f842a922.js";import{C as N}from"./chart.b16d9eb5.js";import"./LoadingCard.9892fd7a.js";import"./breadcrumb.e60df23d.js";const R=i({usage:{next_invoice:null,total:0,total_buyback:0,total_invoice:0,total_lead:0,chart:{selected_date:null,selected_year:null,data_chart:[],list_day:[],list_date:[],list_year:[],total_amount:0,total_buyback:0,total_lead:0,total_lead_amount:0},data:{chart:{year:null,period_start:null,period_end:null}}}}),z=i({usage:{show:!1,chart:!1}}),H=i({usage:!1}),W={class:"relative"},Z={ref:"chartRef",height:"80",id:"charts"};const q=b({components:{Card:$,Modal:E,GroupContainer:L,Select:F,Breadcrumb:U,Currency:G,Chart:I({components:{Button:T},props:{labels:{type:Array,default:()=>[]},datasets:{type:Array,default:()=>[]},type:{default:"line",type:String}},setup(a){const e=u(null);A();const t={chart:null,props:n({},a)},s=(a=[],s=[])=>{if(t.chart)return t.chart.update("reset");var l=document.getElementById("charts").getContext("2d").createLinearGradient(0,0,0,400);return l.addColorStop(0,"#4ED3BB"),l.addColorStop(.5,"#4ED3BB"),l.addColorStop(1,"#FFFFFF"),N.register(K),N.defaults.font.family="'Poppins'",t.chart=new N(e.value.getContext("2d"),{type:t.props.type,responsive:!1,maintainAspectRatio:!1,options:{elements:{point:{radius:4}},plugins:{legend:{display:!0},tooltip:{enabled:!0,position:"nearest",mode:"index",filter:a=>(a.label=a.raw.label,a.formattedValue=`$${V(a.formattedValue)}`,a)}},scales:{y:{beginAtZero:!0,ticks:{callback:a=>`$${V(a)}`}}},parsing:{xAxisKey:"x",yAxisKey:"y"}},data:{labels:a,datasets:s}})};return m((()=>({data:a.datasets})),(()=>{t.chart&&(t.chart.destroy(),t.chart=null),s(a.labels,a.datasets)}),{deep:!0}),p((()=>s(a.labels,a.datasets))),{chartRef:e}}},[["render",function(a,e,t,s,l,o){return g(),h("div",W,[y("canvas",Z,null,512)])}]])},async setup(){const{actionShow:a,actionShowChart:e}=(()=>{const a=new Map;return a.set("month","list_date"),{actionShow:async(a=(()=>{}))=>{try{z.usage.show=!0;const e=await O.dispatch("setting/plan/showUsage");if(M(e))for(let[a,t]of Object.entries(e))Object.keys(R.usage).includes(a)&&(R.usage[a]=t);B(a)&&a()}finally{z.usage.show=!1}},actionShowChart:async(e=(()=>{}))=>{try{z.usage.chart=!0;const t=await O.dispatch("setting/plan/showUsageChart",R.usage.data.chart);if(M(t)){for(let[e,s]of Object.entries(t))Object.keys(R.usage.chart).includes(e)&&(R.usage.chart[e]=s),void 0!==a.get(e)&&(R.usage.chart[a.get(e)]=s);if(t.month){const a=t.month.find((a=>1===a.selected));a&&(R.usage.chart.selected_date=a.name)}if(t.list_year){const a=t.list_year.find((a=>1===a.selected));a&&(R.usage.chart.selected_year=a.year)}}B(e)&&e()}finally{z.usage.chart=!1}}}})(),t=u([{text:"Settings",to:{name:"setting"}},{text:"Usage"}]),s=f((()=>null!==R.usage.next_invoice?S(R.usage.next_invoice,"YYYY-MM-DD HH:mm:ss").format("MMM DD, YYYY"):"-")),l=f((()=>R.usage.total_invoice?V(R.usage.total_invoice):"0")),o=f((()=>({total_buybacks:R.usage.chart.total_buyback?R.usage.chart.total_buyback:0,total_leads:R.usage.chart.total_lead?R.usage.chart.total_lead:0,total_amount_leads:R.usage.chart.total_lead_amount?V(R.usage.chart.total_lead_amount):V(0)}))),r=f((()=>[{label:"Bill",color:"#1672ED",borderColor:"#1672ED",backgroundColor:"#1672ED",smooth:!0,tension:.4,data:R.usage.chart.list_day.map(((a,e)=>{const t=parseInt(S(a,"YYYY-MM-DD").format("DD")),s=S(a,"YYYY-MM-DD").format("MMM DD YYYY")||"-";return{x:isNaN(t)?0:t,y:R.usage.chart.data_chart[e],label:s}}))}])),d=f((()=>R.usage.chart.list_day.map((a=>S(a,"YYYY-MM-DD").format("MMM DD"))))),i=f((()=>R.usage.chart.list_date)),p=f((()=>R.usage.chart.list_year));return m((()=>R.usage.data.chart),P((async()=>{await Promise.all([a(),e()])}),250),{deep:!0}),await Promise.all([a(),e()]),{state:R,loading:z,modal:H,breadcrumb:t,nextInvoiceDate:s,estimatedInvoiceTotal:l,chartDataset:r,chartLabels:d,chartSummary:o,dateOptions:i,yearOptions:p,money:V,handleSelectDateOption:a=>{if(!a)return;const e=i.value.find((e=>e.name===a));e&&Object.assign(R.usage.data.chart,c(n({},R.usage.data.chart),{period_start:e.period_start,period_end:e.period_end}))},handleSelectYear:a=>{Object.assign(R.usage.data.chart,c(n({},R.usage.data.chart),{period_start:null,period_end:null,year:a}))},handleOpenModal:()=>H.usage=!0}}}),J={class:"grid grid-cols-2 gap-8 mt-14 mb-10"},Q={class:"p-4"},X={class:"text-3xl"},aa={class:"p-4"},ea={class:"text-3xl my-2"},ta={class:"grid grid-cols-1 gap-8"},sa={class:"flex justify-between items-center"},la={class:"my-3"},oa={class:"my-3"},ra={class:"my-3"},na={class:"flex justify-between"},ca={class:"pr-4"},da={class:"block mb-2"},ia={class:"block text-grey-04"},ua={class:"flex flex-wrap justify-between"},ma={class:"text-xl font-bold"};var pa=I(q,[["render",function(a,e,t,s,l,o){const r=_("Breadcrumb"),n=_("Card"),c=_("Currency"),d=_("Select"),i=_("GroupContainer"),u=_("Chart"),m=_("Modal"),p=v("loading");return g(),h("div",null,[x(r,{"page-title":"Usage",items:a.breadcrumb,"back-to":{name:"setting"}},null,8,["items"]),y("div",J,[x(n,null,{default:C((()=>[y("div",Q,[e[5]||(e[5]=y("p",{class:"mb-2"},"Next Invoice Date",-1)),y("h6",X,D(a.nextInvoiceDate),1)])])),_:1}),x(n,null,{default:C((()=>[y("div",aa,[e[6]||(e[6]=y("p",{class:"mb-2"},"Estimated Invoice Total",-1)),y("h6",ea,["-"!==a.estimatedInvoiceTotal?(g(),h(j,{key:0},[w(" $"+D(a.estimatedInvoiceTotal),1)],64)):(g(),h(j,{key:1},[w(D(a.estimatedInvoiceTotal),1)],64))]),y("a",{class:"select-none",onClick:e[0]||(e[0]=Y(((...e)=>a.handleOpenModal&&a.handleOpenModal(...e)),["prevent"]))},"See cost breakdown")])])),_:1})]),y("div",ta,[x(n,null,{default:C((()=>[y("div",sa,[y("div",null,[y("p",la,[e[7]||(e[7]=w(" Total Buybacks: ")),y("a",{onClick:e[1]||(e[1]=Y((()=>{}),["prevent"]))},D(a.chartSummary.total_buybacks),1)]),y("p",oa,[e[8]||(e[8]=w(" Total Leads: ")),y("a",{onClick:e[2]||(e[2]=Y((()=>{}),["prevent"]))},D(a.chartSummary.total_leads),1)]),y("p",ra,[e[9]||(e[9]=w(" Total Amount of Leads: ")),y("a",{onClick:e[3]||(e[3]=Y((()=>{}),["prevent"]))},[x(c,{value:a.chartSummary.total_amount_leads},null,8,["value"])])])]),y("div",null,[x(i,null,{default:C((()=>[x(d,{loading:a.loading.usage.chart,modelValue:a.state.usage.chart.selected_date,onChange:a.handleSelectDateOption,items:a.dateOptions,placeholder:"Select Date",name:"name",by:"name"},null,8,["loading","modelValue","onChange","items"]),x(d,{loading:a.loading.usage.chart,modelValue:a.state.usage.chart.selected_year,onChange:a.handleSelectYear,items:a.yearOptions,name:"year",by:"year",placeholder:"Select Year"},null,8,["loading","modelValue","onChange","items"])])),_:1})])]),k(x(u,{datasets:a.chartDataset,labels:a.chartLabels},null,8,["datasets","labels"]),[[p,a.loading.usage.chart]])])),_:1})]),x(m,{modelValue:a.modal.usage,"onUpdate:modelValue":e[4]||(e[4]=e=>a.modal.usage=e),title:"Cost Breakdown",size:"xs"},{default:C((()=>[y("div",na,[y("div",ca,[y("p",da,D(a.state.usage.total_lead)+" Total buyback leads ",1),y("p",ia," 0.5% x $"+D(a.state.usage.total)+" (Total Amount of Buyback Leads) ",1)]),y("div",null," $"+D(a.money(a.state.usage.total_invoice)),1)])])),footer:C((()=>[y("div",ua,[e[10]||(e[10]=y("span",{class:"text-xl font-bold"},"Total",-1)),y("span",ma," $"+D(a.money(a.state.usage.total_invoice)),1)])])),_:1},8,["modelValue"])])}]]),ga=b({setup(){const{genSuspense:a}=d();return()=>a(pa)}});export{ga as default};
