var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,o=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l;import{u as d}from"./components.cc5a127d.js";import{B as n,c as m}from"./setting.dd3979cd.js";import{_ as r,f as p,b as c,d as u,j as b,P as g,u as y,R as f}from"./index.67cab78b.js";import{k as T,a5 as v,f as w,g as _,r as h,m as E,$ as k,o as j,t as C,D as x,w as P,I as U,B as S,K as I,n as M,U as B,A as O,F as V,a1 as R,_ as D}from"./vendor.9695fe57.js";import{C as J}from"./card.ecf283cd.js";import{B as q}from"./Breadcrumb.b2d95db7.js";import{M as L}from"./MultipleEmailInput.a59f89ce.js";import{E as A}from"./index.fec43b48.js";import{P as F}from"./PreviewEmailTemplate.a4edad8b.js";import{T as $,c as H}from"./TextEditor.a697df28.js";import"./LoadingCard.1ce55cf0.js";import"./breadcrumb.ebb004a0.js";import"./index.f40e4a9e.js";import"./index.6b6f6369.js";import"./select.2449bf30.js";import"./fieldset.684cbbdd.js";import"./IframeRender.46e71567.js";const N=T({components:{Card:J,Input:p,Button:c,Modal:u,Alert:b,Breadcrumb:q,Pagination:g,PreviewEmailTemplate:F,TextEditor:$,MultipleEmailInput:L,EmailTemplateTimeDelay:A},async setup(){const{state:e,data:d,loading:r,modal:p,openModal:c,closeModal:u,previewedEmailTemplate:b,isPreviewEmailTemplate:g,actionShow:f,actionUpdate:T,actionPreviewEmailTemplate:E,actionPreviewEmailTemplateOnly:k,actionResetTemplate:j}=n(),{data:C,actionShow:x,loading:P}=m(),U=v(),{me:S}=y(),I=w(null),M=_((()=>["in-store-chaser-email-10-day","chaser-email-10-day","cart-recovery","in-store-cart-recovery","easy-offer-chaser-email-10-day","easy-offer-cart-recovery"].includes(d.email_template.key))),B=_((()=>{var e;return((null==(e=null==d?void 0:d.email_template)?void 0:e.sort_code)||[]).map((e=>{return d=((e,a)=>{for(var t in a||(a={}))i.call(a,t)&&o(e,t,a[t]);if(l)for(var t of l(a))s.call(a,t)&&o(e,t,a[t]);return e})({},e),n={description:e.description.replace(/\\/g,""),tooltip:e.tooltip?e.tooltip.replace(/\\n/g,"<br/>"):null},a(d,t(n));var d,n}))})),O=h({editor:H.exports.Editor,config:{htmlSupport:{allow:[{styles:!0,classes:!0}]},link:{decorators:{test:{mode:"automatic",callback:e=>"{:verify-link}"===e,classes:"btn btn-blue btn-filled my-4"}}},simpleUpload:{uploadUrl:`https://api-us.buybackcloud.com/api/v1/pos/settings/email-template/upload-image/${U.params.templateId}?buyback_company_token=${S.value.buyback_company_token}`}}});return await f({id:U.params.templateId,type:U.query.type}),await x(),{refTextEditor:I,breadcrumb:[{text:"Settings",to:{name:"setting"}},{text:"Edit Notification",to:{name:"settingEmailTemplate",query:{filter:1}}},{text:"Edit"}],ckeditor:O,state:e,dataCompany:C,data:d,loading:r,modal:p,loadingCompany:P,previewedEmailTemplate:b,isPreviewEmailTemplate:g,isShowTimeframe:M,shortCodes:B,openModal:c,closeModal:u,copyText:e=>{navigator.clipboard.writeText(e).then((()=>{D({type:"success",message:"Text copied to clipboard"})}))},updateTemplate:async()=>{r.update=!0;if(!I.value.isEditorReady)return;await I.value.forceSave()&&(await T({id:U.params.templateId,type:U.query.type},(()=>{D({type:"success",message:"Email template change"})})),r.update=!1)},handlePreviewEmailTemplate:async()=>{await k(U.params.templateId)},handleResetTemplate:async()=>{await j((async()=>{u("reset_template"),await f({id:U.params.templateId,type:U.query.type})}))},handleUpdateBccEmail:(e=[])=>{d.email_template.bcc=[...e]},handleUpdateSendingTimes:e=>{d.email_template.sending_times=e},handleUpdateSendingTimesJson:e=>{d.email_template.sending_times_json=e}}}}),z={class:"grid grid-cols-2"},K={class:"col-span-2 lg:col-span-1"},W={class:"mb-4"},Y={class:"my-4"},G={class:"col-span-2"},Q={class:"mr-2"},X=["onClick"],Z={class:"w-96"},ee=["innerHTML"],ae={class:"py-10"},te={class:"text-center"};var le=r(N,[["render",function(e,a,t,l,i,s){const o=E("Button"),d=E("Breadcrumb"),n=E("Input"),m=E("EmailTemplateTimeDelay"),r=E("MultipleEmailInput"),p=E("TextEditor"),c=E("Tooltip"),u=E("TableColumn"),b=E("Table"),g=E("Card"),y=E("Modal"),T=E("PreviewEmailTemplate"),v=k("loading");return j(),C(R,null,[x(d,{class:"mt-2 mb-8",pageTitle:"Edit Notification",backTo:{name:"settingEmailTemplate",query:{filter:1}},items:e.breadcrumb},{right:P((()=>[x(o,{loading:e.loading.update,color:"teal",onClick:e.updateTemplate},{default:P((()=>a[6]||(a[6]=[U(" Save Changes ")]))),_:1},8,["loading","onClick"])])),_:1},8,["items"]),x(g,{class:"mb-6"},{default:P((()=>[S("div",z,[S("div",K,[S("div",W,[a[7]||(a[7]=S("label",{class:"mb-2"},"Title",-1)),S("p",null,I(e.data.email_template.name),1)]),x(n,{value:e.dataCompany.email_sender,class:"mb-4",label:"From",block:"",disabled:"",loading:e.loadingCompany.show},null,8,["value","loading"]),e.isShowTimeframe?(j(),M(m,{key:0,sendingTimes:e.data.email_template.sending_times,sendingTimesJson:e.data.email_template.sending_times_json,"onUpdate:sendingTimes":e.handleUpdateSendingTimes,"onUpdate:sendingTimesJson":e.handleUpdateSendingTimesJson},null,8,["sendingTimes","sendingTimesJson","onUpdate:sendingTimes","onUpdate:sendingTimesJson"])):B("",!0),S("div",Y,[a[8]||(a[8]=S("label",null,"BCC",-1)),x(r,{onEmailChange:e.handleUpdateBccEmail,suggestion:!1,emails:e.data.email_template.bcc},null,8,["onEmailChange","emails"])]),x(n,{class:"mb-4",modelValue:e.data.email_template.subject,"onUpdate:modelValue":a[0]||(a[0]=a=>e.data.email_template.subject=a),label:"Subject",block:""},null,8,["modelValue"])]),O((j(),C("div",G,[x(p,{modelValue:e.data.email_template.body,"onUpdate:modelValue":a[2]||(a[2]=a=>e.data.email_template.body=a),ref:"refTextEditor",options:e.ckeditor,"with-image-upload":""},{toolbar:P((()=>[x(o,{class:"ml-2",onClick:e.handlePreviewEmailTemplate,loading:e.loading.preview_email,color:"teal",dense:""},{default:P((()=>a[9]||(a[9]=[S("i",{class:"material-icons mr-1"},"visibility",-1),U(" Preview Email ")]))),_:1},8,["onClick","loading"]),x(o,{onClick:a[1]||(a[1]=a=>e.openModal("reset_template")),loading:e.loading.reset_template,class:"ml-auto",color:"orange",view:"smooth",dense:""},{default:P((()=>a[10]||(a[10]=[S("i",{class:"material-icons"},"restart_alt",-1),U(" Reset to Default ")]))),_:1},8,["loading"])])),_:1},8,["modelValue","options"]),e.shortCodes.length>0?(j(),M(b,{key:0,class:"mt-6",data:e.shortCodes},{default:P((()=>[x(u,{label:"Code"},{default:P((t=>[S("div",{class:V(["short-code",t.row.is_disabled?"short-code--disabled":""])},[S("span",Q,I(t.row.code),1),!t.row.is_disabled||t.row.disabled?(j(),C("i",{key:0,class:"material-symbols-outlined text-lg text-teal-04",style:{"font-variation-settings":"'FILL' 0"},onClick:a=>e.copyText(t.row.code)}," content_copy ",8,X)):B("",!0),t.row.tooltip?(j(),M(c,{key:1,placement:"top"},{content:P((()=>[S("div",Z,[S("span",{innerHTML:t.row.tooltip},null,8,ee)])])),default:P((()=>a[11]||(a[11]=[S("i",{class:"material-icons text-lg text-teal-04"},"info",-1)]))),_:2},1024)):B("",!0)],2)])),_:1}),x(u,{label:"Description"},{default:P((e=>[S("div",{class:V(["inline-block","short-code",e.row.is_disabled?"short-code--disabled":""])},I(e.row.description),3)])),_:1})])),_:1},8,["data"])):B("",!0)])),[[v,e.loading.show]])])])),_:1}),x(y,{modelValue:e.modal.reset_template,"onUpdate:modelValue":a[4]||(a[4]=a=>e.modal.reset_template=a),"hide-footer":"","hide-header":"",size:"xs"},{default:P((()=>[S("div",ae,[a[14]||(a[14]=S("img",{class:"mb-10 mx-auto",src:f,alt:"Warning icon"},null,-1)),a[15]||(a[15]=S("div",{class:"mt-8 mb-10"},[S("h5",{class:"mb-4 text-center"},"Reset Email Template"),S("p",{class:"text-center mb-6"}," Are you sure you want to reset to the default email template? ")],-1)),S("div",te,[x(o,{onClick:a[3]||(a[3]=a=>e.closeModal("reset_template")),view:"outlined",color:"teal",class:"bg-white",disabled:e.loading.reset_template},{default:P((()=>a[12]||(a[12]=[U("Cancel ")]))),_:1},8,["disabled"]),x(o,{onClick:e.handleResetTemplate,view:"smooth",color:"orange",class:"ml-3",loading:e.loading.reset_template},{default:P((()=>a[13]||(a[13]=[U("Yes, reset ")]))),_:1},8,["onClick","loading"])])])])),_:1},8,["modelValue"]),x(T,{show:e.isPreviewEmailTemplate,"onUpdate:show":a[5]||(a[5]=a=>e.isPreviewEmailTemplate=a),body:e.previewedEmailTemplate,"render-type":"direct"},null,8,["show","body"])],64)}]]),ie=T({setup(){const{genSuspense:e}=d();return()=>e(le)}});export{ie as default};
