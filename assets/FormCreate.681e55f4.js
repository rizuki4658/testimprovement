var e=Object.defineProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,i=(a,l,o)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[l]=o;import{k as n,r as d,N as t,f as s,g as r,m as c,$ as u,o as m,t as p,B as v,D as g,a1 as y,a2 as C,K as f,U as _,A as b,n as h,a0 as k,S,F as w,w as V,I as $}from"./vendor.9695fe57.js";import{u as x,a as I}from"./device.a2558383.js";import{e as D}from"./setting.1af98a84.js";import{f as j,b as q,u as U,_ as A,g as E}from"./index.6438e939.js";import{a as G}from"./inventory.b142de6c.js";import{u as B}from"./index.f40e4a9e.js";import{d as O,r as P,n as L,f as H}from"./index.6b6f6369.js";import{S as M}from"./select.94a9f057.js";import{_ as N}from"./auto-complete.f5ad78ed.js";import{B as T}from"./BSelect.788c4daf.js";import{C as z}from"./CustomConditionInput.3bbaf4cb.js";const F=n({components:{Input:j,Select:M,AutoComplete:N,BSelect:T,CustomConditionInput:z,Button:q},props:{data:{type:Object,default:()=>({product_id:null,condition_name:null,processor:null,hardDrive:null,memory:null,graphicsCard:null,imei_sn:null,paid:0,is_mac:0,color_id:null,status:1,sold:null})},disabled:{type:Boolean,default:!1},edit:{type:Boolean,default:!1}},emits:["update:data"],setup(e,{emit:n}){const{me:c}=U(),u=d(e.data),{dataComputer:m,unsetData:p}=x(),{data:v,loading:g,items:y,action:C}=I("inventory"),{stateConditions:f,loading:_,actionGet:b,getConditions:h,createCustomCondition:k,actionDelete:S}=D(),{state:w}=G(),V=t(),{state:$}=G(),j=s(!1),q=s([]),A=s([]),M=s(null),N=s(!1),T=s([{id:1,name:"Available"},{id:2,name:"Sold"}]),z=s({all:!1}),F=r((()=>{const e={};(null==u?void 0:u.golfSpecs)&&Object.keys(null==u?void 0:u.golfSpecs).forEach((a=>{e[a]={required:P}}));return((e,n)=>{for(var d in n||(n={}))l.call(n,d)&&i(e,d,n[d]);if(a)for(var d of a(n))o.call(n,d)&&i(e,d,n[d]);return e})({imei_sn:u.imei_required?{required:P}:{},processor:u.is_mac?{required:P}:{},hardDrive:u.is_mac?{required:P}:{},memory:u.is_mac?{required:P}:{},graphicsCard:u.is_mac?{required:P}:{},condition_name:{required:P},paid:{required:P,numeric:L,minValue:H(0)}},e)})),K=B(F,u,{$lazy:!0}),J=E((async()=>{await C()}),500),Q=r((()=>0===u.is_mac?null!==u.product_id&&v.q:1===u.is_mac&&(null!==u.product_id&&null!==m.processor&&null!==m.hardDrive&&null!==m.memory&&null!==m.graphicsCard&&v.q))),R=r((()=>0===u.condition_name.length)),W=r((()=>(null==A?void 0:A.value.some((e=>{var a;return(null==(a=null==e?void 0:e.condition_name)?void 0:a.toLowerCase())===(null==u?void 0:u.condition_name.toLowerCase())})))||(null==q?void 0:q.value.some((e=>{var a;return(null==(a=null==e?void 0:e.condition_name)?void 0:a.toLowerCase())===(null==u?void 0:u.condition_name.toLowerCase())}))))),X=async e=>{e&&(u[e]=null,u.golfSpecs[e]={value:null,options:[],loading:!1},await Y(e,e))},Y=async(e,a="all")=>{z.value[a]=!0;const l=u.golfSteps.findIndex((a=>a.key===e)),o=[...u.golfSteps].filter(((e,a)=>a<l)),i=[...u.golfSteps].filter(((e,a)=>a>l)),n={};o.length&&o.forEach((e=>{n[e.key]=u[e.key]})),i.length&&i.forEach((e=>{u[e.key]=null,u.golfSpecs[e.key]={value:null,options:[],loading:!1}}));const d=await V.dispatch("buyback/getGolfSpecs",{product_id:u.product_id,golf_spec:n});console.log(d),u.golfSpecs[e].options=d[e],z.value[a]=!1},Z=r({get:()=>({id:null==u?void 0:u.condition_name,condition_name:null==u?void 0:u.condition_name}),set:e=>{u.condition=e.id,u.condition_name=e.name}});return{data:u,dataComputer:m,dataSearch:v,loading:g,loadingGolf:z,loadingConditions:_,items:y,validation:K,validate:()=>(K.value.$validate(),!K.value.$invalid),conditions:f,isSelected:Q,statuses:T,state:w,stateTransferHistories:$,search:async e=>{v.q=e,u.golfSteps=[],u.golfSpecs={},J()},select:async e=>{var a;if(K.value.$reset(),u.product_id=e.product_id,u.is_mac=e.is_mac,u.golfSteps=[],u.golfSpecs={},u.condition_name=null,u.processor=null,u.hardDrive=null,u.memory=null,u.graphicsCard=null,u.imei_required=e.imei_required,p(!1),1===u.is_mac&&await Promise.all([C({product_id:u.product_id,type:"Processor"}),C({product_id:u.product_id,type:"Hard Drive"}),C({product_id:u.product_id,type:"Memory"}),C({product_id:u.product_id,type:"Graphics Card"})]),Q.value){const e=await h({product_id:u.product_id});q.value=e.conditions.map((e=>({id:e.id,condition_name:e.name}))),A.value=e.custom_conditions.map((e=>({id:e.id,condition_name:e.name})))}e.golf_step&&(u.golfSteps=null==(a=e.golf_step)?void 0:a.map((e=>(z.value[e]=!1,{name:e.replaceAll("_"," "),key:e}))),await X(u.golfSteps[0].key))},selectSpec:async e=>{u.processor=m.processor,u.hardDrive=m.hardDrive,u.memory=m.memory,u.graphicsCard=m.graphicsCard,Q.value&&(await b({product_id:u.product_id,is_mac:u.is_mac,processor:m.processor.name,memory:m.memory.name,hdd:m.hardDrive.name,graphics:m.graphicsCard.name,condition:1}),u.product_id=u.product_id.toString().split("-")[0]+"-",u.product_id+=m.processor.id+"-",u.product_id+=m.memory.id+"-",u.product_id+=m.hardDrive.id+"-",u.product_id+=m.graphicsCard.id)},requiredIf:O,me:c,handleChangeGolf:X,isCustomCondition:j,selectCondition:async e=>{M.value=e.condition_name,u.condition=e.condition_name,u.condition_name=e.condition_name},selectedCondition:Z,optionConditions:q,optionCustomConditions:A,deleteCustomCondition:async e=>{try{N.value=!0,await S(e),A.value=A.value.filter((a=>a.id!==e))}catch(a){console.log(a)}finally{N.value=!1}},confirmCondition:async()=>{try{await k({condition_name:u.condition_name,condition_term:"[]"}),M.value=u.condition_name;const e=await h({product_id:u.product_id});e&&(q.value=e.conditions.map((e=>({id:e.id,condition_name:e.name}))),A.value=e.custom_conditions.map((e=>({id:e.id,condition_name:e.name})))),j.value=!1}catch(e){console.log(e)}},deleting:N,isEmptyConditionInput:R,isAlreadyExistCondition:W,initialCondition:M,handleAddCustomcondition:()=>{j.value=!0,u.condition_name=""},handleCancelCustomcondition:()=>{j.value=!1,u.condition_name=""}}}}),K={class:"block"},J={class:"block"},Q={class:"block"},R={class:"block"},W={class:"block"},X={key:0,class:"space-y-2 my-2"},Y={class:"capitalize"},Z={key:0,class:"h-10"},ee={class:"block"},ae={key:3,class:"block my-2"},le={key:0,class:"text-red-base block mt-2"},oe=["onClick"],ie={class:"block"};var ne=A(F,[["render",function(e,a,l,o,i,n){var d,t;const s=c("AutoComplete"),r=c("Select"),x=c("Input"),I=c("CustomConditionInput"),D=c("Button"),j=c("BSelect"),q=u("loading");return m(),p(y,null,[v("div",K,[a[16]||(a[16]=v("label",null,"Item Name",-1)),g(s,{placeholder:"Search item",name:"product_name",items:e.items.devices,loading:e.loading.devices,onChange:e.search,onSelect:e.select},null,8,["items","loading","onChange","onSelect"])]),1===e.data.is_mac&&e.dataSearch&&e.dataSearch.q?(m(),p(y,{key:0},[v("div",J,[g(r,{modelValue:e.dataComputer.processor,"onUpdate:modelValue":a[0]||(a[0]=a=>e.dataComputer.processor=a),name:"name",label:"Processor",items:e.items.processor,view:e.validation.processor.$invalid?"danger":"default",loading:e.loading.processor,onInput:e.selectSpec,class:"w-full"},null,8,["modelValue","items","view","loading","onInput"]),(m(!0),p(y,null,C(e.validation.processor.$errors,((e,a)=>(m(),p("small",{class:"text-red-base",key:a},f(e.$message)+". ",1)))),128))]),v("div",Q,[a[17]||(a[17]=v("label",null,"Hard Drive",-1)),g(r,{modelValue:e.dataComputer.hardDrive,"onUpdate:modelValue":a[1]||(a[1]=a=>e.dataComputer.hardDrive=a),name:"name",items:e.items.hardDrive,view:e.validation.hardDrive.$invalid?"danger":"default",loading:e.loading.hardDrive,onInput:e.selectSpec,class:"w-full"},null,8,["modelValue","items","view","loading","onInput"]),(m(!0),p(y,null,C(e.validation.hardDrive.$errors,((e,a)=>(m(),p("small",{class:"text-red-base",key:a},f(e.$message)+". ",1)))),128))]),v("div",R,[a[18]||(a[18]=v("label",null,"Memory",-1)),g(r,{modelValue:e.dataComputer.memory,"onUpdate:modelValue":a[2]||(a[2]=a=>e.dataComputer.memory=a),name:"name",items:e.items.memory,view:e.validation.memory.$invalid?"danger":"default",loading:e.loading.memory,onInput:e.selectSpec,class:"w-full"},null,8,["modelValue","items","view","loading","onInput"]),(m(!0),p(y,null,C(e.validation.memory.$errors,((e,a)=>(m(),p("small",{class:"text-red-base",key:a},f(e.$message)+". ",1)))),128))]),v("div",W,[a[19]||(a[19]=v("label",null,"Graphics Card",-1)),g(r,{modelValue:e.dataComputer.graphicsCard,"onUpdate:modelValue":a[3]||(a[3]=a=>e.dataComputer.graphicsCard=a),name:"name",items:e.items.graphicsCard,view:e.validation.graphicsCard.$invalid?"danger":"default",loading:e.loading.graphicsCard,onInput:e.selectSpec,class:"w-full"},null,8,["modelValue","items","view","loading","onInput"]),(m(!0),p(y,null,C(e.validation.graphicsCard.$errors,((e,a)=>(m(),p("small",{class:"text-red-base",key:a},f(e.$message)+". ",1)))),128))])],64)):_("",!0),e.isSelected?(m(),p(y,{key:1},[(null==(d=e.data.golfSteps)?void 0:d.length)?b((m(),p("div",X,[(m(!0),p(y,null,C(e.data.golfSteps,((a,l)=>{var o,i,n;return m(),p("div",{key:`${a.key}_${l}`},[v("label",Y,f(a.name),1),g(r,{modelValue:e.data[a.key],"onUpdate:modelValue":l=>e.data[a.key]=l,class:"w-full",loading:e.loadingGolf[a.key],view:e.validation[a.key].$invalid?"danger":"default",items:(null==(i=null==(o=e.data)?void 0:o.golfSpecs[a.key])?void 0:i.options)||[],disabled:e.disabled||!e.isSelected,onChange:a=>{var o;return e.handleChangeGolf(null==(o=e.data.golfSteps[l+1])?void 0:o.key)}},null,8,["modelValue","onUpdate:modelValue","loading","view","items","disabled","onChange"]),(m(!0),p(y,null,C(null==(n=e.validation[a.key])?void 0:n.$errors,((e,a)=>(m(),p("small",{class:"text-red-base",key:a},f(e.$message)+". ",1)))),128)),e.loadingGolf[a.key]?b((m(),p("div",Z,null,512)),[[q,e.loadingGolf[a.key]]]):_("",!0)])})),128))])),[[q,null==(t=e.loadingGolf)?void 0:t.all]]):_("",!0),e.data.imei_required?(m(),h(x,{key:1,modelValue:e.data.imei_sn,"onUpdate:modelValue":a[4]||(a[4]=a=>e.data.imei_sn=a),type:"text",label:"IMEI/SN",onKeypress:a[5]||(a[5]=k(S((()=>{}),["prevent"]),["space"])),view:e.isSelected&&e.validation.imei_sn.$invalid?"danger":"default",class:"w-full mt-2",disabled:e.disabled||!e.isSelected},null,8,["modelValue","view","disabled"])):_("",!0),(m(!0),p(y,null,C(e.validation.imei_sn.$errors,((e,a)=>(m(),p("small",{class:"text-red-base",key:a},f(e.$message)+". ",1)))),128)),e.$props.edit?(m(),p(y,{key:2},[v("div",ee,[a[20]||(a[20]=v("label",null,"Color",-1)),g(r,{modelValue:e.data.color_id,"onUpdate:modelValue":a[6]||(a[6]=a=>e.data.color_id=a),class:"w-full",name:"name",by:"id",items:e.state.color_options,disabled:!e.isSelected},null,8,["modelValue","items","disabled"])]),g(x,{modelValue:e.state.condition,"onUpdate:modelValue":a[7]||(a[7]=a=>e.state.condition=a),type:"text",label:"Condition",class:"w-full",disabled:""},null,8,["modelValue"])],64)):(m(),p("div",ae,[v("label",{class:w({"text-red-base":e.validation.condition_name.$invalid})},"Condition",2),e.isCustomCondition?(m(),p(y,{key:0},[g(I,{modelValue:e.data.condition_name,"onUpdate:modelValue":a[8]||(a[8]=a=>e.data.condition_name=a),disabled:e.disabled||!e.isSelected,placeholder:"Input condition",onConfirm:e.confirmCondition,onCancel:e.handleCancelCustomcondition,error:e.isEmptyConditionInput||e.isAlreadyExistCondition},null,8,["modelValue","disabled","onConfirm","onCancel","error"]),e.isEmptyConditionInput||e.isAlreadyExistCondition?(m(),p("small",le,f(e.isEmptyConditionInput?"This field is required.":"This custom condition already exists."),1)):_("",!0)],64)):(m(),h(j,{key:1,modelValue:e.selectedCondition,"onUpdate:modelValue":[a[10]||(a[10]=a=>e.selectedCondition=a),e.selectCondition],"item-name":"condition_name",type:"text",class:"w-full",block:"",placeholder:"Select Condition",items:e.optionConditions,disabled:e.disabled||!e.isSelected},{prepend:V((()=>a[21]||(a[21]=[v("label",{class:"p-4"},"Active Condition",-1)]))),append:V((({collapse:l})=>[e.optionCustomConditions.length>0?(m(),p(y,{key:0},[a[23]||(a[23]=v("label",{class:"px-5 pt-4 pb-2"},"Saved Custom Condition",-1)),(m(!0),p(y,null,C(e.optionCustomConditions,(o=>(m(),p("div",{key:o.id,class:"group flex items-center justify-between gap-2 pl-6 border-t border-grey-01 p-4 hover:bg-grey-lighten w-full"},[v("p",{onClick:()=>{e.data.condition_name=o.condition_name,l()},class:"cursor-pointer w-full"},f(o.condition_name),9,oe),g(D,{loading:e.deleting,onClick:a=>e.deleteCustomCondition(o.id),color:"red",dense:"",view:"smooth",class:"group-hover:opacity-100 opacity-0"},{default:V((()=>a[22]||(a[22]=[v("i",{class:"material-icons"},"delete",-1)]))),_:2},1032,["loading","onClick"])])))),128))],64)):_("",!0),v("button",{onClick:a[9]||(a[9]=(...a)=>e.handleAddCustomcondition&&e.handleAddCustomcondition(...a)),class:"flex items-center gap-2 pl-6 border-t border-grey-01 p-4 hover:bg-grey-lighten w-full"},a[24]||(a[24]=[v("i",{class:"material-icons"},"add",-1),$(" Add Custom Condition ")]))])),_:1},8,["modelValue","onUpdate:modelValue","items","disabled"])),(m(!0),p(y,null,C(e.validation.condition_name.$errors,((e,a)=>(m(),p("small",{class:"text-red-base",key:a},f(e.$message)+". ",1)))),128))])),g(x,{modelValue:e.data.paid,"onUpdate:modelValue":a[11]||(a[11]=a=>e.data.paid=a),type:"text",label:"Cost",class:"w-full",view:e.isSelected&&e.validation.paid.$invalid?"danger":"default",disabled:e.disabled||!e.isSelected,currency:!0,icon:""},{icon:V((()=>[$(f(e.me.currency_symbol),1)])),_:1},8,["modelValue","view","disabled"]),(m(!0),p(y,null,C(e.validation.paid.$errors,((e,a)=>(m(),p("small",{class:"text-red-base",key:a},f(e.$message)+". ",1)))),128)),e.$props.edit?(m(),p(y,{key:4},[g(x,{modelValue:e.state.id,"onUpdate:modelValue":a[12]||(a[12]=a=>e.state.id=a),type:"number",label:"Inventory ID",class:"w-full",disabled:""},null,8,["modelValue"]),g(x,{modelValue:e.state.box_id,"onUpdate:modelValue":a[13]||(a[13]=a=>e.state.box_id=a),type:"text",label:"Source",class:"w-full",disabled:""},null,8,["modelValue"]),v("div",ie,[a[25]||(a[25]=v("label",null,"Status",-1)),g(r,{modelValue:e.data.status,"onUpdate:modelValue":a[14]||(a[14]=a=>e.data.status=a),class:"w-full",name:"name",by:"id",items:e.statuses},null,8,["modelValue","items"])]),g(x,{modelValue:e.data.sold,"onUpdate:modelValue":a[15]||(a[15]=a=>e.data.sold=a),type:"number",label:"Sold",class:"w-full",disabled:""},null,8,["modelValue"])],64)):_("",!0)],64)):_("",!0)],64)}]]);export{ne as F};
