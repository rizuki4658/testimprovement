var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,c=(a,t,o)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[t]=o,s=(e,a)=>{for(var t in a||(a={}))i.call(a,t)&&c(e,t,a[t]);if(o)for(var t of o(a))r.call(a,t)&&c(e,t,a[t]);return e};import{k as n,m as d,o as l,n as u,aO as m,w as p,q as v,O as f,f as b,x as j,_}from"./vendor.9695fe57.js";import{u as y}from"./components.3d07dc59.js";import{u as C}from"./buyback.2c2958be.js";import{_ as g,u as w,b as h}from"./index.9c4dcead.js";import{u as k,a as O}from"./customer.f1de99c3.js";import{C as x}from"./card.afeb5d7a.js";import{S as q}from"./stepper.6b3ab4c6.js";import{P as B}from"./PaymentMethod.a36b8595.js";import{D as S}from"./Device.c347f6f1.js";import{C as D}from"./Customer.42c51193.js";import{B as P}from"./Breadcrumb.faa47922.js";import"./LoadingCard.ab052f4a.js";import"./date.f86face7.js";import"./format.f845777a.js";import"./tab.f3c6bb7c.js";import"./Custom.1166315b.js";import"./InputPhone.084d26de.js";import"./SelectCountry.18d0f3bb.js";import"./setting.ec7e7a35.js";import"./index.f40e4a9e.js";import"./index.6b6f6369.js";import"./index.54844a74.js";import"./payment.f1f9da12.js";import"./select.399034f1.js";import"./TremendousCard.2ddef0dd.js";import"./Form.f67eac20.js";import"./device.2fd98634.js";import"./badge.6233536e.js";import"./auto-complete.61a61751.js";import"./Currency.c0281ec2.js";import"./Accordion.02b75cc0.js";import"./BBTable.ce01765d.js";import"./DeviceSearch.7bda05aa.js";import"./BDropdown.a565aa96.js";import"./DeviceGolfSpec.219eac33.js";import"./BSelect.3683cd97.js";import"./fieldset.b90636af.js";import"./CancelAdd.2c4697e5.js";import"./Info.b6532490.js";import"./DeviceGolfSpecBadge.6f36ec64.js";import"./Form.c61d511a.js";import"./breadcrumb.bd47f77c.js";var T=g(n({components:{Breadcrumb:P},setup:e=>({breadcrumb:[{text:"Mail-In Buyback",to:{name:"buybackOnline"}},{text:"Create Buyback"}]})}),[["render",function(e,a,t,o,i,r){const c=d("Breadcrumb",!0);return l(),u(c,{class:"mt-4 mb-8",pageTitle:"Create Buyback",backTo:{name:"buybackOnline"},items:e.breadcrumb},m({_:2},[e.$slots.buttonStep?{name:"right",fn:p((()=>[v(e.$slots,"buttonStep")])),key:"0"}:void 0]),1032,["items"])}]]),I=n({components:{PaymentMethod:B,Device:S},setup(){w();const e=f(),{genSuspense:o}=y(),i=b(1),{dataCustomer:r,dataPaymentMethod:c,dataDevice:n,loading:d,action:l}=C("online"),{state:u,action:m}=k("online"),{data:p,action:v,loading:g}=O(),P=b(!1),I=b(!1),$=b(!1),M=b(!1),F=async e=>{r.customer_id=e.customer_id||e.id,r.customer_email=e.email,r.customer_firstname=e.first_name,r.customer_lastname=e.last_name,await m(e.customer_id),i.value=2},A=e=>{Object.assign(p,e)},E=()=>j(h,{color:"teal",loading:g.value,onClick:()=>(async()=>{M.value.refChildComponent.validate&&M.value.refChildComponent.validate()&&await v((async e=>{await F(e)}))})()},{default:()=>"Continue"}),G=()=>{if(1===i.value)return[j(D,{onData:A,onChoose:F,ref:M,choose:!0,onChange:e=>P.value="CustomerForm"===e}),j("div",{class:["flex","items-center","justify-end"]})];{let e;return 2===i.value?e=j(B,{data:c.value,items:u.value,ref:$,autoSelect:I.value,showTip:!0,"onUpdate:data":e=>{c.value=e}}):3===i.value&&(e=o({component:S,props:{data:n.value,"onUpdate:data":e=>{n.value=e},buybackType:"mailin"}})),[j(x,{class:"mb-4"},{default:()=>e})]}},U=()=>j(h,{view:"outlined",color:"teal",onClick:()=>{2===i.value&&(c.value=null),i.value--}},{default:()=>"Back"}),L=()=>1===i.value?P.value&&E()||"":2===i.value?j("div",{class:"flex items-center justify-between gap-x-2"},{default:()=>[U(),j(h,{color:"teal",loading:d.value,onClick:()=>{var e;I.value=!0;null!=(e=$.value.refChildComponent.validate&&$.value.refChildComponent.validate())&&e&&i.value++}},{default:()=>"Continue"})]}):3===i.value?j("div",{class:"flex items-center justify-between gap-x-2"},{default:()=>[U(),j(h,{color:"teal",loading:d.value,onClick:async()=>{if(!n.value)return _({message:"Please add at least one item first",type:"warning"}),!1;n.value=n.value.map((e=>{var o,i;return 1==e.device.is_custom?s({category:e.device.category_name,category_id:e.device.category_id,product_name:e.product.name,condition:e.device.condition.name,condition_id:e.device.condition.id,price:e.device.price,qty:e.device.qty,is_mac:e.device.is_mac,imei_sn:e.device.imei_sn,is_custom:1,notes:e.device.notes},e.device.custom_color?{custom_color:e.device.custom_color,color_id:null}:{color_id:(null==(o=e.device.color)?void 0:o.id)||null}):(r=s(s({brand:e.product.brand?e.product.brand:e.product.name,category:e.product.category?e.product.category:e.product.name,product_id:e.product.id,condition_id:e.device.condition.id,price:e.device.price,qty:e.device.qty,is_mac:e.device.is_mac,imei_sn:e.device.imei_sn,unique_id:`${(new Date).getTime()}_${e.product.id}_${e.device.condition.id}`,is_custom:0,notes:e.device.notes},e.device.golf_specs),e.device.custom_color?{custom_color:e.device.custom_color,color_id:null}:{color_id:(null==(i=e.device.color)?void 0:i.id)||null}),c={questions:e.device.questions.reduce(((e,a)=>("object"==typeof a.answer_id?a.answer.forEach((t=>e.push({question_id:a.question_id,answer_id:t.id}))):a.answer_id&&e.push({question_id:a.question_id,answer_id:a.answer.id}),e)),[])},a(r,t(c)));var r,c})),await l((a=>{e.push({name:"buybackOnlineDetail",query:{ref:"create-order"},params:{buybackId:a.data.box_id}})}))}},{default:()=>"Continue"})]}):[j("span")];return()=>[j(T,{},{buttonStep:()=>L()}),j(x,{},{default:()=>[j(q,{activeStep:i.value,steps:["Customer","Payout","Item"],class:"mb-16",color:"teal"}),G()]})]}});export{I as default};
