{"version":3,"file":"index.62736269.js","sources":["../../src/views/integration/shipengine/index.vue"],"sourcesContent":["<template>\n  <Modal\n    size=\"md\"\n    :modelValue=\"true\"\n    :hide-footer=\"isHideFooter\"\n    @click-close=\"handleCloseForm\"\n    without-transition\n  >\n    <template #header>\n      <div class=\"flex justify-between\">\n        <span>Shipengine Settings</span>\n        <Button\n          v-if=\"isShowEditCredential\"\n          @click=\"handleEditCredential\"\n          color=\"teal\"\n          dense\n        >\n          <div class=\"flex flex-auto items-center\">\n            <i class=\"material-icons icon-xxs\">edit</i>\n            <span class=\"ml-1\"> Edit API Key</span>\n          </div>\n        </Button>\n      </div>\n    </template>\n    <template #default>\n      <template v-if=\"status.is_ready == 0\">\n        <div\n          class=\"flex items-center bg-orange-lighten text-orange-04 p-4 rounded-lg w-full mx-auto my-4\"\n        >\n          <i class=\"material-icons mr-4 self-start\">info</i>\n          <span\n            >Please activate Mail-in location and complete all forms.\n            <router-link\n              class=\"font-semibold text-orange-04\"\n              :to=\"{ name: 'settingManageLocation' }\"\n            >\n              Mail-In Settings\n            </router-link>\n            .</span\n          >\n        </div>\n        <div\n          class=\"flex items-center bg-blue-lighten text-blue-04 p-4 rounded-lg w-full mx-auto my-4\"\n        >\n          <i class=\"material-icons mr-4 self-start\">info</i>\n          <span\n            >Please make sure your ShipEngine account is in the same country as\n            the country setting in Reusely.\n            <router-link\n              class=\"font-semibold text-blue-04\"\n              :to=\"{ name: 'settingManageLocation' }\"\n            >\n              Country Settings\n            </router-link>\n            .</span\n          >\n        </div>\n      </template>\n      <RouterView v-slot=\"{ Component, route }\">\n        <template v-if=\"Component\">\n          <Transition\n            name=\"slide-fade\"\n            :key=\"route.matched[route.matched.length - 2].name\"\n          >\n            <KeepAlive>\n              <Suspense>\n                <template #default>\n                  <component ref=\"refComponent\" :is=\"Component\"></component>\n                </template>\n                <template #fallback>\n                  <div class=\"w-full flex items-center justify-center\">\n                    <BaseLoading />\n                  </div>\n                </template>\n              </Suspense>\n            </KeepAlive>\n          </Transition>\n        </template>\n      </RouterView>\n    </template>\n    <template #footer>\n      <Tooltip\n        placement=\"top\"\n        content=\"Please choose a shipping courier first\"\n        :disabled=\"!isNotSelectedCarrier\"\n      >\n        <template #default>\n          <div class=\"w-max ml-auto\">\n            <Button\n              @click=\"handleSave\"\n              color=\"teal\"\n              :disabled=\"\n                loading.shippingProvider.fetchCarriers ||\n                loading.shippingKit.fetch ||\n                loadingConfig.integrationChecks ||\n                status.is_ready == 0 ||\n                isNotSelectedCarrier\n              \"\n              :loading=\"\n                loading.shippingProvider.updateCarrier ||\n                loadingShippingKit.update\n              \"\n              >Save</Button\n            >\n          </div>\n        </template>\n      </Tooltip>\n    </template>\n  </Modal>\n</template>\n\n<script>\nimport { defineComponent, ref } from 'vue'\nimport { useRouter, useRoute } from 'vue-router'\nimport {\n  useShippingProvider,\n  useShippingKit,\n  useConfig,\n  useStatus\n} from 'composable/integration/shipengine'\n\nimport Modal from 'bbUi/components/modal/modal.vue'\nimport Tab from 'bbUi/components/tab/tab.vue'\nimport Button from 'bbUi/components/button/button.vue'\nimport ShippingKitForm from 'components/Integration/ShippingKitForm.vue'\nimport BaseLoading from 'components/BaseLoading.vue'\n\nimport { computed } from '@vue/reactivity'\nimport { ElMessage } from 'element-plus'\n\nexport default defineComponent({\n  name: 'Shipmondo',\n  components: {\n    Modal,\n    Button,\n    Tab,\n    ShippingKitForm,\n    BaseLoading\n  },\n  async setup() {\n    const route = useRoute()\n    const router = useRouter()\n    const { loading, updateCarrier, resetSelectedCarrier, selectedCarrier } =\n      useShippingProvider()\n    const { loading: loadingShippingKit, updateShippingKit } = useShippingKit()\n    const { loading: loadingConfig } = useConfig()\n    const { status, fetchStatus } = useStatus()\n\n    const refComponent = ref(null)\n\n    const isHideFooter = computed(() =>\n      route.matched.length > 0\n        ? route.matched.find(\n            (eachRoute) => eachRoute.name === 'integrationShipengineConfig'\n          ) === undefined\n        : false\n    )\n    const isOnShippingKitSection = computed(\n      () => route.name === 'integrationShipengineConfigShippingKit'\n    )\n    const isShowEditCredential = computed(() => !isHideFooter.value)\n    const isNotSelectedCarrier = computed(\n      () => selectedCarrier.value.carrier_uuid === null\n    )\n\n    const handleCloseForm = () => {\n      router.push({\n        name: 'integration',\n        query: {\n          reload: 1\n        }\n      })\n    }\n    const handleSave = async () => {\n      if (isOnShippingKitSection.value) {\n        const isValid =\n          await refComponent.value?.componentElement?.shippingKitFormElement?.validate?.()\n        if (!isValid) return\n      }\n      let isError = {\n        carrier: false,\n        shippingKit: false\n      }\n      await Promise.all([\n        updateCarrier((err) => (isError.carrier = err)),\n        updateShippingKit((err) => (isError.shippingKit = err))\n      ])\n      if (isError.carrier || isError.shippingKit) {\n        resetSelectedCarrier()\n        return\n      }\n      ElMessage({\n        type: 'success',\n        message: 'Changes saved'\n      })\n      router.push({\n        name: 'integration',\n        query: {\n          reload: 1\n        }\n      })\n    }\n    const handleEditCredential = () => {\n      router.push({\n        name: 'integrationShipengineConnect'\n      })\n    }\n\n    await Promise.all([fetchStatus()])\n\n    return {\n      route,\n      refComponent,\n      loading,\n      loadingShippingKit,\n      loadingConfig,\n      isHideFooter,\n      isShowEditCredential,\n      isNotSelectedCarrier,\n      status,\n      handleCloseForm,\n      handleSave,\n      handleEditCredential\n    }\n  }\n})\n</script>\n<style lang=\"scss\" scoped>\n.loading-logo {\n  animation: rotate 0.8s infinite linear;\n}\n@keyframes rotate {\n  from {\n    transform: rotate(0deg);\n  }\n  to {\n    transform: rotate(-360deg);\n  }\n}\n</style>\n"],"names":["_sfc_main","defineComponent","name","components","Modal","Button","Tab","ShippingKitForm","BaseLoading","[object Object]","route","useRoute","router","useRouter","loading","updateCarrier","resetSelectedCarrier","selectedCarrier","useShippingProvider","loadingShippingKit","updateShippingKit","useShippingKit","loadingConfig","useConfig","status","fetchStatus","useStatus","refComponent","ref","isHideFooter","computed","matched","length","find","eachRoute","isOnShippingKitSection","isShowEditCredential","value","isNotSelectedCarrier","carrier_uuid","Promise","all","handleCloseForm","push","query","reload","handleSave","async","_d","_c","_b","_a","componentElement","shippingKitFormElement","validate","call","isError","carrier","shippingKit","err","_u","type","message","handleEditCredential","_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","_openBlock","_createBlock","_component_Modal","size","modelValue","hide-footer","_ctx","onClickClose","header","_withCtx","_createElementVNode","_cache","key","onClick","color","default","_createElementBlock","_Fragment","_createTextVNode","_createVNode","_component_router_link","_createCommentVNode","Component","_Transition","_KeepAlive","_Suspense","fallback","_component_Tooltip","placement","content","_hoisted_5","_component_Button","shippingProvider","fetchCarriers","fetch","integrationChecks","is_ready"],"mappings":"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"}