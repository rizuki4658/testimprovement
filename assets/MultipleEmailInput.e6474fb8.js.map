{"version":3,"file":"MultipleEmailInput.e6474fb8.js","sources":["../../src/components/MultipleEmailInput.vue"],"sourcesContent":["<template>\n  <div class=\"cursor-text p-4 border border-grey-01 rounded-lg flex flex-wrap gap-3 transition-all\" :class=\"{ 'opacity-50 cursor-not-allowed': disabled }\" @click=\"focusInput\">\n    <span v-for=\"(e, i) in emails\" :class=\"{ 'px-4 py-1 bg-teal-01 hover:bg-teal-04 hover:text-white transition-all border border-teal-04 rounded-3xl cursor-pointer flex items-center space-x-1': emails.length > 0 }\" @click=\"editEmail(i)\" :key=\"i\">\n      <span>{{ e }}</span>\n      <i class=\"material-icons mt-1\" @click=\"removeEmail(i)\">close</i>\n    </span>\n    <div v-if=\"!!suggestion\" class=\"relative my-auto\">\n      <input ref=\"inputEmailRef\" v-model=\"data.email\" :class=\"{ 'w-full': emails.length <= 0, 'cursor-not-allowed': disabled }\" :style=\"{ width: `${size}px` }\" :readonly=\"disabled\" @keydown=\"keyArrow\" @keypress=\"inputEmail\" @input=\"searchEmail\" @blur=\"handleAddEmail\" />\n      <div v-if=\"state.data && state.data.length > 0 && data.email && !!suggestion\" :class=\"!!sticky ? 'absolute top-full' : 'fixed top-full'\" class=\"bg-white py-4 rounded space-y-3 shadow\" style=\"z-index: 2001\">\n        <div v-for=\"(user, i) in state.data\" :tabindex=\"i\" :key=\"user\" class=\"px-4 py-4 cursor-pointer\" :class=\"{ 'bg-grey-01': i === emailFocused }\" @mouseover=\"emailOver(i)\" @click=\"selectEmail\">\n          <div class=\"text-lg text-grey-darken font-semibold\">{{ `${user.first_name} ${user.last_name}` }}</div>\n          <div>{{ user.email }}</div>\n        </div>\n      </div>\n    </div>\n    <div v-else class=\"relative my-auto\">\n      <input ref=\"inputEmailRef\" v-model=\"data.email\" :class=\"{ 'w-full': emails.length <= 0, 'cursor-not-allowed': disabled }\" :style=\"{ width: `${size}px` }\" :readonly=\"disabled\" @keydown=\"keyArrow\" @keypress=\"inputEmail\" @input=\"searchEmail\" @blur=\"handleAddEmail\" />  \n    </div>\n  </div>\n  <template v-if=\"data.email !== ''\">\n    <span v-for=\"error of validation.email.$errors\" class=\"text-red-base mt-2 block\" :key=\"error\">\n      {{ error.$message }}. \n    </span>\n  </template>\n</template>\n\n<script>\nimport { defineComponent, ref, reactive, watch, onMounted } from 'vue'\nimport { deepClone } from 'utils/deep-clone'\nimport { useVuelidate } from '@vuelidate/core'\nimport { email, requiredIf } from \"@vuelidate/validators\"\nimport debounce from 'utils/debounce'\nimport { useManageUserAll } from 'composable/setting'\nimport { ElMessage } from 'element-plus'\n\nexport default defineComponent({\n  name: 'MultipleEmailInput',\n  emits: ['email-change'],\n  props: {\n    emails: {\n      type: Array,\n      default: () => []\n    },\n    disabled: {\n      type: Boolean,\n      default: false\n    },\n    suggestion: {\n      type: Boolean,\n      default: false\n    },\n    autofocus: {\n      type: Boolean,\n      default: false\n    },\n    sticky: {\n      type: Boolean,\n      default: false\n    }\n  },\n  setup(props, { emit }) {\n    const { actionAll, state, data: dataUser } = useManageUserAll()\n    const data = reactive({ email: '' })\n    const emails = ref(deepClone(props.emails))\n    const inputEmailRef = ref(null)\n    const size = ref(5)\n    const emailFocused = ref(-1)\n\n    const focusInput = () => {\n      if (props.disabled) {\n        return\n      }\n\n      inputEmailRef.value.focus()\n    }\n\n    const emitEmails = debounce(() => {\n      emit('email-change', emails.value)\n    }, 300)\n\n    const searchEmail = debounce(async () => {\n      if(props.suggestion){\n        dataUser.page = 1\n        dataUser.limit = 3\n        dataUser.search = data.email\n        await actionAll()\n      }\n    }, 300)\n\n    watch(\n      () => data.email,\n      () => {\n        if(typeof data.email === 'string') data.email = data.email.trim()\n        size.value = data.email?.length * 9\n        if (data.email?.length === 0) {\n          size.value = 9\n          return\n        }\n      }\n    )\n\n    if (props.suggestion) {\n      watch(\n        () => props.emails,\n        () => {\n          emails.value = deepClone(props.emails)\n          emit('email-change', emails.value)\n        }\n      )\n    }\n\n    const rules = {\n      email: { \n        required: requiredIf(() => !!data.email ),\n        email \n      }\n    }\n    \n    const validation = useVuelidate(rules, data, {\n      $lazy: true\n    })\n\n    const validate = () => {\n      validation.value.$validate()\n      return !validation.value.$invalid\n    }\n\n    const keyArrow = ($event) => {\n      if (\n        !data.email.split('').length ||\n        !(state.value.data && state.value.data.length) ||\n        !(state.value && Array(state.value) && state.value.length)\n      ) return undefined\n\n      const keyCode = ($event.keyCode ? $event.keyCode : $event.which)\n      // if (!data.email || (state.value.data && state.value.data.length <= 0)) {\n      //   return\n      // }\n\n      if (keyCode === 38 && emailFocused.value > 0) {\n        emailFocused.value -= 1\n      }\n\n      if (keyCode === 40 && emailFocused.value < (state.value.data.length - 1)) {\n        emailFocused.value += 1\n      }\n\n      if (keyCode !== 40 && keyCode !== 39 && keyCode !== 38 && keyCode !== 37 && keyCode !== 13) {\n        emailFocused.value = -1\n      }\n    }\n\n    const emailOver = (i) => {\n      emailFocused.value = i\n    }\n\n    const emailChecker = (email) => {\n      let result = true\n      emails.value.map(v => {\n        if (v === email) {\n          ElMessage({\n            message: 'Email already added',\n            type: 'warning'\n          })\n          result = false\n        }\n      })\n\n      return result\n    }\n\n    const selectEmail = () => {\n      if (emailFocused.value >= 0 && emailFocused.value <= (state.value.data.length - 1)) {\n        if (emailChecker(state.value.data[emailFocused.value].email)) {\n          emails.value.push(state.value.data[emailFocused.value].email)\n          setTimeout(() => data.email = '', 1)\n          emitEmails()\n        }\n      }\n    }\n\n    const inputEmail = ($event) => {\n      if (!data.email.split('').length) return\n\n      const keyCode = ($event.keyCode ? $event.keyCode : $event.which)\n\n      if (data.email?.length >= 60 || (keyCode === 32 && !data.email)) {\n        $event.preventDefault()\n      }\n\n      if ((keyCode === 13 || keyCode === 32) && data.email.trim().length > 0) {\n        selectEmail()\n\n        if (!validate()) {\n          if (keyCode === 32) {\n            $event.preventDefault()\n          }\n          return\n        }\n\n        if (emailChecker(data.email)) {\n          emails.value.push(data.email)\n          setTimeout(() => data.email = '', 1)\n          emitEmails()\n        }\n      }\n    }\n\n    const removeEmail = (i) => {\n      emails.value.splice(i, 1)\n      emitEmails()\n    }\n\n    const editEmail = (i) => {\n      const selectedEmail = emails.value.splice(i, 1)\n      data.email = selectedEmail[0]\n    }\n\n    const handleAddEmail = () => {\n      if(!data.email) return\n      selectEmail()\n        if (!validate()) return null\n        if (emailChecker(data.email)) {\n          emails.value.push(data.email)\n          setTimeout(() => data.email = '', 1)\n          emitEmails()\n        }\n    }\n\n    onMounted(() => {\n      if (props.autofocus){\n        if (inputEmailRef.value) inputEmailRef.value.focus()\n      }\n    })\n\n    return {\n      state,\n      data,\n      emails,\n      size,\n      keyArrow,\n      emailFocused,\n      focusInput,\n      emailOver,\n      inputEmail,\n      searchEmail,\n      validation,\n      validate,\n      inputEmailRef,\n      removeEmail,\n      selectEmail,\n      editEmail,\n      handleAddEmail\n    }\n  }\n})\n</script>\n"],"names":["_sfc_main","defineComponent","name","emits","props","emails","type","Array","default","disabled","Boolean","suggestion","autofocus","sticky","[object Object]","emit","actionAll","state","data","dataUser","useManageUserAll","reactive","email","ref","deepClone","inputEmailRef","size","emailFocused","emitEmails","debounce","value","searchEmail","async","page","limit","search","watch","trim","_a","length","_b","rules","required","requiredIf","validation","useVuelidate","$lazy","validate","$validate","$invalid","emailChecker","email2","result","map","v","_u","message","selectEmail","push","setTimeout","onMounted","focus","keyArrow","$event","split","keyCode","which","focusInput","emailOver","i","inputEmail","preventDefault","removeEmail","splice","editEmail","selectedEmail","handleAddEmail","key","_hoisted_5","_openBlock","_createElementBlock","_Fragment","class","_normalizeClass","opacity-50 cursor-not-allowed","_ctx","_renderList","e","px-4 py-1 bg-teal-01 hover:bg-teal-04 hover:text-white transition-all border border-teal-04 rounded-3xl cursor-pointer flex items-center space-x-1","onClick","_createElementVNode","_toDisplayString","_hoisted_3","_withDirectives","onUpdate:modelValue","_cache","cursor-not-allowed","style","_normalizeStyle","width","readonly","onKeydown","args","onKeypress","onInput","_hoisted_4","user","tabindex","bg-grey-01","onMouseover","_hoisted_6","first_name","last_name","_hoisted_7","_hoisted_8","$errors","error"],"mappings":"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"}