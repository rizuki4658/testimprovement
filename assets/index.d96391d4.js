var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,i=(a,l,o)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[l]=o,s=(e,a)=>{for(var l in a||(a={}))t.call(a,l)&&i(e,l,a[l]);if(o)for(var l of o(a))n.call(a,l)&&i(e,l,a[l]);return e};import{u as r}from"./components.9eb2d515.js";import{s as c,z as d,b as u,t as p,_ as m,R as v,j as g,d as b,P as y,S as f,x as h}from"./index.10c203ea.js";import{j as k,o as x,n as w,w as _,B as L,ap as P,t as S,U as V,I as j,g as B,W as C,a1 as R,a2 as U,D as $,K as T,F as O,a3 as I,_ as q,a4 as F,k as A,m as M,$ as z,A as D,b0 as E,S as N,f as Y,O as W,aq as G}from"./vendor.9695fe57.js";import{p as K}from"./packages.2dec7882.js";import{C as H}from"./card.6034dd30.js";import{u as J}from"./dashboard.0c3bb578.js";import{a as Q,b as X}from"./billing.2742075c.js";import{s as Z}from"./vue-multiselect.esm.973e2e45.js";import"./LoadingCard.202e648c.js";import"./date.f86face7.js";import"./setting.694f0663.js";const ee=k("settingPlansBilling",{state:()=>({packages:{isLoading:!1,result:void 0,selectedPlan:void 0},verifyPayment:{isLoading:!1,result:void 0},reSubscribe:{modal:!1,isLoading:!1,result:void 0},unpaidBilling:{isLoading:!1,result:void 0}}),getters:{trial(){var e,a,l;return 0===(null==(l=null==(a=null==(e=c)?void 0:e.state)?void 0:a.user)?void 0:l.isTrialEnd)},canceled(){var e,a,l,o;return 3==(null==(o=null==(l=null==(a=null==(e=c)?void 0:e.state)?void 0:a.user)?void 0:l.me)?void 0:o.subscription_status)},unpaid(){var e,a,l;return 0!==(null==(l=null==(a=null==(e=c)?void 0:e.state)?void 0:a.user)?void 0:l.isUnpaidBilling)}},actions:{async $getStripePortal(){const e=await d({url:"/v1/pos/billing/customer/portal",method:"get"});this.stripePortal.result=e},async $getBillingPackages(){const e=await d({url:"/v1/pos/billing/package",method:"get"});this.packages.result=e},async $getVerifyPayment(){const e=await d({url:"/v1/login-status",method:"get"});this.verifyPayment.result=e},async $planCheckout(e){const a=await d({url:"/v1/pos/billing/package/checkout",method:"post",data:e});this.reSubscribe.result=a},async $unpaidBilling(){const e=await d({url:"/v1/pos/billing/invoice/unpaid",method:"post"});this.unpaidBilling.result=e}}}),ae={class:"flex items-center justify-center gap-x-2"},le={key:0,class:"material-icons"},oe={__name:"SettingPlanBillingVerifyPayment",setup(e){const a=ee(),l=async()=>{await p(a.verifyPayment,(()=>a.$getVerifyPayment().then((()=>{var e,l;0===(null==(e=null==a?void 0:a.verifyPayment.result)?void 0:e.is_unpaid_billing)&&0===(null==(l=null==a?void 0:a.verifyPayment.result)?void 0:l.is_trial_end)&&(window.location.href="/dashboard")}))))};return(e,o)=>(x(),w(u,{disabled:P(a).verifyPayment.isLoading,loading:P(a).verifyPayment.isLoading,color:"teal",onClick:l},{default:_((()=>[L("div",ae,[P(a).verifyPayment.isLoading?V("",!0):(x(),S("span",le," refresh ")),o[0]||(o[0]=j(" Verify Payment "))])])),_:1},8,["disabled","loading"]))}};const te={key:0,class:"flex flex-wrap"},ne={class:"space-y-8"},ie={class:"space-y-4"},se={class:"flex items-center gap-x-2"},re={class:"text-xl font-medium"},ce={key:0,class:"px-3 py-0.5 bg-teal-04 rounded-full text-white text-sm"},de={class:"text-grey-03"},ue={class:"text-5xl font-medium inline-block"},pe={key:0,class:"ml-2"},me={key:1,class:"ml-2"},ve={key:0,class:"bg-green-01 text-green-04 rounded-full px-4 py-1 inline-block"},ge={class:"font-semibold"},be={key:1},ye={class:"font-medium text-teal-04"},fe={class:"flex items-center gap-x-3"};var he=m({__name:"SettingPlanBillingPackages",props:{period:{type:String,default:"monthly"}},setup(e,{expose:a}){var l;const o=e,t=B((()=>{var e,a;return(null==(e=n.packages)?void 0:e.result)&&(null==o?void 0:o.period)?null==(a=n.packages)?void 0:a.result[null==o?void 0:o.period].map((e=>s(s({},K.find((a=>e.package_id===a.id))),e))).sort(((e,a)=>e.sort-a.sort)):[]})),n=ee(),i=async()=>{await p(n.packages,(()=>n.$getBillingPackages()))};return C((async()=>{var e;(null==(e=null==n?void 0:n.packages)?void 0:e.result)||i()})),a({currentInterval:null==(l=null==n?void 0:n.packages)?void 0:l.result,onLoad:i}),(e,a)=>{var l;return(null==(l=P(n).packages)?void 0:l.result)?(x(),S("div",te,[(x(!0),S(R,null,U(t.value,((e,l)=>(x(),S("div",{key:l,class:"sm:w-1/2 md:w-1/3 py-4 px-2"},[$(H,{class:"h-full relative"},{default:_((()=>{var t;return[L("div",ne,[L("div",ie,[L("div",se,[L("h5",re,T(e.name),1),e.current_price_id?(x(),S("div",ce," Current Plan ")):V("",!0)]),L("p",de,T(e.description),1)]),L("div",null,[L("h6",ue,T(e.price),1),"monthly"===o.period?(x(),S("span",pe," per location/monthly ")):(x(),S("span",me," savings per year, per location "))]),"monthly"!==o.period&&"$0"!==e.saving_amount?(x(),S("div",ve,[L("span",ge,T(e.saving_amount),1),a[0]||(a[0]=j(" savings per year, per location "))])):(x(),S("div",be)),L("div",null,[L("p",ye,T(e.feature_term),1),L("div",{class:O([(null==(t=e.features)?void 0:t.length)>5&&"columns-2","space-y-1"])},[(x(!0),S(R,null,U(e.features,((e,o)=>(x(),S("div",{key:`${l}_${o}`},[L("div",fe,[a[1]||(a[1]=L("span",{class:"material-icons text-teal-04"},"check_circle",-1)),j(" "+T(e),1)])])))),128))],2)])])]})),footer:_((()=>[L("div",null,[$(u,I({ref_for:!0},s({color:"teal"},!e.current_price_id&&{view:"outlined"}),{block:"",loading:P(n).unpaidBilling.isLoading||P(n).reSubscribe.isLoading,onClick:a=>(async e=>{if(n.packages.selectedPlan=e,n.canceled)n.reSubscribe.modal=!0;else if(e.current_price_id||n.unpaid){const e=window.open();await p(n.unpaidBilling,(()=>n.$unpaidBilling().then((()=>{var a,l,o,t;if(!(null==(l=null==(a=n.unpaidBilling)?void 0:a.result)?void 0:l.invoice))return q({type:"error",message:"An error occurred during checkout. Please reach out to our customer support team for assistance. [No Invoice URL]"});n.packages.selectedPlan=void 0,e.location=null==(t=null==(o=n.unpaidBilling)?void 0:o.result)?void 0:t.invoice}))))}else await p(n.reSubscribe,(()=>n.$planCheckout({price_id:n.packages.selectedPlan.price_id}).then((()=>{n.packages.selectedPlan=void 0,window.location.href=n.reSubscribe.result})).catch((()=>{q({type:"error",message:"An error occurred during checkout. Please reach out to our customer support team for assistance."})}))))})(e)}),{default:_((()=>[j(T((P(n).canceled||P(n).unpaid)&&e.current_price_id?"Resubscribe with current plan":"Subscribe"),1)])),_:2},1040,["loading","onClick"])])])),_:2},1024)])))),128))])):V("",!0)}}},[["__scopeId","data-v-39114e8e"]]);const ke={class:"px-4 py-8"},xe={class:"flex flex-wrap justify-center text-center mt-6 gap-4"},we={__name:"SettingPlanBillingResubscribe",emits:["reactive"],setup(e,{emit:a}){const l=a,{stateFiltered:o}=J(),t=ee(),n=async()=>{t.reSubscribe.modal=!1},i=async()=>{if(o.value.total>1)return l("reactive");await(async(e=1)=>{await p(t.reSubscribe,(()=>t.$planCheckout({price_id:t.packages.selectedPlan.price_id,total_location:"object"==typeof e?null==e?void 0:e.total_selected_location:e}).then((()=>{t.packages.selectedPlan=void 0,window.open(t.reSubscribe.result,"_blank","noreferrer noopener")})).catch((()=>{q({type:"error",message:"An error occurred during checkout. Please reach out to our customer support team for assistance."})}))))})()};return(e,a)=>(x(),w(F,{to:"body"},[$(b,{modelValue:P(t).reSubscribe.modal,"onUpdate:modelValue":a[0]||(a[0]=e=>P(t).reSubscribe.modal=e),size:"xs","hide-footer":"","hide-header":""},{default:_((()=>[L("div",ke,[a[4]||(a[4]=L("img",{class:"mb-10 mx-auto text-orange-base",src:v,alt:"Success Icon"},null,-1)),$(g,{color:"orange",view:"smooth"},{default:_((()=>a[1]||(a[1]=[L("div",{class:"flex"},[L("i",{class:"material-icons mr-4"},"info"),L("p",{whitelabel:"text-replace","data-label":"addons host"}," Your Reusely.com subscription has been canceled due to either unpaid billing, incorrect billing information, or because you canceled it. ")],-1)]))),_:1}),a[5]||(a[5]=L("div",{class:"text-grey-04 rounded-lg px-4 py-6 my-4",style:{backgroundColor:"rgba(0,0,0,0.03)"}},[L("p",{class:"font-medium"},"Important actions to take:"),L("ul",{class:"text-grey-03 my-4"},[L("li",null,"1. When your subscription ends, you will no longer be able to access your account, and your data will be deleted."),L("li",null,"2. If your account is still active, please take this time to download any customer or other data you may need.")]),L("p",{class:"text-grey-03"},"Reach out to our support team for additional help.")],-1)),L("div",xe,[$(u,{disabled:P(t).reSubscribe.isLoading,color:"white",onClick:n},{default:_((()=>a[2]||(a[2]=[j(" Cancel ")]))),_:1},8,["disabled"]),$(u,{loading:P(t).reSubscribe.isLoading,color:"teal",onClick:i},{default:_((()=>a[3]||(a[3]=[j(" Reactive Subscription ")]))),_:1},8,["loading"])])])])),_:1},8,["modelValue"])]))}},_e=A({name:"ResubsLocationForm",components:{MultiSelect:Z,Pagination:y,Select:f},props:{modelValue:{type:Object,default:()=>({})},mainLoading:{type:Boolean,default:!1}},emits:["update:modelValue","continue"],setup(e,o){const{loading:t,data:n,query:i,showLocation:r}=Q(),c=B({get:()=>e.modelValue,set:e=>o.emit("update:modelValue",e)}),d=B((()=>{var e,a;const l=null==(a=null==(e=c.value)?void 0:e.locations)?void 0:a.map((e=>e.id));return l.length?[...n.locations].filter((e=>!l.includes(e.id))):n.locations})),u=B((()=>{var e,a,l;return((null==(e=null==n?void 0:n.locations)?void 0:e.length)||0)-((null==(l=null==(a=c.value)?void 0:a.locations)?void 0:l.length)||0)})),p=e=>(n.locations=n.locations.map((o=>{return t=s({},o),n={transfer:null,checked:e.id!==o.id&&o.checked},a(t,l(n));var t,n})),e.checked=!1,e),m=e=>(e.checked=!0,e);return C((async()=>{await r()})),{loading:t,data:n,query:i,form:c,locationToTransfer:d,showLocation:r,unselecLocation:u,handleUpdateCheck:(e,a)=>{if(null==a?void 0:a.checked)return p(a);m(a)},handleRemoveLocation:p,handleSelectLocation:m,handleSelectTransferLocation:e=>(c.value.transfers=[...d.value].filter((e=>![null,void 0].includes(e.transfer))),e)}}}),Le={class:"border border-grey-01 rounded-lg p-4 space-y-8"},Pe={class:"space-y-2"},Se={class:"lg:mx-10"},Ve={class:"flex items-center gap-x-4"},je=["onUpdate:modelValue"],Be={class:"text-sm text-grey-03 mb-1"},Ce={key:0,class:"lg:mx-10 space-y-6"},Re={key:0,class:"bg-orange-01 text-orange-04 rounded-md px-4 py-2"},Ue={class:"flex items-center gap-x-4"},$e={class:"border border-grey-01 border-opacity-50 space-y-6"},Te={class:"space-y-2"},Oe={class:"w-full block text-sm font-semibold"},Ie={class:"w-full text-xs"},qe={key:0,class:"px-4 pb-4"};const Fe=A({name:"ResubsLocation",components:{Modal:b,Button:u,ResubsLocationForm:m(_e,[["render",function(e,a,l,o,t,n){var i,s,r,c,d,u;const p=M("MultiSelect"),m=M("TableColumn"),v=M("Select"),g=M("Table"),b=M("Pagination"),y=z("loading");return x(),S("form",{onSubmit:a[3]||(a[3]=N((()=>{}),["prevent"]))},[L("div",Le,[L("div",Pe,[a[5]||(a[5]=L("div",{class:"flex items-center gap-x-4 mb-6"},[L("div",{class:"bg-teal-04 w-6 h-6 text-white flex items-center justify-center rounded-full"},"1"),L("p",{class:"font-semibold"},"Resubscribe Location")],-1)),L("div",Se,[L("div",null,[a[4]||(a[4]=L("label",{class:"text-sm"},"Location",-1)),$(p,{modelValue:e.form.locations,"onUpdate:modelValue":a[0]||(a[0]=a=>e.form.locations=a),placeholder:"Choose Location",loading:e.loading.location,disabled:e.loading.location,options:e.data.locations,multiple:!0,"hide-selected":!1,"show-labels":!1,"show-no-results":!0,"show-no-options":!0,searchable:!1,"track-by":"id",label:"name",onRemove:e.handleRemoveLocation,onSelect:e.handleSelectLocation,required:""},{option:_((e=>[L("div",Ve,[D(L("input",{"onUpdate:modelValue":a=>e.option.checked=a,type:"checkbox",class:"w-5 h-5 text-teal-04 bg-teal-04 border-gray-300 rounded",style:{"accent-color":"rgba(66, 66, 66, 0.11)"}},null,8,je),[[E,e.option.checked]]),L("div",null,[L("p",Be,T(e.option.name),1),L("p",null,T(e.option.address_text),1)])])])),_:1},8,["modelValue","loading","disabled","options","onRemove","onSelect"])])])]),L("div",{class:O([[(null==(s=null==(i=e.form)?void 0:i.locations)?void 0:s.length)?"opacity-100":"opacity-50"],"space-y-2"])},[a[8]||(a[8]=L("div",{class:"flex items-center gap-x-4 mb-6"},[L("div",{class:"bg-teal-04 w-6 h-6 text-white flex items-center justify-center rounded-full"},"2"),L("p",{class:"font-semibold"},"Transfer Data")],-1)),(null==(c=null==(r=e.form)?void 0:r.locations)?void 0:c.length)?(x(),S("div",Ce,[e.unselecLocation?(x(),S("div",Re,[L("div",Ue,[a[7]||(a[7]=L("i",{class:"material-icons"},"info",-1)),L("p",null,[L("b",null,"Important: "+T(e.unselecLocation)+" locations are currently unselected",1),a[6]||(a[6]=j(". These locations will be permanently deleted; however, you must transfer their data to another location to proceed. Select the locations you want to transfer the data to below. "))])])])):V("",!0),L("div",$e,[D((x(),w(g,{data:e.locationToTransfer},{default:_((()=>[$(m,{prop:"name",label:"Location Name"}),$(m,{prop:"address_text",label:"Address"}),$(m,{prop:"email",label:"Email"}),$(m,{prop:"phone",label:"Phone Number"}),$(m,{label:"Transfer Location",width:"350"},{default:_((({row:a})=>[$(v,{modelValue:a.transfer,"onUpdate:modelValue":e=>a.transfer=e,by:"id",name:"name",placeholder:"Choose Location",items:e.form.locations,block:"","no-border":"","max-height":"200px",onChange:l=>e.handleSelectTransferLocation(a)},{item:_((({item:e})=>[L("div",Te,[L("span",Oe,T(e.name),1),L("span",Ie,T(e.address_text),1)])])),_:2},1032,["modelValue","onUpdate:modelValue","items","onChange"])])),_:1})])),_:1},8,["data"])),[[y,e.loading.transfer]]),(null==(u=null==(d=e.form)?void 0:d.locations)?void 0:u.length)>10?(x(),S("div",qe,[$(b,{page:e.query.page,"onUpdate:page":a[1]||(a[1]=a=>e.query.page=a),limit:e.query.limit,"onUpdate:limit":a[2]||(a[2]=a=>e.query.limit=a)},null,8,["page","limit"])])):V("",!0)])])):V("",!0)],2)])],32)}]])},props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","subscribe"],setup(e,a){const l=Y(),{form:o,loading:t,removeLocation:n}=X(),i=B({get:()=>e.modelValue,set:e=>a.emit("update:modelValue",e)}),s=B((()=>{var e,a,o;return(null==(o=null==(a=null==(e=null==l?void 0:l.value)?void 0:e.data)?void 0:a.locations)?void 0:o.length)||0})),r=B((()=>{var e,a,t;return!(null==(e=null==o?void 0:o.locations)?void 0:e.length)||(null==(a=null==o?void 0:o.transfers)?void 0:a.length)<(null==(t=null==l?void 0:l.value)?void 0:t.unselecLocation)})),c=()=>{i.value=!1,o.locations=[],o.transfers=[]};return{show:i,form:o,loading:t,locations:s,disabledButton:r,resubsLocationForm:l,removeLocation:n,continueRemoveLocation:async()=>{var e,l;(null==(e=null==o?void 0:o.locations)?void 0:e.length)<s.value&&await n(),a.emit("subscribe",{total_selected_location:null==(l=null==o?void 0:o.locations)?void 0:l.length}),c()},cancelRemoveLocation:c}}}),Ae={class:"py-4 space-y-6"},Me={class:"space-y-6"},ze={key:0,class:"bg-blue-01 text-blue-04 rounded-lg px-4 py-2"},De={class:"flex gap-x-4"},Ee={class:"text-sm"},Ne={class:"font-semibold"},Ye={class:"flex items-center justify-end gap-x-4"};var We=m(Fe,[["render",function(e,a,l,o,t,n){const i=M("ResubsLocationForm"),s=M("Button"),r=M("Modal"),c=z("loading");return x(),w(F,{to:"body"},[$(r,{modelValue:e.show,"onUpdate:modelValue":a[2]||(a[2]=a=>e.show=a),size:"lg","hide-header":""},{default:_((()=>[L("div",Ae,[L("div",Me,[a[4]||(a[4]=L("div",{class:"flex items-center justify-center"},[L("img",{src:"/assets/attention-blue.85832a40.svg",alt:"Info Icon"})],-1)),a[5]||(a[5]=L("p",{class:"text-center text-lg font-semibold"},"Before you continue",-1)),e.locations&&e.locations>1?(x(),S("div",ze,[L("div",De,[L("p",Ee,[L("span",Ne," You have "+T(`${e.locations} locations`),1),a[3]||(a[3]=j(". Choose the locations you want to include in your billing update. "))])])])):V("",!0)]),D((x(),S("div",null,[$(i,{ref:"resubsLocationForm",modelValue:e.form,"onUpdate:modelValue":a[0]||(a[0]=a=>e.form=a),"main-loading":e.loading},null,8,["modelValue","main-loading"])])),[[c,e.loading]])])])),footer:_((()=>[L("div",Ye,[L("a",{href:"#",class:"hover:opacity-50 hover:bg-grey-01 px-6 py-3.5 rounded-md",onClick:a[1]||(a[1]=N(((...a)=>e.cancelRemoveLocation&&e.cancelRemoveLocation(...a)),["prevent"]))}," Cancel "),$(s,{color:"teal",loading:e.loading,disabled:e.disabledButton,onClick:e.continueRemoveLocation},{default:_((()=>a[6]||(a[6]=[j(" Continue ")]))),_:1},8,["loading","disabled","onClick"])])])),_:1},8,["modelValue"])])}]]);const Ge={key:0,class:"mt-6 space-y-10"},Ke={class:"flex items-center justify-between"},He={class:"space-y-6"},Je={key:0},Qe={key:1,class:"h-96"};var Xe={__name:"index",async setup(e){var a,l;let o,t;const n=W(),i=h(),s=ee(),r=Y(!1),c=Y(),d=Y(),u=[{id:"monthly",label:"Monthly"},{id:"yearly",label:"Yearly"}],m=async()=>{var e,a;await p(i.billing,(()=>i.$getUrlBilling()));const l=null==(a=null==(e=i.billing)?void 0:e.result)?void 0:a.url;if(l){const e=(e=>{try{const a=new URL(e);return a.origin.includes("stripe")?{srtipe:!0,url:e}:{srtipe:!1,url:a.pathname}}catch(a){return{srtipe:!1,url:"/setting"}}})(l);i.billing.isLoading=!0,e.srtipe?window.location.href=e.url:"/setting"!==e.url?(i.billing.isLoading=!1,await p(s.packages,(()=>s.$getBillingPackages()))):n.push({name:"/setting"})}},v=async()=>{r.value=!0},g=async e=>{await p(s.reSubscribe,(()=>s.$planCheckout({price_id:s.packages.selectedPlan.price_id,total_location:"object"==typeof e?null==e?void 0:e.total_selected_location:e}).then((()=>{s.packages.selectedPlan=void 0,window.location.href=s.reSubscribe.result})).catch((()=>{q({type:"error",message:"An error occurred during checkout. Please reach out to our customer support team for assistance."})}))))};return[o,t]=G((()=>m())),await o,t(),c.value=["year","annual"].includes(null==(l=null==(a=null==s?void 0:s.packages)?void 0:a.result)?void 0:l.current_interval)?"yearly":"monthly",(e,a)=>{const l=M("RadioButton"),o=M("RadioGroup"),t=z("loading");return P(i).billing.isLoading?D((x(),S("div",Qe,null,512)),[[t,!0]]):(x(),S("div",Ge,[L("div",Ke,[a[2]||(a[2]=L("h5",{class:"font-medium"},"Plan & Blling",-1)),$(oe)]),L("div",He,[P(s).unpaid||P(s).canceled?(x(),S("div",Je,a[3]||(a[3]=[L("div",{class:"flex items-center bg-red-lighten text-red-04 py-2 px-4 rounded-lg gap-4"},[L("i",{class:"material-icons"},"info"),L("p",null,' To continue using reusely.com, please update your billing details. Once your payment is successfully made, click "Verify Payment" to confirm. ')],-1)]))):V("",!0),L("div",null,[a[4]||(a[4]=L("label",{class:"font-medium block text-teal-04"}," Compare Plans ",-1)),$(o,{modelValue:c.value,"onUpdate:modelValue":a[0]||(a[0]=e=>c.value=e)},{default:_((()=>[(x(),S(R,null,U(u,(e=>$(l,{key:e.id,label:e.id},{default:_((()=>[j(T(e.label),1)])),_:2},1032,["label"]))),64))])),_:1},8,["modelValue"])]),$(he,{ref_key:"refPackages",ref:d,period:c.value},null,8,["period"])]),$(we,{onReactive:v}),$(We,{modelValue:r.value,"onUpdate:modelValue":a[1]||(a[1]=e=>r.value=e),onSubscribe:g},null,8,["modelValue"])]))}}},Ze=A({setup(){const{genSuspense:e}=r();return()=>e(Xe)}});export{Ze as default};
