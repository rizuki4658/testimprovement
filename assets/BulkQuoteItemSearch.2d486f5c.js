var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,r=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l,o=(e,t)=>{for(var a in t||(t={}))n.call(t,a)&&r(e,a,t[a]);if(l)for(var a of l(t))s.call(t,a)&&r(e,a,t[a]);return e};import{_ as i}from"./fieldset.400d29ed.js";import{B as d}from"./BTable.4e9049f6.js";import{o as u,t as c,A as m,aF as p,B as y,q as b,K as v,G as f,H as h,F as g,f as k,r as _,g as I,y as x,W as S,aT as B,k as w,m as P,n as j,w as V,Q as q,I as O,D as F,a1 as T,a2 as E,U as $,S as N}from"./vendor.9695fe57.js";import{_ as U,f as C,b as M,T as W,g as Q}from"./index.c2f66179.js";import{C as A}from"./Currency.84d5be4a.js";import{d as D}from"./bulkquote.444ceb87.js";import{D as H}from"./DeviceSearch.87dac9c9.js";const R={name:"BSlider",props:{modelValue:{type:Number,default:0},min:{type:Number,default:0},max:{type:Number,default:100},step:{type:Number,default:1},block:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:t}){const a=k(null),l=k(null),n=_({value:0}),s=I({get:()=>e.modelValue&&e.modelValue||n.value,set:(e=0)=>{t("update:modelValue",e),n.value=e}}),r=I((()=>Math.round(s.value/e.max*100))),o=I((()=>`${r.value}%`)),i=()=>{const t=a.value.getBoundingClientRect(),l=Number(100*(s.value-e.min)/(e.max-e.min));a.value.style.left=`calc((${l}% - ${t.width/2}px) + (${8-.15*l}px))`};return x(o,i),S((()=>{i()})),{refSliderTooltip:a,refSlider:l,value:s,sliderPercentage:o}}},L=()=>{B((e=>({a1684f46:e.sliderPercentage})))},G=R.setup;R.setup=G?(e,t)=>(L(),G(e,t)):L;const J=["disabled","min","max"],K={ref:"refSliderTooltip",class:"b-slider__tooltip"};var z=U(R,[["render",function(e,t,a,l,n,s){return u(),c("div",{class:g(["b-slider",a.block&&"b-slider--block",a.disabled&&"b-slider--disabled"])},[m(y("input",{disabled:a.disabled,ref:"refSlider",class:"b-slider__slider","onUpdate:modelValue":t[0]||(t[0]=e=>l.value=e),type:"range",min:a.min,max:a.max,step:1},null,8,J),[[p,l.value]]),y("div",K,[b(e.$slots,"tooltip",f(h({value:l.value})),(()=>[y("span",null,v(l.sliderPercentage),1)]),!0)],512)],2)}],["__scopeId","data-v-7b10b35f"]]);const X=w({name:"BulkQuoteItemTable",components:{BTable:d,Input:C,Button:M,Currency:A},props:{items:{type:Array},percentage:{type:Number,default:100},preview:{type:Boolean,default:!1},disabled:{type:Boolean,default:!0},disabledStatus:{type:Boolean,default:!0},reconcile:{type:Boolean,default:!1}},emits:["update:items","deleteItem","editItem","reconcileItem"],setup(e,{emit:l}){const n={items:[]},s=I({get:()=>e.items&&e.items||n.items,set:(e=[])=>{l("update:items",e),n.items=e}}),r=I((()=>{if(s.value.length<1)return[];const e=new Map;return s.value.forEach((t=>{const{conditions:a={}}=t,{data:l=[]}=a;l.forEach((t=>{e.has(t.name)||e.set(t.name,{name:t.name,rules:t.rule})}))})),Array.from(e.values())})),i=I((()=>{let t=[{key:"product_name",column_name:e.preview?"Device":"Item",meta:{}},{key:"qty",column_name:"Qty",meta:{}}];return r.value.forEach((e=>{t.push({key:f(e.name),column_name:e.name,meta:{rules:h(e.rules)}})})),t})),d=I((()=>s.value.map((e=>{const{conditions:l={}}=e,{data:n=[]}=l,s=Object.fromEntries(n.map((e=>{return[f(e.name),(l=o({},e),n={price:e.price||0},t(l,a(n)))];var l,n}))),i={};return r.value.forEach((e=>{const t=f(e.name);i[t]=s[t]||{name:e.name,price:0,is_manually_priced:!1}})),o(o({},e),i)})))),u=I((()=>s.value.reduce(((e,t)=>e+(parseInt(t.qty)||0)),0))),c=I((()=>(parseInt(`${e.percentage}`)||0)/100)),m=I((()=>{const e={};return r.value.forEach((t=>{e[t.name]=0})),s.value.forEach((t=>{const{conditions:a={}}=t,{data:l=[]}=a,n=parseFloat(t.qty)||0;l.forEach((t=>{const a=parseFloat(t.price)||0;e[t.name]=(e[t.name]||0)+a*n}))})),Object.values(e)})),p=I((()=>{const e={};return r.value.forEach((t=>{e[t.name]=0})),s.value.forEach((t=>{const{conditions:a={}}=t,{data:l=[]}=a,n=parseFloat(t.qty)||0;l.forEach((t=>{const a=parseFloat(t.price)||0,l=(parseFloat(t.price_from_source)||0)-a;e[t.name]=(e[t.name]||0)+l*n}))})),Object.values(e)})),y=I((()=>["Total",u.value,...m.value||[],""])),b=I((()=>{const e=p.value||[],t=Array(r.value.length-e.length).fill(0);return["Commission","",...e,...t,""]})),v=e=>{l("editItem",e)},f=e=>`condition_${e}`,h=e=>{let t=e?JSON.parse(e):[];return Array.isArray(t)&&1===t.length&&t.includes(null)&&(t=[]),t||[]},g=(e,t,a,l={isManuallyPriced:!1})=>{const n=[...s.value];if(e<0)return;const r=((e=[],t)=>e.findIndex((e=>e.name===t)))(n[e].conditions.data,t.name);-1===r?n[e].conditions.data.push({name:t.name,price:a,is_manually_priced:l.isManuallyPriced||!1,original_price:a,rule:t.rule||null}):(n[e].conditions.data[r].price=a,n[e].conditions.data[r].is_manually_priced=l.isManuallyPriced||!1),s.value=n,l.isManuallyPriced&&v(n[e])};return x(c,(()=>{[...s.value].forEach(((e,t)=>{const{conditions:a={}}=e||{},{data:l=[]}=a;l.forEach(((e,a)=>{if(e.is_manually_priced)return;const l=e.original_price*c.value;g(t,e,l)}))}))})),{items:s,itemConditions:r,tableHeaders:i,tableData:d,tableFooter:y,commissionFooter:b,updateConditionPrice:g,updateQty:(e,t=1)=>{const a=[...s.value];e<0||(a[e].qty=t,s.value=a,v(a[e]))},updateName:(e,t)=>{const a=[...s.value];e<0||(a[e].product_name=t,s.value=a,v(a[e]))},deleteItem:(e,t)=>{const a=[...s.value];e<0||(a.splice(e,1),s.value=a,l("deleteItem",t))},reconcileItem:e=>{l("reconcileItem",e)},money:W}}}),Y={key:0,class:"flex items-center justify-center gap-2"},Z={class:"max-w-md"},ee={class:"list"},te=["innerHTML"],ae={key:0,class:"number-column"},le={key:1,class:"number-column",style:{minWidth:"70px"}},ne={key:2,class:"font-semibold",style:{minWidth:"300px",maxWidth:"300px"}},se={key:0,style:{minWidth:"300px"}},re={key:1,style:{minWidth:"70px"}},oe={key:2,style:{minWidth:"150px"}},ie={key:3},de={class:"b-table__row"},ue={key:1,class:"font-medium"},ce={class:"b-table__row"},me={key:1,class:"flex gap-2 items-center"},pe={class:"font-medium"},ye=["onClick"];var be=U(w({name:"BulkQuoteItem",components:{Fieldset:i,BSlider:z,BTable:d,BulkQuoteItemTable:U(X,[["render",function(e,t,a,l,n,s){const r=P("Tooltip"),o=P("Currency"),i=P("Input"),d=P("Button"),m=P("BTable");return u(),j(m,{headers:e.tableHeaders,items:e.tableData,"min-width":"auto",class:g([e.preview&&"table-preview"]),"time-stamp":!1},{header:V((({header:t})=>{var a,l;return["product_name"!==t.key?(u(),c("th",{key:t.key,class:g(["number-column",e.preview&&"column-normal"]),style:q({minWidth:"qty"===t.key&&"100px"})},[t.key.startsWith("condition_")&&!e.preview?(u(),c("span",Y,[O(v(t.column_name)+" ",1),F(r,{placement:"top",disabled:!(null==(l=null==(a=null==t?void 0:t.meta)?void 0:a.rules)?void 0:l.length)},{content:V((()=>{var e;return[y("div",Z,[y("ul",ee,[(u(!0),c(T,null,E((null==(e=null==t?void 0:t.meta)?void 0:e.rules)||[],((e,t)=>(u(),c("li",{key:t,class:"text-white"},[y("span",{innerHTML:e},null,8,te)])))),128))])])]})),default:V((()=>{var e,a;return[y("i",{class:g(["material-icons cursor-pointer",!(null==(a=null==(e=null==t?void 0:t.meta)?void 0:e.rules)?void 0:a.length)&&"opacity-50"])}," info ",2)]})),_:2},1032,["disabled"])])):(u(),c(T,{key:1},[O(v(t.column_name),1)],64))],6)):(u(),c("th",{key:t.key,class:g([e.preview&&"column-normal"])},v(t.column_name),3))]})),column:V((({key:t,column:a,row:l,rowIndex:n})=>[e.preview?(u(),c(T,{key:0},[t.startsWith("condition_")?(u(),c("td",ae,[F(o,{value:null==a?void 0:a.price},null,8,["value"])])):"qty"===t?(u(),c("td",le,v(a),1)):(u(),c("td",ne,v(a),1))],64)):(u(),c(T,{key:1},["product_name"===t?(u(),c("td",se,[1===(null==l?void 0:l.is_custom)?(u(),j(i,{key:`input-name-${n}`,"model-value":a,"onUpdate:modelValue":t=>e.updateName(n,t),block:"",disabled:e.disabled,class:"mb-6"},null,8,["model-value","onUpdate:modelValue","disabled"])):(u(),c(T,{key:1},[O(v(a),1)],64))])):"qty"===t?(u(),c("td",re,[(u(),j(i,{key:`input-qty-${n}`,"model-value":a,"onUpdate:modelValue":t=>e.updateQty(n,t),type:"number",right:"",block:"",disabled:e.disabled||e.disabledStatus,class:"mb-6"},null,8,["model-value","onUpdate:modelValue","disabled"]))])):t.startsWith("condition_")?(u(),c("td",oe,[(u(),j(i,{key:`input-price-${n}`,"model-value":null==a?void 0:a.price,"onUpdate:modelValue":t=>e.updateConditionPrice(n,a,t,{isManuallyPriced:!0}),type:"number",currency:!0,block:"",disabled:e.disabled||e.disabledStatus},null,8,["model-value","onUpdate:modelValue","disabled"])),y("small",{style:q({opacity:a.is_manually_priced?"1":"0"}),class:"text-grey-03 text-right block mt-2"},"Manually priced",4)])):(u(),c("td",ie,v(a),1))],64))])),footerRows:V((()=>[y("tr",de,[(u(!0),c(T,null,E(e.tableFooter,((t,a)=>(u(),c("td",{key:`total_${a}`,class:g([a>0&&"number-column"])},[a>1&&a<e.tableFooter.length-1?(u(),j(o,{key:0,class:"font-medium",value:t},null,8,["value"])):(u(),c("span",ue,v(t),1))],2)))),128))]),y("tr",ce,[(u(!0),c(T,null,E(e.commissionFooter,((a,l)=>(u(),c("td",{key:`commission_${l}`,class:g([l>0&&"number-column"])},[l>1&&l<e.commissionFooter.length-1?(u(),j(o,{key:0,class:"font-medium text-blue-600",value:a},null,8,["value"])):(u(),c("div",me,[y("span",pe,v(a),1),0===l?(u(),j(r,{key:0,placement:"top"},{content:V((()=>t[0]||(t[0]=[y("div",{style:{maxWidth:"300px"}},[y("p",null,"This commission value is subject to change at any time.")],-1)]))),default:V((()=>[t[1]||(t[1]=y("i",{class:"text-teal-04 material-icons ml-2 cursor-pointer"},"info",-1))])),_:1})):$("",!0)]))],2)))),128))])])),action:V((({rowIndex:a,row:l})=>[y("td",null,[e.disabled||e.preview?$("",!0):(u(),c(T,{key:0},[e.reconcile?(u(),j(d,{key:0,onClick:t=>e.reconcileItem(l),color:"teal",dense:""},{default:V((()=>t[2]||(t[2]=[y("p",{class:"flex items-center gap-2 ml-3"},[O(" Reconcile "),y("i",{class:"material-icons"},"chevron_right")],-1)]))),_:2},1032,["onClick"])):(u(),c("a",{key:1,href:"",onClick:N((t=>e.deleteItem(a,l)),["prevent"]),class:"px-3 py-2 flex items-center justify-center"},t[3]||(t[3]=[y("i",{class:"material-icons"},"close",-1)]),8,ye))],64))])])),_:1},8,["headers","items","class"])}],["__scopeId","data-v-b815279e"]])},props:{items:{type:Array},percentage:{type:Number},disabled:{type:Boolean,default:!1},disabledStatus:{type:Boolean,default:!1},reconcile:{type:Boolean,default:!1}},emits:["update:percentage","update:items","deleteItem","editItem","reconcileItem"],setup(e,{emit:t}){const a=_({items:[]}),l=I({get:()=>e.items&&e.items||a.items,set:(e=[])=>{const l=e.filter((e=>e.items.length>0));t("update:items",l),a.items=l}}),n=I((()=>l.value.length>0));return{data:a,items:l,hasOneOrMoreItems:n,handleUpdateItem:(e,t)=>{const a=[...l.value];a[e].items=t,l.value=a}}}}),[["render",function(e,t,a,l,n,s){const r=P("BulkQuoteItemTable"),o=P("Fieldset");return u(),c("div",null,[(u(!0),c(T,null,E(e.items,((a,l)=>(u(),j(o,{key:a.id,class:"my-4",style:{"min-width":"0"}},{label:V((()=>[O(v(a.name),1)])),default:V((()=>[F(r,{items:a.items,"onUpdate:items":t=>e.handleUpdateItem(l,t),onDeleteItem:t[0]||(t[0]=t=>e.$emit("deleteItem",t)),onEditItem:t[1]||(t[1]=t=>e.$emit("editItem",t)),onReconcileItem:t[2]||(t[2]=t=>e.$emit("reconcileItem",t)),percentage:e.percentage,disabled:e.disabled,"disabled-status":e.disabledStatus,reconcile:e.reconcile},null,8,["items","onUpdate:items","percentage","disabled","disabled-status","reconcile"])])),_:2},1024)))),128))])}]]);const ve=w({name:"BulkQuoteItemPercentage",components:{BSlider:z},props:{modelValue:{type:Number},disabled:{type:Boolean,default:!1},create:{type:Boolean,default:!1},order:{type:Object,default:()=>({id:""})}},emits:["update:modelValue"],setup(e,{emit:t}){const a=_({percentage:0});return{show:I((()=>{var t,a;return!!e.create||!(!e.order||!(null==(t=e.order)?void 0:t.status_id)||9e3!==(null==(a=e.order)?void 0:a.status_id))})),percentage:I({get:()=>e.modelValue&&e.modelValue||a.percentage,set:(e=0)=>{t("update:modelValue",e),a.percentage=e}})}}}),fe={key:0},he={class:"flex items-center gap-4"};var ge=U(ve,[["render",function(e,t,a,l,n,s){const r=P("BSlider");return e.show?(u(),c("div",fe,[t[3]||(t[3]=y("label",{class:"font-medium mb-2"},"Quoted Price",-1)),y("div",he,[t[1]||(t[1]=y("span",null,"0%",-1)),F(r,{class:"flex-grow",modelValue:e.percentage,"onUpdate:modelValue":t[0]||(t[0]=t=>e.percentage=t),modelModifiers:{number:!0},disabled:e.disabled,block:""},null,8,["modelValue","disabled"]),t[2]||(t[2]=y("span",null,"100%",-1))])])):$("",!0)}]]);var ke=U(w({name:"BulkQuoteItemSearch",components:{ProductSearch:H},props:{clearOnSelect:{type:Boolean,default:!0}},emits:["select"],setup(e,{emit:t}){const{querySearch:a,products:l,categories:n,loading:s,searchItems:r,isProductActiveButNoPrice:o}=D(),i=Q((()=>r()),500);return{querySearch:a,products:l,categories:n,loadingSearchItems:s,isProductActiveButNoPrice:o,handleSearchItems:i,handleSelectItem:l=>{t("select",l),e.clearOnSelect?a.value="":a.value=l.product_name}}}}),[["render",function(e,t,a,l,n,s){const r=P("ProductSearch");return u(),j(r,{query:e.querySearch,"onUpdate:query":t[0]||(t[0]=t=>e.querySearch=t),onSearch:e.handleSearchItems,onSelect:e.handleSelectItem,label:null,products:e.products,categories:e.categories,loading:e.loadingSearchItems,"show-add-custom-product":!1,"active-product-unprice":e.isProductActiveButNoPrice,placeholder:"Find or add an item"},null,8,["query","onSearch","onSelect","products","categories","loading","active-product-unprice"])}]]);export{ke as B,be as a,ge as b};
