{"version":3,"file":"index.56f8be9e.js","sources":["../../src/views/invoice/detail/return/Items.vue","../../src/views/invoice/detail/return/index.js"],"sourcesContent":["<template>\n  <Breadcrumb\n    class=\"mt-2 mb-8\"\n    pageTitle=\"Return Item\"\n    :backTo=\"{ name: 'invoiceDetail' }\"\n    :items=\"breadcrumb\">\n    <template #right>\n      <Button\n        v-if=\"isSelected\"\n        color=\"teal\"\n        @click=\"openModal('create')\">\n        Process Return\n      </Button>\n    </template>\n  </Breadcrumb>\n  <Card>\n    <p class=\"font-bold mb-4\">Select the items you would like to return:</p>\n    <div class=\"mb-8\">\n      <div class=\"flex flex-col md:flex-row mb-6\">\n        <div class=\"flex-grow md:mr-3 md:mb-0 mb-3\">\n          <Input v-model=\"dataReturn.search\" placeholder=\"Search Everything\" class=\"w-full\" @input=\"search\" icon>\n            <template #icon>\n              <span class=\"material-icons\">search</span>\n            </template>\n          </Input>\n        </div>\n      </div>\n      <Table v-loading=\"loading.available\" :row-key=\"rowKey\" :data=\"getAvailable\" :tree-props=\"{ children: 'child' }\" @select=\"itemSelected\" @select-all=\"itemSelected\" default-expand-all>\n        <TableColumn type=\"selection\" :selectable=\"isParent\" width=\"55\" />\n        <TableColumn prop=\"id\" label=\"Item #\" width=\"150\">\n          <template #default=\"scope\">\n            <template v-if=\"!scope.row.child || (scope.row.child && scope.row.child.length === 0)\">\n              {{ scope.row.id }}\n            </template>\n          </template>\n        </TableColumn>\n        <TableColumn prop=\"product_name\" label=\"Item\" width=\"300\">\n          <!--      TODO: Check if it's complete or not-->\n          <template #default=\"scope\">\n            <p class=\"font-bold mb-0\">{{ scope.row.product_name }}</p>\n            <template v-if=\"!scope.row.child || (scope.row.child && scope.row.child.length === 0)\">\n              <template v-if=\"scope.row.detail\">\n                <small>{{ scope.row.detail }}</small>\n                <br>\n              </template>\n              <small>\n                (<template v-if=\"scope.row.imei_sn !== null\">{{ scope.row.imei_sn }}</template>\n                <span v-else class=\"text-red-base font-bold\">IMEI/Serial Number not found</span>)\n              </small>\n              <div class=\"block\">\n                <p class=\"font-bold mb-0\">Notes</p>\n                <p>{{ scope.row.notes }}</p>\n              </div>\n            </template>\n          </template>\n        </TableColumn>\n        <TableColumn prop=\"condition\" label=\"Condition\" width=\"200\" />\n        <TableColumn prop=\"qty\" label=\"Qty\" width=\"200\" />\n        <TableColumn prop=\"price\" label=\"Unit Price\" width=\"200\">\n          <template #default=\"scope\">\n            <Currency :value=\"scope.row.price\" />\n          </template>\n        </TableColumn>\n        <TableColumn prop=\"total\" label=\"Total\">\n          <template #default=\"scope\">\n            <Currency :value=\"scope.row.total\" />\n          </template>\n        </TableColumn>\n      </Table>\n    </div>\n  </Card>\n  <Modal v-model=\"modal.create\" title=\"Record Payout\">\n    <PaymentMethod ref=\"refPaymentMethod\" v-model:data=\"data\" :items=\"statePaymentMethod\" auto-select>\n      <template #additional>\n        <RecordPaymentForm v-model:data=\"dataRecord\" is-return />\n      </template>\n    </PaymentMethod>\n    <template #footer>\n      <Button color=\"teal\" :loading=\"loading.create\" @click=\"createReturn\">Save Payout</Button>\n    </template>\n  </Modal>\n</template>\n\n<script>\nimport { defineComponent, ref, computed, nextTick } from 'vue'\nimport { useRoute, useRouter } from 'vue-router'\nimport debounce from 'utils/debounce'\nimport { useShowReturn, useShowPaymentMethod, useShowRecord, useShowItems } from 'composable/invoice'\nimport Input from 'bbUi/components/input/input.vue'\nimport Button from 'bbUi/components/button/button.vue'\nimport Breadcrumb from 'components/Breadcrumb.vue'\nimport Card from 'bbUi/components/card/card.vue'\nimport Modal from 'bbUi/components/modal/modal.vue'\nimport PaymentMethod from 'components/PaymentMethod.vue'\nimport RecordPaymentForm from 'components/Invoice/RecordPayment/Form.vue'\nimport Currency from 'components/Currency.vue'\n\nexport default defineComponent({\n  components: {\n    Input,\n    Button,\n    Breadcrumb,\n    Card,\n    Modal,\n    PaymentMethod,\n    RecordPaymentForm,\n    Currency\n  },\n  async setup() {\n    const { data: dataReturn, getAvailable, loading, modal, unsetData, openModal, actionAvailable, actionCreate } = useShowReturn('invoice')\n    const { state: stateItems } = useShowItems('invoice')\n    const { data: dataRecord } = useShowRecord('invoice')\n    const { state: statePaymentMethod, actionAll: actionPaymentMethods } = useShowPaymentMethod('invoice')\n    const route = useRoute()\n    const router = useRouter()\n\n    const refPaymentMethod = ref(null)\n    const data = ref(null)\n    const selected = ref([])\n    const rowKey = row => {\n      const child = row.child ? '_parent' : '_child'\n      return row.id + child\n    }\n    const isParent = (row, index) => {\n      return !(row.child && row.child.length > 0)\n    }\n    const itemSelected = (selectedItems) => {\n      selected.value = [...selectedItems]\n    }\n    const createReturn = async () => {\n      const isValid = await nextTick(() => refPaymentMethod.value.refChildComponent.validate())\n      if(isValid) {\n        await actionCreate(route.params.buybackId, {\n          amount: dataRecord.amount,\n          reason: dataRecord.note,\n          ...data.value,\n          return_items: JSON.stringify(selected.value.map(item => ({\n            id: item.id\n          })))\n        }, () => {\n          router.push({\n            name: 'invoiceDetail'\n          })\n        })\n      }\n    }\n    const isSelected = computed(() => {\n      return selected.value.length > 0\n    })\n    const breadcrumb = [{\n      text: 'Invoice',\n      to: {\n        name: 'invoice'\n      }\n    }, {\n      text: 'Invoice Details',\n      to: {\n        name: 'invoiceDetail'\n      }\n    }, {\n      text: 'Return Item'\n    }]\n\n    await Promise.all([\n      actionPaymentMethods(route.params.buybackId, {return: true}),\n      actionAvailable(route.params.buybackId)\n    ])\n    const search = debounce(async () => {\n      await actionAvailable(route.params.buybackId)\n    }, 500)\n\n    return {\n      data,\n      dataRecord,\n      dataReturn,\n      search,\n      stateItems,\n      statePaymentMethod,\n      getAvailable,\n      loading,\n      modal,\n      unsetData,\n      openModal,\n      isSelected,\n      rowKey,\n      isParent,\n      itemSelected,\n      createReturn,\n      breadcrumb,\n      refPaymentMethod\n    }\n  }\n})\n</script>","import { defineComponent, h } from 'vue'\nimport { useSuspense } from 'composable/components'\nimport Items from './Items.vue'\n\nexport default defineComponent({\n  setup() {\n    const { genSuspense } = useSuspense()\n\n    return () => genSuspense(Items)\n  }\n})"],"names":["_sfc_main","defineComponent","components","Input","Button","Breadcrumb","Card","Modal","PaymentMethod","RecordPaymentForm","Currency","[object Object]","data","dataReturn","getAvailable","loading","modal","unsetData","openModal","actionAvailable","actionCreate","useShowReturn","state","stateItems","useShowItems","dataRecord","useShowRecord","statePaymentMethod","actionAll","actionPaymentMethods","useShowPaymentMethod","route","useRoute","router","useRouter","refPaymentMethod","ref","selected","isSelected","computed","value","length","Promise","all","params","buybackId","return","search","debounce","async","rowKey","row","child","id","isParent","index2","itemSelected","selectedItems","createReturn","nextTick","refChildComponent","validate","__spreadValues","amount","reason","note","return_items","JSON","stringify","map","item","push","name","breadcrumb","text","to","_hoisted_1","class","_hoisted_2","_hoisted_3","key","_openBlock","_createElementBlock","_Fragment","_createVNode","_component_Breadcrumb","pageTitle","backTo","_withCtx","color","_cache","default","_createElementVNode","_component_Input","modelValue","_ctx","onUpdate:modelValue","$event","placeholder","onInput","icon","_withDirectives","_createBlock","_component_Table","row-key","tree-props","children","onSelect","onSelectAll","_component_TableColumn","type","selectable","prop","label","scope","_toDisplayString","product_name","detail","_createCommentVNode","_createTextVNode","_hoisted_5","_hoisted_6","_component_Currency","_component_Modal","create","_component_Button","_component_PaymentMethod","onUpdate:data","items","_component_RecordPaymentForm","index","genSuspense","useSuspense","Items"],"mappings":"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"}