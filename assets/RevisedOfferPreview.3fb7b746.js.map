{"version":3,"file":"RevisedOfferPreview.3fb7b746.js","sources":["../../src/composable/setting/revisedOffer.js","../../src/components/RevisedOffer/RevisedOfferPreview.vue","../../../../../../../images/revised-offer/message-accept.webp","../../../../../../../images/revised-offer/message-decline.webp","../../../../../../../images/revised-offer/message-revised.webp"],"sourcesContent":["import { computed, reactive, ref, watch } from 'vue'\nimport store from 'store'\nimport { isFunction } from 'utils/is'\nimport debounce from 'utils/debounce'\n\nexport const useRevisedOffer = () => {\n\tconst revisedOfferState = reactive({\n\t\tloading: {\n\t\t\tall: false,\n\t\t\tshow: false,\n\t\t\tshow_theme: false,\n\t\t\tupdateStatus: [],\n\t\t\tupdate: false,\n\t\t\tupdate_theme: false,\n\t\t\tlocation: false,\n\t\t\tsubscription: false,\n\t\t\tstoreSubscription: false,\n\t\t\tpreview_email: false,\n\t\t\treset_template: false\n\t\t}\n\t})\n\n\tconst location = computed(() => {\n\t\tif (store.state.dashboard.locationFiltered) {\n\t\t\tconst hasMailinLocation = store.state.dashboard.locationFiltered.is_mailin_available == 1\n\t\t\tconst totalInstoreLocation = store.state.dashboard.locationFiltered.total_instore\n\n\t\t\tif (hasMailinLocation && totalInstoreLocation === 0) return 'mail-in'\n\t\t\telse if (!hasMailinLocation && totalInstoreLocation > 0) return 'in-store'\n\t\t\telse return 'both'\n\t\t}\n\t\treturn undefined\n\t})\n\tconst isMailIn = computed(() => store.state.user.me?.is_location_mail_in == 1)\n\tconst state = computed(() => ({\n\t\tall: store.state.setting.revisedOffer.all,\n\t\tshow: store.state.setting.revisedOffer.show\n\t}))\n\tconst revisedOfferTypes = computed(() => {\n\t\tif (location.value == 'local') {\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\tname: location.value === 'mail-in' ? 'Mail-In' : 'In-Store',\n\t\t\t\t\tvalue: location.value === 'local' ? 'mail-in' : 'in-store'\n\t\t\t\t}\n\t\t\t]\n\t\t} else if (location.value == 'mail-in') {\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\tname: 'Mail-In',\n\t\t\t\t\tvalue: 'mail-in'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'Easy Offer',\n\t\t\t\t\tvalue: 'easy-offer'\n\t\t\t\t}\n\t\t\t]\n\t\t} else if (location.value == 'both') {\n\t\t\treturn [\n\t\t\t\t{\n\t\t\t\t\tname: 'Mail-In',\n\t\t\t\t\tvalue: 'mail-in'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'In-Store',\n\t\t\t\t\tvalue: 'in-store'\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\tname: 'Easy Offer',\n\t\t\t\t\tvalue: 'easy-offer'\n\t\t\t\t}\n\t\t\t]\n\t\t}\n\t\treturn []\n\t})\n\tconst data = reactive({\n\t\temail_template: {\n\t\t\tid: null,\n\t\t\tbody: null\n\t\t},\n\t\tall: {\n\t\t\tpage: 1,\n\t\t\tlimit: 10,\n\t\t\ttype: isMailIn.value || location.value === 'both' ? 'mail-in' : 'in-store'\n\t\t},\n\t\ttype: null\n\t})\n\tconst modal = reactive({\n\t\treset_template: false\n\t})\n\tconst isPreviewRevisedOffer = ref(false)\n\tconst previewedRevisedOffer = ref('')\n\n\tconst openModal = key => {\n\t\tif (Object.keys(modal).includes(key)) modal[key] = true\n\t}\n\tconst closeModal = key => {\n\t\tif (Object.keys(modal).includes(key)) modal[key] = false\n\t}\n\n\tconst actionAll = async (callback = () => {}) => {\n\t\ttry {\n\t\t\trevisedOfferState.loading.all = true\n\t\t\tconst response = await store.dispatch('setting/revisedOffer/all', data.all)\n\t\t\tisFunction(callback) && callback(response)\n\t\t} finally {\n\t\t\trevisedOfferState.loading.all = false\n\t\t}\n\t}\n\tconst actionShow = async (payload, callback = () => {}) => {\n\t\ttry {\n\t\t\trevisedOfferState.loading.show = true\n\t\t\tconst newPayload = {\n\t\t\t\tid: payload.id\n\t\t\t}\n\t\t\tconst response = await store.dispatch(`setting/revisedOffer/show`, newPayload)\n\t\t\tObject.assign(data.email_template, {\n\t\t\t\t...response\n\t\t\t})\n\t\t\tisFunction(callback) && callback(response)\n\t\t} finally {\n\t\t\trevisedOfferState.loading.show = false\n\t\t}\n\t}\n\tconst actionUpdate = async (payload, callback = () => {}) => {\n\t\ttry {\n\t\t\trevisedOfferState.loading.update = true\n\t\t\tconst newPayload = Object.assign(\n\t\t\t\t{},\n\t\t\t\t{\n\t\t\t\t\tid: payload.id,\n\t\t\t\t\tdata: data.email_template\n\t\t\t\t}\n\t\t\t)\n\t\t\tconst response = await store.dispatch(`setting/revisedOffer/update`, newPayload)\n\n\t\t\tisFunction(callback) && callback(response)\n\t\t} finally {\n\t\t\trevisedOfferState.loading.update = false\n\t\t}\n\t}\n\tconst actionPreviewRevisedOffer = async (id, callback = () => {}) => {\n\t\tlet response = ''\n\n\t\ttry {\n\t\t\trevisedOfferState.loading.preview_email = true\n\t\t\tisPreviewRevisedOffer.value = false\n\t\t\tif (!!id) {\n\t\t\t\tresponse = await store.dispatch('setting/revisedOffer/previewRevisedOfferById', id)\n\t\t\t} else {\n\t\t\t\tresponse = await store.dispatch('setting/revisedOffer/previewRevisedOffer', {\n\t\t\t\t\tbody: data.email_template.body || ''\n\t\t\t\t})\n\t\t\t}\n\t\t\tisPreviewRevisedOffer.value = true\n\t\t\tpreviewedRevisedOffer.value = response\n\t\t\tisFunction(callback) && callback(response)\n\t\t} finally {\n\t\t\trevisedOfferState.loading.preview_email = false\n\t\t}\n\t}\n\tconst actionResetTemplate = async (callback = () => {}) => {\n\t\tconst templateId = data.email_template?.id\n\t\tif (!templateId) return\n\t\ttry {\n\t\t\trevisedOfferState.loading.reset_template = true\n\t\t\tawait store.dispatch('setting/revisedOffer/resetRevisedOffer', templateId)\n\t\t\tisFunction(callback) && callback()\n\t\t\tawait actionShow({\n\t\t\t\tid: templateId\n\t\t\t})\n\t\t} finally {\n\t\t\trevisedOfferState.loading.reset_template = false\n\t\t}\n\t}\n\n\twatch(\n\t\t() => ({ ...data.all }),\n\t\tdebounce(async () => {\n\t\t\tawait actionAll()\n\t\t}, 400)\n\t)\n\n\treturn {\n\t\tstate,\n\t\tdata,\n\t\tloading: revisedOfferState.loading,\n\t\tmodal,\n\t\tlocation,\n\t\tisPreviewRevisedOffer,\n\t\tpreviewedRevisedOffer,\n\t\topenModal,\n\t\tcloseModal,\n\t\tactionAll,\n\t\tactionUpdate,\n\t\tactionShow,\n\t\tactionPreviewRevisedOffer,\n\t\tactionResetTemplate,\n\t\tisMailIn,\n\t\trevisedOfferTypes\n\t}\n}\n","<template>\n\t<Modal v-model=\"isShow\" :title=\"title\">\n\t\t<template #default>\n\t\t\t<div class=\"border border-grey-01 rounded-lg mb-6\">\n\t\t\t\t<CollapsibleCard>\n\t\t\t\t\t<template #title><p class=\"font-semibold\">Where can i found this texts?</p></template>\n\t\t\t\t\t<template v-if=\"type?.includes('Accepted')\">\n\t\t\t\t\t\t<p class=\"mb-4\">\n\t\t\t\t\t\t\tThis text is showed on customer portal when customer accept the new offer.\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<img\n\t\t\t\t\t\tsrc=\"/images/revised-offer/message-accept.webp\"\n\t\t\t\t\t\talt=\"Declined Offer Message \" />\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-if=\"type?.includes('Declined')\">\n\t\t\t\t\t\t<p class=\"mb-4\">\n\t\t\t\t\t\t\tThis text is showed on the customer portal when the customer declines the {{type.includes('Easy Offer') ? 'pending' : 'revised'}} offer.\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<img\n\t\t\t\t\t\tsrc=\"/images/revised-offer/message-decline.webp\"\n\t\t\t\t\t\talt=\"Declined Offer Message \" />\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-if=\"type?.includes('Revised') || type?.includes('Pending')\">\n\t\t\t\t\t\t<p class=\"mb-4\">\n\t\t\t\t\t\t\tThis text is showed on the customer portal when the item doesn't match the original offer.\n\t\t\t\t\t\t</p>\n\t\t\t\t\t\t<img src=\"/images/revised-offer/message-revised.webp\" alt=\"Revised Offer Message\" />\n\t\t\t\t\t</template>\n\t\t\t\t</CollapsibleCard>\n\t\t\t</div>\n\t\t\t<div class=\"border border-grey-01 rounded-lg p-6\">\n\t\t\t\t<IframeRender\n\t\t\t\t\tv-if=\"renderType === 'iframe'\"\n\t\t\t\t\t:css=\"styles\"\n\t\t\t\t\tstyle=\"width: 100%; height: 600px\">\n\t\t\t\t\t<div class=\"html-template\" v-html=\"sanitizedBody\"></div>\n\t\t\t\t</IframeRender>\n\t\t\t\t<div v-else v-html=\"sanitizedBody\" class=\"ck-content\" />\n\t\t\t</div>\n\t\t</template>\n\t\t<template #footer>\n\t\t\t<div class=\"text-left\">\n\t\t\t\t<a href=\"#!\" @click.prevent=\"handleClose\" class=\"text-red-04 hover:text-red-02\">Cancel</a>\n\t\t\t</div>\n\t\t</template>\n\t</Modal>\n</template>\n\n<script>\nimport { computed, defineComponent, ref } from 'vue'\nimport { sanitize } from 'utils/dom'\n\nimport Modal from 'bbUi/components/modal/modal.vue'\nimport Button from 'bbUi/components/button/button.vue'\nimport CollapsibleCard from 'components/CollapsibleCard.vue'\nimport IframeRender from 'components/IframeRender.vue'\n\nexport default defineComponent({\n\tname: 'PreviewEmailTemplate',\n\tcomponents: {\n\t\tModal,\n\t\tButton,\n\t\tCollapsibleCard,\n\t\tIframeRender\n\t},\n\tprops: {\n\t\tshow: {\n\t\t\ttype: Boolean,\n\t\t\tdefault: false\n\t\t},\n\t\ttype: {\n\t\t\ttype: String,\n\t\t\tdefault: ''\n\t\t},\n\t\tbody: {\n\t\t\ttype: String,\n\t\t\tdefault: ''\n\t\t},\n\t\trenderType: {\n\t\t\ttype: String,\n\t\t\tdefault: 'iframe' // \"iframe | direct\"\n\t\t},\n\t\ttitle: {\n\t\t\ttype: String,\n\t\t\tdefault: 'Preview Text'\n\t\t}\n\t},\n\temits: ['update:show'],\n\tsetup(props, { emit }) {\n\t\tconst styles = ref(\n\t\t\t`.html-template {  font-family: Arial, Helvetica, sans-serif; all: revert; }`\n\t\t)\n\t\tconst isShow = computed({\n\t\t\tget() {\n\t\t\t\treturn props.show\n\t\t\t},\n\t\t\tset(newVal) {\n\t\t\t\temit('update:show', newVal)\n\t\t\t}\n\t\t})\n\t\tconst sanitizedBody = computed(() => sanitize(props.body))\n\t\tconst renderType = computed(() => sanitize(props.renderType))\n\n\t\tconst handleClose = () => {\n\t\t\tisShow.value = false\n\t\t}\n\n\t\treturn {\n\t\t\tstyles,\n\t\t\tisShow,\n\t\t\trenderType,\n\t\t\tsanitizedBody,\n\t\t\thandleClose\n\t\t}\n\t}\n})\n</script>\n","export default \"/images/revised-offer/message-accept.webp\"","export default \"/images/revised-offer/message-decline.webp\"","export default \"/images/revised-offer/message-revised.webp\""],"names":["useRevisedOffer","revisedOfferState","reactive","loading","all","show","show_theme","updateStatus","update","update_theme","location","subscription","storeSubscription","preview_email","reset_template","computed","store","state","dashboard","locationFiltered","hasMailinLocation","is_mailin_available","totalInstoreLocation","total_instore","isMailIn","_a","user","me","is_location_mail_in","setting","revisedOffer","revisedOfferTypes","value","name","data","email_template","id","body","page","limit","type","modal","isPreviewRevisedOffer","ref","previewedRevisedOffer","actionAll","async","callback","response","dispatch","isFunction","actionShow","payload","newPayload","Object","assign","__spreadValues","watch","debounce","openModal","key","keys","includes","closeModal","actionUpdate","actionPreviewRevisedOffer","actionResetTemplate","templateId","_sfc_main","defineComponent","components","Modal","Button","CollapsibleCard","IframeRender","props","Boolean","default","String","renderType","title","emits","[object Object]","emit","styles","isShow","get","newVal","sanitizedBody","sanitize","handleClose","_hoisted_1","class","_hoisted_2","_hoisted_5","_createBlock","_component_Modal","onUpdate:modelValue","_cache","$event","_ctx","_withCtx","_createVNode","_createElementBlock","_Fragment","_createElementVNode","src","_createCommentVNode","_toDisplayString","_d","_hoisted_3","css","innerHTML","footer","_hoisted_6","href","onClick","_withModifiers","args"],"mappings":"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"}