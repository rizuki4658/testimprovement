var e=Object.defineProperty,t=Object.defineProperties,n=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,a=(t,n,i)=>n in t?e(t,n,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[n]=i;import{E as s,i as r}from"./buyback.129968bf.js";import{f as d,b as u,d as c,j as m,u as p,T as v,_ as f}from"./index.ec266ec1.js";import{S as y,u as w}from"./Form.692df6cc.js";import{u as g}from"./index.32689823.js";import{c as h,d as _}from"./index.05b14cb2.js";import{S as b}from"./select.5f1e68e6.js";import{B as C}from"./BBTable.f8945a26.js";import{I as S,C as q,B as x}from"./ChooseCondition.f3ed1463.js";import{k,f as $,g as I,y as V,m as B,o as j,t as A,D as E,w as P,B as F,I as M,a2 as T,a3 as L,K as N,U as O,n as R,W as U,s as Q,A as D,aF as z,F as K}from"./vendor.f1efedad.js";const H=k({components:{Input:d,Select:b,SelectCheckbox:y,Button:u,Modal:c,Alert:m,ItemList:S,ChooseCondition:q,BBTable:C,BBTColumn:x},props:{items:{type:Array,default:()=>[]},conditions:{type:Array,default:()=>[]},loadingCondition:{type:Boolean,default:()=>!1},show:{type:Boolean,default:()=>!1},loading:{type:Boolean,default:()=>!1},me:{type:Object,default:()=>[]}},emits:["close","submit"],setup(e,{emit:d}){const{state:u,action:c}=s(),{me:m}=p(),f=w(),y=$(null),b=$(e.show),C=$(1),S=$([]),q=$("leave it as is"),x=$(null);$(null);const k=$({questions:[]}),B={questions:{$each:h.forEach({answer_id:{required:_(((e,t)=>t.is_required))}})}},j=g(B,k,{$lazy:!0}),A=I((()=>!S.value.length||2===C.value&&!q.value)),E=I((()=>1===C.value?{items:e.items||[],onSelectionChange:e=>{S.value=e.map((e=>e.id||null)).filter((e=>!!e))}}:2===C.value?{conditions:e.conditions||[],onSelectionChange:e=>q.value=e.condition_name||""}:void 0)),P=I((()=>1===C.value?"ItemList":2===C.value?"ChooseCondition":void 0));V((()=>e.show),(e=>{b.value=e}));const F=()=>{for(let t=0;t<e.items.length;t++)f.$state.getQuestions.result.forEach(((n,i)=>O(n,i,e.items[t],t)))},M=()=>{for(let t=0;t<e.items.length;t++)e.items[t].new_price=null},T=()=>{for(let t=0;t<e.items.length;t++)e.items[t].new_condition=null},L=(e,t)=>{let n=parseFloat(e.amount_price);return"Percentage"===e.amount_type&&(n=parseFloat(t.price)*(n/100)),"Mark Down"===e.type?-1*n:n},N=e=>k.value.questions.reduce(((t,n)=>"object"==typeof n.answer_id?t+n.answer.reduce(((t,n)=>t+L(n,e)),0):n.answer_id?t+L(n.answer,e):t),0),O=(t,n,i,o)=>{console.log(t),k.value.questions[n].answer?"Single"===t.answer_type?k.value.questions[n].answer_id=k.value.questions[n].answer.id:k.value.questions[n].answer_id=k.value.questions[n].answer.map((e=>e.id)):k.value.questions[n].answer_id=void 0,x.value?e.items[o].new_price=parseFloat(x.value)+N(i):e.items[o].new_price=parseFloat(i.price)+N(i)};return V((()=>u),(()=>{(()=>{var t;for(let n=0;n<e.items.length;n++)e.items[n].new_price=null==(t=u.value.find((t=>t.product_id==e.items[n].product_id)))?void 0:t.price})()}),{deep:!0}),{props:e,refComponent:y,currentStep:C,isShowModal:b,isDisabledPrice:r,componentName:P,componentBind:E,selectedIds:S,selectedCondition:q,disableNext:A,handleCloseModal:()=>{C.value=1,S.value=[],x.value=null,f.$state.getQuestions.result=[],k.value.questions=[],q.value="leave it as is",b.value=!1,M(),T(),d("close",!0)},handleNextStep:()=>{2===C.value&&d("submit",{ids:JSON.stringify(S.value),condition:q.value}),C.value<2&&++C.value},handlePreviousStep:()=>C.value>1&&--C.value,save:()=>{if(j.value.$validate(),!j.value.$invalid){const t={data:e.items.map((e=>({id:e.id,condition:(null==e?void 0:e.new_condition)?null==e?void 0:e.new_condition:null==e?void 0:e.condition,price:(null==e?void 0:e.new_price)?null==e?void 0:e.new_price:"",condition_id:null==e?void 0:e.new_condition_id}))),questions:k.value.questions.reduce(((e,t)=>("object"==typeof t.answer_id?t.answer.forEach((n=>e.push({question_id:t.question_id,answer_id:n.id}))):t.answer_id&&e.push({question_id:t.question_id,answer_id:t.answer.id}),e)),[])};d("submit",t),x.value=null,q.value="leave it as is"}},money:v,filterNumber:e=>{const t=[...e.target.value],n=e.keyCode?e.keyCode:e.which;(n<48||n>57)&&(46!=n&&e.preventDefault(),46==n&&t.map((t=>{"."===t&&e.preventDefault()})))},priceAll:x,setPriceAll:()=>{""!=x.value?F():M()},selectCondition:async()=>{const t=e.conditions.find((e=>e.name==q.value));x.value=null;const n=e.items.map((e=>e.product_id)).filter((e=>-1!=e)).join(",");for(let i=0;i<e.items.length;i++)e.items[i].new_condition=q.value,e.items[i].new_condition_id=t.id;n&&(await f.$getQuestions({id:t.id}),k.value.questions=[],f.$state.getQuestions.result.forEach((e=>{k.value.questions.push({question_id:e.id,answer_id:void 0,is_required:e.is_required,question:e,answer:void 0})})),await c({ids:n,is_mac:e.items[0].is_mac,condition_id:t.id,category_id:e.items[0].category_id}))},conditionStore:f,dataForm:k,validation:j,conditionalQuestionShown:e=>{return f.getConditionalFormat((s=((e,t)=>{for(var n in t||(t={}))o.call(t,n)&&a(e,n,t[n]);if(i)for(var n of i(t))l.call(t,n)&&a(e,n,t[n]);return e})({},e),r={symbol:m.value.currency_symbol},t(s,n(r))));var s,r},onChangeAnswer:(e,t)=>{u.value.forEach(((n,i)=>{O(e,t,n,i)}))}}}}),W={class:"grid grid-cols-5 gap-6 mb-6"},Y={key:0,class:"font-normal text-grey-02"},J=["innerHTML","value"],G={class:"max-h-96 overflow-y-auto"},X={class:"font-semibold text-grey-04"},Z={class:"text-grey-04"},ee={class:"text-grey-04"},te={class:"text-grey-04 text-right"},ne={class:"text-grey-04"},ie={class:"flex justify-between"};var oe=f(H,[["render",function(e,t,n,i,o,l){const a=B("Select"),s=B("SelectCheckbox"),r=B("Input"),d=B("BBTColumn"),u=B("BBTable"),c=B("Button"),m=B("Modal");return j(),A("div",null,[E(m,{modelValue:e.isShowModal,"onUpdate:modelValue":t[2]||(t[2]=t=>e.isShowModal=t),title:"Change Conditions",onClose:e.handleCloseModal,size:"xl"},{footer:P((()=>[F("div",ie,[t[6]||(t[6]=F("div",null," Â  ",-1)),F("div",null,[E(c,{class:"mr-2",color:"white",onClick:e.handleCloseModal},{default:P((()=>t[4]||(t[4]=[M("Cancel")]))),_:1},8,["onClick"]),E(c,{color:"teal",onClick:e.save},{default:P((()=>t[5]||(t[5]=[M("Apply Changes")]))),_:1},8,["onClick"])])])])),default:P((()=>[F("div",W,[E(a,{modelValue:e.selectedCondition,"onUpdate:modelValue":t[0]||(t[0]=t=>e.selectedCondition=t),items:e.props.conditions,onChange:e.selectCondition,loading:e.props.loadingCondition,name:"name",by:"name",label:"Set All New Condition to",placeholder:"leave it as is"},null,8,["modelValue","items","onChange","loading"]),e.conditionStore.$state.getQuestions.result&&e.conditionStore.$state.getQuestions.result.length?(j(!0),A(T,{key:0},L(e.conditionStore.$state.getQuestions.result,((n,i)=>(j(),A("div",{key:n.id},[F("label",null,[M(N(n.question)+" ",1),n.is_required?O("",!0):(j(),A("span",Y,"(Optional)"))]),e.dataForm.questions[i]?(j(),A(T,{key:0},["Single"===n.answer_type?(j(),R(a,{key:0,modelValue:e.dataForm.questions[i].answer,"onUpdate:modelValue":[t=>e.dataForm.questions[i].answer=t,t=>e.onChangeAnswer(n,i)],items:n.answers,name:"answer",placeholder:"Select Answer","max-height":"300px",style:{display:"block"},"disabled-default-option":"",block:""},{"default-option":P((()=>t[3]||(t[3]=[F("option",{class:"select__option",value:"",selected:""},"Choose the answer",-1)]))),option:P((({item:t})=>[(j(),A("option",{class:"select__option",innerHTML:`${t.answer} (${e.conditionalQuestionShown(t)})`,value:t,key:t.id},null,8,J))])),_:2},1032,["modelValue","onUpdate:modelValue","items"])):(j(),R(s,{key:1,modelValue:e.dataForm.questions[i].answer,"onUpdate:modelValue":[t=>e.dataForm.questions[i].answer=t,t=>e.onChangeAnswer(n,i)],items:n.answers,placeholder:"Choose the answer",name:"answer"},{head:P((({item:t})=>[M(N(t.answer)+" ("+N(e.conditionalQuestionShown(t))+") ",1)])),option:P((({item:t})=>[M(N(t.answer)+" ("+N(e.conditionalQuestionShown(t))+") ",1)])),_:2},1032,["modelValue","onUpdate:modelValue","items"])),e.validation.questions.$error?(j(!0),A(T,{key:2},L(e.validation.questions.$each.$response.$errors[i].answer_id,((e,t)=>(j(),A("small",{class:"text-red-base block my-2",key:t},N(e.$message)+". ",1)))),128)):O("",!0)],64)):O("",!0)])))),128)):O("",!0),E(r,{modelValue:e.priceAll,"onUpdate:modelValue":t[1]||(t[1]=t=>e.priceAll=t),type:"number",onKeyup:e.setPriceAll,label:"Set All Payout to",disabled:e.isDisabledPrice,icon:""},{icon:P((()=>[M(N(e.me.currency_symbol),1)])),_:1},8,["modelValue","onKeyup","disabled"])]),F("div",G,[E(u,{items:e.items,selectable:!1,"check-all":!1,header:["Item","IMEI","Condition","Payout","New Condition","New Payout"],"collapse-all":""},{item:P((({item:t})=>[E(d,null,{default:P((()=>[F("p",X,N(t.product_name),1)])),_:2},1024),E(d,null,{default:P((()=>[F("p",Z,N(t.imei_sn),1)])),_:2},1024),E(d,null,{default:P((()=>[F("p",ee,N(t.condition),1)])),_:2},1024),E(d,null,{default:P((()=>[F("p",te,"$"+N(e.money(t.price)),1)])),_:2},1024),E(d,{class:"border-separator"},{default:P((()=>[F("p",ne,N(null==t?void 0:t.new_condition),1)])),_:2},1024),E(d,null,{default:P((()=>[E(r,{modelValue:t.new_price,"onUpdate:modelValue":e=>t.new_price=e,disabled:e.isDisabledPrice,type:"text",onKeypress:e.filterNumber,icon:""},{icon:P((()=>[M(N(e.me.currency_symbol),1)])),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onKeypress"])])),_:2},1024)])),_:1},8,["items"])])])),_:1},8,["modelValue","onClose"])])}],["__scopeId","data-v-45f4e040"]]);const le=k({name:"BulkImeiSNInput",components:{},props:{modelValue:{type:String,default:void 0},block:{type:Boolean,default:!0},qty:{type:Number,default:1},rows:{type:String,default:"5"}},emits:["update:modelValue"],setup(e,t){const n=$(),i=$(),o=I({get:()=>e.modelValue,set:e=>t.emit("update:modelValue",e)}),l=I((()=>({imeiSn:{maxRows:t=>{if(!t)return!0;return t.split("\n").length<=e.qty}}}))),a=I((()=>({maxRows:`You have exceeded the maximum number of lines. The limit is ${e.qty}.`}))),s=g(l,{imeiSn:o},{$lazy:!0}),r=e=>{const t=o.value.split("\n");let n=0;for(let i=0;i<t.length;i++)if(n+=t[i].length+1,e<n)return i;return t.length-1},d=e=>{const t=o.value.split("\n");let n=0;for(let i=0;i<e;i++)n+=t[i].length+1;return n},u=e=>{const t=o.value.split("\n");let n=0;for(let i=0;i<=e;i++)n+=t[i].length;return n+e},c=(t,n)=>{const i=e.qty-1;if(t.length<e.qty)return!0;for(let e=0;e<i;e++)if(""===t[e].trim())return!1;return n===i&&""!==t[i].trim()};return U((()=>{const e=window.getComputedStyle(n.value);["fontFamily","fontSize","fontWeight","letterSpacing","lineHeight","padding"].forEach((t=>{i.value.style[t]=e[t]}));const t=e=>e.endsWith("px")?parseInt(e.slice(0,-2),10):0,o=`${e.fontSize} ${e.fontFamily}`,l=t(e.paddingLeft),a=t(e.paddingRight),s=document.createElement("canvas").getContext("2d");s.font=o;const r=()=>{const e=n.value.value.split("\n").map((e=>(e=>{const t=n.value.getBoundingClientRect().width-l-a,i=e.split(" ");let o=0,r="";for(let n=0;n<i.length;n++){const e=s.measureText(i[n]+" ").width;s.measureText(r).width+e>t?(o++,r=i[n]+" "):r+=i[n]+" "}return""!==r.trim()&&o++,o})(e)));let t=[],i=1;for(;e.length>0;){const n=e.shift();t.push(i),n>1&&Array(n-1).fill("").forEach((e=>t.push(""))),i++}return t},d=()=>{const e=r();i.value.innerHTML=Array.from({length:e.length},((t,n)=>`<div>${e[n]||"&nbsp;"}</div>`)).join("")};n.value.addEventListener("input",(()=>{d()})),d();new ResizeObserver((()=>{if(!n.value||!i.value)return;const e=n.value.getBoundingClientRect();i.value.style.height=`${e.height}px`,d()})).observe(n.value),n.value.addEventListener("scroll",(()=>{i.value.scrollTop=n.value.scrollTop}))})),{imeiSn:o,refInput:n,refLines:i,validate:s,messages:a,inputImei:()=>{const t=o.value.split("\n");(null==t?void 0:t.length)>e.quantity&&(o.value=t.slice(0,this.quantity).join("\n"))},validateRows:async t=>{const n=o.value.split("\n"),i=t.target.selectionStart,l=r(i),a=e.qty-1;if("Enter"===t.key){if(c(n,l))return await s.value.$validate();if(t.preventDefault(),l<a){const e=l+1,i=d(e);if(""!==n[e].trim()){const n=u(e);Q((()=>{t.target.setSelectionRange(n,n)}))}else Q((()=>{t.target.setSelectionRange(i,i)}))}}},canAddNewLine:c,getLineEndPosition:u,getLineIndexAtCursor:r,getLineStartPosition:d}}}),ae={class:"flex items-center gap-x-2 mb-2"},se={class:"font-semibold text-sm"},re={style:{maxWidth:"300px"}},de={ref:"refLines",class:"bulk-imei-sn-lines"},ue=["block","rows"],ce={key:0,class:"text-red-base text-sm space-y-4"},me={key:0};var pe=f(le,[["render",function(e,t,n,i,o,l){var a,s,r;const d=B("Tooltip");return j(),A(T,null,[F("div",ae,[t[5]||(t[5]=F("img",{src:"/assets/scanner-gun.156d109f.svg"},null,-1)),F("div",se,[t[4]||(t[4]=M(" Using a scanner, continuously scan IMEI/SN barcodes below: ")),E(d,{placement:"top"},{content:P((()=>[F("div",re," You can only add up to "+N(e.qty)+" IMEI/SNs lines. ",1)])),default:P((()=>t[3]||(t[3]=[F("i",{class:"material-icons cursor-pointer",style:{"line-height":"1!important"}}," info ",-1)]))),_:1})])]),F("div",{class:K(["bulk-imei-sn",e.validate.imeiSn.$error&&"error"])},[F("div",de,null,512),D(F("textarea",{ref:"refInput","onUpdate:modelValue":t[0]||(t[0]=t=>e.imeiSn=t),block:e.block,rows:String(e.qty||e.rows),class:"w-full p-2.5",onKeydown:t[1]||(t[1]=(...t)=>e.validateRows&&e.validateRows(...t)),onInput:t[2]||(t[2]=(...t)=>e.inputImei&&e.inputImei(...t))},null,40,ue),[[z,e.imeiSn]])],2),e.validate.imeiSn.$error?(j(),A("div",ce,[(null==(r=null==(s=null==(a=e.validate)?void 0:a.imeiSn)?void 0:s.maxRows)?void 0:r.$invalid)?(j(),A("span",me,N(e.messages.maxRows),1)):O("",!0)])):O("",!0)],64)}],["__scopeId","data-v-103e6fd6"]]);export{oe as B,pe as a};
