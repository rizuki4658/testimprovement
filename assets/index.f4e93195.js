var e=Object.defineProperty,a=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,i=(a,t,o)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[t]=o;import{N as l,g as n,k as r,f as s,y as d,m as c,o as m,t as u,B as p,D as f,a1 as g,a2 as b,K as v,w as y,I as w,O as C,n as h,U as T,_}from"./vendor.9695fe57.js";import{r as E}from"./index.54844a74.js";import{v as D,f as k,b as x,_ as M,d as N,j as A}from"./index.10c203ea.js";import{u as I}from"./integration.7dafcde7.js";import{_ as O}from"./badge.0380b3b7.js";import{u as j}from"./index.f40e4a9e.js";import"./index.6b6f6369.js";const V=()=>{const e=l(),a=n((()=>e.state.integration.directToMobile.credentials)),t=n((()=>e.state.integration.directToMobile.loading.credentials)),o=n((()=>btoa(JSON.stringify(e.state.integration.directToMobile.credentials))!==btoa(JSON.stringify(e.state.integration.directToMobile.cached_credentials))));return{credentials:a,validationRules:{domain:{required:E},logon_name:{required:E},password:{required:E}},loading:t,isEditedCredentials:o,setCredential:(a=null)=>{null!==a&&e.commit("integration/directToMobile/SET_CREDENTIAL",a)},resetCredential:()=>e.commit("integration/directToMobile/RESET_CREDENTIAL"),connectCredential:async(a=(()=>{}))=>{try{e.commit("integration/directToMobile/SET_LOADING_CREDENTIAL_CONNECT",!0),await e.dispatch("integration/directToMobile/connectCredential"),D(a)&&a(null)}catch(t){D(a)&&a(t)}finally{e.commit("integration/directToMobile/SET_LOADING_CREDENTIAL_CONNECT",!1)}},fetchCredential:async(a=(()=>{}))=>{try{await e.commit("integration/directToMobile/SET_LOADING_CREDENTIAL_FETCH",!0),await e.dispatch("integration/directToMobile/fetchCredential"),D(a)&&a(null)}catch(t){D(a)&&a(t)}finally{await e.commit("integration/directToMobile/SET_LOADING_CREDENTIAL_FETCH",!1)}}}},F=r({name:"integrationKlayvioForm",components:{Input:k,Button:x},props:{data:{type:Object,default:()=>({domain:null,logon_name:null,password:null})}},emits:["update:data"],setup(e,{emit:l}){const{validationRules:n}=V(),r=s({domain:e.data.domain,logon_name:e.data.logon_name,password:e.data.password}),c=s(!1),m=j(n,r,{$lazy:!0});return d((()=>e.data),(()=>r.value=((e,l)=>{for(var n in l||(l={}))t.call(l,n)&&i(e,n,l[n]);if(a)for(var n of a(l))o.call(l,n)&&i(e,n,l[n]);return e})({},e.data))),{formData:r,showPassword:c,validation:m,validate:()=>(m.value.$validate(),!m.value.$invalid),handleUpdateForm:()=>l("update:data",r.value)}}}),U={class:"grid grid-cols-1 gap-6"},P={class:"col-span-1"},S={class:"col-span-1"},L={class:"col-span-1"};const $=r({name:"integrationKlaviyo",components:{Button:x,Modal:N,Alert:A,Badge:O,DirectToMobileForm:M(F,[["render",function(e,a,t,o,i,l){const n=c("Input");return m(),u("div",U,[p("div",P,[f(n,{modelValue:e.formData.domain,"onUpdate:modelValue":a[0]||(a[0]=a=>{e.formData.domain=a,e.handleUpdateForm()}),placeholder:"Domain",label:'Domain "AKA Enterprise ID"',block:"",view:e.validation.domain.$invalid?"danger":"default"},null,8,["modelValue","view"]),(m(!0),u(g,null,b(e.validation.domain.$errors,((e,a)=>(m(),u("small",{class:"text-red-base block",key:a},v(e.$message)+". ",1)))),128))]),p("div",S,[f(n,{modelValue:e.formData.logon_name,"onUpdate:modelValue":a[1]||(a[1]=a=>{e.formData.logon_name=a,e.handleUpdateForm()}),placeholder:"Logon Name",label:"Logon Name",block:"",view:e.validation.logon_name.$invalid?"danger":"default"},null,8,["modelValue","view"]),(m(!0),u(g,null,b(e.validation.logon_name.$errors,((e,a)=>(m(),u("small",{class:"text-red-base block",key:a},v(e.$message)+". ",1)))),128))]),p("div",L,[f(n,{modelValue:e.formData.password,"onUpdate:modelValue":a[3]||(a[3]=a=>{e.formData.password=a,e.handleUpdateForm()}),type:e.showPassword?"text":"password",placeholder:"API Key",label:"API Key",block:"",view:e.validation.password.$invalid?"danger":"default",icon:"",right:"",autocomplete:"new-password"},{icon:y((()=>[p("span",{class:"material-icons block cursor-pointer text-grey-03",onClick:a[2]||(a[2]=a=>e.showPassword=!e.showPassword)},v(e.showPassword?"visibility_off":"visibility"),1)])),default:y((()=>a[4]||(a[4]=[w(" Verify ")]))),_:1},8,["modelValue","type","view"]),(m(!0),u(g,null,b(e.validation.password.$errors,((e,a)=>(m(),u("small",{class:"text-red-base block",key:a},v(e.$message)+". ",1)))),128))])])}]])},async setup(){const e=s(null),a=C(),{credentials:t,loading:o,isEditedCredentials:i,setCredential:l,fetchCredential:r,connectCredential:d}=V(),{actionAll:c}=I(),m=n((()=>0===Object.entries(t.value).filter((([e,a])=>!a)).length&&!i.value));return await r(),{refDirectToMobileForm:e,credentials:t,loading:o,isVerified:m,setCredential:l,handleCloseForm:()=>{a.push({name:"integration",query:{reload:1}})},handleUpdateCredential:async()=>{if(!e.value)return;e.value.validate()&&await d((async e=>{e||(await Promise.allSettled([c(),r()]),_({type:"success",message:"Settings updated!"}),a.push({name:"integration",query:{reload:1}}))}))}}}}),R={key:0,class:"flex items-center py-2 px-4 bg-green-lighten text-green-04 w-max rounded-full my-3"},K={class:"flex items-center justify-between"};var q=M($,[["render",function(e,a,t,o,i,l){const n=c("Alert"),r=c("DirectToMobileForm"),s=c("Button"),d=c("Modal");return m(),h(d,{size:"xs",modelValue:!0,onClickClose:e.handleCloseForm,"without-transition":""},{header:y((()=>a[1]||(a[1]=[p("div",{class:"flex justify-between"},[p("span",null,"UPS Direct to Mobile")],-1)]))),default:y((()=>[f(n,{class:"my-4",color:"blue",view:"smooth"},{default:y((()=>a[2]||(a[2]=[p("div",{class:"flex"},[p("i",{class:"material-icons mr-3"},"info"),p("span",null,"These credentials are provided to you by your UPS account representative.")],-1)]))),_:1}),e.isVerified?(m(),u("div",R,a[3]||(a[3]=[p("i",{class:"material-icons mr-3"},"check_circle",-1),p("span",null,"Verified",-1)]))):T("",!0),f(r,{ref:"refDirectToMobileForm",data:e.credentials,"onUpdate:data":e.setCredential},null,8,["data","onUpdate:data"])])),footer:y((()=>[p("div",K,[p("div",null,[e.isVerified?(m(),u("button",{key:0,class:"px-3 py-3",onClick:a[0]||(a[0]=(...a)=>e.handleCloseForm&&e.handleCloseForm(...a))}," Close ")):T("",!0)]),p("div",null,[f(s,{color:"teal",loading:e.loading.connect||e.loading.fetch,onClick:e.handleUpdateCredential},{default:y((()=>a[4]||(a[4]=[w("Verify")]))),_:1},8,["loading","onClick"])])])])),_:1},8,["onClickClose"])}]]);export{q as default};
