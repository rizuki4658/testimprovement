import{k as e,f as t,g as n,W as i,s as l,m as a,o as s,t as o,B as r,I as u,n as d,w as m,K as c,U as p,A as f,aF as v,F as g,a1 as y}from"./vendor.9695fe57.js";import{u as h}from"./index.f40e4a9e.js";import{_ as w}from"./index.10c203ea.js";const x=e({name:"BulkImeiSNInput",components:{},props:{modelValue:{type:String,default:void 0},block:{type:Boolean,default:!0},qty:{type:Number,default:1},rows:{type:String,default:"5"},limited:{type:Boolean,default:!0},imeiInput:{type:Boolean,default:!0},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,a){const s=t(),o=t(),r=n({get:()=>e.modelValue,set:e=>a.emit("update:modelValue",e)}),u=n((()=>({imeiSn:{maxRows:t=>{if(!e.limited)return!0;if(!t)return!0;return t.split("\n").length<=e.qty}}}))),d=n((()=>({maxRows:`You have exceeded the maximum number of lines. The limit is ${e.qty}.`}))),m=h(u,{imeiSn:r},{$lazy:!0}),c=e=>{const t=r.value.split("\n");let n=0;for(let i=0;i<t.length;i++)if(n+=t[i].length+1,e<n)return i;return t.length-1},p=e=>{const t=r.value.split("\n");let n=0;for(let i=0;i<e;i++)n+=t[i].length+1;return n},f=e=>{const t=r.value.split("\n");let n=0;for(let i=0;i<=e;i++)n+=t[i].length;return n+e},v=(t,n)=>{const i=e.qty-1;if(t.length<e.qty)return!0;for(let e=0;e<i;e++)if(""===t[e].trim())return!1;return n===i&&""!==t[i].trim()};return i((()=>{const e=window.getComputedStyle(s.value);["fontFamily","fontSize","fontWeight","letterSpacing","lineHeight","padding"].forEach((t=>{o.value.style[t]=e[t]}));const t=e=>e.endsWith("px")?parseInt(e.slice(0,-2),10):0,n=`${e.fontSize} ${e.fontFamily}`,i=t(e.paddingLeft),l=t(e.paddingRight),a=document.createElement("canvas").getContext("2d");a.font=n;const r=()=>{const e=s.value.value.split("\n").map((e=>(e=>{const t=s.value.getBoundingClientRect().width-i-l,n=e.split(" ");let o=0,r="";for(let i=0;i<n.length;i++){const e=a.measureText(n[i]+" ").width;a.measureText(r).width+e>t?(o++,r=n[i]+" "):r+=n[i]+" "}return""!==r.trim()&&o++,o})(e)));let t=[],n=1;for(;e.length>0;){const i=e.shift();t.push(n),i>1&&Array(i-1).fill("").forEach((e=>t.push(""))),n++}return t},u=()=>{const e=r();o.value.innerHTML=Array.from({length:e.length},((t,n)=>`<div>${e[n]||"&nbsp;"}</div>`)).join("")};s.value.addEventListener("input",(()=>{u()})),u();new ResizeObserver((()=>{if(!s.value||!o.value)return;const e=s.value.getBoundingClientRect();o.value.style.height=`${e.height}px`,u()})).observe(s.value),s.value.addEventListener("scroll",(()=>{o.value.scrollTop=s.value.scrollTop}))})),{imeiSn:r,refInput:s,refLines:o,validate:m,messages:d,inputImei:()=>{if(!e.limited)return;const t=r.value.split("\n");t.length>e.qty&&(r.value=t.slice(0,e.qty).join("\n"))},validateRows:async t=>{if(!e.limited)return;const n=r.value.split("\n"),i=t.target.selectionStart,a=c(i),s=e.qty-1;if("Enter"===t.key){if(v(n,a))return await m.value.$validate();if(t.preventDefault(),a<s){const e=a+1,i=p(e);if(""!==n[e].trim()){const n=f(e);l((()=>{t.target.setSelectionRange(n,n)}))}else l((()=>{t.target.setSelectionRange(i,i)}))}}},canAddNewLine:v,getLineEndPosition:f,getLineIndexAtCursor:c,getLineStartPosition:p}}}),S={key:0,class:"flex items-center gap-x-2 mb-2"},b={class:"font-semibold text-sm"},I={style:{maxWidth:"300px"}},k={ref:"refLines",class:"bulk-imei-sn-lines"},R=["block","disabled","rows"],q={key:1,class:"text-red-base text-sm space-y-4"},L={key:0};var $=w(x,[["render",function(e,t,n,i,l,h){var w,x,$;const B=a("Tooltip");return s(),o(y,null,[e.imeiInput?(s(),o("div",S,[t[5]||(t[5]=r("img",{src:"/assets/scanner-gun.156d109f.svg"},null,-1)),r("div",b,[t[4]||(t[4]=u(" Using a scanner, continuously scan IMEI/SN barcodes below: ")),e.limited?(s(),d(B,{key:0,placement:"top"},{content:m((()=>[r("div",I," You can only add up to "+c(e.qty)+" IMEI/SNs lines. ",1)])),default:m((()=>t[3]||(t[3]=[r("i",{class:"material-icons cursor-pointer",style:{"line-height":"1!important"}}," info ",-1)]))),_:1})):p("",!0)])])):p("",!0),r("div",{class:g(["bulk-imei-sn",e.validate.imeiSn.$error&&"error"])},[r("div",k,null,512),f(r("textarea",{ref:"refInput","onUpdate:modelValue":t[0]||(t[0]=t=>e.imeiSn=t),block:e.block,disabled:e.disabled,rows:String(e.qty||e.rows),class:"w-full p-2.5",onKeydown:t[1]||(t[1]=(...t)=>e.validateRows&&e.validateRows(...t)),onInput:t[2]||(t[2]=(...t)=>e.inputImei&&e.inputImei(...t))},null,40,R),[[v,e.imeiSn]])],2),e.validate.imeiSn.$error?(s(),o("div",q,[(null==($=null==(x=null==(w=e.validate)?void 0:w.imeiSn)?void 0:x.maxRows)?void 0:$.$invalid)?(s(),o("span",L,c(e.messages.maxRows),1)):p("",!0)])):p("",!0)],64)}],["__scopeId","data-v-1d1c0e09"]]);export{$ as B};
