var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,n=(a,t,o)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[t]=o,s=(e,a)=>{for(var t in a||(a={}))r.call(a,t)&&n(e,t,a[t]);if(o)for(var t of o(a))l.call(a,t)&&n(e,t,a[t]);return e},i=(e,o)=>a(e,t(o));import{u as d}from"./components.aaee2f92.js";import{f as c}from"./date.f86face7.js";import{_ as u,b as p,u as m,e as v,f,j as g,P as h,al as b,r as y,g as C}from"./index.35a87af4.js";import{b as x}from"./report.c67af73d.js";import{C as R}from"./card.85454cb1.js";import{_ as w}from"./badge.8abc46cf.js";import{_ as k}from"./tab.8e54d1d1.js";import{B as _}from"./Breadcrumb.a04d3c7a.js";import{_ as D}from"./group-container.5846be88.js";import{C as F}from"./Currency.fc2b9129.js";import{p as O}from"./chartjs-plugin-zoom.esm.f842a922.js";import{C as P}from"./chart.b16d9eb5.js";import{f as j,r as I,y as S,W as V,o as E,t as B,B as T,q as U,K as z,U as K,G as N,H as A,a1 as L,a2 as M,Q as G,F as W,k as q,g as X,h as $,m as H,$ as Q,D as Y,w as J,n as Z,I as ee,a3 as ae,A as te}from"./vendor.9695fe57.js";import{T as oe}from"./TreeCheckbox.afd82710.js";import"./LoadingCard.fae900cb.js";import"./dymo.b392f7c9.js";import"./breadcrumb.f242deab.js";const re={id:"tooltip-comparison",class:"tooltip-comparison"},le={class:"tooltip-comparison__date"},ne={key:0},se={class:"tooltip-comparison-data"},ie={class:"px-2"},de={class:"px-2"},ce={key:0,class:"material-icons icon-xs ml-1"},ue={class:"relative"},pe={ref:"chartRef",height:"80",id:"charts"};const me=q({components:{Card:R,Checkbox:v,Input:f,Alert:g,Button:p,Badge:w,Tab:k,Breadcrumb:_,Pagination:h,GroupContainer:D,Currency:F,ChartConversion:u({components:{Button:p},props:{labels:{type:Array,default:()=>[]},datasets:{type:Array,default:()=>[]},type:{default:"line",type:String},xKey:{type:String,default:""},yKey:{type:String,default:"data"},compareKey:{type:String,default:"comparation"}},setup(e){const a=j(null);m();const t={chart:null,props:s({},e)},o=I({data:[]}),r=a=>{const{chart:t,tooltip:r}=a,l=(e=>{let a=e.canvas.parentNode.querySelector("div");if(!a){a=document.createElement("div"),a.style.background="rgba(255, 255, 255, 1)",a.style.border="solid 1px rgba(0,0,0,0.1)",a.style.borderRadius="10px",a.style.boxShadow="-1px 5px 9px -2px #4a4a4a47",a.style.color="black",a.style.opacity=1,a.style.pointerEvents="none",a.style.position="absolute",a.style.transform="translate(-50%, 0)",a.style.transition="all .1s ease";const t=document.createElement("table");t.style.margin="0px",a.appendChild(t),e.canvas.parentNode.appendChild(a)}return a})(t);if(0===r.opacity)return void(l.style.opacity=0);if(r.body){const a=r.title||[],t=document.createElement("thead");a.forEach((e=>{const a=document.createElement("tr");a.style.borderWidth=0;const o=document.createElement("th");o.style.borderWidth=0;const r=document.createTextNode(e);o.appendChild(r),a.appendChild(o),t.appendChild(a)})),o.data=[];for(let l of r.dataPoints){const{dataIndex:a,dataset:t}=l,r=t.data[a][e.compareKey],n=r.value,s=t.data[a][e.yKey],i=t.data[a].compare_label,d=r.status;o.data.push({source_name:t.label,current_percentage:s,percentage:n,color:t.borderColor,trend:d,date_compared:i})}const n=document.getElementById("tooltip-comparison");n&&(n.classList.add("--show"),l.appendChild(n))}const{offsetLeft:n,offsetTop:s}=t.canvas;l.style.opacity=1,l.style.left=t.canvas.offsetWidth-r.caretX<300?n+r.caretX-Math.abs(200-(t.canvas.offsetWidth-r.caretX))+"px":n+r.caretX+100+"px",l.style.top=s+r.caretY+"px",l.style.font=r.options.bodyFont.string,l.style.padding="16px 16px",l.style.zIndex=999},l=(e=[],o=[])=>{if(t.chart)return t.chart.update("reset");var l=document.getElementById("charts").getContext("2d").createLinearGradient(0,0,0,400);return l.addColorStop(0,"#4ED3BB"),l.addColorStop(.5,"#4ED3BB"),l.addColorStop(1,"#FFFFFF"),P.register(O),P.defaults.font.family="'Poppins'",t.chart=new P(a.value.getContext("2d"),{type:t.props.type,responsive:!1,maintainAspectRatio:!1,options:{elements:{point:{radius:8}},plugins:{legend:{display:!1},tooltip:{enabled:!1,position:"nearest",mode:"index",external:r}},scales:{y:{ticks:{callback:e=>`${e}%`}}}},data:{labels:e,datasets:o}})};return S((()=>({data:e.datasets})),(()=>{t.chart&&(t.chart.destroy(),t.chart=null),l(e.labels,e.datasets)}),{deep:!0}),V((()=>l(e.labels,e.datasets))),{chartRef:a,comparedData:o}}},[["render",function(e,a,t,o,r,l){return E(),B(L,null,[T("div",re,[T("small",le,[U(e.$slots,"tooltip-compare-date",N(A(o.comparedData)),(()=>{var e;return[o.comparedData.data.length?(E(),B("small",ne,z(null==(e=o.comparedData.data[0])?void 0:e.date_compared),1)):K("",!0)]}),!0)]),T("table",se,[(E(!0),B(L,null,M(o.comparedData.data,((e,a)=>(E(),B("tr",{key:a},[T("td",null,[T("div",{class:"tooltip-comparison-data__label-color",style:G({backgroundColor:e.color})},null,4)]),T("td",ie,z(e.source_name),1),T("td",de,z(Number(e.current_percentage||0).toFixed(2))+"% ",1),T("td",null,[T("div",{class:W(["flex","items-center","tooltip-comparison-data__trend-label","dec"===e.trend&&"--down","inc"===e.trend&&"--up"])},[T("span",null,z(Number(e.percentage||0).toFixed(0))+"%",1),"eql"!==e.trend?(E(),B("i",ce,z("inc"===e.trend?"arrow_upward":"arrow_downward"),1)):K("",!0)],2)])])))),128))])]),T("div",ue,[T("canvas",pe,null,512)])],64)}],["__scopeId","data-v-81a6500c"]]),TreeCheckbox:oe},async setup(e,{emit:a}){const{loading:t,stateConversionRateChart:o,stateConversionRateDevices:r,stateConversionRateChartFilters:l,stateConversionRateFilters:n,conversionRateFilters:d,conversionRateChartFilters:u,dateRangeOptions:p,chartDateRangeOptions:m,datePickerOptions:v,refDatePicker:f,selectedDateRangeOptionIndex:g,setSelectedDateRangeOption:h,datePickerFocus:R,datePickerSelected:w,selectedDateRangeOptionChartIndex:k,refChartDatePicker:_,setSelectedDateRangeOptionChart:D,chartDatePickerFocus:F,chartDatePickerSelected:O,actionConversionRateChart:P,actionConversionRateDevices:I,actionConversionRateDeviceShow:V,actionConversionRateChartFilters:E,actionConversionRateFilters:B}=x(),T=j(null),U=j([]),z=X((()=>y(o.value.label))),K=X((()=>Object.entries(y(o.value.data)).map((e=>{const[a,t]=e,o=t.map((e=>i(s({},e),{y:null==e?void 0:e.data,x:e.label})));return{label:`${a} Conversion Rate`,borderColor:b(a),data:o,tension:.4}})))),N=C((async e=>{const{device:a,detail:o,array_sources:r}=e;if(t.device.show.includes(a)||o)return null;const l=U.value.findIndex((e=>e.device===a));if(-1===l)return null;await V(a,r,(e=>{U.value[l].detail={compare_label:e.compare_label,sources:Object.entries(e.data).map((e=>{const[a,t]=e;return{name:a,detail:t}}))}}))}),500);return S((()=>u),C((async()=>{await P()}),500),{deep:!0}),S((()=>d),C((async()=>{T.value.layout.store.states.expandRows.value=[],await I()}),500),{deep:!0}),S((()=>r),(e=>{U.value=y(e.value.data).map((e=>i(s({},e),{detail:null})))}),{deep:!0}),S((()=>({device:u.device})),C((async()=>{await E()}),500),{deep:!0}),S((()=>u.is_mailin),(()=>{u.device=[],u.model=[]})),S((()=>({search:d.search,from:d.from,to:d.to,source:d.source})),(()=>{d.page=1}),{deep:!0}),I(),E(),B(),await P(),{refConversionRateTable:T,refDatePicker:f,refChartDatePicker:_,stateConversionRateChart:o,stateConversionRateChartFilters:l,stateConversionRateFilters:n,stateDevices:U,conversionRateSourceOptions:[{name:"Flipsy",value:"flipsy"},{name:"Google",value:"google"}],breadcrumb:[{text:"Reports",to:{name:"report"}},{text:"Conversion and Mail-In Rate"}],sourceLabels:z,datasets:K,loading:t,dateRangeOptions:p,chartDateRangeOptions:m,selectedDateRangeOptionIndex:g,selectedDateRangeOptionChartIndex:k,datePickerOptions:v,conversionRateFilters:d,conversionRateChartFilters:u,handleSelectDateRangeOption:e=>{h(e)},handleSelectDateRangeOptionChart:e=>{D(e)},datePickerFocus:R,datePickerSelected:w,chartDatePickerFocus:F,chartDatePickerSelected:O,formatDatabase:c,moment:$,handleExpandChange:N,handleRowKey:e=>e.device,stringToHex:b}}}),ve={class:"flex xl:flex-row flex-col justify-between mb-8"},fe={class:"flex justify-between items-center"},ge={class:"px-6 py-4 mb-2 border-b border-grey-01 border-dotted"},he={key:0},be={key:1},ye={class:"mt-2"},Ce={key:0,class:"material-icons text-teal-04"},xe={key:0,class:"p-4"},Re={class:"font-normal"},we={key:1,class:"px-4 py-2"},ke={class:"flex justify-between"},_e={class:"flex-grow mr-2"},De={class:"flex-grow-0"},Fe={class:"px-6 py-4 mb-2 border-b border-grey-01 border-dotted"},Oe={key:0},Pe={key:1},je={class:"mt-2"},Ie={key:0,class:"material-icons text-teal-04"},Se={class:"my-4"},Ve={class:"py-4"},Ee={key:0,class:"w-full"},Be={class:"mb-4 block text-grey-03"},Te={class:"conversion-source flex flex-col items-center w-96"},Ue={class:"flex-grow-0"},ze={class:"flex-grow px-6 w-20 break-words"},Ke={class:"flex-grow-0"},Ne={class:"text-black mr-2"},Ae={key:0,class:"material-icons icon-xs ml-1"},Le={class:"flex items-center p-1"};var Me=u(me,[["render",function(e,a,t,o,r,l){const n=H("Breadcrumb"),s=H("Tab"),i=H("Button"),d=H("DropdownItem"),c=H("DatePicker"),u=H("DropdownMenu"),p=H("Dropdown"),m=H("Checkbox"),v=H("TreeCheckbox"),f=H("GroupContainer"),g=H("ChartConversion"),h=H("Card"),b=H("Input"),y=H("TableColumn"),C=H("Badge"),x=H("Table"),R=H("Pagination"),w=Q("loading");return E(),B(L,null,[T("div",ve,[Y(n,{pageTitle:"Conversion and Mail-In Rate",backTo:{name:"report"},items:e.breadcrumb},null,8,["items"])]),Y(h,{class:"mb-8"},{default:J((()=>[T("div",fe,[T("div",null,[Y(s,{modelValue:e.conversionRateChartFilters.is_mailin,"onUpdate:modelValue":a[0]||(a[0]=a=>e.conversionRateChartFilters.is_mailin=a),color:"teal",by:"value",items:[{name:"Conversion Rate",value:0},{name:"Mail-In Rate",value:1}],component:""},null,8,["modelValue"])]),T("div",null,[Y(f,null,{default:J((()=>[Y(p,{trigger:"click",size:"medium"},{dropdown:J((()=>[Y(u,null,{default:J((()=>[T("div",ge,[null!==e.selectedDateRangeOptionChartIndex?(E(),B("small",he,z(e.chartDateRangeOptions[e.selectedDateRangeOptionChartIndex].name),1)):(E(),B("small",be,"Date Range")),T("p",ye,z(e.formatDatabase(e.conversionRateChartFilters.from))+" - "+z(e.formatDatabase(e.conversionRateChartFilters.to)),1)]),(E(!0),B(L,null,M(e.chartDateRangeOptions,((a,t)=>(E(),Z(d,{key:t,onClick:a=>e.handleSelectDateRangeOptionChart(t),class:"flex items-center"},{default:J((()=>[t===e.selectedDateRangeOptionChartIndex?(E(),B("i",Ce,"check_circle")):K("",!0),ee(" "+z(a.name),1)])),_:2},1032,["onClick"])))),128)),T("div",{onClick:a[1]||(a[1]=(...a)=>e.chartDatePickerFocus&&e.chartDatePickerFocus(...a)),class:"px-6 py-4 border-t border-grey-01 border-dotted mt-4 cursor-pointer select-none hover:bg-grey-lighten"},[Y(c,ae({style:{position:"absolute",color:"rgba(0, 0, 0, 0)"},"onUpdate:modelValue":e.chartDatePickerSelected},e.datePickerOptions,{type:"daterange",ref:"refChartDatePicker",class:"hide-picker"}),null,16,["onUpdate:modelValue"]),a[11]||(a[11]=ee(" Custom date ranges "))])])),_:1})])),default:J((()=>[Y(i,{color:"white",view:"outlined",class:"flex-auto dropdown dropdown-arrow"},{default:J((()=>[a[10]||(a[10]=T("i",{class:"material-icons mr-2"},"date_range",-1)),ee(z(null!==e.selectedDateRangeOptionChartIndex?e.chartDateRangeOptions[e.selectedDateRangeOptionChartIndex].name:"Date Range"),1)])),_:1})])),_:1}),Y(p,{trigger:"click",size:"medium","hide-on-click":!1},{dropdown:J((()=>[Y(u,null,{default:J((()=>{var t;return[(E(!0),B(L,null,M((null==(t=e.stateConversionRateChartFilters)?void 0:t.source)||[],((t,o)=>(E(),Z(d,{key:o},{default:J((()=>[Y(m,{modelValue:e.conversionRateChartFilters.source,"onUpdate:modelValue":a[2]||(a[2]=a=>e.conversionRateChartFilters.source=a),value:t,color:"teal"},{default:J((()=>[ee(z(t),1)])),_:2},1032,["modelValue","value"])])),_:2},1024)))),128))]})),_:1})])),default:J((()=>[Y(i,{loading:e.loading.chartFilters,color:"white",view:"outlined",class:"flex-auto dropdown dropdown-arrow"},{default:J((()=>a[12]||(a[12]=[ee("Source")]))),_:1},8,["loading"])])),_:1}),0==e.conversionRateChartFilters.is_mailin?(E(),Z(p,{key:0,trigger:"click",size:"medium","hide-on-click":!1},{dropdown:J((()=>[Y(u,null,{default:J((()=>{var t;return[(E(!0),B(L,null,M((null==(t=e.stateConversionRateChartFilters)?void 0:t.device)||[],((t,o)=>(E(),Z(d,{key:o},{default:J((()=>[Y(m,{modelValue:e.conversionRateChartFilters.device,"onUpdate:modelValue":a[3]||(a[3]=a=>e.conversionRateChartFilters.device=a),value:t.device,color:"teal"},{default:J((()=>[ee(z(t.device),1)])),_:2},1032,["modelValue","value"])])),_:2},1024)))),128))]})),_:1})])),default:J((()=>[Y(i,{loading:e.loading.chartFilters,color:"white",view:"outlined",class:"flex-auto dropdown dropdown-arrow"},{default:J((()=>a[13]||(a[13]=[ee("Item")]))),_:1},8,["loading"])])),_:1})):K("",!0),0==e.conversionRateChartFilters.is_mailin?(E(),Z(p,{key:1,trigger:"click",size:"medium","hide-on-click":!1},{dropdown:J((()=>[Y(u,null,{default:J((()=>{var t,o,r;return[(null==(o=null==(t=e.stateConversionRateChartFilters)?void 0:t.model)?void 0:o.length)>0?(E(),B("div",xe,[Y(v,{modelValue:e.conversionRateChartFilters.model,"onUpdate:modelValue":a[4]||(a[4]=a=>e.conversionRateChartFilters.model=a),items:(null==(r=e.stateConversionRateChartFilters)?void 0:r.model)||[],by:"name",name:"name"},{default:J((({item:e})=>[T("span",Re,z(e.name),1)])),_:1},8,["modelValue","items"])])):(E(),B("div",we,a[15]||(a[15]=[T("span",null,"Choose device first",-1)])))]})),_:1})])),default:J((()=>[Y(i,{loading:e.loading.chartFilters,color:"white",view:"outlined",class:"flex-auto dropdown dropdown-arrow"},{default:J((()=>a[14]||(a[14]=[ee("Model")]))),_:1},8,["loading"])])),_:1})):K("",!0)])),_:1})])]),te((E(),B("div",null,[Y(g,{datasets:e.datasets,labels:e.sourceLabels},null,8,["datasets","labels"])])),[[w,e.loading.chart]])])),_:1}),Y(h,null,{default:J((()=>[T("div",ke,[T("div",_e,[Y(b,{modelValue:e.conversionRateFilters.search,"onUpdate:modelValue":a[5]||(a[5]=a=>e.conversionRateFilters.search=a),placeholder:"Search Everything",block:"",icon:""},{icon:J((()=>a[16]||(a[16]=[T("span",{class:"material-icons"},"search",-1)]))),_:1},8,["modelValue"])]),T("div",De,[Y(f,null,{default:J((()=>[Y(p,{trigger:"click",size:"medium","hide-on-click":!1},{dropdown:J((()=>[Y(u,null,{default:J((()=>{var t;return[(E(!0),B(L,null,M((null==(t=e.stateConversionRateFilters)?void 0:t.source)||[],((t,o)=>(E(),Z(d,{key:o},{default:J((()=>[Y(m,{modelValue:e.conversionRateFilters.source,"onUpdate:modelValue":a[6]||(a[6]=a=>e.conversionRateFilters.source=a),value:t,color:"teal"},{default:J((()=>[ee(z(t),1)])),_:2},1032,["modelValue","value"])])),_:2},1024)))),128))]})),_:1})])),default:J((()=>[Y(i,{loading:e.loading.filters,color:"white",view:"outlined",class:"flex-auto dropdown dropdown-arrow"},{default:J((()=>a[17]||(a[17]=[ee("Source")]))),_:1},8,["loading"])])),_:1}),Y(p,{trigger:"click",size:"medium"},{dropdown:J((()=>[Y(u,null,{default:J((()=>[T("div",Fe,[null!==e.selectedDateRangeOptionIndex?(E(),B("small",Oe,z(e.dateRangeOptions[e.selectedDateRangeOptionIndex].name),1)):(E(),B("small",Pe,"Date Range")),T("p",je,z(e.formatDatabase(e.conversionRateFilters.from))+" - "+z(e.formatDatabase(e.conversionRateFilters.to)),1)]),(E(!0),B(L,null,M(e.dateRangeOptions,((a,t)=>(E(),Z(d,{key:t,onClick:a=>e.handleSelectDateRangeOption(t),class:"flex items-center"},{default:J((()=>[t===e.selectedDateRangeOptionIndex?(E(),B("i",Ie,"check_circle")):K("",!0),ee(" "+z(a.name),1)])),_:2},1032,["onClick"])))),128)),T("div",{onClick:a[7]||(a[7]=(...a)=>e.datePickerFocus&&e.datePickerFocus(...a)),class:"px-6 py-4 border-t border-grey-01 border-dotted mt-4 cursor-pointer select-none hover:bg-grey-lighten"},[Y(c,ae({style:{position:"absolute",color:"rgba(0, 0, 0, 0)"},"onUpdate:modelValue":e.datePickerSelected},e.datePickerOptions,{type:"daterange",ref:"refDatePicker",class:"hide-picker"}),null,16,["onUpdate:modelValue"]),a[19]||(a[19]=ee(" Custom date ranges "))])])),_:1})])),default:J((()=>[Y(i,{color:"white",view:"outlined",class:"flex-auto dropdown dropdown-arrow"},{default:J((()=>[a[18]||(a[18]=T("i",{class:"material-icons mr-2"},"date_range",-1)),ee(z(null!==e.selectedDateRangeOptionIndex?e.dateRangeOptions[e.selectedDateRangeOptionIndex].name:"Date Range"),1)])),_:1})])),_:1})])),_:1})])]),T("div",Se,[te((E(),Z(x,{ref:"refConversionRateTable",data:e.stateDevices,onExpandChange:e.handleExpandChange,"row-key":e.handleRowKey},{default:J((()=>[Y(y,{type:"expand"},{default:J((a=>{var t;return[te((E(),B("div",Ve,[(null==(t=a.row.detail)?void 0:t.sources)?(E(),B("div",Ee,[T("small",Be,z(a.row.detail.compare_label),1),T("div",Te,[(E(!0),B(L,null,M(a.row.detail.sources,((a,t)=>(E(),B("div",{key:t,class:"flex flex-wrap w-full"},[T("div",Ue,[T("div",{class:"conversion-source__label-color",style:G({backgroundColor:e.stringToHex(a.name)})},null,4)]),T("div",ze,z(a.name),1),T("div",Ke,[T("div",{class:W(["flex","items-center","conversion-source__trend-label","dec"===a.detail.comparation.status&&"--down","inc"===a.detail.comparation.status&&"--up"])},[T("span",Ne,z(Number(a.detail.data||0).toFixed(2))+"%",1),T("span",null,z(Number(a.detail.comparation.value||0).toFixed(2))+"%",1),"eql"!==a.detail.comparation.status?(E(),B("i",Ae,z("inc"===a.detail.comparation.status?"arrow_upward":"arrow_downward"),1)):K("",!0)],2)])])))),128))])])):K("",!0)])),[[w,e.loading.device.show.includes(a.row.device)]])]})),_:1}),Y(y,{label:"Item",prop:"device"}),Y(y,{label:"Average Conversion Rate"},{default:J((e=>[ee(z(Number(e.row.average_rate||0).toFixed(2))+"% ",1)])),_:1}),Y(y,{label:"Source"},{default:J((e=>[Y(C,{class:"whitespace-nowrap",color:"orange"},{default:J((()=>[T("div",Le,z(e.row.source)+" Resources ",1)])),_:2},1024)])),_:1})])),_:1},8,["data","onExpandChange","row-key"])),[[w,e.loading.all]]),Y(R,{page:e.conversionRateFilters.page,"onUpdate:page":a[8]||(a[8]=a=>e.conversionRateFilters.page=a),limit:e.conversionRateFilters.limit,"onUpdate:limit":a[9]||(a[9]=a=>e.conversionRateFilters.limit=a),data:e.stateConversionRateChart},null,8,["page","limit","data"])])])),_:1})],64)}]]),Ge=q({setup(){const{genSuspense:e}=d();return()=>e(Me)}});export{Ge as default};
