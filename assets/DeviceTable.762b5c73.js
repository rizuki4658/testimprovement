var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,s=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,o=(e,a)=>{for(var l in a||(a={}))i.call(a,l)&&s(e,l,a[l]);if(t)for(var l of t(a))n.call(a,l)&&s(e,l,a[l]);return e},r=(e,t)=>a(e,l(t));import{e as d,i as c,d as u,b,u as p,_ as m,s as g,ad as f}from"./index.c2f66179.js";import{k as h,f as y,a5 as _,O as v,r as w,g as k,y as x,s as C,m as T,$ as S,o as A,t as j,A as I,n as V,w as P,D as B,U as O,B as M,K as D,I as E,T as U,L,S as F,a1 as R,aY as $}from"./vendor.9695fe57.js";import{p as z}from"./setting.10b5d883.js";import{_ as N}from"./catalog-not-found.379a4c88.js";const J=h({name:"DeviceTable",components:{Checkbox:d,Loading:c,Modal:u,Button:b},props:{data:Array,category:{type:Object,default:{name:null,is_enable:0,is_mac:0}},disabled:{type:Boolean,default:!1}},emits:["update-buyback","update-all","update-buyback-category"],setup(e,{emit:a}){const l=y(!0),t=_(),i=v(),{me:n}=p(),{actionUpdateBuybackType:s,actionGetChildren:d}=z(),c=y(0),u=w({buybackType:{update:new Map}}),b=w({name:e.category.name,is_enable:e.category.is_enable,is_mac:e.category.is_mac}),m=y(!1);y(0);const h=y(e.data.map((e=>r(o({},e),{child:e.child.map((a=>r(o({},a),{is_child:!0,manufacturer:e.manufacturer})))})))||[]),T=k((()=>{var e,a,l;if(g.state.dashboard.locationFiltered){const t=(null==(e=g.state.dashboard.locationFiltered)?void 0:e.mailin_location_id)>-1,i=t?(null==(a=g.state.dashboard.locationFiltered)?void 0:a.total)>1:(null==(l=g.state.dashboard.locationFiltered)?void 0:l.total)>0;if(t&&i)return"both";if(t)return"mail-in";if(i)return"in-store"}})),S=y(!1),A=y(null),j="buyback-setup-warning",I=k((()=>E(h.value))),V=k((()=>{const e=t.params.brand.split("");return e[0]=e[0].toUpperCase(),e.join("")})),P=()=>"1"!==sessionStorage.getItem(j),B=e=>{var l,t;e.is_loading=!0,e.instore=e.is_enable,e.mailin=e.is_enable;const i=null!=(t=null==(l=e.parent)?void 0:l.total_active)?t:e.total_active;a("update-buyback",r(o(o({},e),!b.is_mac&&{total_active:i.total_active}),{is_mac:b.is_mac}),(a=>{if(200!=a.status_code)return e.is_enable=1==e.is_enable?0:1,e.instore=e.is_enable,e.mailin=e.is_enable,void(e.is_loading=!1);e.child.length>0&&O(e.child,"all",e.is_enable);const l=I.value.get(e.id);l&&l.parents&&D(l.parents),e.total_active&&(e.total_active=a.data.total_active_category),e.is_loading=!1}))},O=(e,a="all",l)=>{if(e)for(let t of e){"all"===a?(t.is_enable=l,t.instore=l,t.mailin=l):t[a]=l;const e=0===t.instore&&0===t.mailin;t.is_enable=e?0:1;t.child.length>0&&O(t.child,a,l)}},M=(e,a)=>{for(let l of e){if(l.child.length>0){const{buybackType:e,enableStatus:t}=l.child.reduce(((e,l)=>(0===l[a]&&(e.buybackType.isCheckAll=!1),1===l[a]&&(e.buybackType.isUncheckAll=!1),(e.buybackType.isCheckAll||e.buybackType.isUncheckAll)&&2!==l[a]||(e.buybackType.isIndeterminate=!0),0===l.is_enable&&(e.enableStatus.isEnableAll=!1),1===l.is_enable&&(e.enableStatus.isDisableAll=!1),e)),{buybackType:{isCheckAll:!0,isUncheckAll:!0,isIndeterminate:!1},enableStatus:{isEnableAll:!0,isDisableAll:!0}});e.isCheckAll&&(l[a]=1),e.isUncheckAll&&(l[a]=0),e.isIndeterminate&&(l[a]=2),t.isEnableAll&&(l.is_enable=1),t.isDisableAll&&(l.is_enable=0)}}},D=e=>{for(let a of e){if(a.child.length>0){const{status:e}=a.child.reduce(((e,a)=>(0===a.is_enable&&(e.status.enableAll=!1),1===a.is_enable&&(e.status.disableAll=!1),e)),{status:{enableAll:!0,disableAll:!0}});!e.enableAll&&e.disableAll||(a.is_enable=1,a.instore=1,a.mailin=1),e.disableAll&&(a.is_enable=0,a.instore=0,a.mailin=0)}}},E=(e=[],a=new Map,l=[])=>{var t;if((null==e?void 0:e.length)>0)for(let i of e){a.set(i.id,r(o({},i),{parents:l}));(null==(t=null==i?void 0:i.child)?void 0:t.length)>0&&E(i.child,a,[i,...l])}return a};function U(e,a,l){return e.map((e=>{var t;const i=(e=>{var a,l,t,i;return r(o({},e),{has_condition:null!=(l=null!=(a=e.has_condition)?a:e.have_condition)?l:0,has_price:null!=(i=null!=(t=e.has_price)?t:e.have_price)?i:0})})(e),n=Array.isArray(i.child)&&i.child.length>0;return r(o({},i),{has_child:n?1:0,is_child:!0,parent:a,manufacturer:null!=(t=null==e?void 0:e.manufacturer)?t:l,rawChild:n?$(e.child):[],_lazyFetched:!1,child:[]})}))}return x((()=>e.data),(()=>{h.value=e.data.map((e=>r(o({},e),{child:e.child.map((a=>r(o({},a),{is_child:!0,manufacturer:e.manufacturer})))})))}),{deep:!0}),x((()=>({category:e.category})),(e=>{Object.assign(b,e.category)})),x((()=>({name:b.name,param:V.value})),(()=>{l.value=!1,setTimeout((()=>{l.value=!0}),300)})),{category:b,data:h,flattenData:I,route:t,me:n,loading:u,loadingCategory:m,updateBuybackDevice:B,updateBuybackDeviceByCategory:async()=>{m.value=!0,a("update-buyback-category",b,(async e=>{e&&(b.is_enable=1==b.is_enable?0:1),await C((()=>{h.value=[],m.value=!1}))}))},updateBuybackType:async(e,a,l)=>{if(!["instore","mailin"].includes(l))return;const{id:i}=e,n={type:null,category_id:null,category:f(t.params.category),value:null};"instore"===l?(n.type="instore",n.category_id=i,n.value=a):(n.type="mailin",n.category_id=i,n.value=a);const r=o({},e);e[l]=2==e[l]&&1==a?1:a;0===e.instore&&0===e.mailin&&(e.is_enable=0);e.child.length>0&&O(e.child,l,a);const d=I.value.get(i);d&&d.parents&&M(d.parents,l);try{u.buybackType.update.set(i,!0),await s(n)}catch(c){Object.assign(e,r);e.child.length>0&&O(e.child,l,1==a?0:1);const t=I.value.get(i);t&&t.parents&&M(t.parents,l)}finally{u.buybackType.update.delete(i)}},paramsBrand:V,showPricing:(e,a)=>{i.push({path:`/setting/bulk-price-editor/${t.params.category}`})},modal:S,dontShow:c,selectedRow:A,closeModal:()=>{1===c.value&&sessionStorage.setItem(j,"1"),S.value=!1},shouldShowModal:P,findParentName:e=>{if(null==e?void 0:e.parent_id){const a=h.value.find((a=>a.id===(null==e?void 0:e.parent_id)));return a?null==a?void 0:a.name:null==e?void 0:e.name}return null==e?void 0:e.name},toggleEnable:e=>{1===e.is_enable?1===e.has_condition&&1===e.has_price?B(e):(B(e),A.value=e,P()&&(S.value=!0)):B(e)},onExpandChange:async(e,a,l=(e=>e))=>{var i,n;if(e.is_loading=!0,!e._lazyFetched&&(null==(i=e.rawChild)?void 0:i.length))return e.child=U(e.rawChild,e,e.manufacturer),e._lazyFetched=!0,e.is_loading=!1,void l(e.child);let s=[];await d({id:e.id,data:{categories:null==(n=t.params)?void 0:n.category}},(a=>{s=U(JSON.parse(JSON.stringify(null!=a?a:[])),e,e.manufacturer)})),l(s);const c=h.value.findIndex((a=>a.id===e.id));if(-1!==c){const e=h.value[c];h.value[c]=r(o({},e),{is_loading:!1,child:s})}},showTable:l,location:T}}}),Y={class:"flex items-center gap-2"},G={class:"w-80 leading-6"},H={key:0},K={key:1},q={class:"flex flex-wrap items-center py-2"},Q={class:"flex flex-wrap items-center mr-4"},W={class:"w-96 leading-6 text-center"},X={class:"flex flex-wrap items-center"},Z={class:"w-96 leading-6 text-center"},ee={class:"relative ml-6"},ae={key:0,class:"flex flex-row items-center justify-center ml-auto md:mr-20 lg:opacity-0 group-hover:opacity-100 transition-opacity"},le=["href","disabled","onClick"],te=["href","disabled","onClick"],ie={key:1,class:"w-full bg-teal-01 bg-opacity-10",style:{height:"540px"}},ne={key:0,class:"flex flex-col items-center"},se={class:"flex flex-col gap-6"},oe={class:"flex items-center gap-4"},re={class:"text-teal-03"},de=["href"],ce={class:"flex items-center gap-4"},ue={class:"text-teal-03"},be=["href"],pe=["href"],me={class:"flex justify-between items-center"};var ge=m(J,[["render",function(e,a,l,t,i,n){const s=T("TableColumn"),o=T("Checkbox"),r=T("Tooltip"),d=T("RouterLink"),c=T("Loading"),u=T("Table"),b=T("Button"),p=T("Modal"),m=S("loading");return A(),j(R,null,[e.showTable?I((A(),V(u,{key:0,data:e.data,"row-class-name":e.disabled?"global-disabled-row-table":"",load:e.onExpandChange,"tree-props":!e.disabled&&{children:"child",hasChildren:"has_child"},"row-key":"id",lazy:""},{default:P((()=>[B(s,{width:"50"}),B(s,{width:"100",prop:"is_enable"},{header:P((()=>[e.category?(A(),V(o,{key:0,modelValue:e.category.is_enable,"onUpdate:modelValue":a[0]||(a[0]=a=>e.category.is_enable=a),type:"toggle",value:1,"value-off":0,disabled:e.disabled,loading:e.loadingCategory,onInput:a[1]||(a[1]=a=>e.updateBuybackDeviceByCategory())},null,8,["modelValue","disabled","loading"])):O("",!0)])),default:P((a=>[B(o,{modelValue:a.row.is_enable,"onUpdate:modelValue":e=>a.row.is_enable=e,class:"py-3",type:"toggle",value:1,"value-off":0,disabled:e.disabled,loading:a.row.is_loading,onInput:l=>e.toggleEnable(a.row)},null,8,["modelValue","onUpdate:modelValue","disabled","loading","onInput"])])),_:1}),"all"===e.route.params.brand?(A(),V(s,{key:0,label:"Brand"},{default:P((e=>[M("div",Y,[M("span",null,D(e.row.manufacturer),1),0===e.row.has_condition||0===e.row.has_price?(A(),V(r,{key:0,placement:"top"},{default:P((()=>a[6]||(a[6]=[M("i",{class:"material-icons text-orange-04"},"warning",-1)]))),content:P((()=>[M("div",G,[0===e.row.has_condition&&0===e.row.has_price||0===e.row.has_condition&&1===e.row.has_price?(A(),j("p",H,' To start buying this item, switch the "Activate" toggle to on, then configure its conditions and pricing. ')):(A(),j("p",K,"To start buying this item, you must configure its pricing."))])])),_:2},1024)):O("",!0)])])),_:1})):O("",!0),B(s,{prop:"name",label:"Model"},{default:P((e=>{var a,l;return[E(D(null!=(l=null==(a=e.row)?void 0:a.name)?l:"-"),1)]})),_:1}),B(s,{label:"Purchasing Type","min-width":300},{default:P((({row:l})=>[M("div",q,[M("div",Q,["mail-in"==e.location&&l.is_enable&&!e.disabled?(A(),V(r,{key:0,placement:"top"},{default:P((()=>[B(o,{class:"py-3",color:"teal",value:"1","value-off":"0",modelValue:2==l.instore?0:l.instore,indeterminate:2==l.instore,disabled:""},{default:P((()=>a[7]||(a[7]=[M("span",{class:"ml-1 font-normal"},"In-Store",-1)]))),_:2},1032,["modelValue","indeterminate"])])),content:P((()=>[M("div",W,[a[9]||(a[9]=E(" To enable In-Store purchasing, add an In-Store subscription under ")),B(d,{class:"text-white underline",to:{name:"settingManageLocationStoreLocations"}},{default:P((()=>a[8]||(a[8]=[E("Location Settings")]))),_:1}),a[10]||(a[10]=E(". "))])])),_:2},1024)):(A(),V(o,{key:1,modelValue:2==l.instore?0:l.instore,indeterminate:2==l.instore,value:1,"value-off":0,disabled:!l.is_enable||e.disabled||l.is_loading,onInput:a=>e.updateBuybackType(l,a,"instore")},{default:P((()=>a[11]||(a[11]=[M("span",{class:"ml-1 font-normal"},"In-Store",-1)]))),_:2},1032,["modelValue","indeterminate","disabled","onInput"]))]),M("div",X,["in-store"==e.location&&l.is_enable&&!e.disabled?(A(),V(r,{key:0,placement:"top"},{default:P((()=>[B(o,{class:"py-3",color:"teal",value:"1","value-off":"0",modelValue:2==l.mailin?0:l.mailin,indeterminate:2==l.mailin,disabled:""},{default:P((()=>a[12]||(a[12]=[M("span",{class:"ml-1 font-normal"},"Mail-in",-1)]))),_:2},1032,["modelValue","indeterminate"])])),content:P((()=>[M("div",Z,[a[14]||(a[14]=E(" To enable Mail-in purchasing, add a Mail-in subscription under ")),B(d,{class:"text-white underline",to:{name:"settingManageLocationStoreLocations"}},{default:P((()=>a[13]||(a[13]=[E("Location Settings")]))),_:1}),a[15]||(a[15]=E(". "))])])),_:2},1024)):(A(),V(o,{key:1,modelValue:2==l.mailin?0:l.mailin,indeterminate:2==l.mailin,value:1,"value-off":0,disabled:!l.is_enable||e.disabled||l.is_loading,onInput:a=>e.updateBuybackType(l,a,"mailin")},{default:P((()=>a[16]||(a[16]=[M("span",{class:"ml-1 font-normal"},"Mail-in",-1)]))),_:2},1032,["modelValue","indeterminate","disabled","onInput"])),M("div",ee,[B(U,{name:"fade"},{default:P((()=>[I(B(c,null,null,512),[[L,e.loading.buybackType.update.get(l.id)]])])),_:2},1024)])]),l.is_enable?(A(),j("div",ae,[l.has_child?(A(),j("a",{key:1,href:`/setting/bulk-price-editor/${e.route.params.category}`,disabled:l.is_loading,class:"btn btn-teal btn-dense btn-filled",onClick:F((a=>e.showPricing(l,2)),["prevent"])},a[18]||(a[18]=[M("div",{class:"flex items-center justify-center"},[M("i",{class:"material-icons text-lg"},"attach_money"),E(" Pricing Editor ")],-1)]),8,te)):(A(),j("a",{key:0,href:`/setting/bulk-price-editor/${e.route.params.category}`,disabled:l.is_loading,class:"btn btn-teal btn-dense btn-filled",onClick:F((a=>e.showPricing(l,1)),["prevent"])},a[17]||(a[17]=[M("div",{class:"flex items-center justify-center"},[M("i",{class:"material-icons text-lg"},"attach_money"),E(" Pricing Editor ")],-1)]),8,le))])):O("",!0)])])),_:1})])),_:1},8,["data","row-class-name","load","tree-props"])),[[m,e.loadingCategory]]):(A(),j("div",ie)),B(p,{size:"sm",modelValue:e.modal,"onUpdate:modelValue":a[5]||(a[5]=a=>e.modal=a)},{header:P((()=>a[19]||(a[19]=[E(" Important Information ")]))),default:P((()=>{var l;return[e.selectedRow?(A(),j("div",ne,[a[24]||(a[24]=M("div",{class:"flex justify-center items-center p-8 rounded-full bg-teal-lighten"},[M("img",{src:N,alt:""})],-1)),a[25]||(a[25]=M("p",{class:"text-center mt-8"},"Your item has been enabled in your catalog, but you still need to complete the following steps",-1)),a[26]||(a[26]=M("p",{class:"text-center my-6"},"Here are your next steps:",-1)),M("div",se,[M("div",oe,[a[21]||(a[21]=M("div",{class:"flex items-center justify-center bg-teal-02 rounded-full text-white font-semibold w-8 h-8"},"1",-1)),M("p",re,[a[20]||(a[20]=E("Set item conditions as needed within the ")),M("a",{class:"underline text-black",href:`/setting/product-conditions/create?model=${e.findParentName(e.selectedRow)}&ref=true`},"Conditions Settings",8,de)])]),M("div",ce,[a[23]||(a[23]=M("div",{class:"flex items-center justify-center bg-teal-02 rounded-full text-white font-semibold w-8 h-8"},"2",-1)),M("p",ue,[a[22]||(a[22]=E(" Set item prices as needed within the ")),(null==(l=e.selectedRow)?void 0:l.is_child)?(A(),j("a",{key:1,class:"underline text-black",href:`/setting/bulk-price-editor/${e.route.params.category}`,onClick:a[3]||(a[3]=F((a=>e.showPricing(e.selectedRow,2)),["prevent"]))}," Price Editor Settings ",8,pe)):(A(),j("a",{key:0,class:"underline text-black",href:`/setting/bulk-price-editor/${e.route.params.category}`,onClick:a[2]||(a[2]=F((a=>e.showPricing(e.selectedRow,1)),["prevent"]))}," Price Editor Settings ",8,be))])])])])):O("",!0)]})),footer:P((()=>[M("div",me,[M("div",null,[B(o,{modelValue:e.dontShow,"onUpdate:modelValue":a[4]||(a[4]=a=>e.dontShow=a),value:1,"value-off":0,class:"font-normal"},{default:P((()=>a[27]||(a[27]=[E(" Don't show this again for this session ")]))),_:1},8,["modelValue"])]),B(b,{color:"teal",view:"smooth",onClick:e.closeModal},{default:P((()=>a[28]||(a[28]=[M("i",{class:"material-icons mr-2"},"close",-1),E("Close Notification")]))),_:1},8,["onClick"])])])),_:1},8,["modelValue"])],64)}]]);export{ge as D};
