import{u as e}from"./components.3d07dc59.js";import{C as a}from"./card.afeb5d7a.js";import{f as l,_ as t,b as o,d as i,u as n,R as s}from"./index.9c4dcead.js";import{B as d}from"./Breadcrumb.faa47922.js";import{k as m,g as r,m as c,o as u,t as p,B as f,D as g,U as b,a1 as v,a2 as y,K as h,N as T,a5 as w,r as V,f as E,w as k,I as _,_ as j,$ as x,A as C,n as U}from"./vendor.9695fe57.js";import{u as B}from"./index.f40e4a9e.js";import{r as N}from"./index.6b6f6369.js";import{e as S}from"./emailTemplate.08b09a3e.js";import{M as F}from"./MultipleEmailInput.f15ed602.js";import{E as G}from"./index.2ee2bcb0.js";import{T as I,c as P}from"./TextEditor.1cc179d3.js";import{P as R}from"./PreviewEmailTemplate.11883a5c.js";import"./LoadingCard.ab052f4a.js";import"./breadcrumb.bd47f77c.js";import"./setting.ec7e7a35.js";import"./select.399034f1.js";import"./fieldset.b90636af.js";import"./IframeRender.46e71567.js";const $=m({name:"GeneralNotificationsFormInfo",components:{Input:l,MultipleEmailInput:F,EmailTemplateTimeDelay:G},props:{modelValue:{type:Object,default:()=>({})},validation:{type:Object,default:()=>({})},hideBcc:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,a){const l=r({get:()=>e.modelValue,set:e=>a.emit("update:modelValue",e)});return{data:l,handleUpdateBccEmail:e=>{l.value.bcc=[...e]},handleUpdateSendingTimes:e=>{l.value.sending_times=e},handleUpdateSendingTimesJson:e=>{l.value.sending_times_json=e}}}}),M={class:"space-y-4"},J={class:"space-y-1 lg:w-1/2"},D={class:"space-y-1 lg:w-1/2"},A={key:0,class:"space-y-1 lg:w-1/2"},O={key:1,class:"space-y-1 lg:w-1/2"},q={class:"space-y-1 lg:w-1/2"};var z=t($,[["render",function(e,a,l,t,o,i){var n,s;const d=c("Input"),m=c("EmailTemplateTimeDelay"),r=c("MultipleEmailInput");return u(),p("div",M,[f("div",J,[a[3]||(a[3]=f("label",null,"Title",-1)),g(d,{modelValue:e.data.name,"onUpdate:modelValue":a[0]||(a[0]=a=>e.data.name=a),placeholder:"Title",block:"",disabled:""},null,8,["modelValue"])]),f("div",D,[a[4]||(a[4]=f("label",null,"Email",-1)),g(d,{modelValue:e.data.email_sender,"onUpdate:modelValue":a[1]||(a[1]=a=>e.data.email_sender=a),placeholder:"Email Sender",block:"",disabled:""},null,8,["modelValue"])]),0!==e.data.sending_times?(u(),p("div",A,[g(m,{sendingTimes:e.data.sending_times,sendingTimesJson:e.data.sending_times_json,"onUpdate:sendingTimes":e.handleUpdateSendingTimes,"onUpdate:sendingTimesJson":e.handleUpdateSendingTimesJson},null,8,["sendingTimes","sendingTimesJson","onUpdate:sendingTimes","onUpdate:sendingTimesJson"])])):b("",!0),e.hideBcc?b("",!0):(u(),p("div",O,[a[5]||(a[5]=f("label",null,"BCC",-1)),g(r,{onEmailChange:e.handleUpdateBccEmail,suggestion:!1,emails:e.data.bcc},null,8,["onEmailChange","emails"])])),f("div",q,[a[6]||(a[6]=f("label",null,"Subject",-1)),g(d,{modelValue:e.data.subject,"onUpdate:modelValue":a[2]||(a[2]=a=>e.data.subject=a),placeholder:"Subject",block:""},null,8,["modelValue"]),(u(!0),p(v,null,y(null==(s=null==(n=e.validation)?void 0:n.subject)?void 0:s.$errors,((e,a)=>(u(),p("small",{key:a,class:"mt-2 text-red-base block"},h(e.$message)+". ",1)))),128))])])}]]);const H=m({name:"GeneralNotificationsFormEditor",components:{PreviewEmailTemplate:R,TextEditor:I,Button:o,Modal:i},props:{modelValue:{type:String,default:void 0},validation:{type:Object,default:()=>({})}},emits:["update:modelValue","reset"],setup(e,a){const l=T(),t=w(),{me:o}=n(),i=V({editor:P.exports.Editor,config:{htmlSupport:{allow:[{styles:!0,classes:!0}]},link:{decorators:{test:{mode:"automatic",callback:e=>"{:verify-link}"===e,classes:"btn btn-blue btn-filled my-4"}}},simpleUpload:{uploadUrl:`https://api-us.buybackcloud.com/api/v1/pos/settings/email-template/upload-image/${t.params.id}?buyback_company_token=${o.value.buyback_company_token}`}}}),s=r({get:()=>e.modelValue,set:e=>a.emit("update:modelValue",e)}),d=E(),m=E(!1),c=E(!1),u=E(!1);return{ckeditor:i,data:s,preview:d,showPreview:m,loading:c,modal:u,openModalReset:()=>{u.value=!0},handleResetTemplate:async()=>{try{await l.dispatch("setting/emailTemplate/resetEmailTemplate",t.params.id),u.value=!1,a.emit("reset")}catch(e){}finally{c.value=!1}},handlePreviewEmailTemplate:async()=>{c.value=!0;try{const e=await l.dispatch("setting/emailTemplate/previewEmailTemplate",{id:t.params.id,body:s.value||""});d.value=e,m.value=!0}catch(e){d.value=null,m.value=!1}finally{c.value=!1}}}}}),K={class:"py-10"},L={class:"text-center"};var W=t(H,[["render",function(e,a,l,t,o,i){var n,d;const m=c("Button"),r=c("TextEditor"),b=c("Modal"),T=c("PreviewEmailTemplate");return u(),p("div",null,[g(r,{modelValue:e.data,"onUpdate:modelValue":a[0]||(a[0]=a=>e.data=a),options:e.ckeditor,"with-image-upload":""},{toolbar:k((()=>[g(m,{class:"ml-2",color:"teal",dense:"",loading:e.loading,onClick:e.handlePreviewEmailTemplate},{default:k((()=>a[4]||(a[4]=[f("i",{class:"material-icons mr-1"},"visibility",-1),_(" Preview Email ")]))),_:1},8,["loading","onClick"]),g(m,{class:"ml-auto",color:"orange",view:"smooth",dense:"",onClick:e.openModalReset},{default:k((()=>a[5]||(a[5]=[f("i",{class:"material-icons"},"restart_alt",-1),_(" Reset to Default ")]))),_:1},8,["onClick"])])),_:1},8,["modelValue","options"]),(u(!0),p(v,null,y(null==(d=null==(n=e.validation)?void 0:n.body)?void 0:d.$errors,((e,a)=>(u(),p("small",{key:a,class:"mt-2 text-red-base block"},h(e.$message)+". ",1)))),128)),g(b,{modelValue:e.modal,"onUpdate:modelValue":a[2]||(a[2]=a=>e.modal=a),"hide-footer":"","hide-header":"",size:"xs"},{default:k((()=>[f("div",K,[a[8]||(a[8]=f("img",{class:"mb-10 mx-auto",src:s,alt:"Warning icon"},null,-1)),a[9]||(a[9]=f("div",{class:"mt-8 mb-10"},[f("h5",{class:"mb-4 text-center"},"Reset Email Template"),f("p",{class:"text-center mb-6"}," Are you sure you want to reset to the default email template? ")],-1)),f("div",L,[g(m,{view:"outlined",color:"teal",class:"bg-white",onClick:a[1]||(a[1]=a=>e.modal=!1),disabled:e.loading},{default:k((()=>a[6]||(a[6]=[_(" Cancel ")]))),_:1},8,["disabled"]),g(m,{view:"smooth",color:"orange",class:"ml-3",loading:e.loading,onClick:e.handleResetTemplate},{default:k((()=>a[7]||(a[7]=[_(" Yes, reset ")]))),_:1},8,["loading","onClick"])])])])),_:1},8,["modelValue"]),g(T,{show:e.showPreview,"onUpdate:show":a[3]||(a[3]=a=>e.showPreview=a),body:e.preview,"render-type":"direct"},null,8,["show","body"])])}]]);const Y=m({name:"GeneralNotificationsFormCodes",components:{},props:{modelValue:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},setup:e=>({data:r((()=>e.modelValue)),loading:r((()=>e.loading)),copyText:e=>{navigator.clipboard.writeText(e).then((()=>{j({type:"success",message:"Text copied to clipboard"})}))}})}),Q={class:"flex items-center gap-x-4"},X=["onClick"];const Z=m({name:"GeneralNotificationsForm",components:{Button:o,GeneralNotificationsFormInfo:z,GeneralNotificationsFormCodes:t(Y,[["render",function(e,a,l,t,o,i){const n=c("TableColumn"),s=c("Table"),d=x("loading");return C((u(),U(s,{data:e.modelValue},{default:k((()=>[g(n,{prop:"code",label:"Code"},{default:k((l=>[f("div",Q,[f("span",null,h(l.row.code),1),f("i",{class:"material-symbols-outlined text-lg text-teal-04",onClick:a=>e.copyText(l.row.code)}," content_copy ",8,X),a[0]||(a[0]=f("i",{class:"material-icons"},"copy",-1))])])),_:1}),g(n,{prop:"description",label:"Description"})])),_:1},8,["data"])),[[d,e.loading]])}]]),GeneralNotificationsFormEditor:W},async setup(){const e=w(),a=E(),l=E(),{data:t,loading:o,handleShow:i,handleUpdate:n}=S(),s=r((()=>["31"].includes(`${t.value.id}`))),d=B({subject:{required:N},body:{required:N}},t,{$lazy:!0});return await i(e.params.id),{data:t,loading:o,isHideBcc:s,formInfo:a,formEditor:l,validation:d,handleShow:i,handleUpdate:n,saveTemplate:async()=>{if(!(await d.value.$validate()))return;const a={id:e.params.id,data:t.value};await n(a)},resetTemplate:async()=>{i(e.params.id)}}}}),ee={class:"space-y-10"};var ae=t(m({components:{Card:a,Button:o,Breadcrumb:d,GeneralNotificationsForm:t(Z,[["render",function(e,a,l,t,o,i){const n=c("GeneralNotificationsFormInfo"),s=c("GeneralNotificationsFormEditor"),d=c("GeneralNotificationsFormCodes"),m=x("loading");return C((u(),p("div",ee,[g(n,{modelValue:e.data,"onUpdate:modelValue":a[0]||(a[0]=a=>e.data=a),validation:e.validation,"hide-bcc":e.isHideBcc,ref:"formInfo"},null,8,["modelValue","validation","hide-bcc"]),g(s,{modelValue:e.data.body,"onUpdate:modelValue":a[1]||(a[1]=a=>e.data.body=a),validation:e.validation,ref:"formEditor",onReset:e.resetTemplate},null,8,["modelValue","validation","onReset"]),g(d,{modelValue:e.data.sort_code,"onUpdate:modelValue":a[2]||(a[2]=a=>e.data.sort_code=a),loading:e.loading},null,8,["modelValue","loading"])])),[[m,e.loading]])}]])},async setup(){const e=E(null),a=E(!1);return{generalForm:e,breadcrumb:[{text:"Settings",to:{name:"setting"}},{text:"Notifications",to:{name:"settingEmailTemplate"}},{text:"Edit Notification"}],handleSave:async()=>{var a;await(null==(a=null==e?void 0:e.value)?void 0:a.saveTemplate())},loading:a}}}),[["render",function(e,a,l,t,o,i){const n=c("Button"),s=c("Breadcrumb"),d=c("GeneralNotificationsForm"),m=c("Card");return u(),p(v,null,[g(s,{class:"mt-2 mb-8",pageTitle:"Edit Notification",backTo:{name:"settingEmailTemplate"},items:e.breadcrumb},{right:k((()=>[g(n,{loading:e.loading,color:"teal",onClick:e.handleSave},{default:k((()=>a[0]||(a[0]=[_(" Save Changes ")]))),_:1},8,["loading","onClick"])])),_:1},8,["items"]),g(m,null,{default:k((()=>[g(d,{ref:"generalForm"},null,512)])),_:1})],64)}]]),le=m({setup(){const{genSuspense:a}=e();return()=>a(ae)}});export{le as default};
