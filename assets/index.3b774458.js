import{u as e}from"./components.dd762bd4.js";import{k as a,a5 as o,O as t,f as l,g as i,m as s,o as r,t as m,B as d,D as n,w as p,I as w,a1 as f,_ as c}from"./vendor.9695fe57.js";import{D as u,C as g,j as k}from"./setting.1af98a84.js";import{D as b}from"./workflow.82480012.js";import{_ as v,b as h,d as T,R as W}from"./index.6438e939.js";import{C as E}from"./card.33d29bf3.js";import{W as j}from"./Form.eb6e35ca.js";import{B as y}from"./Breadcrumb.cb17adf4.js";import{P as _}from"./PreviewEmailTemplate.330a337c.js";import"./LoadingCard.6426fb93.js";import"./index.f40e4a9e.js";import"./index.6b6f6369.js";import"./index.54844a74.js";import"./fieldset.85092f83.js";import"./InputFile.ee51f7a2.js";import"./Colorpicker.250b88e5.js";import"./MultipleEmailInput.4f716641.js";import"./TextEditor.2633fc04.js";import"./index.87b7fe6f.js";import"./select.94a9f057.js";import"./breadcrumb.0bf6764a.js";import"./IframeRender.46e71567.js";const I=a({components:{Button:h,Card:E,WorkflowForm:j,Modal:T,Breadcrumb:y,PreviewEmail:_},async setup(){const e=o(),a=t(),s=e.query.type||"in-store",r=l(null),{data:m,loading:d,loadingEmailTheme:n,actionShow:p,actionUpdate:w,actionUpdateEmailTheme:f}=u({type:s}),{modal:v,loading:h,openModal:T,closeModal:W,actionResetEmailTemplate:E,specialWorkflowIds:j}=g({type:s}),{emailBody:y,isPreview:_,previewedTemplate:I,loading:P,actionWorkflowEmail:x}=k({type:s}),C=i((()=>!m.parent_id&&1==m.havechild)),B=i((()=>d.value));if(!b.includes(parseInt(e.params.workflowId)))return await p(e.params.workflowId),{data:m,specialWorkflowIds:j,loading:d,loadingEmailTheme:n,breadcrumb:[{text:"Settings",to:{name:"setting"}},{text:"Workflow",to:{name:"settingWorkflow"}},{text:"Edit Workflow"}],refForm:r,route:e,isParent:C,isPreview:_,isLoadingEditor:B,previewedTemplate:I,loadingPreviewEmailTemplate:P,modalWorkflow:v,loadingWorkflow:h,openModalWorkflow:T,closeModalWorkflow:W,updateWorkflow:async()=>{var o,t;await(null==(t=null==(o=r.value)?void 0:o.validate)?void 0:t.call(o))&&await w(e.params.workflowId,(async e=>{e&&200===e.status&&await a.push({name:"settingWorkflow"})}))},handleUpdateEmailTheme:async()=>await f(e.params.workflowId,(()=>{c({type:"success",message:"Workflow email theme updated"})})),handlePreviewEmailTemplate:async()=>{y.value=m.email_template,m.id&&await x(m.id)},handleResetTemplate:()=>T("reset_template"),resetTemplate:async()=>await E({id:e.params.workflowId},(async()=>{W("reset_template"),await p(e.params.workflowId)}))};await a.push({name:"settingWorkflow"})}}),P={class:"py-10"},x={class:"text-center"};var C=v(I,[["render",function(e,a,o,t,l,i){const c=s("Button"),u=s("Breadcrumb"),g=s("WorkflowForm"),k=s("Card"),b=s("Modal"),v=s("PreviewEmail");return r(),m(f,null,[d("div",null,[n(u,{class:"mt-2 mb-8",pageTitle:"Edit Workflow",backTo:{name:"settingWorkflowTab",params:{buyback:e.route.query.type}},items:e.breadcrumb},{right:p((()=>[n(c,{color:"teal",loading:e.loading,onClick:e.updateWorkflow},{default:p((()=>a[3]||(a[3]=[w(" Save Changes ")]))),_:1},8,["loading","onClick"])])),_:1},8,["backTo","items"]),n(k,{class:"mb-24"},{default:p((()=>[n(g,{data:e.data,ref:"refForm","disable-status":e.specialWorkflowIds.includes(parseInt(e.route.params.workflowId)),"disbale-send-mail":!1,"is-parent":e.isParent,"loading-theme":e.loadingEmailTheme,"loading-preview-email":e.loadingPreviewEmailTemplate,"loading-editor":e.isLoadingEditor,onUpdateEmailTheme:e.handleUpdateEmailTheme,onPreviewEmail:e.handlePreviewEmailTemplate,onResetTemplate:e.handleResetTemplate,"reset-template":""},null,8,["data","disable-status","is-parent","loading-theme","loading-preview-email","loading-editor","onUpdateEmailTheme","onPreviewEmail","onResetTemplate"])])),_:1})]),n(b,{modelValue:e.modalWorkflow.reset_template,"onUpdate:modelValue":a[1]||(a[1]=a=>e.modalWorkflow.reset_template=a),"hide-footer":"","hide-header":"",size:"xs"},{default:p((()=>[d("div",P,[a[6]||(a[6]=d("img",{class:"mb-10 mx-auto",src:W,alt:"Warning icon"},null,-1)),a[7]||(a[7]=d("div",{class:"mt-8 mb-10"},[d("h5",{class:"mb-4 text-center"},"Reset Email Template"),d("p",{class:"text-center mb-6"}," Are you sure you want to reset to the default email template? ")],-1)),d("div",x,[n(c,{onClick:a[0]||(a[0]=a=>e.closeModalWorkflow("reset_template")),view:"outlined",color:"teal",class:"bg-white",disabled:e.loadingWorkflow.reset_template},{default:p((()=>a[4]||(a[4]=[w("Cancel")]))),_:1},8,["disabled"]),n(c,{onClick:e.resetTemplate,view:"smooth",color:"orange",class:"ml-3",loading:e.loadingWorkflow.reset_template},{default:p((()=>a[5]||(a[5]=[w("Yes, reset")]))),_:1},8,["onClick","loading"])])])])),_:1},8,["modelValue"]),n(v,{show:e.isPreview,"onUpdate:show":a[2]||(a[2]=a=>e.isPreview=a),body:e.previewedTemplate},null,8,["show","body"])],64)}]]),B=a({setup(){const{genSuspense:a}=e();return()=>a(C)}});export{B as default};
