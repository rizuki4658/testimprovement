{"version":3,"file":"Chart.3de476bd.js","sources":["../../src/components/ChartDashboard.vue","../../src/views/dashboard/Chart.vue"],"sourcesContent":["<template>\n  <div>\n    <!-- <Button class=\"mt-3\" color=\"teal\" view=\"smooth\" dense @click=\"togglePoints\">Toogle</Button> -->\n    <canvas ref=\"chartRef\" height=\"105\" id=\"charts\"></canvas>\n  </div>\n</template>\n\n<script>\nimport Chart from \"chart.js/auto\";\nimport zoomPlugin from 'chartjs-plugin-zoom'\nimport { onMounted, ref, watch } from \"vue\";\nimport { useUser } from 'composable/user'\nimport { currency } from 'utils/number'\nimport Button from 'bbUi/components/button/button.vue'\n\nexport default {\n  components: {\n    Button\n  },\n  props: {\n    labels: Array,\n    data: Array,\n    dataLeads: Array,\n    type: {\n      default: \"line\",\n      type: String,\n    },\n  },\n  setup(props) {\n    const chartRef = ref(null);\n    const { me } = useUser()\n\n    const showPoints = ref(false)\n    const chartState = {\n      chart: null,\n      props: { ...props },\n    };\n    const roundUpToNiceNumber = (value) => {\n      const digits = Math.pow(10, Math.floor(Math.log10(value))); // basis 10 terdekat\n      return Math.ceil(value / digits) * digits;\n    }\n    const maxLabelY = roundUpToNiceNumber(Math.max(...[...props.data, ...props.dataLeads]))\n    const maxTick = Math.max(...[props?.dataLeads?.filter(i => i > 0).length || 0, props?.data?.filter(i => 0)?.length || 0])\n    const stepSize = Math.ceil(maxLabelY / maxTick)\n\n    const legendSpacing = {\n      id: 'extraLegendSpacing',\n      beforeInit(chart) {\n        const fitValue = chart.legend.fit\n        chart.legend.fit = function () {\n          fitValue.bind(chart.legend)()\n          this.height += 20; // px space between chart and legend\n        }\n      }\n    }\n    const togglePoints = () => {\n      showPoints.value = !showPoints.value;\n\n      if (chartState.chart) {\n        chartState.chart.data.datasets.forEach((dataset) => {\n          dataset.pointRadius = showPoints.value ? 3 : 0;\n          dataset.pointHoverRadius = showPoints.value ? 5 : 6;\n        });\n\n        chartState.chart.update();\n      }\n    }\n\n    const render = (labels, data, dataLeads) => {\n      if (chartState.chart) {\n        return chartState.chart.update(\"reset\");\n      }\n\n      var gradient = document\n        .getElementById(\"charts\")\n        .getContext(\"2d\")\n        .createLinearGradient(0, 0, 0, 400);\n      gradient.addColorStop(0, \"#4ED3BB\");\n      gradient.addColorStop(0.5, \"#4ED3BB\");\n      gradient.addColorStop(1, \"#FFFFFF\");\n\n      Chart.register(zoomPlugin)\n      Chart.defaults.font.family = \"'Poppins'\"\n      Chart.register(zoomPlugin, legendSpacing)\n      return (chartState.chart = new Chart(chartRef.value.getContext(\"2d\"), {\n        type: chartState.props.type,\n        responsive: false,\n        maintainAspectRatio: false,\n        options: {\n          plugins: {\n            legend: {\n              display: true,\n              labels: {\n                usePointStyle: true,\n                pointStyle: 'circle',\n                color: '#a8a8a890'\n              }\n            },\n            tooltip: {\n              callbacks: {\n                label: function(context) {\n                  let label = context.dataset.label || '';\n\n                  if (label) {\n                    label += ': ';\n                  }\n                  if (context.parsed.y !== null) {\n                    label += currency(me.value, context.parsed.y)\n                  }\n                  return label;\n                }\n              }\n            }\n          },\n          scales: {\n            y: {\n              max: maxLabelY + stepSize,\n              ticks: {\n                stepSize: stepSize,\n                beginAtZero: true,\n                color: '#a8a8a890',\n                callback: (value) => {\n                  return currency(me.value, value)\n                },\n                autoSkip: true,\n                font: {\n                  size: 12\n                }\n              }\n            },\n            x: {\n              ticks: {\n                callback: function(value) {\n                  if (window.innerWidth <= 1028) {\n                    return this.getLabelForValue(value).slice(0, 3)\n                  }\n                  return this.getLabelForValue(value)\n                },\n                color: '#a8a8a890',\n                autoSkip: false,\n                maxRotation: 0,\n                minRotation: 0,\n                font: {\n                  size: 12\n                }\n              }\n            }\n          }\n        },\n        data: {\n          labels: labels,\n          datasets: [\n            {\n              label: \"Paid\",\n              data: data,\n              fill: false,\n              backgroundColor: \"#424242\",\n              borderColor: \"#424242\",\n              tension: 0.4,\n              smooth: true,\n              borderWidth: 1.5,\n              pointRadius: 0,\n              pointHoverRadius: 5,\n              pointHitRadius: 20\n            },\n            {\n              label: \"Leads\",\n              data: dataLeads,\n              fill: false,\n              backgroundColor: \"#1672ec\",\n              borderColor: \"#1672ec\",\n              tension: 0.4,\n              smooth: true,\n              borderWidth: 1.5,\n              pointRadius: 0,\n              pointHoverRadius: 5,\n              pointHitRadius: 20\n            },\n          ],\n        },\n      }));\n    };\n\n    const destroy = () => {\n      if (chartState.chart) {\n        chartState.chart.destroy();\n        chartState.chart = null;\n      }\n    };\n\n    watch(() => ({\n      data: props.data,\n      dataLeads: props.dataLeads,\n    }),\n      () => {\n        destroy();\n        render(props.labels, props.data, props.dataLeads);\n      },\n      {\n        deep: true,\n      }\n    );\n\n    onMounted(() => render(props.labels, props.data, props.dataLeads));\n\n    // const resetZoom = () => chartState.chart.resetZoom()\n\n    return {\n      chartRef,\n      togglePoints\n      // resetZoom\n    };\n  },\n};\n</script>","<template>\n  <Card class=\"shadow-lg h-full\">\n    <!--    <template #header>-->\n    <!--      <p class=\"font-semibold\">Monthly Buyback</p>-->\n    <!--    </template>-->\n    <div class=\"sm:flex\">\n      <div class=\"w-1/2 space-y-3\">\n        <p class=\"text-teal-02\">\n          Total Buybacks:\n          <span class=\"text-teal-04 font-bold\">{{ state.total_count }}</span>\n        </p>\n        <p class=\"text-teal-02\">\n          Total Payouts:\n          <span class=\"text-teal-04 font-bold\">\n            <Currency :value=\"state.total\" />\n          </span>\n        </p>\n        <p class=\"text-teal-02\">\n          Total Item Quantity:\n          <span class=\"text-teal-04 font-bold\">{{\n            state.total_device_quantity\n          }}</span>\n        </p>\n      </div>\n      <div class=\"w-1/2 flex\">\n        <GroupContainer class=\"filter-container\">\n          <Select\n            placeholder=\"Status\"\n            class=\"w-full\"\n            :items=\"localBuyback\"\n            by=\"id\"\n            name=\"name\"\n            v-model=\"data.local\"\n          />\n          <Select\n            placeholder=\"Month\"\n            class=\"w-full\"\n            :items=\"months\"\n            by=\"id\"\n            name=\"name\"\n            v-model=\"data.month\"\n          />\n          <Select class=\"w-full\" :items=\"years\" v-model=\"data.year\" />\n        </GroupContainer>\n      </div>\n    </div>\n    <ChartDashboard\n      :labels=\"state.labels\"\n      :data=\"state.data\"\n      :data-leads=\"state.data_leads\"\n    />\n  </Card>\n</template>\n\n<script>\nimport { defineComponent, watch } from 'vue'\nimport { useChart } from 'composable/dashboard'\nimport Card from 'bbUi/components/card/card.vue'\nimport CardHeader from 'components/dashboard/CardHeader.vue'\nimport ChartDashboard from 'components/ChartDashboard.vue'\nimport Select from 'bbUi/components/select/select.vue'\nimport Currency from 'components/Currency.vue'\nimport GroupContainer from 'bbUi/components/group-container/group-container.vue'\n\nexport default defineComponent({\n  components: {\n    Card,\n    CardHeader,\n    ChartDashboard,\n    Select,\n    Currency,\n    GroupContainer\n  },\n  async setup() {\n    const { data, state, chart } = useChart()\n\n    const generateArrayOfYears = () => {\n      var max = new Date().getFullYear()\n      var min = max - 9\n      var years = []\n\n      for (var i = max; i >= min; i--) {\n        years.push(i)\n      }\n      return years\n    }\n\n    const months = [\n      {\n        id: 'all',\n        name: 'All'\n      },\n      {\n        id: 1,\n        name: 'January'\n      },\n      {\n        id: 2,\n        name: 'February'\n      },\n      {\n        id: 3,\n        name: 'March'\n      },\n      {\n        id: 4,\n        name: 'April'\n      },\n      {\n        id: 5,\n        name: 'May'\n      },\n      {\n        id: 6,\n        name: 'June'\n      },\n      {\n        id: 7,\n        name: 'July'\n      },\n      {\n        id: 8,\n        name: 'August'\n      },\n      {\n        id: 9,\n        name: 'September'\n      },\n      {\n        id: 10,\n        name: 'October'\n      },\n      {\n        id: 11,\n        name: 'November'\n      },\n      {\n        id: 12,\n        name: 'December'\n      }\n    ]\n\n    const years = generateArrayOfYears()\n\n    const localBuyback = [\n      {\n        id: '',\n        name: 'All'\n      },\n      {\n        id: 'leads',\n        name: 'Leads'\n      },\n      {\n        id: 'paid',\n        name: 'Paid'\n      }\n    ]\n\n    await chart()\n\n    watch(\n      () => data,\n      async () => {\n        await chart()\n      },\n      {\n        deep: true\n      }\n    )\n\n    return {\n      data,\n      state,\n      months,\n      years,\n      localBuyback\n    }\n  }\n})\n</script>\n\n<style lang=\"scss\" scoped>\n.filter-container{\n  @apply justify-end #{!important}\n}\n</style>"],"names":["ref","height","_sfc_main","defineComponent","components","Card","CardHeader","ChartDashboard","Button","props","labels","Array","data","dataLeads","type","default","String","[object Object]","chartRef","me","useUser","showPoints","chartState","chart","__spreadValues","maxLabelY","value","digits","Math","pow","floor","log10","ceil","roundUpToNiceNumber","max","maxTick","_a","filter","i","length","_c","_b","stepSize","legendSpacing","id","fitValue","legend","fit","bind","this","render","update","gradient","document","getElementById","getContext","createLinearGradient","addColorStop","Chart","register","zoomPlugin","Chart$1","defaults","font","family","responsive","maintainAspectRatio","options","plugins","display","usePointStyle","pointStyle","color","tooltip","callbacks","label","context","dataset","parsed","y","currency","scales","ticks","beginAtZero","callback","autoSkip","size","x","window","innerWidth","getLabelForValue","slice","maxRotation","minRotation","datasets","fill","backgroundColor","borderColor","tension","smooth","borderWidth","pointRadius","pointHoverRadius","pointHitRadius","watch","destroy","deep","onMounted","togglePoints","forEach","_cache","$props","$setup","$data","$options","_openBlock","_createElementBlock","Select","Currency","GroupContainer","state","useChart","years","Date","getFullYear","min","years2","push","generateArrayOfYears","async","months","name","localBuyback","_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_createBlock","_component_Card","_withCtx","_createElementVNode","_createTextVNode","_component_Currency","_hoisted_9","_createVNode","_component_Select","placeholder","items","_ctx","by","modelValue","local","month","year","_component_ChartDashboard"],"mappings":"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"}