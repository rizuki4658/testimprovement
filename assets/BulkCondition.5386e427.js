var e=Object.defineProperty,o=Object.defineProperties,t=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,l=(o,t,n)=>t in o?e(o,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):o[t]=n;import{F as s,i as d}from"./buyback.2c2958be.js";import{f as r,b as u,d as c,j as m,u as p,T as v,_ as w}from"./index.9c4dcead.js";import{S as _,u as f}from"./Form.f67eac20.js";import{u as y}from"./index.f40e4a9e.js";import{c as h,d as b}from"./index.6b6f6369.js";import{S as g}from"./select.399034f1.js";import{B as C}from"./BBTable.ce01765d.js";import{I as q,C as S,B as k}from"./ChooseCondition.20859cf2.js";import{k as x,f as j,g as V,y as B,m as $,o as A,t as P,D as F,w as I,B as M,I as O,a1 as Q,a2 as U,K as N,U as D,n as T}from"./vendor.9695fe57.js";const E=x({components:{Input:r,Select:g,SelectCheckbox:_,Button:u,Modal:c,Alert:m,ItemList:q,ChooseCondition:S,BBTable:C,BBTColumn:k},props:{items:{type:Array,default:()=>[]},conditions:{type:Array,default:()=>[]},loadingCondition:{type:Boolean,default:()=>!1},show:{type:Boolean,default:()=>!1},loading:{type:Boolean,default:()=>!1},me:{type:Object,default:()=>[]}},emits:["close","submit"],setup(e,{emit:r}){const{state:u,action:c}=s(),{me:m}=p(),w=f(),_=j(null),g=j(e.show),C=j(1),q=j([]),S=j("leave it as is"),k=j(null);j(null);const x=j({questions:[]}),$={questions:{$each:h.forEach({answer_id:{required:b(((e,o)=>o.is_required))}})}},A=y($,x,{$lazy:!0}),P=V((()=>!q.value.length||2===C.value&&!S.value)),F=V((()=>1===C.value?{items:e.items||[],onSelectionChange:e=>{q.value=e.map((e=>e.id||null)).filter((e=>!!e))}}:2===C.value?{conditions:e.conditions||[],onSelectionChange:e=>S.value=e.condition_name||""}:void 0)),I=V((()=>1===C.value?"ItemList":2===C.value?"ChooseCondition":void 0));B((()=>e.show),(e=>{g.value=e}));const M=()=>{for(let o=0;o<e.items.length;o++)w.$state.getQuestions.result.forEach(((t,n)=>D(t,n,e.items[o],o)))},O=()=>{for(let o=0;o<e.items.length;o++)e.items[o].new_price=null},Q=()=>{for(let o=0;o<e.items.length;o++)e.items[o].new_condition=null},U=(e,o)=>{let t=parseFloat(e.amount_price);return"Percentage"===e.amount_type&&(t=parseFloat(o.price)*(t/100)),"Mark Down"===e.type?-1*t:t},N=e=>x.value.questions.reduce(((o,t)=>"object"==typeof t.answer_id?o+t.answer.reduce(((o,t)=>o+U(t,e)),0):t.answer_id?o+U(t.answer,e):o),0),D=(o,t,n,a)=>{console.log(o),x.value.questions[t].answer?"Single"===o.answer_type?x.value.questions[t].answer_id=x.value.questions[t].answer.id:x.value.questions[t].answer_id=x.value.questions[t].answer.map((e=>e.id)):x.value.questions[t].answer_id=void 0,k.value?e.items[a].new_price=parseFloat(k.value)+N(n):e.items[a].new_price=parseFloat(n.price)+N(n)};return B((()=>u),(()=>{(()=>{var o;for(let t=0;t<e.items.length;t++)e.items[t].new_price=null==(o=u.value.find((o=>o.product_id==e.items[t].product_id)))?void 0:o.price})()}),{deep:!0}),{props:e,refComponent:_,currentStep:C,isShowModal:g,isDisabledPrice:d,componentName:I,componentBind:F,selectedIds:q,selectedCondition:S,disableNext:P,handleCloseModal:()=>{C.value=1,q.value=[],k.value=null,w.$state.getQuestions.result=[],x.value.questions=[],S.value="leave it as is",g.value=!1,O(),Q(),r("close",!0)},handleNextStep:()=>{2===C.value&&r("submit",{ids:JSON.stringify(q.value),condition:S.value}),C.value<2&&++C.value},handlePreviousStep:()=>C.value>1&&--C.value,save:()=>{if(A.value.$validate(),!A.value.$invalid){const o={data:e.items.map((e=>({id:e.id,condition:(null==e?void 0:e.new_condition)?null==e?void 0:e.new_condition:null==e?void 0:e.condition,price:(null==e?void 0:e.new_price)?null==e?void 0:e.new_price:"",condition_id:null==e?void 0:e.new_condition_id}))),questions:x.value.questions.reduce(((e,o)=>("object"==typeof o.answer_id?o.answer.forEach((t=>e.push({question_id:o.question_id,answer_id:t.id}))):o.answer_id&&e.push({question_id:o.question_id,answer_id:o.answer.id}),e)),[])};r("submit",o),k.value=null,S.value="leave it as is"}},money:v,filterNumber:e=>{const o=[...e.target.value],t=e.keyCode?e.keyCode:e.which;(t<48||t>57)&&(46!=t&&e.preventDefault(),46==t&&o.map((o=>{"."===o&&e.preventDefault()})))},priceAll:k,setPriceAll:()=>{""!=k.value?M():O()},selectCondition:async()=>{const o=e.conditions.find((e=>e.name==S.value));k.value=null;const t=e.items.map((e=>e.product_id)).filter((e=>-1!=e)).join(",");for(let n=0;n<e.items.length;n++)e.items[n].new_condition=S.value,e.items[n].new_condition_id=o.id;t&&(await w.$getQuestions({id:o.id}),x.value.questions=[],w.$state.getQuestions.result.forEach((e=>{x.value.questions.push({question_id:e.id,answer_id:void 0,is_required:e.is_required,question:e,answer:void 0})})),await c({ids:t,is_mac:e.items[0].is_mac,condition_id:o.id,category_id:e.items[0].category_id}))},conditionStore:w,dataForm:x,validation:A,conditionalQuestionShown:e=>{return w.getConditionalFormat((s=((e,o)=>{for(var t in o||(o={}))a.call(o,t)&&l(e,t,o[t]);if(n)for(var t of n(o))i.call(o,t)&&l(e,t,o[t]);return e})({},e),d={symbol:m.value.currency_symbol},o(s,t(d))));var s,d},onChangeAnswer:(e,o)=>{u.value.forEach(((t,n)=>{D(e,o,t,n)}))}}}}),K={class:"grid grid-cols-5 gap-6 mb-6"},L={key:0,class:"font-normal text-grey-02"},z=["innerHTML","value"],H={class:"max-h-96 overflow-y-auto"},J={class:"font-semibold text-grey-04"},G={class:"text-grey-04"},R={class:"text-grey-04"},W={class:"text-grey-04 text-right"},X={class:"text-grey-04"},Y={class:"flex justify-between"};var Z=w(E,[["render",function(e,o,t,n,a,i){const l=$("Select"),s=$("SelectCheckbox"),d=$("Input"),r=$("BBTColumn"),u=$("BBTable"),c=$("Button"),m=$("Modal");return A(),P("div",null,[F(m,{modelValue:e.isShowModal,"onUpdate:modelValue":o[2]||(o[2]=o=>e.isShowModal=o),title:"Change Conditions",onClose:e.handleCloseModal,size:"xl"},{footer:I((()=>[M("div",Y,[o[6]||(o[6]=M("div",null," Â  ",-1)),M("div",null,[F(c,{class:"mr-2",color:"white",onClick:e.handleCloseModal},{default:I((()=>o[4]||(o[4]=[O("Cancel")]))),_:1},8,["onClick"]),F(c,{color:"teal",onClick:e.save},{default:I((()=>o[5]||(o[5]=[O("Apply Changes")]))),_:1},8,["onClick"])])])])),default:I((()=>[M("div",K,[F(l,{modelValue:e.selectedCondition,"onUpdate:modelValue":o[0]||(o[0]=o=>e.selectedCondition=o),items:e.props.conditions,onChange:e.selectCondition,loading:e.props.loadingCondition,name:"name",by:"name",label:"Set All New Condition to",placeholder:"leave it as is"},null,8,["modelValue","items","onChange","loading"]),e.conditionStore.$state.getQuestions.result&&e.conditionStore.$state.getQuestions.result.length?(A(!0),P(Q,{key:0},U(e.conditionStore.$state.getQuestions.result,((t,n)=>(A(),P("div",{key:t.id},[M("label",null,[O(N(t.question)+" ",1),t.is_required?D("",!0):(A(),P("span",L,"(Optional)"))]),e.dataForm.questions[n]?(A(),P(Q,{key:0},["Single"===t.answer_type?(A(),T(l,{key:0,modelValue:e.dataForm.questions[n].answer,"onUpdate:modelValue":[o=>e.dataForm.questions[n].answer=o,o=>e.onChangeAnswer(t,n)],items:t.answers,name:"answer",placeholder:"Select Answer","max-height":"300px",style:{display:"block"},"disabled-default-option":"",block:""},{"default-option":I((()=>o[3]||(o[3]=[M("option",{class:"select__option",value:"",selected:""},"Choose the answer",-1)]))),option:I((({item:o})=>[(A(),P("option",{class:"select__option",innerHTML:`${o.answer} (${e.conditionalQuestionShown(o)})`,value:o,key:o.id},null,8,z))])),_:2},1032,["modelValue","onUpdate:modelValue","items"])):(A(),T(s,{key:1,modelValue:e.dataForm.questions[n].answer,"onUpdate:modelValue":[o=>e.dataForm.questions[n].answer=o,o=>e.onChangeAnswer(t,n)],items:t.answers,placeholder:"Choose the answer",name:"answer"},{head:I((({item:o})=>[O(N(o.answer)+" ("+N(e.conditionalQuestionShown(o))+") ",1)])),option:I((({item:o})=>[O(N(o.answer)+" ("+N(e.conditionalQuestionShown(o))+") ",1)])),_:2},1032,["modelValue","onUpdate:modelValue","items"])),e.validation.questions.$error?(A(!0),P(Q,{key:2},U(e.validation.questions.$each.$response.$errors[n].answer_id,((e,o)=>(A(),P("small",{class:"text-red-base block my-2",key:o},N(e.$message)+". ",1)))),128)):D("",!0)],64)):D("",!0)])))),128)):D("",!0),F(d,{modelValue:e.priceAll,"onUpdate:modelValue":o[1]||(o[1]=o=>e.priceAll=o),type:"number",onKeyup:e.setPriceAll,label:"Set All Payout to",disabled:e.isDisabledPrice,icon:""},{icon:I((()=>[O(N(e.me.currency_symbol),1)])),_:1},8,["modelValue","onKeyup","disabled"])]),M("div",H,[F(u,{items:e.items,selectable:!1,"check-all":!1,header:["Item","IMEI","Condition","Payout","New Condition","New Payout"],"collapse-all":""},{item:I((({item:o})=>[F(r,null,{default:I((()=>[M("p",J,N(o.product_name),1)])),_:2},1024),F(r,null,{default:I((()=>[M("p",G,N(o.imei_sn),1)])),_:2},1024),F(r,null,{default:I((()=>[M("p",R,N(o.condition),1)])),_:2},1024),F(r,null,{default:I((()=>[M("p",W,"$"+N(e.money(o.price)),1)])),_:2},1024),F(r,{class:"border-separator"},{default:I((()=>[M("p",X,N(null==o?void 0:o.new_condition),1)])),_:2},1024),F(r,null,{default:I((()=>[F(d,{modelValue:o.new_price,"onUpdate:modelValue":e=>o.new_price=e,disabled:e.isDisabledPrice,type:"text",onKeypress:e.filterNumber,icon:""},{icon:I((()=>[O(N(e.me.currency_symbol),1)])),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onKeypress"])])),_:2},1024)])),_:1},8,["items"])])])),_:1},8,["modelValue","onClose"])])}],["__scopeId","data-v-45f4e040"]]);export{Z as B};
