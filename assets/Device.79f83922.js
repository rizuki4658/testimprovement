var e=Object.defineProperty,l=Object.defineProperties,a=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,i=(l,a,o)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[a]=o,c=(e,l)=>{for(var a in l||(l={}))t.call(l,a)&&i(e,a,l[a]);if(o)for(var a of o(l))s.call(l,a)&&i(e,a,l[a]);return e},n=(e,o)=>l(e,a(o));import{k as d,N as u,f as r,g as m,y as v,m as p,o as _,t as f,B as b,D as y,w as g,I as h,K as C,n as w,U as S,a1 as D,S as k,a2 as q,a3 as j,a4 as B,a6 as P,s as U}from"./vendor.f1efedad.js";import{i as x,r as I,a as V}from"./buyback.8c173696.js";import{D as O,u as F}from"./Form.52df5181.js";import{_ as N,b as T,f as A,d as E,u as G}from"./index.9aa6481b.js";import{_ as $}from"./badge.b59865a3.js";import{_ as Q}from"./tab.065d46d3.js";import{C as K}from"./Currency.ae08941b.js";import{D as M,B as J,C as W}from"./CancelAdd.248a9d3d.js";import{G as z}from"./DeviceGolfSpecBadge.c26d56c0.js";const H=d({components:{Button:T,Input:A,Modal:E,SearchDeviceForm:O,DeviceScan:M,BBBScan:J,CancelAdd:W,Currency:K,Badge:$,Tab:Q,GolfSpecBadge:z},props:{data:{type:Array,default:()=>[]},buybackType:{type:String,default:"instore"}},emits:["update:data"],async setup(e,{emit:l}){const a=u(),o=r(null),t=r(null),s=r(null),i=r(null),d=r(null),p=r(e.data||[]),_=r(!1),f=r(null),b=r(null),y=r(!1),g=r(!1),h=r(null),{me:C,isDisableCustomProduct:w}=G(),S=F(),D=m((()=>({data:o.value,"onUpdate:data":e=>o.value=e,dataComputer:t.value,"onUpdate:dataComputer":e=>t.value=e,dataGolf:s.value,"onUpdate:dataGolf":e=>s.value=e,device:i.value,"onUpdate:device":e=>{(null==e?void 0:e.is_custom)&&(y.value=!0),i.value=e},condition:d.value,"onUpdate:condition":e=>d.value=e,colors:b.value,"onUpdate:colors":e=>b.value=e,hide:{imei_sn:!1},buybackType:e.buybackType,multiImei:!0,"onUpdate:isCustomProduct":e=>y.value=1==e,isCustomColor:g.value,"onUpdate:isCustomColor":e=>g.value=e,customColor:h.value,"onUpdate:customColor":e=>h.value=e}))),k=m((()=>a.state&&a.state.user&&a.state.user.bbbScan&&a.state.user.bbbScan.device));0===p.value.length&&(_.value=!0);const q=()=>new Promise((e=>U((()=>{var l,a;return e(null==(a=null==(l=f.value)?void 0:l.validate)?void 0:a.call(l))})))),j=(e=!1)=>{var l,a,c,n,u;const r={product:{id:null,name:null},device:{condition:{id:null,name:null},price:null,qty:null,is_mac:null,imei_sn:null,color:{id:null,name:null},golf_specs:{length:null,loft:null,gender:null,shaft_model:null,shaft_material:null,custom_length:null,custom_loft:null,custom_gender:null,custom_shaft_model:null,custom_shaft_material:null},is_custom:0,details:null,category_id:null,category_name:null,custom_color:null,questions:[]}};return e?(r.product.id=null,r.device.category_id=o.value.category_id,r.device.category_name=o.value.category_name,r.product.name=o.value.product_name,r.device.is_custom=1):(r.product.id=i.value.product_id+(t.value.processor?`-${t.value.processor.id}-${t.value.memory.id}-${t.value.hardDrive.id}-${t.value.graphicsCard.id}`:""),r.product.name=i.value.product_name),s.value&&(r.device.golf_specs={length:null,loft:null,gender:null,shaft_model:null,shaft_material:null,custom_length:null,custom_loft:null,custom_gender:null,custom_shaft_model:null,custom_shaft_material:null},Object.entries(s.value).forEach((([e,l])=>{r.device.golf_specs.hasOwnProperty(e)&&(l.is_custom?r.device.golf_specs[`custom_${e}`]=l.selected:r.device.golf_specs[e]=l.selected)}))),e&&!o.value.category_id?(r.device.condition.id=-1,r.device.condition.name=o.value.condition,r.device.is_mac=0):(r.device.condition.id=d.value.id,r.device.condition.name=d.value.name,r.device.is_mac=i.value.is_mac,r.device.questions=o.value.questions.filter((e=>e.answer))),r.device.price=o.value.price,r.device.qty=o.value.qty,r.device.imei_sn=o.value.imei_sn,g.value||e&&!o.value.category_id?r.device.custom_color=h.value:(r.device.color.id=null==(a=null==(l=o.value)?void 0:l.color)?void 0:a.id,r.device.color.name=null==(n=null==(c=o.value)?void 0:c.color)?void 0:n.name),r.device.details=1==(null==(u=null==i?void 0:i.value)?void 0:u.is_mac)?Object.entries(t.value).map((([e,l])=>(null==l?void 0:l.name)||"")).join(", "):"",r.device.notes=o.value.notes,r},B=e=>{if(e){const l=JSON.parse(e.device.imei_sn),o=JSON.parse(e.device.notes);for(let t=0;t<Number(e.device.qty);t++)p.value.push(n(c({},e),{device:c(n(c(c(c({},e.device),l&&l.length&&{imei_sn:l[t],notes:o[t]}),{bbb_diagnostic_result:a.state.user.bbbScan&&a.state.user.bbbScan.device}),{qty:1}),f.value.dataForm&&f.value.dataForm.imei_required&&{imei_required:f.value.dataForm.imei_required})}))}l("update:data",p.value),V(),P(),O(),_.value=!1},P=()=>{y.value=!1,o.value=null,t.value=null,i.value=null,d.value=null,I()},O=()=>{g.value=!1,h.value=null};return v(p,(()=>{l("update:data",p.value)}),{deep:!0}),{data:o,dataComputer:t,condition:d,device:i,devices:p,deviceScan:k,modal:_,isDisabledPrice:x,refDeviceForm:f,componentBind:D,isCustomProduct:y,addDevice:async()=>{if(await q()){const e=j();B(e)}},addCustomDevice:async()=>{try{if(await q()){const e=j(!0);B(e)}}catch(e){console.error("Error adding custom device:",e)}},removeDevice:e=>{p.value.splice(e,1),l("update:data",p.value)},unsetData:P,onlyNumber:e=>{let l=e.keyCode?e.keyCode:e.which;(l<48||l>57)&&46!==l&&e.preventDefault()},handleScan:e=>{f.value.stateSearch.query=e?e.Name:null,f.value.stateSearch.product.query=e?e.Name:null,e&&(f.value.imeiSnNotes[0]={imei_sn:e.UID,imei_notes:""},f.value.refDeviceSearch&&(f.value.refDeviceSearch.isCollapse=!0)),f.value.handleSearchProduct()},colors:b,isDisableCustomProduct:w,conditionalQuestionShown:e=>S.getConditionalFormat(n(c({},e),{symbol:C.value.currency_symbol}))}}}),L={class:"text-right mb-4"},R={class:"space-x-2 mb-0"},X={class:"font-bold"},Y={class:"whitespace-nowrap"},Z={key:0},ee={class:"flex gap-2"},le={key:1},ae={class:"flex items-center gap-x-2"},oe={style:{maxWidth:"300px"}},te={class:"list-decimal pl-4"},se={class:"mb-1"},ie={class:"list"},ce={key:1,class:"text-white"},ne={class:"flex justify-between gap-x-4"};var de=N(H,[["render",function(e,l,a,o,t,s){const i=p("Button"),c=p("GolfSpecBadge"),n=p("Badge"),d=p("TableColumn"),u=p("Input"),r=p("BBBScan"),m=p("Tooltip"),v=p("Currency"),U=p("Table"),x=p("DeviceScan"),I=p("CancelAdd"),V=p("Modal");return _(),f(q,null,[b("div",L,[y(i,{color:"teal",onClick:l[0]||(l[0]=l=>e.modal=!0)},{default:g((()=>l[4]||(l[4]=[b("i",{class:"material-icons"},"add",-1),h("Add Item")]))),_:1})]),y(U,{class:"mb-6",data:e.devices,"max-height":"300"},{default:g((()=>[y(d,{prop:"device",label:"Item"},{default:g((({row:e})=>[b("div",R,[b("span",X,C(e.product.name),1),y(c,{length:e.device.golf_specs.length||e.device.golf_specs.custom_length,loft:e.device.golf_specs.loft||e.device.golf_specs.custom_loft,gender:e.device.golf_specs.gender||e.device.golf_specs.custom_gender,shaft_model:e.device.golf_specs.shaft_model||e.device.golf_specs.custom_shaft_model,shaft_material:e.device.golf_specs.shaft_material||e.device.golf_specs.custom_shaft_material},null,8,["length","loft","gender","shaft_model","shaft_material"]),e.device.custom_color||e.device.color.name?(_(),w(n,{key:0,color:"grey"},{default:g((()=>[b("span",Y,C(e.device.custom_color||e.device.color.name),1)])),_:2},1024)):S("",!0)]),1==e.device.is_mac&&0==e.device.is_custom?(_(),f("small",Z,C(e.device.details),1)):S("",!0)])),_:1}),y(d,{label:"IMEI/SN",width:"350"},{default:g((({row:e})=>[b("div",ee,[e.device.imei_required||e.device.is_custom&&!e.device.category_id?(_(),w(u,{key:0,modelValue:e.device.imei_sn,"onUpdate:modelValue":l=>e.device.imei_sn=l,block:"",placeholder:"IMEI/SN",onKeypress:l[1]||(l[1]=D(k((()=>{}),["prevent"]),["space"]))},null,8,["modelValue","onUpdate:modelValue"])):(_(),f("span",le,"-")),e.device.bbb_diagnostic_result?(_(),w(r,{key:2,modelValue:e.device.bbb_diagnostic_result,"onUpdate:modelValue":l=>e.device.bbb_diagnostic_result=l,static:""},null,8,["modelValue","onUpdate:modelValue"])):S("",!0)])])),_:1}),y(d,{prop:"device.condition.name",label:"Condition"},{default:g((({row:a})=>[b("div",ae,[b("span",null,C(a.device.condition.name),1),a.device.questions.length>0?(_(),w(m,{key:0,placement:"top"},{content:g((()=>[b("div",oe,[l[5]||(l[5]=b("p",{class:"font-semibold mb-2"},"Q&A",-1)),b("ol",te,[(_(!0),f(q,null,j(a.device.questions,((l,a)=>(_(),f(q,null,[l.question&&l.answer?(_(),f("li",{class:"mb-1",key:a},[b("p",se,C(l.question.question),1),b("ul",ie,[l.answer?(_(),f(q,{key:0},[l.answer.length?(_(!0),f(q,{key:0},j(l.answer,(l=>(_(),f("li",{key:l.id,class:"text-white"},[b("p",null,[h(C(l.answer)+" ",1),b("span",null,"("+C(e.conditionalQuestionShown(l))+")",1)])])))),128)):(_(),f("li",ce,[b("p",null,[h(C(l.answer.answer)+" ",1),b("span",null,"("+C(e.conditionalQuestionShown(l.answer))+")",1)])]))],64)):S("",!0)])])):S("",!0)],64)))),256))])])])),default:g((()=>[l[6]||(l[6]=b("span",{class:"material-icons"},"info",-1))])),_:2},1024)):S("",!0)])])),_:1}),y(d,{prop:"device.qty",label:"Quantity"}),y(d,{prop:"device.price",label:"Payout"},{default:g((({row:l})=>[y(u,{modelValue:l.device.price,"onUpdate:modelValue":e=>l.device.price=e,placeholder:"Price",type:"number",min:"0",disabled:e.isDisabledPrice,onKeypress:e.onlyNumber,class:"w-full",icon:"","icon-block":""},{icon:g((()=>[y(v,{"only-symbol":"",class:"text-xl"})])),_:2},1032,["modelValue","onUpdate:modelValue","disabled","onKeypress"])])),_:1}),y(d,{label:"Total"},{default:g((({row:e})=>[y(v,{value:parseFloat(e.device.qty)*parseFloat(e.device.price)||0},null,8,["value"])])),_:1}),y(d,null,{default:g((a=>[y(i,{color:"red",onClick:l=>e.removeDevice(a.$index),dense:""},{default:g((()=>l[7]||(l[7]=[h("Delete")]))),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data"]),y(V,{modelValue:e.modal,"onUpdate:modelValue":l[3]||(l[3]=l=>e.modal=l),title:"Add Item",onClose:e.unsetData},{default:g((()=>[b("div",null,[y(x,{show:"instore"===e.buybackType&&e.modal,selected:e.componentBind.data,onScanned:e.handleScan},null,8,["show","selected","onScanned"]),(_(),w(P("SearchDeviceForm"),B({ref:"refDeviceForm"},e.componentBind,{"device-scan":e.deviceScan,"is-disabled-custom-product":e.isDisableCustomProduct,"with-scan":""}),null,16,["device-scan","is-disabled-custom-product"]))])])),footer:g((()=>{var a;return[b("div",ne,["instore"===e.buybackType?(_(),w(I,{key:0,onCancel:l[2]||(l[2]=()=>{e.modal=!1,e.unsetData()})})):S("",!0),e.isCustomProduct?(_(),w(i,{key:1,color:"teal",class:"ml-auto",onClick:e.addCustomDevice},{default:g((()=>l[8]||(l[8]=[h("Add Item")]))),_:1},8,["onClick"])):(_(),w(i,{key:2,color:"teal",class:"ml-auto",onClick:e.addDevice,disabled:null==(a=e.refDeviceForm)?void 0:a.isEmptyCondition},{default:g((()=>l[9]||(l[9]=[h("Add Item")]))),_:1},8,["onClick","disabled"]))])]})),_:1},8,["modelValue","onClose"])],64)}]]);export{de as D};
