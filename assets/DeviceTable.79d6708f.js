var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,s=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,r=(e,a)=>{for(var l in a||(a={}))i.call(a,l)&&s(e,l,a[l]);if(t)for(var l of t(a))n.call(a,l)&&s(e,l,a[l]);return e},o=(e,t)=>a(e,l(t));import{k as d,f as c,a5 as u,O as p,r as m,g as b,y as f,m as h,o as y,t as g,n as _,w as v,D as w,U as k,B as x,K as C,I as A,T,A as j,L as S,S as B,a2 as I,aY as P}from"./vendor.f1efedad.js";import{e as V,i as O,d as $,b as D,u as E,_ as U,ad as M}from"./index.9aa6481b.js";import{p as R}from"./setting.2daa7691.js";import{_ as z}from"./catalog-not-found.379a4c88.js";const N=d({name:"DeviceTable",components:{Checkbox:V,Loading:O,Modal:$,Button:D},props:{data:Array,category:{type:Object,default:{name:null,is_enable:0,is_mac:0}},disabled:{type:Boolean,default:!1}},emits:["update-buyback","update-all","update-buyback-category"],setup(e,{emit:a}){const l=c(!0),t=u(),i=p(),{me:n}=E(),{actionUpdateBuybackType:s,actionGetChildren:d}=R(),h=c(0),y=m({buybackType:{update:new Map}}),g=m({name:e.category.name,is_enable:e.category.is_enable,is_mac:e.category.is_mac}),_=c(e.data.map((e=>o(r({},e),{child:e.child.map((a=>o(r({},a),{is_child:!0,manufacturer:e.manufacturer})))})))||[]),v=c(!1),w=c(null),k="buyback-setup-warning",x=b((()=>I(_.value))),C=b((()=>{const e=t.params.brand.split("");return e[0]=e[0].toUpperCase(),e.join("")})),A=()=>"1"!==sessionStorage.getItem(k),T=e=>{var l,t;e.is_loading=!0,e.instore=e.is_enable,e.mailin=e.is_enable;const i=null!=(t=null==(l=e.parent)?void 0:l.total_active)?t:e.total_active;a("update-buyback",o(r(r({},e),!g.is_mac&&{total_active:i.total_active}),{is_mac:g.is_mac}),(a=>{if(200!=a.status_code)return e.is_enable=1==e.is_enable?0:1,e.instore=e.is_enable,e.mailin=e.is_enable,void(e.is_loading=!1);e.child.length>0&&j(e.child,"all",e.is_enable);const l=x.value.get(e.id);l&&l.parents&&B(l.parents),e.total_active&&(e.total_active=a.data.total_active_category),e.is_loading=!1}))},j=(e,a="all",l)=>{if(e)for(let t of e){"all"===a?(t.is_enable=l,t.instore=l,t.mailin=l):t[a]=l;const e=0===t.instore&&0===t.mailin;t.is_enable=e?0:1;t.child.length>0&&j(t.child,a,l)}},S=(e,a)=>{for(let l of e){if(l.child.length>0){const{buybackType:e,enableStatus:t}=l.child.reduce(((e,l)=>(0===l[a]&&(e.buybackType.isCheckAll=!1),1===l[a]&&(e.buybackType.isUncheckAll=!1),(e.buybackType.isCheckAll||e.buybackType.isUncheckAll)&&2!==l[a]||(e.buybackType.isIndeterminate=!0),0===l.is_enable&&(e.enableStatus.isEnableAll=!1),1===l.is_enable&&(e.enableStatus.isDisableAll=!1),e)),{buybackType:{isCheckAll:!0,isUncheckAll:!0,isIndeterminate:!1},enableStatus:{isEnableAll:!0,isDisableAll:!0}});e.isCheckAll&&(l[a]=1),e.isUncheckAll&&(l[a]=0),e.isIndeterminate&&(l[a]=2),t.isEnableAll&&(l.is_enable=1),t.isDisableAll&&(l.is_enable=0)}}},B=e=>{for(let a of e){if(a.child.length>0){const{status:e}=a.child.reduce(((e,a)=>(0===a.is_enable&&(e.status.enableAll=!1),1===a.is_enable&&(e.status.disableAll=!1),e)),{status:{enableAll:!0,disableAll:!0}});!e.enableAll&&e.disableAll||(a.is_enable=1,a.instore=1,a.mailin=1),e.disableAll&&(a.is_enable=0,a.instore=0,a.mailin=0)}}},I=(e=[],a=new Map,l=[])=>{var t;if((null==e?void 0:e.length)>0)for(let i of e){a.set(i.id,o(r({},i),{parents:l}));(null==(t=null==i?void 0:i.child)?void 0:t.length)>0&&I(i.child,a,[i,...l])}return a};function V(e,a,l){return e.map((e=>{var t;const i=(e=>{var a,l,t,i;return o(r({},e),{has_condition:null!=(l=null!=(a=e.has_condition)?a:e.have_condition)?l:0,has_price:null!=(i=null!=(t=e.has_price)?t:e.have_price)?i:0})})(e),n=Array.isArray(i.child)&&i.child.length>0;return o(r({},i),{has_child:n?1:0,is_child:!0,parent:a,manufacturer:null!=(t=null==e?void 0:e.manufacturer)?t:l,rawChild:n?P(e.child):[],_lazyFetched:!1,child:[]})}))}return f((()=>e.data),(()=>{_.value=e.data.map((e=>o(r({},e),{child:e.child.map((a=>o(r({},a),{is_child:!0,manufacturer:e.manufacturer})))})))}),{deep:!0}),f((()=>({category:e.category})),(e=>{Object.assign(g,e.category)})),f((()=>({name:g.name,param:C.value})),(()=>{l.value=!1,setTimeout((()=>{l.value=!0}),300)})),{category:g,data:_,flattenData:x,route:t,me:n,loading:y,updateBuybackDevice:T,updateBuybackDeviceByCategory:()=>{a("update-buyback-category",g,(e=>{e&&(g.is_enable=1==g.is_enable?0:1)}))},updateBuybackType:async(e,a,l)=>{if(!["instore","mailin"].includes(l))return;const{id:i}=e,n={type:null,category_id:null,category:M(t.params.category),value:null};"instore"===l?(n.type="instore",n.category_id=i,n.value=a):(n.type="mailin",n.category_id=i,n.value=a);const o=r({},e);e[l]=2==e[l]&&1==a?1:a;0===e.instore&&0===e.mailin&&(e.is_enable=0);e.child.length>0&&j(e.child,l,a);const d=x.value.get(i);d&&d.parents&&S(d.parents,l);try{y.buybackType.update.set(i,!0),await s(n)}catch(c){Object.assign(e,o);e.child.length>0&&j(e.child,l,1==a?0:1);const t=x.value.get(i);t&&t.parents&&S(t.parents,l)}finally{y.buybackType.update.delete(i)}},paramsBrand:C,showPricing:(e,a)=>{i.push({path:`/setting/bulk-price-editor/${t.params.category}/${"all"===t.params.brand?e.manufacturer:t.params.brand}`,query:r({ref:!0},2===a&&{model:e.name})})},modal:v,dontShow:h,selectedRow:w,closeModal:()=>{1===h.value&&sessionStorage.setItem(k,"1"),v.value=!1},shouldShowModal:A,findParentName:e=>{if(null==e?void 0:e.parent_id){const a=_.value.find((a=>a.id===(null==e?void 0:e.parent_id)));return a?null==a?void 0:a.name:null==e?void 0:e.name}return null==e?void 0:e.name},toggleEnable:e=>{1===e.is_enable?1===e.has_condition&&1===e.has_price?T(e):(T(e),w.value=e,A()&&(v.value=!0)):T(e)},onExpandChange:async(e,a,l=(e=>e))=>{var i,n;if(e.is_loading=!0,!e._lazyFetched&&(null==(i=e.rawChild)?void 0:i.length))return e.child=V(e.rawChild,e,e.manufacturer),e._lazyFetched=!0,e.is_loading=!1,void l(e.child);let s=[];await d({id:e.id,data:{categories:null==(n=t.params)?void 0:n.category}},(a=>{s=V(JSON.parse(JSON.stringify(null!=a?a:[])),e,e.manufacturer)})),l(s);const c=_.value.findIndex((a=>a.id===e.id));if(-1!==c){const e=_.value[c];_.value[c]=o(r({},e),{is_loading:!1,child:s})}},showTable:l}}}),F={class:"flex items-center gap-2"},L={class:"w-80 leading-6"},J={key:0},Y={key:1},q={class:"flex flex-wrap items-center py-2"},G={class:"flex flex-wrap items-center mr-4"},H={class:"flex flex-wrap items-center"},K={class:"relative ml-6"},Q={key:0,class:"flex flex-row items-center justify-center ml-auto md:mr-20 lg:opacity-0 group-hover:opacity-100 transition-opacity"},W=["href","disabled","onClick"],X=["href","disabled","onClick"],Z={key:1,class:"w-full bg-teal-01 bg-opacity-10",style:{height:"540px"}},ee={key:0,class:"flex flex-col items-center"},ae={class:"flex flex-col gap-6"},le={class:"flex items-center gap-4"},te={class:"text-teal-03"},ie=["href"],ne={class:"flex items-center gap-4"},se={class:"text-teal-03"},re=["href"],oe=["href"],de={class:"flex justify-between items-center"};var ce=U(N,[["render",function(e,a,l,t,i,n){const s=h("TableColumn"),r=h("Checkbox"),o=h("Tooltip"),d=h("Loading"),c=h("Table"),u=h("Button"),p=h("Modal");return y(),g(I,null,[e.showTable?(y(),_(c,{key:0,data:e.data,"row-class-name":e.disabled?"global-disabled-row-table":"",load:e.onExpandChange,"tree-props":!e.disabled&&{children:"child",hasChildren:"has_child"},"row-key":"id",lazy:""},{default:v((()=>[w(s,{width:"50"}),w(s,{width:"100",prop:"is_enable"},{header:v((()=>[e.category?(y(),_(r,{key:0,modelValue:e.category.is_enable,"onUpdate:modelValue":a[0]||(a[0]=a=>e.category.is_enable=a),type:"toggle",value:1,"value-off":0,disabled:e.disabled,onInput:a[1]||(a[1]=a=>e.updateBuybackDeviceByCategory())},null,8,["modelValue","disabled"])):k("",!0)])),default:v((a=>[w(r,{modelValue:a.row.is_enable,"onUpdate:modelValue":e=>a.row.is_enable=e,class:"py-3",type:"toggle",value:1,"value-off":0,disabled:e.disabled,loading:a.row.is_loading,onInput:l=>e.toggleEnable(a.row)},null,8,["modelValue","onUpdate:modelValue","disabled","loading","onInput"])])),_:1}),"all"===e.route.params.brand?(y(),_(s,{key:0,label:"Brand"},{default:v((e=>[x("div",F,[x("span",null,C(e.row.manufacturer),1),0===e.row.has_condition||0===e.row.has_price?(y(),_(o,{key:0,placement:"top"},{default:v((()=>a[6]||(a[6]=[x("i",{class:"material-icons text-orange-04"},"warning",-1)]))),content:v((()=>[x("div",L,[0===e.row.has_condition&&0===e.row.has_price||0===e.row.has_condition&&1===e.row.has_price?(y(),g("p",J,' To start buying this item, switch the "Activate" toggle to on, then configure its conditions and pricing. ')):(y(),g("p",Y,"To start buying this item, you must configure its pricing."))])])),_:2},1024)):k("",!0)])])),_:1})):k("",!0),w(s,{prop:"name",label:"Model"},{default:v((e=>{var a,l;return[A(C(null!=(l=null==(a=e.row)?void 0:a.name)?l:"-"),1)]})),_:1}),w(s,{label:"Purchasing Type","min-width":300},{default:v((({row:l})=>[x("div",q,[x("div",G,[w(r,{modelValue:2==l.instore?0:l.instore,indeterminate:2==l.instore,value:1,"value-off":0,disabled:!l.is_enable||e.disabled||l.is_loading,onInput:a=>e.updateBuybackType(l,a,"instore")},{default:v((()=>a[7]||(a[7]=[x("span",{class:"ml-1 font-normal"},"In-Store",-1)]))),_:2},1032,["modelValue","indeterminate","disabled","onInput"])]),x("div",H,[w(r,{modelValue:2==l.mailin?0:l.mailin,indeterminate:2==l.mailin,value:1,"value-off":0,disabled:!l.is_enable||e.disabled||l.is_loading,onInput:a=>e.updateBuybackType(l,a,"mailin")},{default:v((()=>a[8]||(a[8]=[x("span",{class:"ml-1 font-normal"},"Mail-in",-1)]))),_:2},1032,["modelValue","indeterminate","disabled","onInput"]),x("div",K,[w(T,{name:"fade"},{default:v((()=>[j(w(d,null,null,512),[[S,e.loading.buybackType.update.get(l.id)]])])),_:2},1024)])]),l.is_enable?(y(),g("div",Q,[l.has_child?(y(),g("a",{key:1,href:`/setting/bulk-price-editor/${e.route.params.category}/${"all"===e.route.params.brand?l.manufacturer:e.paramsBrand}?ref=true&model=${l.name}`,disabled:l.is_loading,class:"btn btn-teal btn-dense btn-filled",onClick:B((a=>e.showPricing(l,2)),["prevent"])},a[10]||(a[10]=[x("div",{class:"flex items-center justify-center"},[x("i",{class:"material-icons text-lg"},"attach_money"),A(" Pricing Editor ")],-1)]),8,X)):(y(),g("a",{key:0,href:`/setting/bulk-price-editor/${e.route.params.category}/${"all"===e.route.params.brand?l.manufacturer:e.paramsBrand}?ref=true`,disabled:l.is_loading,class:"btn btn-teal btn-dense btn-filled",onClick:B((a=>e.showPricing(l,1)),["prevent"])},a[9]||(a[9]=[x("div",{class:"flex items-center justify-center"},[x("i",{class:"material-icons text-lg"},"attach_money"),A(" Pricing Editor ")],-1)]),8,W))])):k("",!0)])])),_:1})])),_:1},8,["data","row-class-name","load","tree-props"])):(y(),g("div",Z)),w(p,{size:"sm",modelValue:e.modal,"onUpdate:modelValue":a[5]||(a[5]=a=>e.modal=a)},{header:v((()=>a[11]||(a[11]=[A(" Important Information ")]))),default:v((()=>{var l,t,i,n;return[e.selectedRow?(y(),g("div",ee,[a[16]||(a[16]=x("div",{class:"flex justify-center items-center p-8 rounded-full bg-teal-lighten"},[x("img",{src:z,alt:""})],-1)),a[17]||(a[17]=x("p",{class:"text-center mt-8"},"Your item has been enabled in your catalog, but you still need to complete the following steps",-1)),a[18]||(a[18]=x("p",{class:"text-center my-6"},"Here are your next steps:",-1)),x("div",ae,[x("div",le,[a[13]||(a[13]=x("div",{class:"flex items-center justify-center bg-teal-02 rounded-full text-white font-semibold w-8 h-8"},"1",-1)),x("p",te,[a[12]||(a[12]=A("Set item conditions as needed within the ")),x("a",{class:"underline text-black",href:`/setting/product-conditions/create?model=${e.findParentName(e.selectedRow)}&ref=true`},"Conditions Settings",8,ie)])]),x("div",ne,[a[15]||(a[15]=x("div",{class:"flex items-center justify-center bg-teal-02 rounded-full text-white font-semibold w-8 h-8"},"2",-1)),x("p",se,[a[14]||(a[14]=A(" Set item prices as needed within the ")),(null==(l=e.selectedRow)?void 0:l.is_child)?(y(),g("a",{key:1,class:"underline text-black",href:`/setting/bulk-price-editor/${e.route.params.category}/${"all"===e.route.params.brand?null==(i=e.selectedRow)?void 0:i.manufacturer:e.paramsBrand}?ref=true&model=${null==(n=e.selectedRow)?void 0:n.name}`,onClick:a[3]||(a[3]=B((a=>e.showPricing(e.selectedRow,2)),["prevent"]))}," Price Editor Settings ",8,oe)):(y(),g("a",{key:0,class:"underline text-black",href:`/setting/bulk-price-editor/${e.route.params.category}/${"all"===e.route.params.brand?null==(t=e.selectedRow)?void 0:t.manufacturer:e.paramsBrand}?ref=true`,onClick:a[2]||(a[2]=B((a=>e.showPricing(e.selectedRow,1)),["prevent"]))}," Price Editor Settings ",8,re))])])])])):k("",!0)]})),footer:v((()=>[x("div",de,[x("div",null,[w(r,{modelValue:e.dontShow,"onUpdate:modelValue":a[4]||(a[4]=a=>e.dontShow=a),value:1,"value-off":0,class:"font-normal"},{default:v((()=>a[19]||(a[19]=[A(" Don't show this again for this session ")]))),_:1},8,["modelValue"])]),w(u,{color:"teal",view:"smooth",onClick:e.closeModal},{default:v((()=>a[20]||(a[20]=[x("i",{class:"material-icons mr-2"},"close",-1),A("Close Notification")]))),_:1},8,["onClick"])])])),_:1},8,["modelValue"])],64)}]]);export{ce as D};
