var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,o=(a,l,s)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[l]=s;import{k as d,f as n,r,a5 as m,g as c,_ as p,m as u,a0 as b,o as _,t as g,B as v,D as f,a2 as y,a3 as h,K as w,U as k,A as T,L as E,w as x,I as j,n as C,S as U,F as $}from"./vendor.f1efedad.js";import{u as V}from"./index.32689823.js";import{c as I,d as P}from"./index.1c09f422.js";import{r as S}from"./index.2fb3814c.js";import{f as B,e as q,b as M,u as O,_ as D}from"./index.e231b017.js";import{_ as L}from"./fieldset.32ceb9ab.js";import{I as F}from"./InputFile.251403df.js";import{C as J}from"./Colorpicker.28afd4d3.js";import{M as R}from"./MultipleEmailInput.e6474fb8.js";import{T as A,c as W}from"./TextEditor.8118238d.js";import{E as H}from"./index.fd6cc087.js";const N=d({name:"WorkflowForm",components:{Input:B,InputFile:F,Colorpicker:J,MultipleEmailInput:R,Checkbox:q,Fieldset:L,Button:M,TextEditor:A,EmailTemplateTimeDelay:H},props:{data:{type:Object,default:()=>({id:null,description:null,email_subject:null,email_template:"",reminded_days:0,sending_times_json:[],is_send_email:1,short_name:null,status_name:null,bcc:null,color_mail_template:"#000000",is_mail_logo_show:0})},disableStatus:{type:Boolean,default:!1},disbaleSendMail:{type:Boolean,default:!1},disableEmailPreview:{type:Boolean,default:!1},isParent:{type:Boolean,default:!1},loadingTheme:{type:Boolean,default:!1},loadingPreviewEmail:{type:Boolean,default:!1},loadingEditor:{type:Boolean,default:!1},resetTemplate:{type:Boolean,default:!1}},emits:["update-email-theme","preview-email","reset-template"],setup(e,{emit:d}){const u=n(null),b=r(e.data),{me:_}=O(),g=m(),v=r({editor:W.exports.Editor,config:{htmlSupport:{allow:[{styles:!0,classes:!0}]},simpleUpload:{uploadUrl:`https://api-eu.buybackcloud.com/api/v1/pos/settings/email-template/upload-image/${g.params.workflowId}?buyback_company_token=${_.value.buyback_company_token}`}}}),f=r({description:{required:S},reminded_days:{requiredIf:I.withMessage("Remainded days is required",P((()=>y.value)))},short_name:{required:S},status_name:{required:S},email_subject:{requiredIf:I.withMessage("Email subject is required",P((()=>1==b.is_send_email&&!e.isParent&&y.value)))},email_template:{requiredIf:I.withMessage("Email body is required",P((()=>1==b.is_send_email&&!e.isParent&&y.value)))}}),y=c((()=>{const e=["leads",1001,"not as described",5,"on hold",10,"canceled",2002,"abandoned buyback",1e3];return b.short_name?!e.includes(b.id)&&!e.includes(b.short_name.toLowerCase()):!e.includes(b.id)})),h=c((()=>((null==b?void 0:b.sort_code)||[]).map((e=>{return d=((e,a)=>{for(var l in a||(a={}))t.call(a,l)&&o(e,l,a[l]);if(s)for(var l of s(a))i.call(a,l)&&o(e,l,a[l]);return e})({},e),n={description:e.description.replace(/\\/g,""),tooltip:e.tooltip?e.tooltip.replace(/\\n/g,"<br/>"):null},a(d,l(n));var d,n})))),w=V(f,b,{$lazy:!0});return{refTextEditor:u,data:b,ckeditor:v,hasEmailTemplate:y,shortCodes:h,validation:w,copyText:e=>{navigator.clipboard.writeText(e).then((()=>{p({type:"success",message:"Text copied to clipbord"})}))},isSendEmail:()=>{f.email_subject=1==b.is_send_email?{required:S}:{required:!1},f.email_template=1==b.is_send_email?{required:S}:{required:!1}},validate:async()=>{if(1==b.is_send_email&&!e.isParent){if(!u.value.isEditorReady)return!1;if(!(await u.value.forceSave()))return!1}return w.value.$validate(),!w.value.$invalid},handleBccUpdate:e=>{b.bcc=e},handleUpdateEmailTheme:()=>d("update-email-theme",!0),handlePreviewEmailTemplate:async()=>d("preview-email",!0),handleResetTemplate:()=>d("reset-template",!0),handleUpdateSendingTimes:e=>{b.reminded_days=e},handleUpdateSendingTimesJson:e=>{b.sending_times_json=e}}}}),z={class:"grid xl:grid-cols-4 grid-cols-1 gap-4"},K={class:"col-span-2 grid grid-cols-4 gap-4"},G={class:"col-span-4"},Q={class:"col-span-4"},X={class:"col-span-4"},Y={key:0,class:"col-span-4"},Z={class:"col-span-4"},ee={class:"grid grid-cols-4 gap-4"},ae={class:"col-span-4 xl:col-span-2"},le={class:"mb-3"},se={class:"mb-3"},te={class:"mb-3"},ie={class:"col-span-4"},oe={key:0,class:"col-span-4"},de={class:"mr-2"},ne=["onClick"],re={class:"w-96"},me=["innerHTML"];var ce=D(N,[["render",function(e,a,l,s,t,i){const o=u("Input"),d=u("EmailTemplateTimeDelay"),n=u("Checkbox"),r=u("MultipleEmailInput"),m=u("Button"),c=u("TextEditor"),p=u("Tooltip"),V=u("TableColumn"),I=u("Table"),P=b("loading");return _(),g("div",z,[v("div",K,[v("div",G,[f(o,{modelValue:e.data.status_name,"onUpdate:modelValue":a[0]||(a[0]=a=>e.data.status_name=a),disabled:e.disableStatus,type:"text",label:"Status Name",view:e.validation.status_name.$invalid?"danger":"default",block:""},null,8,["modelValue","disabled","view"]),(_(!0),g(y,null,h(e.validation.status_name.$errors,(e=>(_(),g("span",{class:"text-red-base mt-2 block",key:e},w(e.$message)+". ",1)))),128))]),v("div",Q,[f(o,{modelValue:e.data.short_name,"onUpdate:modelValue":a[1]||(a[1]=a=>e.data.short_name=a),disabled:e.disableStatus,type:"text",label:"Short Name",view:e.validation.short_name.$invalid?"danger":"default",block:""},null,8,["modelValue","disabled","view"]),(_(!0),g(y,null,h(e.validation.short_name.$errors,(e=>(_(),g("span",{class:"text-red-base mt-2 block",key:e},w(e.$message)+". ",1)))),128))]),v("div",X,[f(o,{modelValue:e.data.description,"onUpdate:modelValue":a[2]||(a[2]=a=>e.data.description=a),type:"textarea",label:"Description",view:e.validation.description.$invalid?"danger":"default",rows:"6",block:""},null,8,["modelValue","view"]),(_(!0),g(y,null,h(e.validation.description.$errors,(e=>(_(),g("span",{class:"text-red-base mt-2 block",key:e},w(e.$message)+". ",1)))),128))]),e.hasEmailTemplate?(_(),g("div",Y,[f(d,{isWorkflow:"",sendingTimes:e.data.sending_times_json.length,sendingTimesJson:e.data.sending_times_json,"onUpdate:sendingTimes":e.handleUpdateSendingTimes,"onUpdate:sendingTimesJson":e.handleUpdateSendingTimesJson},null,8,["sendingTimes","sendingTimesJson","onUpdate:sendingTimes","onUpdate:sendingTimesJson"]),(_(!0),g(y,null,h(e.validation.reminded_days.$errors,(e=>(_(),g("span",{class:"text-red-base mt-2 block",key:e},w(e.$message)+". ",1)))),128))])):k("",!0)]),v("div",Z,[T(v("div",null,[v("div",ee,[v("div",ae,[v("div",le,[a[7]||(a[7]=v("label",{class:"block mb-2"},"Logo",-1)),f(n,{modelValue:e.data.is_mail_logo_show,"onUpdate:modelValue":a[3]||(a[3]=a=>e.data.is_mail_logo_show=a),onInput:e.handleUpdateEmailTheme,loading:e.loadingTheme,type:"toggle",id:"logo",value:1,"value-off":0},{default:x((()=>a[6]||(a[6]=[v("span",{class:"font-medium"},"Show company logo",-1)]))),_:1},8,["modelValue","onInput","loading"])]),v("div",se,[a[8]||(a[8]=v("label",null,"BCC",-1)),f(r,{onEmailChange:e.handleBccUpdate,suggestion:!1,emails:e.data.bcc},null,8,["onEmailChange","emails"])]),v("div",te,[f(o,{modelValue:e.data.email_subject,"onUpdate:modelValue":a[4]||(a[4]=a=>e.data.email_subject=a),type:"text",label:"Email Subject",view:e.validation.email_subject.$invalid?"danger":"default",block:""},null,8,["modelValue","view"]),(_(!0),g(y,null,h(e.validation.email_subject.$errors,(e=>(_(),g("span",{class:"text-red-base mt-2 block",key:e},w(e.$message)+". ",1)))),128))])]),T((_(),g("div",ie,[f(c,{modelValue:e.data.email_template,"onUpdate:modelValue":a[5]||(a[5]=a=>e.data.email_template=a),ref:"refTextEditor",options:e.ckeditor,"with-image-upload":""},{toolbar:x((()=>[f(m,{class:"ml-2",onClick:e.handlePreviewEmailTemplate,loading:e.loadingPreviewEmail||e.loadingTheme,disabled:e.disableEmailPreview,color:"teal",view:"smooth",dense:""},{default:x((()=>a[9]||(a[9]=[v("i",{class:"material-icons mr-1"},"visibility",-1),j(" Preview Email ")]))),_:1},8,["onClick","loading","disabled"]),e.resetTemplate?(_(),C(m,{key:0,onClick:U(e.handleResetTemplate,["prevent"]),class:"ml-auto",color:"orange",view:"smooth",dense:""},{default:x((()=>a[10]||(a[10]=[v("i",{class:"material-icons"},"restart_alt",-1),j(" Reset to Default ")]))),_:1},8,["onClick"])):k("",!0)])),_:1},8,["modelValue","options"]),(_(!0),g(y,null,h(e.validation.email_template.$errors,(e=>(_(),g("span",{class:"text-red-base mt-2 block",key:e},w(e.$message)+". ",1)))),128))])),[[P,e.loadingEditor]])])],512),[[E,1==e.data.is_send_email&&!e.isParent&&e.hasEmailTemplate]])]),0!==e.shortCodes.length&&1==e.data.is_send_email&&e.hasEmailTemplate?(_(),g("div",oe,[e.shortCodes&&Array.isArray(e.shortCodes)?(_(),C(I,{key:0,class:"mt-6",data:e.shortCodes},{default:x((()=>[f(V,{label:"Code"},{default:x((l=>[v("div",{class:$(["short-code",l.row.is_disabled?"short-code--disabled":""])},[v("span",de,w(l.row.code),1),!l.row.is_disabled||l.row.disabled?(_(),g("i",{key:0,class:"material-symbols-outlined text-lg text-teal-04",style:{"font-variation-settings":"'FILL' 0"},onClick:a=>e.copyText(l.row.code)}," content_copy ",8,ne)):k("",!0),l.row.tooltip?(_(),C(p,{key:1,placement:"top"},{content:x((()=>[v("div",re,[v("span",{innerHTML:l.row.tooltip},null,8,me)])])),default:x((()=>a[11]||(a[11]=[v("i",{class:"material-icons text-lg text-teal-04"},"info",-1)]))),_:2},1024)):k("",!0)],2)])),_:1}),f(V,{label:"Description"},{default:x((e=>[v("div",{class:$(["inline-block","short-code",e.row.is_disabled?"short-code--disabled":""])},w(e.row.description),3)])),_:1})])),_:1},8,["data"])):k("",!0)])):k("",!0)])}]]);export{ce as W};
