var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,n=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,s=(t,a,l)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:l}):t[a]=l,o=(e,t)=>{for(var a in t||(t={}))n.call(t,a)&&s(e,a,t[a]);if(l)for(var a of l(t))r.call(t,a)&&s(e,a,t[a]);return e};import{_ as i}from"./fieldset.49a14fc7.js";import{B as d}from"./BTable.59e23b62.js";import{o as u,t as c,A as m,aF as p,B as y,q as b,K as v,G as f,H as h,F as g,f as k,r as I,g as _,y as S,W as B,aT as x,k as w,m as P,n as V,w as j,Q as q,I as O,D as T,a2 as N,a3 as U,S as $,U as C}from"./vendor.f1efedad.js";import{_ as E,f as M,b as Q,T as W,g as F}from"./index.9aa6481b.js";import{C as A}from"./Currency.ae08941b.js";import{d as D}from"./bulkquote.38ab78f5.js";import{D as H}from"./DeviceSearch.79f61d11.js";const R={name:"BSlider",props:{modelValue:{type:Number,default:0},min:{type:Number,default:0},max:{type:Number,default:100},step:{type:Number,default:1},block:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:t}){const a=k(null),l=k(null),n=I({value:0}),r=_({get:()=>e.modelValue&&e.modelValue||n.value,set:(e=0)=>{t("update:modelValue",e),n.value=e}}),s=_((()=>Math.round(r.value/e.max*100))),o=_((()=>`${s.value}%`)),i=()=>{const t=a.value.getBoundingClientRect(),l=Number(100*(r.value-e.min)/(e.max-e.min));a.value.style.left=`calc((${l}% - ${t.width/2}px) + (${8-.15*l}px))`};return S(o,i),B((()=>{i()})),{refSliderTooltip:a,refSlider:l,value:r,sliderPercentage:o}}},L=()=>{x((e=>({"7b8487f2":e.sliderPercentage})))},G=R.setup;R.setup=G?(e,t)=>(L(),G(e,t)):L;const J=["disabled","min","max"],K={ref:"refSliderTooltip",class:"b-slider__tooltip"};var z=E(R,[["render",function(e,t,a,l,n,r){return u(),c("div",{class:g(["b-slider",a.block&&"b-slider--block",a.disabled&&"b-slider--disabled"])},[m(y("input",{disabled:a.disabled,ref:"refSlider",class:"b-slider__slider","onUpdate:modelValue":t[0]||(t[0]=e=>l.value=e),type:"range",min:a.min,max:a.max,step:1},null,8,J),[[p,l.value]]),y("div",K,[b(e.$slots,"tooltip",f(h({value:l.value})),(()=>[y("span",null,v(l.sliderPercentage),1)]),!0)],512)],2)}],["__scopeId","data-v-91168364"]]);const X=w({name:"BulkQuoteItemTable",components:{BTable:d,Input:M,Button:Q,Currency:A},props:{items:{type:Array},percentage:{type:Number,default:100},preview:{type:Boolean,default:!1},disabled:{type:Boolean,default:!0},disabledStatus:{type:Boolean,default:!0},reconcile:{type:Boolean,default:!1}},emits:["update:items","deleteItem","editItem","reconcileItem"],setup(e,{emit:l}){const n={items:[]},r=_({get:()=>e.items&&e.items||n.items,set:(e=[])=>{l("update:items",e),n.items=e}}),s=_((()=>{if(r.value.length<1)return[];const e=new Map;return r.value.forEach((t=>{const{conditions:a={}}=t,{data:l=[]}=a;l.forEach((t=>{e.has(t.name)||e.set(t.name,{name:t.name,rules:t.rule})}))})),Array.from(e.values())})),i=_((()=>{let t=[{key:"product_name",column_name:e.preview?"Device":"Item",meta:{}},{key:"qty",column_name:"Qty",meta:{}}];return s.value.forEach((e=>{t.push({key:b(e.name),column_name:e.name,meta:{rules:v(e.rules)}})})),t})),d=_((()=>r.value.map((e=>{const{conditions:l={}}=e,{data:n=[]}=l,r=Object.fromEntries(n.map((e=>{return[b(e.name),(l=o({},e),n={price:e.price||0},t(l,a(n)))];var l,n}))),i={};return s.value.forEach((e=>{const t=b(e.name);i[t]=r[t]||{name:e.name,price:0,is_manually_priced:!1}})),o(o({},e),i)})))),u=_((()=>r.value.reduce(((e,t)=>e+(parseInt(t.qty)||0)),0))),c=_((()=>(parseInt(`${e.percentage}`)||0)/100)),m=_((()=>{const e={};return s.value.forEach((t=>{e[t.name]=0})),r.value.forEach((t=>{const{conditions:a={}}=t,{data:l=[]}=a,n=parseFloat(t.qty)||0;l.forEach((t=>{const a=parseFloat(t.price)||0;e[t.name]=(e[t.name]||0)+a*n}))})),Object.values(e)})),p=_((()=>["Total",u.value,...m.value||[],""])),y=e=>{l("editItem",e)},b=e=>`condition_${e}`,v=e=>{let t=e?JSON.parse(e):[];return Array.isArray(t)&&1===t.length&&t.includes(null)&&(t=[]),t||[]},f=(e,t,a,l={isManuallyPriced:!1})=>{const n=[...r.value];if(e<0)return;const s=((e=[],t)=>e.findIndex((e=>e.name===t)))(n[e].conditions.data,t.name);-1===s?n[e].conditions.data.push({name:t.name,price:a,is_manually_priced:l.isManuallyPriced||!1,original_price:a,rule:t.rule||null}):(n[e].conditions.data[s].price=a,n[e].conditions.data[s].is_manually_priced=l.isManuallyPriced||!1),r.value=n,l.isManuallyPriced&&y(n[e])};return S(c,(()=>{[...r.value].forEach(((e,t)=>{const{conditions:a={}}=e||{},{data:l=[]}=a;l.forEach(((e,a)=>{if(e.is_manually_priced)return;const l=e.original_price*c.value;f(t,e,l)}))}))})),{items:r,itemConditions:s,tableHeaders:i,tableData:d,tableFooter:p,updateConditionPrice:f,updateQty:(e,t=1)=>{const a=[...r.value];e<0||(a[e].qty=t,r.value=a,y(a[e]))},updateName:(e,t)=>{const a=[...r.value];e<0||(a[e].product_name=t,r.value=a,y(a[e]))},deleteItem:(e,t)=>{const a=[...r.value];e<0||(a.splice(e,1),r.value=a,l("deleteItem",t))},reconcileItem:e=>{l("reconcileItem",e)},money:W}}}),Y={key:0,class:"flex items-center justify-center gap-2"},Z={class:"max-w-md"},ee={class:"list"},te=["innerHTML"],ae={key:0,class:"number-column"},le={key:1,class:"number-column",style:{minWidth:"70px"}},ne={key:2,class:"font-semibold",style:{minWidth:"300px",maxWidth:"300px"}},re={key:0,style:{minWidth:"300px"}},se={key:1,style:{minWidth:"70px"}},oe={key:2,style:{minWidth:"150px"}},ie={key:3},de={key:1,class:"font-medium"},ue=["onClick"];var ce=E(w({name:"BulkQuoteItem",components:{Fieldset:i,BSlider:z,BTable:d,BulkQuoteItemTable:E(X,[["render",function(e,t,a,l,n,r){const s=P("Tooltip"),o=P("Currency"),i=P("Input"),d=P("Button"),m=P("BTable");return u(),V(m,{headers:e.tableHeaders,items:e.tableData,"min-width":"auto",class:g([e.preview&&"table-preview"]),"time-stamp":!1},{header:j((({header:t})=>{var a,l;return["product_name"!==t.key?(u(),c("th",{key:t.key,class:g(["number-column",e.preview&&"column-normal"]),style:q({minWidth:"qty"===t.key&&"100px"})},[t.key.startsWith("condition_")&&!e.preview?(u(),c("span",Y,[O(v(t.column_name)+" ",1),T(s,{placement:"top",disabled:!(null==(l=null==(a=null==t?void 0:t.meta)?void 0:a.rules)?void 0:l.length)},{content:j((()=>{var e;return[y("div",Z,[y("ul",ee,[(u(!0),c(N,null,U((null==(e=null==t?void 0:t.meta)?void 0:e.rules)||[],((e,t)=>(u(),c("li",{key:t,class:"text-white"},[y("span",{innerHTML:e},null,8,te)])))),128))])])]})),default:j((()=>{var e,a;return[y("i",{class:g(["material-icons cursor-pointer",!(null==(a=null==(e=null==t?void 0:t.meta)?void 0:e.rules)?void 0:a.length)&&"opacity-50"])}," info ",2)]})),_:2},1032,["disabled"])])):(u(),c(N,{key:1},[O(v(t.column_name),1)],64))],6)):(u(),c("th",{key:t.key,class:g([e.preview&&"column-normal"])},v(t.column_name),3))]})),column:j((({key:t,column:a,row:l,rowIndex:n})=>[e.preview?(u(),c(N,{key:0},[t.startsWith("condition_")?(u(),c("td",ae,[T(o,{value:null==a?void 0:a.price},null,8,["value"])])):"qty"===t?(u(),c("td",le,v(a),1)):(u(),c("td",ne,v(a),1))],64)):(u(),c(N,{key:1},["product_name"===t?(u(),c("td",re,[1===(null==l?void 0:l.is_custom)?(u(),V(i,{key:`input-name-${n}`,"model-value":a,"onUpdate:modelValue":t=>e.updateName(n,t),block:"",disabled:e.disabled,class:"mb-6"},null,8,["model-value","onUpdate:modelValue","disabled"])):(u(),c(N,{key:1},[O(v(a),1)],64))])):"qty"===t?(u(),c("td",se,[(u(),V(i,{key:`input-qty-${n}`,"model-value":a,"onUpdate:modelValue":t=>e.updateQty(n,t),type:"number",right:"",block:"",disabled:e.disabled||e.disabledStatus,class:"mb-6"},null,8,["model-value","onUpdate:modelValue","disabled"]))])):t.startsWith("condition_")?(u(),c("td",oe,[(u(),V(i,{key:`input-price-${n}`,"model-value":null==a?void 0:a.price,"onUpdate:modelValue":t=>e.updateConditionPrice(n,a,t,{isManuallyPriced:!0}),type:"number",currency:!0,block:"",disabled:e.disabled||e.disabledStatus},null,8,["model-value","onUpdate:modelValue","disabled"])),y("small",{style:q({opacity:a.is_manually_priced?"1":"0"}),class:"text-grey-03 text-right block mt-2"},"Manually priced",4)])):(u(),c("td",ie,v(a),1))],64))])),footer:j((()=>[(u(!0),c(N,null,U(e.tableFooter,((t,a)=>(u(),c("td",{key:`total_${a}`,class:g([a>0&&"number-column"])},[a>1&&a<e.tableFooter.length-1?(u(),V(o,{key:0,class:"font-medium",value:t},null,8,["value"])):(u(),c("span",de,v(t),1))],2)))),128))])),action:j((({rowIndex:a,row:l})=>[y("td",null,[e.disabled||e.preview?C("",!0):(u(),c(N,{key:0},[e.reconcile?(u(),V(d,{key:0,onClick:t=>e.reconcileItem(l),color:"teal",dense:""},{default:j((()=>t[0]||(t[0]=[y("p",{class:"flex items-center gap-2 ml-3"},[O(" Reconcile "),y("i",{class:"material-icons"},"chevron_right")],-1)]))),_:2},1032,["onClick"])):(u(),c("a",{key:1,href:"",onClick:$((t=>e.deleteItem(a,l)),["prevent"]),class:"px-3 py-2 flex items-center justify-center"},t[1]||(t[1]=[y("i",{class:"material-icons"},"close",-1)]),8,ue))],64))])])),_:1},8,["headers","items","class"])}],["__scopeId","data-v-2150f465"]])},props:{items:{type:Array},percentage:{type:Number},disabled:{type:Boolean,default:!1},disabledStatus:{type:Boolean,default:!1},reconcile:{type:Boolean,default:!1}},emits:["update:percentage","update:items","deleteItem","editItem","reconcileItem"],setup(e,{emit:t}){const a=I({items:[]}),l=_({get:()=>e.items&&e.items||a.items,set:(e=[])=>{const l=e.filter((e=>e.items.length>0));t("update:items",l),a.items=l}}),n=_((()=>l.value.length>0));return{data:a,items:l,hasOneOrMoreItems:n,handleUpdateItem:(e,t)=>{const a=[...l.value];a[e].items=t,l.value=a}}}}),[["render",function(e,t,a,l,n,r){const s=P("BulkQuoteItemTable"),o=P("Fieldset");return u(),c("div",null,[(u(!0),c(N,null,U(e.items,((a,l)=>(u(),V(o,{key:a.id,class:"my-4",style:{"min-width":"0"}},{label:j((()=>[O(v(a.name),1)])),default:j((()=>[T(s,{items:a.items,"onUpdate:items":t=>e.handleUpdateItem(l,t),onDeleteItem:t[0]||(t[0]=t=>e.$emit("deleteItem",t)),onEditItem:t[1]||(t[1]=t=>e.$emit("editItem",t)),onReconcileItem:t[2]||(t[2]=t=>e.$emit("reconcileItem",t)),percentage:e.percentage,disabled:e.disabled,"disabled-status":e.disabledStatus,reconcile:e.reconcile},null,8,["items","onUpdate:items","percentage","disabled","disabled-status","reconcile"])])),_:2},1024)))),128))])}]]);const me=w({name:"BulkQuoteItemPercentage",components:{BSlider:z},props:{modelValue:{type:Number},disabled:{type:Boolean,default:!1},create:{type:Boolean,default:!1},order:{type:Object,default:()=>({id:""})}},emits:["update:modelValue"],setup(e,{emit:t}){const a=I({percentage:0});return{show:_((()=>{var t,a;return!!e.create||!(!e.order||!(null==(t=e.order)?void 0:t.status_id)||9e3!==(null==(a=e.order)?void 0:a.status_id))})),percentage:_({get:()=>e.modelValue&&e.modelValue||a.percentage,set:(e=0)=>{t("update:modelValue",e),a.percentage=e}})}}}),pe={key:0},ye={class:"flex items-center gap-4"};var be=E(me,[["render",function(e,t,a,l,n,r){const s=P("BSlider");return e.show?(u(),c("div",pe,[t[3]||(t[3]=y("label",{class:"font-medium mb-2"},"Quoted Price",-1)),y("div",ye,[t[1]||(t[1]=y("span",null,"0%",-1)),T(s,{class:"flex-grow",modelValue:e.percentage,"onUpdate:modelValue":t[0]||(t[0]=t=>e.percentage=t),modelModifiers:{number:!0},disabled:e.disabled,block:""},null,8,["modelValue","disabled"]),t[2]||(t[2]=y("span",null,"100%",-1))])])):C("",!0)}]]);var ve=E(w({name:"BulkQuoteItemSearch",components:{ProductSearch:H},props:{clearOnSelect:{type:Boolean,default:!0}},emits:["select"],setup(e,{emit:t}){const{querySearch:a,products:l,categories:n,loading:r,searchItems:s,isProductActiveButNoPrice:o}=D(),i=F((()=>s()),500);return{querySearch:a,products:l,categories:n,loadingSearchItems:r,isProductActiveButNoPrice:o,handleSearchItems:i,handleSelectItem:l=>{t("select",l),e.clearOnSelect?a.value="":a.value=l.product_name}}}}),[["render",function(e,t,a,l,n,r){const s=P("ProductSearch");return u(),V(s,{query:e.querySearch,"onUpdate:query":t[0]||(t[0]=t=>e.querySearch=t),onSearch:e.handleSearchItems,onSelect:e.handleSelectItem,label:null,products:e.products,categories:e.categories,loading:e.loadingSearchItems,"show-add-custom-product":!1,"active-product-unprice":e.isProductActiveButNoPrice,placeholder:"Find or add an item"},null,8,["query","onSearch","onSelect","products","categories","loading","active-product-unprice"])}]]);export{ve as B,ce as a,be as b};
