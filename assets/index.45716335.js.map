{"version":3,"file":"index.45716335.js","sources":["../../src/views/setting/manage-location/create/index.vue","../../src/assets/icon/location-add.svg"],"sourcesContent":["<template>\n  <div>\n    <Modal v-model=\"isShowModal\" title=\"Add Location\" @close=\"handleCloseModal\">\n      <div class=\"grid grid-cols-1\">\n        <ManageLocationForm ref=\"refComponent\" :data=\"data\" :is-mailin-available=\"hasActiveMailinLocation\" />\n      </div>\n      <template #footer>\n        <div class=\"flex justify-between\">\n          <Button @click=\"handleCloseModal\" color=\"white\" class=\"btn-white--borderless\">\n            Cancel\n          </Button>\n          <Button @click=\"handleConfirmAddLocation\" color=\"teal\" :disabled=\"hasEmptyRequiredField\" :loading=\"loading.form ||\n            loadingLegacyLocation?.all ||\n            loadingAdditionalPrice ||\n            loadingLocation.mailin_location\n            \">\n            Add Location\n          </Button>\n        </div>\n      </template>\n    </Modal>\n    <Modal v-model=\"modal.form\" :size=\"isAddedLocation || isErrorAddingLocation ? 'xs' : 'sm'\" hide-footer hide-header>\n      <div>\n        <div v-if=\"isAddedLocation\" class=\"flex flex-col items-center justify-center my-6\">\n          <img class=\"mb-4 w-28\" src=\"@/assets/icon/success.svg\" alt=\"company icon\" />\n          <h2 class=\"text-2xl my-4 font-medium\">\n            New Location Successfully Added!\n          </h2>\n          <p class=\"text-center text-grey-03\">\n            You have been charged a prorated amount of\n            {{ chargedProrateAmount }} until the start of your billing cycle.\n          </p>\n          <Button @click=\"handleCloseOnSuccess\" class=\"my-6\" color=\"white\">\n            Close\n          </Button>\n        </div>\n        <div v-else-if=\"isErrorAddingLocation\" class=\"flex flex-col items-center justify-center my-6\">\n          <img class=\"mb-4 w-28\" src=\"@/assets/icon/error-circle.svg\" alt=\"company icon\" />\n          <h2 class=\"text-2xl my-4 font-medium\">\n            Payment Failed!\n          </h2>\n          <p class=\"text-center text-grey-03\">\n            Your payment was unsuccessful. Please try again. If the problem persists, go to <a href=\"#!\"\n              class=\"underline\" @click.prevent=\"() => !isLoadingBilling && handleOpenBilling()\">Plans &\n              Billing Settings</a>\n          </p>\n          <div class=\"flex flex-wrap items-center gap-4\">\n            <Button @click=\"handleCloseModal\" :loading=\"isLoadingBilling\" class=\"my-6 btn-white--borderless\"\n              color=\"white\">\n              Close\n            </Button>\n            <Button @click=\"handleSubmitAddLocation\" color=\"teal\" view=\"outlined\" :loading=\"loading.form ||\n              loadingAdditionalPrice ||\n              loadingLocation.mailin_location || isLoadingBilling\n              \">\n              Retry <i class=\"material-icons\">refresh</i>\n            </Button>\n          </div>\n        </div>\n        <div v-else class=\"flex flex-col items-center justify-center my-4\">\n          <img class=\"mb-4 w-28\" src=\"@/assets/icon/location-add.svg\" alt=\"company icon\" />\n          <h2 class=\"text-2xl my-4 font-medium\">Pay to Add Location</h2>\n          <p class=\"text-center text-grey-03\">\n            By clicking 'Subscribe,' you agree to an additional charge of\n            <span class=\"font-semibold\">\n              {{ stateLocation?.package_detail?.additional_location_price }} {{ billingCycleType }}\n            </span>, prorated from the subscription start date. You will be\n            charged a prorated amount of {{ chargedProrateAmount }} today, which\n            will cover the period until your next billing cycle begins.\n          </p>\n          <div class=\"flex items-center gap-4 mt-8 mb-4\">\n            <Button @click=\"modal.form = false\" color=\"white\" class=\"btn-white--borderless\">\n              Cancel\n            </Button>\n            <Button :loading=\"loading.form ||\n              loadingAdditionalPrice ||\n              loadingLocation.mailin_location\n              \" color=\"teal\" @click=\"handleSubmitAddLocation\">\n              Subscribe\n            </Button>\n          </div>\n        </div>\n      </div>\n    </Modal>\n  </div>\n</template>\n\n<script>\nimport { defineComponent, inject, onMounted, ref, computed } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { useStore } from 'vuex'\nimport { useManageLocationForm } from 'composable/setting'\nimport { useLocations as useLegacyLocation } from 'composable/dashboard'\nimport {\n  storeLocationSymbols,\n  useStoreLocation,\n  useAdditionalPrice\n} from 'composable/location'\n\nimport Alert from 'bbUi/components/alert/alert.vue'\nimport Button from 'bbUi/components/button/button.vue'\nimport Card from 'bbUi/components/card/card.vue'\nimport Breadcrumb from 'components/Breadcrumb.vue'\nimport Modal from 'bbUi/components/modal/modal.vue'\nimport ManageLocationForm from 'components/ManageLocation/Form.vue'\nimport { ElMessage } from 'element-plus'\n\nexport default defineComponent({\n  components: {\n    Alert,\n    Button,\n    Card,\n    Modal,\n    ManageLocationForm,\n    Breadcrumb\n  },\n  setup() {\n    const store = useStore()\n    const router = useRouter()\n    const {\n      data,\n      loading,\n      modal,\n      currentMailinLocationId,\n      actionCreate,\n      actionUpdate\n    } = useManageLocationForm()\n    const { locations } = useLegacyLocation()\n    const {\n      loading: loadingAdditionalPrice,\n      chargedProrateAmount,\n      getChargedProrateAmount,\n      billingCycleType\n    } = useAdditionalPrice()\n    const {\n      loading: loadingLocation,\n      actionMailLocation: actionSetupMailinLocation\n    } = useStoreLocation()\n    const {\n      state: stateSymbol,\n      actionAll: actionAllSymbol,\n      loading: loadingSymbol\n    } = storeLocationSymbols\n\n    const actionLocation = inject(actionAllSymbol)\n    const loadingLegacyLocation = inject(loadingSymbol)\n    const stateLocation = inject(stateSymbol, {})\n\n    const refComponent = ref(null)\n    const isShowModal = ref(false)\n    const isAddedLocation = ref(false)\n    const isErrorAddingLocation = ref(false)\n    const isLoadingBilling = ref(false)\n\n    const hasActiveMailinLocation = computed(\n      () =>\n        store.state.setting.manageLocation.all?.mailin_location\n          ?.is_enable_mailin == 1\n    )\n    const hasEmptyRequiredField = computed(\n      () => refComponent.value?.hasEmptyRequiredField\n    )\n\n    const breadcrumb = [\n      {\n        text: 'Settings',\n        to: {\n          name: 'setting'\n        }\n      },\n      {\n        text: 'Manage Locations',\n        to: {\n          name: 'settingManageLocation'\n        }\n      },\n      {\n        text: 'New Location'\n      }\n    ]\n    const handleCloseOnSuccess = async () => {\n      await router.push({\n        name: 'settingManageLocation'\n      })\n      await Promise.allSettled([\n        locations(() => { }, store.state.user.me.id),\n        actionLocation(store.state.user.me.id)\n      ])\n      isAddedLocation.value = false\n      ElMessage({\n        type: 'success',\n        message: 'New Mail-in Location has been added'\n      })\n    }\n    const handleErrorAddLocation = (err) => {\n      console.warn('Error adding location: ', err)\n      isErrorAddingLocation.value = true\n    }\n    const onSubmitAddLocation = async (err) => {\n      if (err) {\n        handleErrorAddLocation()\n        return\n      }\n      if (stateLocation.value?.package_detail?.is_popup_paid_location) {\n        isAddedLocation.value = true\n        isErrorAddingLocation.value = false\n        return\n      }\n      await handleCloseOnSuccess()\n    }\n    const createInstoreLocation = async () => {\n      await actionCreate(onSubmitAddLocation, {\n        closeOnSuccess: false\n      })\n    }\n    const createMailinLocation = async () => {\n      if (!currentMailinLocationId.value) {\n        console.warn('Mail-in location id is empty')\n        ElMessage({\n          message: 'Unable to create Mail-In location',\n          type: 'error'\n        })\n        return\n      }\n\n      await actionUpdate(currentMailinLocationId.value, (err) => {\n        if (err) return handleErrorAddLocation()\n        actionSetupMailinLocation(\n          {\n            is_enable: 1\n          },\n          onSubmitAddLocation\n        )\n      })\n    }\n    const handleSubmitAddLocation = async () => {\n      const isAddingMailinLocation = data.is_mailin == 1\n      if (isAddingMailinLocation) {\n        await createMailinLocation()\n        return\n      }\n      await createInstoreLocation()\n    }\n    const handleConfirmAddLocation = async () => {\n      const isValidForm = refComponent.value?.validate?.()\n      if (!isValidForm) return\n      if (!stateLocation.value?.package_detail?.is_popup_paid_location) {\n        await handleSubmitAddLocation()\n        return\n      }\n      await getChargedProrateAmount()\n      modal.form = true\n    }\n    const handleCloseModal = () => {\n      isShowModal.value = false\n      modal.form = false\n      router.push({\n        name: 'settingManageLocation'\n      })\n    }\n    const handleOpenBilling = async () => {\n      isLoadingBilling.value = true\n      router.push({\n        name: 'settingBilling'\n      })\n      // try {\n      //   const response = await store.dispatch('billing/stripePortal')\n      //   if (!response.url) throw new Error('Error retriving Customer Portal URL')\n      //   window.open(response.url, '_blank')\n      // } catch (err) {\n      //   console.warn(err.message)\n      // } finally {\n      //   isLoadingBilling.value = false\n      // }\n    }\n\n    onMounted(() => (isShowModal.value = true))\n\n    return {\n      stateLocation,\n      store,\n      data,\n      loading,\n      loadingLocation,\n      loadingLegacyLocation,\n      loadingAdditionalPrice,\n      modal,\n      breadcrumb,\n      refComponent,\n      isShowModal,\n      isAddedLocation,\n      isErrorAddingLocation,\n      isLoadingBilling,\n      chargedProrateAmount,\n      hasActiveMailinLocation,\n      hasEmptyRequiredField,\n      billingCycleType,\n      handleSubmitAddLocation,\n      handleConfirmAddLocation,\n      handleCloseModal,\n      handleCloseOnSuccess,\n      handleOpenBilling\n    }\n  }\n})\n</script>\n","export default \"__VITE_ASSET__d94e4939__\""],"names":["_sfc_main","defineComponent","components","Alert","Button","Card","Modal","ManageLocationForm","Breadcrumb","[object Object]","store","useStore","router","useRouter","data","loading","modal","currentMailinLocationId","actionCreate","actionUpdate","useManageLocationForm","locations","useLegacyLocation","loadingAdditionalPrice","chargedProrateAmount","getChargedProrateAmount","billingCycleType","useAdditionalPrice","loadingLocation","actionMailLocation","actionSetupMailinLocation","useStoreLocation","state","stateSymbol","actionAll","actionAllSymbol","loadingSymbol","storeLocationSymbols","actionLocation","inject","loadingLegacyLocation","stateLocation","refComponent","ref","isShowModal","isAddedLocation","isErrorAddingLocation","isLoadingBilling","hasActiveMailinLocation","computed","_b","_a","setting","manageLocation","all","mailin_location","is_enable_mailin","hasEmptyRequiredField","value","handleCloseOnSuccess","async","push","name","Promise","allSettled","user","me","id","_u","type","message","handleErrorAddLocation","err","console","warn","onSubmitAddLocation","package_detail","is_popup_paid_location","handleSubmitAddLocation","is_mailin","is_enable","createMailinLocation","closeOnSuccess","createInstoreLocation","onMounted","breadcrumb","text","to","handleConfirmAddLocation","validate","call","_d","_c","form","handleCloseModal","handleOpenBilling","_hoisted_1","class","key","_hoisted_6","_hoisted_9","_hoisted_10","_openBlock","_createElementBlock","onUpdate:modelValue","_cache","$event","_ctx","title","footer","_withCtx","_hoisted_2","_createVNode","_component_Button","onClick","color","disabled","default","_component_ManageLocationForm","_component_Modal","modelValue","size","hide-footer","_hoisted_3","_createElementVNode","src","_imports_0","_hoisted_4","_toDisplayString","_hoisted_5","_imports_1","_createTextVNode","href","_withModifiers","_hoisted_7","view","_hoisted_8","additional_location_price","_hoisted_11"],"mappings":"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"}