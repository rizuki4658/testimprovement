{"version":3,"file":"device.a2558383.js","sources":["../../src/composable/device.js"],"sourcesContent":["import { computed, reactive, ref } from 'vue'\nimport store from 'store'\nimport { isFunction } from 'utils/is'\nimport { camelCase } from 'utils/string'\nimport axios from 'axios'\n\nconst loadingSearch = reactive({\n  devices: false,\n  detail: false,\n  processor: false,\n  hardDrive: false,\n  memory: false,\n  graphicsCard: false\n})\nconst itemsSearch = reactive({\n  devices: [],\n  detail: [],\n  processor: [],\n  hardDrive: [],\n  memory: [],\n  graphicsCard: []\n})\n\nconst useForm = (buybackType='instore', isEditable=false) => {\n  const data = reactive({\n    product_id: null,\n    product_name: null,\n    category_id: null,\n    category_name: null,\n    condition_id: null,\n\t\tcondition_price: 0,\n    color_id: null,\n    color: null,\n    is_mac: 0,\n    is_custom: 0,\n    qty: 1,\n    price: 0,\n    imei_sn: null,\n    buyback_type: buybackType,\n    is_editable: isEditable ? 1 : 0,\n\t\tquestions: []\n  })\n  const dataComputer = reactive({\n    processor: null,\n    hardDrive: null,\n    memory: null,\n    graphicsCard: null\n  })\n  const dataGolf = reactive({\n    length: {\n      selected: null,\n      is_custom: false\n    },\n    loft: {\n      selected: null,\n      is_custom: false\n    },\n    gender: {\n      selected: null,\n      is_custom: false\n    },\n    shaft_model: {\n      selected: null,\n      is_custom: false\n    },\n    shaft_material: {\n      selected: null,\n      is_custom: false\n    }\n  })\n  const isDeviceScan = computed(() => store.state.user && store.state.user.bbbScan && !!store.state.user.bbbScan.device)\n  const unsetData = (isForm = true) => {\n    if(isForm) {\n      data.product_id = null\n      data.category_id = null\n      data.category_name = null\n      data.product_name = null\n      data.is_mac = 0\n      data.is_custom = 0\n      data.color_id =\n      data.color = null\n\t\t\tdata.questions = []\n    }\n    data.condition_id = null\n\t\tdata.condition_price = 0\n    data.qty = 1\n    data.price = 0\n    unsetDataComputer()\n    unsetDataGolf()\n  }\n  const unsetDataComputer = () => {\n    dataComputer.processor = null\n    dataComputer.hardDrive = null\n    dataComputer.memory = null\n    dataComputer.graphicsCard = null\n  }\n  const unsetDataGolf = () => {\n    dataGolf.length.selected = null\n    dataGolf.loft.selected = null\n    dataGolf.gender.selected = null\n    dataGolf.shaft_model.selected = null\n    dataGolf.shaft_material.selected = null\n  }\n\n  return {\n    data,\n    dataComputer,\n    dataGolf,\n    isDeviceScan,\n    unsetData,\n    unsetDataComputer\n  }\n}\n\nconst useGolfSpec = (options = { buybackType: 'instore' }) => {\n  const step = ref(1)\n  const steps = ref([])\n  const loading = ref(false)\n\n  const item = reactive({\n    productId: null\n  })\n  const createSelectedSpecOption = (selectedOption) => ({\n    name: selectedOption,\n    value: selectedOption\n  })\n  const createSpec = (name) => ({\n    name,\n    options: [],\n    is_custom: false,\n    selected: createSelectedSpecOption(null)\n  })\n\n  const specs = reactive({\n    length: createSpec('Length'),\n    loft: createSpec('Loft'),\n    gender: createSpec('Gender'),\n    shaft_model: createSpec('Shaft Model'),\n    shaft_material: createSpec('Shaft Material')\n  })\n\n  const specsValues = computed(() => {\n    return Object.fromEntries(\n      Object.entries(specs)\n        .map(([key, spec]) => [key, spec.selected.value])\n        .filter(([_, value]) => value !== null)\n    )\n  })\n\n  const sortedSpecs = computed(() => {\n    return steps.value\n      .map((stepKey) => {\n        return specs[stepKey] ? { key: stepKey, ...specs[stepKey] } : null\n      })\n      .filter((spec) => spec !== null)\n  })\n\n  const specsOptions = computed(() => {\n    return sortedSpecs.value.slice(0, step.value)\n  })\n  const setSpecOptionByKey = (key, options = []) => {\n    if (!specs[key]) {\n      console.warn(`Invalid key ${key} for golf spec`)\n      return\n    }\n    specs[key].options = options\n  }\n\n  const setItem = (payload = {}) => {\n    for (const key in item) {\n      if (payload[key] !== undefined) {\n        item[key] = payload[key]\n      }\n    }\n  }\n  const unsetSelectedSpecByKey = (key) => {\n    if (!specs.hasOwnProperty(key) || !key) return\n    specs[key].selected = {\n      name: null,\n      value: null\n    }\n  }\n  const unsetSelectedSpecOptionsByKey = (key) => {\n    if (!key) return\n    setSpecOptionByKey(key, [])\n  }\n  const unsetSpecsByCurrentStep = () => {\n    sortedSpecs.value\n      .slice(step.value - 1, sortedSpecs.value.length)\n      .forEach((spec) => {\n        unsetSelectedSpecByKey(spec.key)\n        unsetSelectedSpecOptionsByKey(spec.key)\n      })\n  }\n  const unsetSpecs = () => {\n    Object.entries(specs).forEach(([key]) => {\n      specs[key].selected = {\n        name: null,\n        value: null\n      }\n      specs[key].is_custom = false\n    })\n  }\n  const setSpec = (key, selected, options = {}) => {\n    if (!specs.hasOwnProperty(key)) {\n      console.warn(`Invalid key ${key} for golf spec`)\n      return\n    }\n    specs[key].selected = selected\n\n    const hasIsCustomAttribute = options.hasOwnProperty('is_custom')\n    if (hasIsCustomAttribute) {\n      specs[key].is_custom = options.is_custom\n    }\n    // step.value = getStepBySpecKey(key) + 1\n    // unsetSpecsByCurrentStep()\n  }\n\n  const setSteps = (selectedSteps = []) => {\n    steps.value = selectedSteps\n    step.value = selectedSteps.length\n  }\n\n  const getStepBySpecKey = (key) => {\n    return sortedSpecs.value.findIndex((spec) => spec.key === key) + 1\n  }\n\n  const getSpecOptions = async () => {\n    try {\n      loading.value = true\n      const specsResponse = await store.dispatch('buyback/getGolfSpecs', {\n        product_id: item.productId,\n        golf_spec: specsValues.value\n      })\n\n      for (const [key, options] of Object.entries(specsResponse || {})) {\n        setSpecOptionByKey(\n          key,\n          (Array.isArray(options) ? options : []).map((option) => ({\n            name: option,\n            value: option\n          }))\n        )\n      }\n    } catch (err) {\n      console.error('Error getting spec options: ', err)\n    }finally{\n      loading.value = false\n    }\n  }\n  const setCustomSpec = (key, value=true) => {\n    if(!specs.hasOwnProperty(key)) {\n      console.warn(`Invalid key ${key} for golf spec`)\n      return\n    }\n    specs[key].is_custom = value\n  }\n\n  return {\n    item,\n    step,\n    steps,\n    specsOptions,\n    specsValues,\n    specs,\n    loading,\n    setItem,\n    setSteps,\n    setSpec,\n    getSpecOptions,\n    unsetSpecs,\n    createSelectedSpecOption,\n    setCustomSpec\n  }\n}\n\nconst useSearch = (buybackType='instore', isEditable=false) => {\n  const data = reactive({\n    q: null\n  })\n  const loading = reactive({\n    devices: false,\n    processor: false,\n    hardDrive: false,\n    memory: false,\n    graphicsCard: false\n  })\n  const items = reactive({\n    devices: [],\n    detail: [],\n    processor: [],\n    hardDrive: [],\n    memory: [],\n    graphicsCard: []\n  })\n  const devices = computed(() => items.devices.map(item => ({\n    ...item,\n    disabled: item[buybackType] === 0\n  })))\n  let isCanceledSearch = false\n  const action = async (params = {}, callback = () => {}) => {\n    const camelType = params.type ? camelCase(params.type) : 'devices'\n    const payload = {...params, buyback_type: buybackType, is_editable: isEditable ? 1 : 0}\n    try{\n      loading[camelType] = true\n      loadingSearch[camelType] = true\n      // if(camelType === 'devices'){\n      //   items.devices = []\n      // }\n\n      items[camelType] = await store.dispatch(`device/search`, {\n        ...data,\n        ...payload\n      })\n      itemsSearch[camelType] = items[camelType]\n      isFunction(callback) && callback(null)\n    }\n    catch(err){\n      if(axios.isCancel(err)) isCanceledSearch = true\n      isFunction(callback) && callback(err)\n    }finally{\n      // If error was axios canceled request, keep loading true\n      if(isCanceledSearch){\n        isCanceledSearch = false\n        return\n      }\n      loading[camelType] = false\n      loadingSearch[camelType] = false\n    }\n  }\n\n  return {\n    data,\n    loading,\n    items,\n    devices,\n    action\n  }\n}\n\nconst useCondition = (buybackType='instore', isEditable=false) => {\n  const loading = ref(false)\n  const items = ref([])\n  const action = async (params, callback = () => {}) => {\n    try{\n      const payload = {...params, buyback_type: buybackType, is_editable: isEditable ? 1 : 0}\n      loading.value = true\n      items.value = await store.dispatch(`device/conditions`, payload)\n      isFunction(callback) && callback()\n    }finally{\n      loading.value = false\n    }\n  }\n  const actionCustom = async (params, callback = () => {}) => {\n    try{\n      loading.value = true\n      items.value = await store.dispatch(`device/customConditions`, params)\n      isFunction(callback) && callback()\n    }finally{\n      loading.value = false\n    }\n  }\n  const unset = () => {\n    items.value = []\n  }\n\n  return {\n    loading,\n    items,\n    action,\n    actionCustom,\n    unset\n  }\n}\n\nconst useColors = () => {\n  const colors = ref([])\n\n  const getColors = async (payload) => {\n    try{\n      return await store.dispatch(`device/colors`, {\n        ...payload\n      })\n\n    }finally{}\n  }\n  const unset = () => {\n    colors.value = []\n  }\n\n  return {\n    colors,\n    getColors,\n    unset\n  }\n}\n\nexport {\n  itemsSearch,\n  loadingSearch,\n  useForm,\n  useSearch,\n  useCondition,\n  useColors,\n  useGolfSpec\n}\n"],"names":["loadingSearch","reactive","devices","detail","processor","hardDrive","memory","graphicsCard","itemsSearch","useForm","buybackType","isEditable","data","product_id","product_name","category_id","category_name","condition_id","condition_price","color_id","color","is_mac","is_custom","qty","price","imei_sn","buyback_type","is_editable","questions","dataComputer","dataGolf","length","selected","loft","gender","shaft_model","shaft_material","isDeviceScan","computed","store","state","user","bbbScan","device","unsetDataComputer","unsetDataGolf","unsetData","isForm","useGolfSpec","options","step","ref","steps","loading","item","productId","createSelectedSpecOption","selectedOption","name","value","createSpec","specs","specsValues","Object","fromEntries","entries","map","key","spec","filter","_","sortedSpecs","stepKey","__spreadValues","specsOptions","slice","setSpecOptionByKey","options2","console","warn","setItem","payload","setSteps","selectedSteps","setSpec","hasOwnProperty","getSpecOptions","async","specsResponse","dispatch","golf_spec","isArray","option","err","error","unsetSpecs","forEach","setCustomSpec","useSearch","q","items","__spreadProps","disabled","isCanceledSearch","action","params","callback","camelType","type","camelCase","isFunction","axios","isCancel","useCondition","actionCustom","unset","useColors","colors","getColors"],"mappings":"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"}