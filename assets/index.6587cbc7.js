var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,n=(a,t,o)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):a[t]=o;import{u as d}from"./components.41c6afd8.js";import{k as i,a5 as s,O as c,f as m,g as u,m as p,a0 as b,o as f,t as y,D as h,w as v,n as w,I as j,U as g,B as P,A as k,a2 as I,K as _,s as C}from"./vendor.f1efedad.js";import{_ as S,f as R,b as x,d as M,g as O}from"./index.e231b017.js";import{e as A,f as D,g as B,h as T}from"./invoice.f6db67cd.js";import{B as U}from"./Breadcrumb.e5dd1515.js";import{C as V}from"./card.de1f0319.js";import{P as E}from"./PaymentMethod.10916ac1.js";import{R as F}from"./Form.86061c29.js";import{C as K}from"./Currency.3768e3b3.js";import"./LoadingCard.9892fd7a.js";import"./date.f86face7.js";import"./breadcrumb.e60df23d.js";import"./tab.9f764545.js";import"./Custom.9820d20d.js";import"./InputPhone.f8d9b657.js";import"./SelectCountry.75182cc2.js";import"./setting.86482221.js";import"./index.32689823.js";import"./index.1c09f422.js";import"./index.2fb3814c.js";import"./buyback.362c230f.js";import"./payment.20cfce93.js";import"./select.04e4ee62.js";import"./TremendousCard.12fd5823.js";const N=i({components:{Input:R,Button:x,Breadcrumb:U,Card:V,Modal:M,PaymentMethod:E,RecordPaymentForm:F,Currency:K},async setup(){const{data:e,getAvailable:d,loading:i,modal:p,unsetData:b,openModal:f,actionAvailable:y,actionCreate:h}=A("invoice"),{state:v}=D("invoice"),{data:w}=B("invoice"),{state:j,actionAll:g}=T("invoice"),P=s(),k=c(),I=m(null),_=m(null),S=m([]),R=u((()=>S.value.length>0));await Promise.all([g(P.params.buybackId,{return:!0}),y(P.params.buybackId)]);const x=O((async()=>{await y(P.params.buybackId)}),500);return{data:_,dataRecord:w,dataReturn:e,search:x,stateItems:v,statePaymentMethod:j,getAvailable:d,loading:i,modal:p,unsetData:b,openModal:f,isSelected:R,rowKey:e=>{const a=e.child?"_parent":"_child";return e.id+a},isParent:(e,a)=>!(e.child&&e.child.length>0),itemSelected:e=>{S.value=[...e]},createReturn:async()=>{var e,d;await C((()=>I.value.refChildComponent.validate()))&&await h(P.params.buybackId,(e=((e,a)=>{for(var t in a||(a={}))l.call(a,t)&&n(e,t,a[t]);if(o)for(var t of o(a))r.call(a,t)&&n(e,t,a[t]);return e})({amount:w.amount,reason:w.note},_.value),d={return_items:JSON.stringify(S.value.map((e=>({id:e.id}))))},a(e,t(d))),(()=>{k.push({name:"invoiceDetail"})}))},breadcrumb:[{text:"Invoice",to:{name:"invoice"}},{text:"Invoice Details",to:{name:"invoiceDetail"}},{text:"Return Item"}],refPaymentMethod:I}}}),q={class:"mb-8"},J={class:"flex flex-col md:flex-row mb-6"},L={class:"flex-grow md:mr-3 md:mb-0 mb-3"},Q={class:"font-bold mb-0"},z={key:1,class:"text-red-base font-bold"},G={class:"block"};var H=S(N,[["render",function(e,a,t,o,l,r){const n=p("Button"),d=p("Breadcrumb"),i=p("Input"),s=p("TableColumn"),c=p("Currency"),m=p("Table"),u=p("Card"),C=p("RecordPaymentForm"),S=p("PaymentMethod"),R=p("Modal"),x=b("loading");return f(),y(I,null,[h(d,{class:"mt-2 mb-8",pageTitle:"Return Item",backTo:{name:"invoiceDetail"},items:e.breadcrumb},{right:v((()=>[e.isSelected?(f(),w(n,{key:0,color:"teal",onClick:a[0]||(a[0]=a=>e.openModal("create"))},{default:v((()=>a[5]||(a[5]=[j(" Process Return ")]))),_:1})):g("",!0)])),_:1},8,["items"]),h(u,null,{default:v((()=>[a[11]||(a[11]=P("p",{class:"font-bold mb-4"},"Select the items you would like to return:",-1)),P("div",q,[P("div",J,[P("div",L,[h(i,{modelValue:e.dataReturn.search,"onUpdate:modelValue":a[1]||(a[1]=a=>e.dataReturn.search=a),placeholder:"Search Everything",class:"w-full",onInput:e.search,icon:""},{icon:v((()=>a[6]||(a[6]=[P("span",{class:"material-icons"},"search",-1)]))),_:1},8,["modelValue","onInput"])])]),k((f(),w(m,{"row-key":e.rowKey,data:e.getAvailable,"tree-props":{children:"child"},onSelect:e.itemSelected,onSelectAll:e.itemSelected,"default-expand-all":""},{default:v((()=>[h(s,{type:"selection",selectable:e.isParent,width:"55"},null,8,["selectable"]),h(s,{prop:"id",label:"Item #",width:"150"},{default:v((e=>[!e.row.child||e.row.child&&0===e.row.child.length?(f(),y(I,{key:0},[j(_(e.row.id),1)],64)):g("",!0)])),_:1}),h(s,{prop:"product_name",label:"Item",width:"300"},{default:v((e=>[P("p",Q,_(e.row.product_name),1),!e.row.child||e.row.child&&0===e.row.child.length?(f(),y(I,{key:0},[e.row.detail?(f(),y(I,{key:0},[P("small",null,_(e.row.detail),1),a[7]||(a[7]=P("br",null,null,-1))],64)):g("",!0),P("small",null,[a[8]||(a[8]=j(" (")),null!==e.row.imei_sn?(f(),y(I,{key:0},[j(_(e.row.imei_sn),1)],64)):(f(),y("span",z,"IMEI/Serial Number not found")),a[9]||(a[9]=j(") "))]),P("div",G,[a[10]||(a[10]=P("p",{class:"font-bold mb-0"},"Notes",-1)),P("p",null,_(e.row.notes),1)])],64)):g("",!0)])),_:1}),h(s,{prop:"condition",label:"Condition",width:"200"}),h(s,{prop:"qty",label:"Qty",width:"200"}),h(s,{prop:"price",label:"Unit Price",width:"200"},{default:v((e=>[h(c,{value:e.row.price},null,8,["value"])])),_:1}),h(s,{prop:"total",label:"Total"},{default:v((e=>[h(c,{value:e.row.total},null,8,["value"])])),_:1})])),_:1},8,["row-key","data","onSelect","onSelectAll"])),[[x,e.loading.available]])])])),_:1}),h(R,{modelValue:e.modal.create,"onUpdate:modelValue":a[4]||(a[4]=a=>e.modal.create=a),title:"Record Payout"},{footer:v((()=>[h(n,{color:"teal",loading:e.loading.create,onClick:e.createReturn},{default:v((()=>a[12]||(a[12]=[j("Save Payout")]))),_:1},8,["loading","onClick"])])),default:v((()=>[h(S,{ref:"refPaymentMethod",data:e.data,"onUpdate:data":a[3]||(a[3]=a=>e.data=a),items:e.statePaymentMethod,"auto-select":""},{additional:v((()=>[h(C,{data:e.dataRecord,"onUpdate:data":a[2]||(a[2]=a=>e.dataRecord=a),"is-return":""},null,8,["data"])])),_:1},8,["data","items"])])),_:1},8,["modelValue"])],64)}]]),W=i({setup(){const{genSuspense:e}=d();return()=>e(H)}});export{W as default};
