import{u as e}from"./receipt.29e7bae5.js";import{r as a,b as t,e as s,d as i,t as o}from"./index.73ae30fa.js";import{C as l}from"./card.0f43ecfb.js";import{B as r}from"./Breadcrumb.8a4b1e47.js";import{L as d}from"./Loading.6620d96e.js";import{_ as n}from"./attention-warning.f7b3f9bc.js";import{_ as c}from"./error-circle.966becfe.js";import{u as p}from"./index.f40e4a9e.js";import{O as u,r as m,aP as f,g as v,aW as g,y as b,aq as y,m as _,o as x,t as $,D as h,w,B as k,ap as C,I as V,K as O,n as T,U as j,a1 as D,_ as M,ar as S}from"./vendor.9695fe57.js";import{T as R,c as L}from"./TextEditor.5cfed8cc.js";import{V as P}from"./vue3-pdf-app.umd.64ee9a39.js";const A={class:"flex"},E={class:"mr-2"},U=["onClick"],z={class:"flex"},N={class:"mr-2"},B=["onClick"],I={class:"text-center"},J={class:"flex items-center justify-center my-10"},W={class:"flex flex-col gap-6 items-center my-6"},Y={class:"flex flex-wrap items-center justify-center gap-14"},q={__name:"SettingReceiptForm",props:{buybackType:String},async setup(r,{expose:d}){let S,q;const F=r,K=e(),G=u(),H=m({initData:{},pendingNavigation:void 0,isModalOpen:{preview:!1,reset:!1,discard:!1},isDirty:!1}),Q={editor:L.exports.Editor,config:{htmlSupport:{allow:[{styles:!0,classes:!0}]}}},X={toolbar:{toolbarViewerRight:!1},secondaryToolbar:!1},Z=p({},K,{$lazy:!0}),ee=f("text-editor"),ae=f("text-editor-additional"),te=v((()=>({buyback_type:F.buybackType}))),se=()=>{H.pendingNavigation&&H.pendingNavigation(),H.isModalOpen.discard=!1},ie=()=>{H.isModalOpen.discard=!1},oe=e=>{navigator.clipboard.writeText(e).then((()=>{M({type:"success",message:"Text copied to clipboard"})}))},le=async()=>{await o(K.$state.reset,(()=>K.$reset({data:K.$state.form,params:te.value}).then((e=>{K.$state.form.receipt.textinfo=e.receipt.textinfo,H.isModalOpen.reset=!1,M({type:"success",message:"Receipt template has been reset"})}))))};return g(((e,a,t)=>{H.isDirty?(H.isModalOpen.discard=!0,H.pendingNavigation=()=>{H.isDirty=!1,t()}):t()})),b((()=>K.$state.form),(e=>{H.initData&&(H.isDirty=JSON.stringify(e)!==JSON.stringify(H.initData))}),{deep:!0}),d({state:H,onSubmit:async()=>{(async()=>{if(!ee.value.isEditorReady||!("1"!==K.$state.form.is_custom_addtional_provision||ae.value&&ae.value.isEditorReady))return!1;const e=[ee.value.forceSave()];return"1"===K.$state.form.is_custom_addtional_provision&&e.push(ae.value.forceSave()),!!(await Promise.all(e)).every((e=>e))&&(Z.value.$validate(),!Z.value.$invalid)})()&&await o(K.$state.update,(()=>K.$update({data:K.$state.form,params:te.value}).then((()=>{H.isDirty=!1,M({type:"success",message:"Receipt has been saved"}),G.push({name:"settingReceipt"})}))))},onPreview:async()=>{await o(K.$state.preview,(()=>K.$preview({data:K.$state.form,params:te.value}).then((()=>{H.isModalOpen.preview=!0}))))}}),[S,q]=y((()=>K.$get({params:te.value}))),await S,q(),K.$state.get.result&&(H.initData=a(K.$state.get.result),Object.assign(K.$state.form,a(K.$state.get.result))),(e,a)=>{const o=_("TableColumn"),r=_("Table");return x(),$(D,null,[h(l,{class:"my-6"},{header:w((()=>a[8]||(a[8]=[k("h5",null,"Receipt",-1)]))),default:w((()=>[h(R,{modelValue:C(K).$state.form.receipt.textinfo,"onUpdate:modelValue":a[1]||(a[1]=e=>C(K).$state.form.receipt.textinfo=e),options:Q,ref_key:"refTextEditor",ref:ee},{toolbar:w((()=>[h(t,{view:"smooth",color:"teal",class:"ml-auto",onClick:a[0]||(a[0]=e=>H.isModalOpen.reset=!0),dense:""},{default:w((()=>a[9]||(a[9]=[k("span",{class:"material-icons mr-1"},"refresh",-1),V(" Reset ")]))),_:1})])),_:1},8,["modelValue"]),h(r,{data:C(K).$state.form.receipt.sort_code,class:"mt-6"},{default:w((()=>[h(o,{label:"Code"},{default:w((e=>[k("div",A,[k("span",E,O(e.row.code),1),k("i",{class:"material-icons text-lg text-teal-04",onClick:a=>oe(e.row.code)}," content_copy ",8,U)])])),_:1}),h(o,{prop:"description",label:"Description"})])),_:1},8,["data"])])),_:1}),h(l,null,{header:w((()=>a[10]||(a[10]=[k("h5",null,"Additional Provisions",-1)]))),default:w((()=>[a[12]||(a[12]=k("p",{class:"mb-4"}," Incorporate additional provisions into your terms and conditions to ensure better compliance. ",-1)),h(s,{modelValue:C(K).$state.form.is_custom_addtional_provision,"onUpdate:modelValue":a[2]||(a[2]=e=>C(K).$state.form.is_custom_addtional_provision=e),color:"teal",value:"1","value-off":"0",class:"mb-6"},{default:w((()=>a[11]||(a[11]=[V(" Custom Additional Provisions ")]))),_:1},8,["modelValue"]),"1"===C(K).$state.form.is_custom_addtional_provision?(x(),T(R,{key:0,modelValue:C(K).$state.form.addtional_provision.textinfo,"onUpdate:modelValue":a[3]||(a[3]=e=>C(K).$state.form.addtional_provision.textinfo=e),options:Q,ref_key:"refTextEditorAdditional",ref:ae},null,8,["modelValue"])):j("",!0),h(r,{data:C(K).$state.form.addtional_provision.sort_code,class:"mt-6"},{default:w((()=>[h(o,{label:"Code"},{default:w((e=>[k("div",z,[k("span",N,O(e.row.code),1),k("i",{class:"material-icons text-lg text-teal-04",onClick:a=>oe(e.row.code)}," content_copy ",8,B)])])),_:1}),h(o,{prop:"description",label:"Description"})])),_:1},8,["data"])])),_:1}),h(i,{modelValue:H.isModalOpen.preview,"onUpdate:modelValue":a[4]||(a[4]=e=>H.isModalOpen.preview=e),title:"Preview Receipt",size:"lg",style:{"z-index":"1001"},"hide-footer":"","no-padding":""},{default:w((()=>[h(C(P),{pdf:C(K).$state.preview.result,config:X,style:{height:"60vh"},theme:"dark"},null,8,["pdf"])])),_:1},8,["modelValue"]),h(i,{modelValue:H.isModalOpen.reset,"onUpdate:modelValue":a[6]||(a[6]=e=>H.isModalOpen.reset=e),"hide-header":"","hide-footer":"",size:"xs",style:{"z-index":"1001"}},{default:w((()=>[k("div",I,[a[15]||(a[15]=k("img",{class:"w-32 mx-auto my-10",src:n,alt:"Warning icon"},null,-1)),a[16]||(a[16]=k("p",{class:"text-center my-10 text-grey-04"},[V(" All changes will be reset to original template. "),k("br"),V(" Are you sure to reset to default? ")],-1)),k("div",J,[h(t,{onClick:le,loading:C(K).$state.reset.isLoading,class:"mx-2",color:"orange",view:"outlined"},{default:w((()=>a[13]||(a[13]=[V(" Yes, Reset ")]))),_:1},8,["loading"]),h(t,{loading:C(K).$state.reset.isLoading,class:"mx-2",color:"teal",onClick:a[5]||(a[5]=e=>H.isModalOpen.reset=!1)},{default:w((()=>a[14]||(a[14]=[V(" Cancel ")]))),_:1},8,["loading"])])])])),_:1},8,["modelValue"]),h(i,{modelValue:H.isModalOpen.discard,"onUpdate:modelValue":a[7]||(a[7]=e=>H.isModalOpen.discard=e),"hide-header":"","hide-footer":"",size:"xs"},{default:w((()=>[k("div",W,[a[19]||(a[19]=k("img",{src:c},null,-1)),a[20]||(a[20]=k("h6",{class:"text-3xl font-medium"},"Discard Changes?",-1)),a[21]||(a[21]=k("p",{class:"text-grey-02 text-center"},[V(" You have made changes that haven't been saved yet. "),k("br"),V(" Are you sure to discard changes? ")],-1)),k("div",Y,[h(t,{color:"red",onClick:se},{default:w((()=>a[17]||(a[17]=[V("Discard Changes")]))),_:1}),h(t,{color:"teal",view:"smooth",onClick:ie},{default:w((()=>a[18]||(a[18]=[V("Continue Editing")]))),_:1})])])])),_:1},8,["modelValue"])],64)}}},F={class:"flex justify-between items-center mt-2 mb-8"},K={class:"flex gap-4"},G={__name:"SettingReceiptView",props:{title:String,backTo:Object,buybackType:String,breadcrumb:{type:Array,default:()=>[]}},setup(a){const s=e(),i=f("form"),o=v((()=>!!i.state&&!i.state.isDirty||s.$state.preview.isLoading)),n=()=>{i.value.onPreview()},c=()=>{i.value.onSubmit()};return(e,a)=>(x(),$("div",null,[k("div",F,[h(r,{pageTitle:e.$props.title,backTo:e.$props.backTo,items:e.$props.breadcrumb,class:"w-full"},{right:w((()=>[k("div",K,[h(C(t),{loading:C(s).$state.preview.isLoading,disabled:C(s).$state.update.isLoading,color:"teal",view:"outlined",onClick:n},{default:w((()=>a[0]||(a[0]=[k("i",{class:"material-icons"},"visibility",-1),V(" Preview ")]))),_:1},8,["loading","disabled"]),h(C(t),{color:"teal",loading:C(s).$state.update.isLoading,disabled:o.value,onClick:c},{default:w((()=>a[1]||(a[1]=[V(" Save Changes ")]))),_:1},8,["loading","disabled"])])])),_:1},8,["pageTitle","backTo","items"])]),(x(),T(S,null,{fallback:w((()=>[h(C(l),null,{default:w((()=>[h(d)])),_:1})])),default:w((()=>[h(q,{"buyback-type":e.$props.buybackType,ref:"form"},null,8,["buyback-type"])])),_:1}))]))}};export{G as _};
