var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,n=(a,l,i)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:i}):a[l]=i,o=(e,a)=>{for(var l in a||(a={}))s.call(a,l)&&n(e,l,a[l]);if(i)for(var l of i(a))t.call(a,l)&&n(e,l,a[l]);return e};import{u as r}from"./components.bc8fc588.js";import{u as d}from"./ghl.7c4248f7.js";import{k as u,a5 as c,O as p,f as m,g as v,m as b,o as f,t as g,a2 as y,B as h,I as x,F as _,U as w,S as A,D as k,w as C,K as S,a3 as j,Q as q,T as P,aG as V,r as O,x as I}from"./vendor.f1efedad.js";import{b as $,f as U,S as L,_ as G,d as H}from"./index.161fb295.js";import{u as B}from"./index.32689823.js";import{r as D}from"./index.a87b789d.js";import{C as z}from"./CollapsibleCard.374b9a03.js";import"./LoadingCard.105ff0f2.js";import"./card.6a96327d.js";import"./index.05b14cb2.js";const F=u({components:{Button:$,Input:U,Select:L,CollapsibleCard:z},async setup(e){var i,s,t,n,r;const u=c(),b=p(),f=m(!1),g=v((()=>{var e;return!!(null==(e=w.value)?void 0:e.is_ready)})),{tutorials:y,subAccounts:h,pipelines:x,claimed:_,status:w,query:A,form:k,code:C,loading:S,setSubAccounts:j,setPipelines:q,setClaims:P,updateGHL:V,init:O}=d(),I=B({subAccount:{required:D},pipeline:{required:D}},k,{$lazy:!0}),$=async e=>{k.subAccount=o({},e),await q({location_id:e._id})},U=e=>{var i,s,t,n,r;k.pipeline=(n=o({},e),r={pipeline_id:1===(null==(i=e.stages)?void 0:i.length)&&(null==(t=null==(s=[...e.stages])?void 0:s.shift())?void 0:t.id)},a(n,l(r)))},L=async e=>{await P(e),(null==_?void 0:_.value)&&await O(),S.subAccount=!0,g.value&&await j()};if(await O(),(null==(i=null==u?void 0:u.query)?void 0:i.code)&&!g.value)await L((null==(s=null==u?void 0:u.query)?void 0:s.code)||(null==(t=w.value)?void 0:t.code));else if(g.value&&((null==(n=null==u?void 0:u.query)?void 0:n.code)&&b.replace({query:""}),await j(),null==(r=w.value)?void 0:r.location_id)){const e=!!Array.isArray(h.value)&&[...h.value].find((e=>e._id==w.value.location_id));e&&await $(e);const a=!!Array.isArray(x.value)&&[...x.value].find((e=>e.id==w.value.pipeline_id));a&&U(a)}return{handleChangeSub:$,handleChangePipe:U,handleClaims:L,saveChanges:async(e=(()=>{}))=>{var a,l;return await I.value.$validate()?await V((null==(a=k.pipeline)?void 0:a.id)||(null==(l=k.pipeline)?void 0:l.pipeline_id)||k.pipeline).then((()=>{e("success")})).catch((()=>e("failed"))):e("failed")},closePanel:()=>{b.push({name:"integration",query:{reload:1}})},validation:I,isCollapse:f,subAccounts:h,isInstalled:g,pipelines:x,tutorials:y,claimed:_,loading:S,status:w,query:A,form:k,code:C,init:O}}}),M={class:"space-y-8 text-base"},T={key:0,class:"flex bg-blue-lighten text-blue-04 gap-4 px-4 py-3 rounded-lg mb-4"},E=["href"],K={class:"px-4 py-4 w-full"},Q={key:0,class:"material-icons text-lg text-teal-04"},W={class:"px-4 py-4 w-full"},J={key:0,class:"material-icons text-lg text-teal-04"},N={class:"space-y-2"},R=["onClick"],X={class:"flex items-center justify-between"},Y={class:"font-semibold"},Z={key:0,class:"px-8 py-6 space-y-4"},ee={class:"space-y-4"},ae={class:"flex items-start xl:gap-x-4 gap-x-2"},le={class:"list-number"},ie=["src","alt"];var se=G(F,[["render",function(e,a,l,i,s,t){var n;const o=b("Input"),r=b("Select");return f(),g("div",M,[e.isInstalled?w("",!0):(f(),g(y,{key:0},[a[7]||(a[7]=h("p",null,"Use the button below to get started",-1)),h("a",{href:"https://app.gohighlevel.com/integration/6613db15527f84167dd61db5",class:_(["bg-teal-04","text-white px-6","py-2 inline-flex","items-center justify-center","hover:opacity-90 rounded-lg"]),target:"_blank",onClick:a[0]||(a[0]=(...a)=>e.closePanel&&e.closePanel(...a))},a[6]||(a[6]=[x(" Go to GHL App Marketplace "),h("i",{class:"material-icons icon-xs"},"launch",-1)]))],64)),e.isInstalled?(f(),g("form",{key:1,class:"space-y-6",onSubmit:a[5]||(a[5]=A(((...a)=>e.saveChanges&&e.saveChanges(...a)),["prevent"]))},[h("div",null,[e.status.location_id?(f(),g("div",T,[a[10]||(a[10]=h("div",null,[h("i",{class:"material-icons"},"info")],-1)),h("div",null,[h("p",null,[a[8]||(a[8]=x(" Make sure to check the 'Allow Duplicate Opportunity' option under your ")),h("a",{class:"text-blue-04 hover:text-blue-03 font-semibold",href:`https://app.gohighlevel.com/v2/location/${e.status.location_id}/settings/company`,rel:"noreferrer noopener"},"Business Profile Settings",8,E),a[9]||(a[9]=x(" to ensure Opportunities from existing customers appear in GHL "))])])])):w("",!0),a[12]||(a[12]=h("label",null,"Sub Account",-1)),k(r,{modelValue:e.form.subAccount._id,"onUpdate:modelValue":a[2]||(a[2]=a=>e.form.subAccount._id=a),placeholder:"Select Sub-Account",by:"_id",name:"name",error:e.validation.subAccount.$invalid,items:e.subAccounts,loading:e.loading.subAccount||e.loading.update,disabled:e.loading.default||e.loading.subAccount,"max-height":"200px",block:"","no-border":"",onChange:e.handleChangeSub},{prepend:C((()=>[h("div",K,[k(o,{modelValue:e.query.searchSub,"onUpdate:modelValue":a[1]||(a[1]=a=>e.query.searchSub=a),placeholder:"Search Sub-Account",class:"w-full",block:"",icon:""},{icon:C((()=>a[11]||(a[11]=[h("span",{class:"material-icons"},"search",-1)]))),_:1},8,["modelValue"])])])),item:C((({item:a})=>[h("div",{class:_([a._id===e.form.subAccount._id?"text-teal-04":"","flex gap-x-2 items-center"])},[x(S(a.name)+" ",1),a._id===e.form.subAccount._id?(f(),g("span",Q," check_circle ")):w("",!0)],2)])),_:1},8,["modelValue","error","items","loading","disabled","onChange"]),(f(!0),g(y,null,j(e.validation.subAccount.$errors,((e,a)=>(f(),g("small",{class:"text-red-base block mb-4",key:a},S(e.$message)+". ",1)))),128))]),h("div",null,[a[14]||(a[14]=h("label",null,"Pipeline",-1)),k(r,{modelValue:e.form.pipeline.id,"onUpdate:modelValue":a[4]||(a[4]=a=>e.form.pipeline.id=a),placeholder:"Select Pipeline",by:"id",name:"name",error:e.validation.pipeline.$invalid,items:e.pipelines,loading:e.loading.pipeline||e.loading.update,disabled:!(null==(n=e.form.subAccount)?void 0:n._id)||e.loading.default||e.loading.pipeline||e.loading.subAccount,"max-height":"200px",block:"","no-border":"",onChange:e.handleChangePipe},{prepend:C((()=>[h("div",W,[k(o,{modelValue:e.query.searchPipe,"onUpdate:modelValue":a[3]||(a[3]=a=>e.query.searchPipe=a),placeholder:"Search Pipeline",class:"w-full",block:"",icon:""},{icon:C((()=>a[13]||(a[13]=[h("span",{class:"material-icons"},"search",-1)]))),_:1},8,["modelValue"])])])),item:C((({item:a})=>[h("div",{class:_([a.id===e.form.pipeline.id?"text-teal-04":"","flex gap-x-2 items-center"])},[x(S(a.name)+" ",1),a.id===e.form.pipeline.id?(f(),g("span",J," check_circle ")):w("",!0)],2)])),_:1},8,["modelValue","error","items","loading","disabled","onChange"]),(f(!0),g(y,null,j(e.validation.pipeline.$errors,((e,a)=>(f(),g("small",{class:"text-red-base block mb-4",key:a},S(e.$message)+". ",1)))),128))])],32)):w("",!0),h("div",N,[a[15]||(a[15]=h("p",null," Alternatively, you can refer to the detailed installation instructions below. ",-1)),(f(!0),g(y,null,j(e.tutorials,(e=>(f(),g("div",{key:e.title,class:"border border-grey-01 rounded-xl bg-grey-01 bg-opacity-30"},[h("div",{class:"px-8 py-6 cursor-pointer",onClick:a=>e.is_collapsed=!e.is_collapsed},[h("div",X,[h("span",Y,S(e.title),1),h("i",{class:_(["material-icons icon-xs","transform transition-all","ease-in-out duration-300",e.is_collapsed&&"rotate-180",!e.is_collapsed&&"rotate-0"])}," expand_more ",2)])],8,R),k(P,{name:"slide-fade"},{default:C((()=>[e.is_collapsed?(f(),g("div",Z,[h("ul",ee,[(f(!0),g(y,null,j(e.steps,((e,a)=>(f(),g("li",{key:a},[h("div",ae,[h("div",le,S(a+1),1),h("div",{class:_(["mt-1 flex-1",e.image&&"space-y-2"])},[h("p",null,S(e.text),1),e.image?(f(),g("img",{key:0,src:e.image,alt:`tutorial-step-${a+1}`,style:q({maxWidth:e.width,width:"100%"}),class:"w-100"},null,12,ie)):w("",!0)],2)])])))),128))])])):w("",!0)])),_:2},1024)])))),128))])])}],["__scopeId","data-v-466ca841"]]),te=u({async setup(e,a){const{genSuspense:l}=r(),i=m(null),s=c(),t=p(),n=m(!0),o=m({default:!1,subAccount:!1,pipeline:!1,update:!1}),{isUninstalled:u,setUninstall:v}=d(),b=async()=>{const e=a.attrs.integrations.find((e=>"ghl"===e.name.toLowerCase()));o.value.update=!0,await i.value.saveChanges((async a=>{"success"===a?(0==e.is_enable&&(e.is_enable=1),o.value.update=!1,t.push({name:"integration",query:{reload:1}})):o.value.update=!1}))};V((()=>{u.value&&(v(!1),t.push({name:"integration",query:{reload:1}})),i.value&&void 0!==i.value.isInstalled&&(n.value=!i.value.isInstalled),i.value&&void 0!==i.value.loading&&(o.value=i.value.loading)}));const f=O({modelValue:!0,closeTo:{name:"integration",query:{reload:1}},size:"xs",title:"HighLevel Config",hideFooter:n}),g=O({default:()=>{return l(I(se,{ref:i,status:(null==(e=null==a?void 0:a.attrs)?void 0:e.integrations)?[...a.attrs.integrations].find((e=>e.id===s.query.id||"ghl"===e.name.toLowerCase())):void 0}));var e},footer:()=>{return I($,{color:"teal",disabled:o.value.subAccount||o.value.pipeline&&(!(null==(a=null==(e=null==i?void 0:i.value)?void 0:e.form)?void 0:a.pipeline)||!(null==(s=null==(l=null==i?void 0:i.value)?void 0:l.form)?void 0:s.subAccount)),loading:o.value.default||o.value.update,onClick:b},{default:()=>"Save"});var e,a,l,s}});return()=>I(H,f,g)}});export{te as default};
