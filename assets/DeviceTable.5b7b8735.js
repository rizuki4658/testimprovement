var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,s=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,o=(e,a)=>{for(var l in a||(a={}))i.call(a,l)&&s(e,l,a[l]);if(t)for(var l of t(a))n.call(a,l)&&s(e,l,a[l]);return e},r=(e,t)=>a(e,l(t));import{k as d,f as c,a5 as u,O as p,r as m,g as b,y as f,s as g,m as h,$ as y,o as v,t as _,A as w,n as k,w as x,D as C,U as A,B as T,K as j,I as S,T as B,L as I,S as P,a1 as V,aY as O}from"./vendor.9695fe57.js";import{e as $,i as D,d as E,b as U,u as M,_ as R,ad as z}from"./index.9c4dcead.js";import{p as N}from"./setting.ec7e7a35.js";import{_ as F}from"./catalog-not-found.379a4c88.js";const L=d({name:"DeviceTable",components:{Checkbox:$,Loading:D,Modal:E,Button:U},props:{data:Array,category:{type:Object,default:{name:null,is_enable:0,is_mac:0}},disabled:{type:Boolean,default:!1}},emits:["update-buyback","update-all","update-buyback-category"],setup(e,{emit:a}){const l=c(!0),t=u(),i=p(),{me:n}=M(),{actionUpdateBuybackType:s,actionGetChildren:d}=N(),h=c(0),y=m({buybackType:{update:new Map}}),v=m({name:e.category.name,is_enable:e.category.is_enable,is_mac:e.category.is_mac}),_=c(!1);c(0);const w=c(e.data.map((e=>r(o({},e),{child:e.child.map((a=>r(o({},a),{is_child:!0,manufacturer:e.manufacturer})))})))||[]),k=c(!1),x=c(null),C="buyback-setup-warning",A=b((()=>V(w.value))),T=b((()=>{const e=t.params.brand.split("");return e[0]=e[0].toUpperCase(),e.join("")})),j=()=>"1"!==sessionStorage.getItem(C),S=e=>{var l,t;e.is_loading=!0,e.instore=e.is_enable,e.mailin=e.is_enable;const i=null!=(t=null==(l=e.parent)?void 0:l.total_active)?t:e.total_active;a("update-buyback",r(o(o({},e),!v.is_mac&&{total_active:i.total_active}),{is_mac:v.is_mac}),(a=>{if(200!=a.status_code)return e.is_enable=1==e.is_enable?0:1,e.instore=e.is_enable,e.mailin=e.is_enable,void(e.is_loading=!1);e.child.length>0&&B(e.child,"all",e.is_enable);const l=A.value.get(e.id);l&&l.parents&&P(l.parents),e.total_active&&(e.total_active=a.data.total_active_category),e.is_loading=!1}))},B=(e,a="all",l)=>{if(e)for(let t of e){"all"===a?(t.is_enable=l,t.instore=l,t.mailin=l):t[a]=l;const e=0===t.instore&&0===t.mailin;t.is_enable=e?0:1;t.child.length>0&&B(t.child,a,l)}},I=(e,a)=>{for(let l of e){if(l.child.length>0){const{buybackType:e,enableStatus:t}=l.child.reduce(((e,l)=>(0===l[a]&&(e.buybackType.isCheckAll=!1),1===l[a]&&(e.buybackType.isUncheckAll=!1),(e.buybackType.isCheckAll||e.buybackType.isUncheckAll)&&2!==l[a]||(e.buybackType.isIndeterminate=!0),0===l.is_enable&&(e.enableStatus.isEnableAll=!1),1===l.is_enable&&(e.enableStatus.isDisableAll=!1),e)),{buybackType:{isCheckAll:!0,isUncheckAll:!0,isIndeterminate:!1},enableStatus:{isEnableAll:!0,isDisableAll:!0}});e.isCheckAll&&(l[a]=1),e.isUncheckAll&&(l[a]=0),e.isIndeterminate&&(l[a]=2),t.isEnableAll&&(l.is_enable=1),t.isDisableAll&&(l.is_enable=0)}}},P=e=>{for(let a of e){if(a.child.length>0){const{status:e}=a.child.reduce(((e,a)=>(0===a.is_enable&&(e.status.enableAll=!1),1===a.is_enable&&(e.status.disableAll=!1),e)),{status:{enableAll:!0,disableAll:!0}});!e.enableAll&&e.disableAll||(a.is_enable=1,a.instore=1,a.mailin=1),e.disableAll&&(a.is_enable=0,a.instore=0,a.mailin=0)}}},V=(e=[],a=new Map,l=[])=>{var t;if((null==e?void 0:e.length)>0)for(let i of e){a.set(i.id,r(o({},i),{parents:l}));(null==(t=null==i?void 0:i.child)?void 0:t.length)>0&&V(i.child,a,[i,...l])}return a};function $(e,a,l){return e.map((e=>{var t;const i=(e=>{var a,l,t,i;return r(o({},e),{has_condition:null!=(l=null!=(a=e.has_condition)?a:e.have_condition)?l:0,has_price:null!=(i=null!=(t=e.has_price)?t:e.have_price)?i:0})})(e),n=Array.isArray(i.child)&&i.child.length>0;return r(o({},i),{has_child:n?1:0,is_child:!0,parent:a,manufacturer:null!=(t=null==e?void 0:e.manufacturer)?t:l,rawChild:n?O(e.child):[],_lazyFetched:!1,child:[]})}))}return f((()=>e.data),(()=>{w.value=e.data.map((e=>r(o({},e),{child:e.child.map((a=>r(o({},a),{is_child:!0,manufacturer:e.manufacturer})))})))}),{deep:!0}),f((()=>({category:e.category})),(e=>{Object.assign(v,e.category)})),f((()=>({name:v.name,param:T.value})),(()=>{l.value=!1,setTimeout((()=>{l.value=!0}),300)})),{category:v,data:w,flattenData:A,route:t,me:n,loading:y,loadingCategory:_,updateBuybackDevice:S,updateBuybackDeviceByCategory:async()=>{_.value=!0,a("update-buyback-category",v,(async e=>{e&&(v.is_enable=1==v.is_enable?0:1),await g((()=>{w.value=[],_.value=!1}))}))},updateBuybackType:async(e,a,l)=>{if(!["instore","mailin"].includes(l))return;const{id:i}=e,n={type:null,category_id:null,category:z(t.params.category),value:null};"instore"===l?(n.type="instore",n.category_id=i,n.value=a):(n.type="mailin",n.category_id=i,n.value=a);const r=o({},e);e[l]=2==e[l]&&1==a?1:a;0===e.instore&&0===e.mailin&&(e.is_enable=0);e.child.length>0&&B(e.child,l,a);const d=A.value.get(i);d&&d.parents&&I(d.parents,l);try{y.buybackType.update.set(i,!0),await s(n)}catch(c){Object.assign(e,r);e.child.length>0&&B(e.child,l,1==a?0:1);const t=A.value.get(i);t&&t.parents&&I(t.parents,l)}finally{y.buybackType.update.delete(i)}},paramsBrand:T,showPricing:(e,a)=>{i.push({path:`/setting/bulk-price-editor/${t.params.category}/${"all"===t.params.brand?e.manufacturer:t.params.brand}`,query:o({ref:!0},2===a&&{model:e.name})})},modal:k,dontShow:h,selectedRow:x,closeModal:()=>{1===h.value&&sessionStorage.setItem(C,"1"),k.value=!1},shouldShowModal:j,findParentName:e=>{if(null==e?void 0:e.parent_id){const a=w.value.find((a=>a.id===(null==e?void 0:e.parent_id)));return a?null==a?void 0:a.name:null==e?void 0:e.name}return null==e?void 0:e.name},toggleEnable:e=>{1===e.is_enable?1===e.has_condition&&1===e.has_price?S(e):(S(e),x.value=e,j()&&(k.value=!0)):S(e)},onExpandChange:async(e,a,l=(e=>e))=>{var i,n;if(e.is_loading=!0,!e._lazyFetched&&(null==(i=e.rawChild)?void 0:i.length))return e.child=$(e.rawChild,e,e.manufacturer),e._lazyFetched=!0,e.is_loading=!1,void l(e.child);let s=[];await d({id:e.id,data:{categories:null==(n=t.params)?void 0:n.category}},(a=>{s=$(JSON.parse(JSON.stringify(null!=a?a:[])),e,e.manufacturer)})),l(s);const c=w.value.findIndex((a=>a.id===e.id));if(-1!==c){const e=w.value[c];w.value[c]=r(o({},e),{is_loading:!1,child:s})}},showTable:l}}}),J={class:"flex items-center gap-2"},Y={class:"w-80 leading-6"},q={key:0},G={key:1},H={class:"flex flex-wrap items-center py-2"},K={class:"flex flex-wrap items-center mr-4"},Q={class:"flex flex-wrap items-center"},W={class:"relative ml-6"},X={key:0,class:"flex flex-row items-center justify-center ml-auto md:mr-20 lg:opacity-0 group-hover:opacity-100 transition-opacity"},Z=["href","disabled","onClick"],ee=["href","disabled","onClick"],ae={key:1,class:"w-full bg-teal-01 bg-opacity-10",style:{height:"540px"}},le={key:0,class:"flex flex-col items-center"},te={class:"flex flex-col gap-6"},ie={class:"flex items-center gap-4"},ne={class:"text-teal-03"},se=["href"],oe={class:"flex items-center gap-4"},re={class:"text-teal-03"},de=["href"],ce=["href"],ue={class:"flex justify-between items-center"};var pe=R(L,[["render",function(e,a,l,t,i,n){const s=h("TableColumn"),o=h("Checkbox"),r=h("Tooltip"),d=h("Loading"),c=h("Table"),u=h("Button"),p=h("Modal"),m=y("loading");return v(),_(V,null,[e.showTable?w((v(),k(c,{key:0,data:e.data,"row-class-name":e.disabled?"global-disabled-row-table":"",load:e.onExpandChange,"tree-props":!e.disabled&&{children:"child",hasChildren:"has_child"},"row-key":"id",lazy:""},{default:x((()=>[C(s,{width:"50"}),C(s,{width:"100",prop:"is_enable"},{header:x((()=>[e.category?(v(),k(o,{key:0,modelValue:e.category.is_enable,"onUpdate:modelValue":a[0]||(a[0]=a=>e.category.is_enable=a),type:"toggle",value:1,"value-off":0,disabled:e.disabled,loading:e.loadingCategory,onInput:a[1]||(a[1]=a=>e.updateBuybackDeviceByCategory())},null,8,["modelValue","disabled","loading"])):A("",!0)])),default:x((a=>[C(o,{modelValue:a.row.is_enable,"onUpdate:modelValue":e=>a.row.is_enable=e,class:"py-3",type:"toggle",value:1,"value-off":0,disabled:e.disabled,loading:a.row.is_loading,onInput:l=>e.toggleEnable(a.row)},null,8,["modelValue","onUpdate:modelValue","disabled","loading","onInput"])])),_:1}),"all"===e.route.params.brand?(v(),k(s,{key:0,label:"Brand"},{default:x((e=>[T("div",J,[T("span",null,j(e.row.manufacturer),1),0===e.row.has_condition||0===e.row.has_price?(v(),k(r,{key:0,placement:"top"},{default:x((()=>a[6]||(a[6]=[T("i",{class:"material-icons text-orange-04"},"warning",-1)]))),content:x((()=>[T("div",Y,[0===e.row.has_condition&&0===e.row.has_price||0===e.row.has_condition&&1===e.row.has_price?(v(),_("p",q,' To start buying this item, switch the "Activate" toggle to on, then configure its conditions and pricing. ')):(v(),_("p",G,"To start buying this item, you must configure its pricing."))])])),_:2},1024)):A("",!0)])])),_:1})):A("",!0),C(s,{prop:"name",label:"Model"},{default:x((e=>{var a,l;return[S(j(null!=(l=null==(a=e.row)?void 0:a.name)?l:"-"),1)]})),_:1}),C(s,{label:"Purchasing Type","min-width":300},{default:x((({row:l})=>[T("div",H,[T("div",K,[C(o,{modelValue:2==l.instore?0:l.instore,indeterminate:2==l.instore,value:1,"value-off":0,disabled:!l.is_enable||e.disabled||l.is_loading,onInput:a=>e.updateBuybackType(l,a,"instore")},{default:x((()=>a[7]||(a[7]=[T("span",{class:"ml-1 font-normal"},"In-Store",-1)]))),_:2},1032,["modelValue","indeterminate","disabled","onInput"])]),T("div",Q,[C(o,{modelValue:2==l.mailin?0:l.mailin,indeterminate:2==l.mailin,value:1,"value-off":0,disabled:!l.is_enable||e.disabled||l.is_loading,onInput:a=>e.updateBuybackType(l,a,"mailin")},{default:x((()=>a[8]||(a[8]=[T("span",{class:"ml-1 font-normal"},"Mail-in",-1)]))),_:2},1032,["modelValue","indeterminate","disabled","onInput"]),T("div",W,[C(B,{name:"fade"},{default:x((()=>[w(C(d,null,null,512),[[I,e.loading.buybackType.update.get(l.id)]])])),_:2},1024)])]),l.is_enable?(v(),_("div",X,[l.has_child?(v(),_("a",{key:1,href:`/setting/bulk-price-editor/${e.route.params.category}/${"all"===e.route.params.brand?l.manufacturer:e.paramsBrand}?ref=true&model=${l.name}`,disabled:l.is_loading,class:"btn btn-teal btn-dense btn-filled",onClick:P((a=>e.showPricing(l,2)),["prevent"])},a[10]||(a[10]=[T("div",{class:"flex items-center justify-center"},[T("i",{class:"material-icons text-lg"},"attach_money"),S(" Pricing Editor ")],-1)]),8,ee)):(v(),_("a",{key:0,href:`/setting/bulk-price-editor/${e.route.params.category}/${"all"===e.route.params.brand?l.manufacturer:e.paramsBrand}?ref=true`,disabled:l.is_loading,class:"btn btn-teal btn-dense btn-filled",onClick:P((a=>e.showPricing(l,1)),["prevent"])},a[9]||(a[9]=[T("div",{class:"flex items-center justify-center"},[T("i",{class:"material-icons text-lg"},"attach_money"),S(" Pricing Editor ")],-1)]),8,Z))])):A("",!0)])])),_:1})])),_:1},8,["data","row-class-name","load","tree-props"])),[[m,e.loadingCategory]]):(v(),_("div",ae)),C(p,{size:"sm",modelValue:e.modal,"onUpdate:modelValue":a[5]||(a[5]=a=>e.modal=a)},{header:x((()=>a[11]||(a[11]=[S(" Important Information ")]))),default:x((()=>{var l,t,i,n;return[e.selectedRow?(v(),_("div",le,[a[16]||(a[16]=T("div",{class:"flex justify-center items-center p-8 rounded-full bg-teal-lighten"},[T("img",{src:F,alt:""})],-1)),a[17]||(a[17]=T("p",{class:"text-center mt-8"},"Your item has been enabled in your catalog, but you still need to complete the following steps",-1)),a[18]||(a[18]=T("p",{class:"text-center my-6"},"Here are your next steps:",-1)),T("div",te,[T("div",ie,[a[13]||(a[13]=T("div",{class:"flex items-center justify-center bg-teal-02 rounded-full text-white font-semibold w-8 h-8"},"1",-1)),T("p",ne,[a[12]||(a[12]=S("Set item conditions as needed within the ")),T("a",{class:"underline text-black",href:`/setting/product-conditions/create?model=${e.findParentName(e.selectedRow)}&ref=true`},"Conditions Settings",8,se)])]),T("div",oe,[a[15]||(a[15]=T("div",{class:"flex items-center justify-center bg-teal-02 rounded-full text-white font-semibold w-8 h-8"},"2",-1)),T("p",re,[a[14]||(a[14]=S(" Set item prices as needed within the ")),(null==(l=e.selectedRow)?void 0:l.is_child)?(v(),_("a",{key:1,class:"underline text-black",href:`/setting/bulk-price-editor/${e.route.params.category}/${"all"===e.route.params.brand?null==(i=e.selectedRow)?void 0:i.manufacturer:e.paramsBrand}?ref=true&model=${null==(n=e.selectedRow)?void 0:n.name}`,onClick:a[3]||(a[3]=P((a=>e.showPricing(e.selectedRow,2)),["prevent"]))}," Price Editor Settings ",8,ce)):(v(),_("a",{key:0,class:"underline text-black",href:`/setting/bulk-price-editor/${e.route.params.category}/${"all"===e.route.params.brand?null==(t=e.selectedRow)?void 0:t.manufacturer:e.paramsBrand}?ref=true`,onClick:a[2]||(a[2]=P((a=>e.showPricing(e.selectedRow,1)),["prevent"]))}," Price Editor Settings ",8,de))])])])])):A("",!0)]})),footer:x((()=>[T("div",ue,[T("div",null,[C(o,{modelValue:e.dontShow,"onUpdate:modelValue":a[4]||(a[4]=a=>e.dontShow=a),value:1,"value-off":0,class:"font-normal"},{default:x((()=>a[19]||(a[19]=[S(" Don't show this again for this session ")]))),_:1},8,["modelValue"])]),C(u,{color:"teal",view:"smooth",onClick:e.closeModal},{default:x((()=>a[20]||(a[20]=[T("i",{class:"material-icons mr-2"},"close",-1),S("Close Notification")]))),_:1},8,["onClick"])])])),_:1},8,["modelValue"])],64)}]]);export{pe as D};
