{"version":3,"file":"OnboardingReferralCode.d8db6980.js","sources":["../../src/store/pinia/onboarding.js","../../src/components/Features/Onboarding/OnboardingReferralCode.vue"],"sourcesContent":["import { defineStore } from 'pinia'\nimport request from 'utils/request'\n\nexport const useOnboarding = defineStore('onboarding', {\n  state: () => ({\n    referralCode: {\n      modal: false,\n      isError: false,\n      isLoading: false,\n      result: undefined\n    }\n  }),\n  getters: {},\n  actions: {\n    async $applyReferralCode(payload = { referral_code: undefined }) {\n      const response = await request({\n        url: `/v1/pos/billing/apply-referral`,\n        method: 'post',\n        data: payload\n      })\n      this.referralCode.result = response\n    }\n  }\n})\n","<script setup>\nimport { defineEmits, ref } from 'vue'\nimport { useOnboarding } from 'store/pinia/onboarding'\nimport { tryCatchRequest } from '@/utils/request'\n\nimport Modal from 'bbUi/components/modal/modal.vue'\nimport Input from 'bbUi/components/input/input.vue'\nimport Button from 'bbUi/components/button/button.vue'\n\nconst emits = defineEmits([\n  'skip',\n  'applied'\n])\n\nconst store = useOnboarding()\nconst confirmation = ref(false)\nconst referralCode = ref(null)\nconst applied = ref(false)\n\nconst onClose = () => {\n  store.referralCode.modal = false\n  confirmation.value = false\n  referralCode.value = null\n}\nconst onSkip = () => {\n  emits('skip')\n  onClose()\n}\nconst onApplyCode = () => {\n  confirmation.value = true\n}\nconst onCancel = () => {\n  confirmation.value = false\n}\nconst onConfirm = async () => {\n  await tryCatchRequest(\n    store.referralCode,\n    () => store.$applyReferralCode({\n      referral_code: referralCode.value\n    }).then(() => {\n      applied.value = true\n      store.referralCode.isError = false\n      emits('applied')\n    }).catch(() => {\n      applied.value = false\n      confirmation.value = false\n      store.referralCode.isError = true\n    })\n  )\n}\n\nconst onContinue = () => {\n  onSkip()\n}\nconst onInput = () => {\n  if (store.referralCode.isError) store.referralCode.isError = false\n}\n</script>\n<template>\n  <div>\n    <Teleport to=\"body\">\n      <Modal\n        v-model=\"store.referralCode.modal\"\n        size=\"xs\"\n        :hide-header=\"confirmation\"\n        :hide-footer=\"confirmation\"\n        @close=\"onClose\">\n        <template #header>\n          <span>Have a referral code?</span>\n        </template>\n        <template #default>\n          <div v-if=\"!confirmation\">\n            <Input\n              v-model=\"referralCode\"\n              :view=\"store.referralCode.isError ? 'danger' : 'default'\"\n              :disabled=\"store.referralCode.isLoading\"\n              placeholder=\"Enter referral code\"\n              block\n              @input=\"onInput\">\n              <template #label>\n                <span class=\"font-medium\">\n                  Referral Code\n                </span>\n              </template>\n            </Input>\n            <small\n              v-if=\"store.referralCode.isError\"\n              class=\"text-red-04\">\n              The referral code you entered is invalid\n            </small>\n          </div>\n          <div\n            v-else-if=\"!applied && confirmation\"\n            class=\"flex flex-col justify-center items-center gap-8 py-10\">\n            <img\n              src=\"@/assets/icon/warning.svg\"\n              alt=\"Warning icon\"\n              height=\"10\"\n              width=\"10\"\n              class=\"w-40\"\n            />\n            <div class=\"space-y-2 text-center\">\n              <h5 class=\"font-medium text-2xl\">Apply referral code</h5>\n              <p class=\"text-sm text-grey-03\">Only one referral source can be used per subscription.</p>\n            </div>\n            <div class=\"flex justify-center items-center gap-x-4\">\n              <Button\n                :disabled=\"store.referralCode.isLoading\"\n                color=\"white\"\n                view=\"outlined\"\n                @click=\"onCancel\">\n                Cancel\n              </Button>\n              <Button\n                :disabled=\"store.referralCode.isLoading\"\n                :loading=\"store.referralCode.isLoading\"\n                color=\"teal\"\n                @click=\"onConfirm\">\n                Yes, Apply\n              </Button>\n            </div>\n          </div>\n          <div\n            v-else-if=\"applied && confirmation\"\n            class=\"flex flex-col justify-center items-center gap-8 py-10\">\n            <img\n              src=\"@/assets/icon/success.svg\"\n              alt=\"Warning icon\"\n              height=\"10\"\n              width=\"10\"\n              class=\"w-40\"\n            />\n            <div class=\"space-y-2 text-center\">\n              <h5 class=\"font-medium text-2xl\">Apply referral code applied succesfully!</h5>\n              <p class=\"text-sm text-grey-03\">{{ store.referralCode.result?.message ?? '-' }}</p>\n            </div>\n            <div class=\"flex justify-center items-center gap-x-4\">\n              <Button\n                :disabled=\"store.referralCode.isLoading\"\n                :loading=\"store.referralCode.isLoading\"\n                color=\"teal\"\n                @click=\"onContinue\">\n                Continue to App\n              </Button>\n            </div>\n          </div>\n        </template>\n        <template #footer>\n          <div class=\"flex items-center justify-end gap-x-4\">\n            <Button\n              :disabled=\"store.referralCode.isLoading\"\n              color=\"white\"\n              view=\"outlined\"\n              @click=\"onSkip\">\n              Skip\n            </Button>\n            <Button\n              :disabled=\"!referralCode || referralCode?.length <= 3\"\n              color=\"teal\"\n              @click=\"onApplyCode\">\n              Apply Code\n            </Button>\n          </div>\n        </template>\n      </Modal>\n    </Teleport>\n  </div>\n</template>"],"names":["useOnboarding","defineStore","state","referralCode","modal","isError","isLoading","result","getters","actions","[object Object]","payload","referral_code","response","request","url","method","data","this","emits","__emit","store","confirmation","ref","applied","onClose","value","onSkip","onApplyCode","onCancel","onConfirm","async","tryCatchRequest","$applyReferralCode","then","catch","onContinue","onInput"],"mappings":"oPAGY,MAACA,EAAgBC,EAAY,aAAc,CACrDC,MAAO,KAAO,CACZC,aAAc,CACZC,OAAO,EACPC,SAAS,EACTC,WAAW,EACXC,YAAQ,KAGZC,QAAS,GACTC,QAAS,CAAAC,yBACkBC,EAAU,CAAEC,mBAAe,IAC5C,MAAAC,QAAiBC,EAAQ,CAC7BC,IAAK,iCACLC,OAAQ,OACRC,KAAMN,IAERO,KAAKf,aAAaI,OAASM,2eCXjC,MAAMM,EAAQC,EAKRC,EAAQrB,IACRsB,EAAeC,GAAI,GACnBpB,EAAeoB,EAAI,MACnBC,EAAUD,GAAI,GAEdE,EAAU,KACdJ,EAAMlB,aAAaC,OAAQ,EAC3BkB,EAAaI,OAAQ,EACrBvB,EAAauB,MAAQ,MAEjBC,EAAS,KACPR,EAAA,QACNM,KAEIG,EAAc,KAClBN,EAAaI,OAAQ,GAEjBG,EAAW,KACfP,EAAaI,OAAQ,GAEjBI,EAAYC,gBACVC,EACJX,EAAMlB,cACN,IAAMkB,EAAMY,mBAAmB,CAC7BrB,cAAeT,EAAauB,QAC3BQ,MAAK,KACNV,EAAQE,OAAQ,EAChBL,EAAMlB,aAAaE,SAAU,EACvBc,EAAA,cACLgB,OAAM,KACPX,EAAQE,OAAQ,EAChBJ,EAAaI,OAAQ,EACrBL,EAAMlB,aAAaE,SAAU,QAK7B+B,EAAa,KACjBT,KAEIU,EAAU,KACVhB,EAAMlB,aAAaE,UAASgB,EAAMlB,aAAaE,SAAU"}