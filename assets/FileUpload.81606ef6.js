var e=Object.defineProperty,l=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,i=(l,a,s)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):l[a]=s,o=(e,l)=>{for(var a in l||(l={}))t.call(l,a)&&i(e,a,l[a]);if(s)for(var a of s(l))r.call(l,a)&&i(e,a,l[a]);return e},n=(e,s)=>l(e,a(s));import{k as c,f as u,m as d,o as p,t as f,n as v,w as g,B as m,I as h,K as y,U as F,q as b,G as C,H as k,F as _,g as w,D,S as O,a2 as j,a3 as x,T as A,Q as P}from"./vendor.f1efedad.js";import{j as E,_ as L,as as T,ar as U,z as $}from"./index.e231b017.js";const z=c({components:{Alert:E},props:{accept:{type:Array,default:()=>[]}},emits:["change","click","dragover","dragleave","drop","reset"],setup(e,{emit:l}){const a=u(null),s=u(!1),t=u(!1),r=()=>{if(!a.value||!a.value.files.length)return;const s=T(a.value.files[0].name);e.accept.includes(s)?(t.value=!1,l("change",a.value.files)):t.value=!0};return{elInputFile:a,onDrag:s,invalid:t,fileChange:e=>{r()},reset:()=>{a.value.value=null,l("reset")},closeAlert:()=>{t.value=!1},doChange:()=>{a.value.click(),l("click")},dragOver:e=>{e.preventDefault(),s.value=!0,l("dragover")},dragLeave:e=>{e.preventDefault(),s.value=!1,l("dragleave")},drop:e=>{e.preventDefault(),a.value.files=e.dataTransfer.files,r(),l("drop"),s.value=!1},handleFileClick:()=>{var e;(null==(e=a.value)?void 0:e.value)&&(a.value.value=null)}}}}),I={class:"items-center h-full"};const S=c({components:{FilePicker:L(z,[["render",function(e,l,a,s,t,r){const i=d("Alert");return p(),f("div",null,[e.invalid?(p(),v(i,{key:0,color:"red",view:"smooth",class:"mb-5",dense:""},{left:g((()=>l[9]||(l[9]=[m("span",{class:"material-icons text-4xl"},"info",-1)]))),right:g((()=>[m("span",{class:"material-icons my-auto ml-auto cursor-pointer",onClick:l[0]||(l[0]=(...l)=>e.closeAlert&&e.closeAlert(...l))},"close")])),default:g((()=>[m("div",I,[l[7]||(l[7]=h(" File format is not supported. ")),l[8]||(l[8]=m("br",null,null,-1)),m("small",null,"Supported formats: "+y(e.accept.toString()),1)])])),_:1})):F("",!0),m("div",{class:_(["w-full h-full border border-dashed border-teal-02 rounded-lg cursor-pointer transition-all",{"border-teal-04":e.onDrag}]),onDragover:l[4]||(l[4]=(...l)=>e.dragOver&&e.dragOver(...l)),onDragleave:l[5]||(l[5]=(...l)=>e.dragLeave&&e.dragLeave(...l)),onDrop:l[6]||(l[6]=(...l)=>e.drop&&e.drop(...l))},[b(e.$slots,"default",C(k({openDialog:e.doChange})),(()=>[m("div",{onClick:l[1]||(l[1]=(...l)=>e.doChange&&e.doChange(...l)),class:"text-center text-sm py-6 px-4"},l[10]||(l[10]=[m("img",{src:"/icon/upload.svg",class:"w-14 h-14 mx-auto"},null,-1),h(" Click to browser or "),m("br",null,null,-1),h(" drag and drop your files ")]))])),m("input",{ref:"elInputFile",type:"file",class:"hidden",onChange:l[2]||(l[2]=(...l)=>e.fileChange&&e.fileChange(...l)),onClick:l[3]||(l[3]=(...l)=>e.handleFileClick&&e.handleFileClick(...l))},null,544)],34)])}]])},props:{singleUpload:{type:Boolean,default:!1},accept:{type:Array,default:()=>[]},config:{type:Object,default:()=>({url:null,method:"post",headers:{},field:"file"})},files:{type:Array,default:()=>[]},offline:{type:Boolean,default:!1}},emits:["change","completed","error","uploading","remove"],setup(e,{emit:l}){const a=u({}),s=u(!1),t=u(new Map),r=w((()=>Object.entries(a.value).map((([e,l])=>({id:e,name:l.file.name,size:U(l.file.size),file:l.file,status:l.status}))))),i=w((()=>r.value.length<1)),c=w((()=>{const l=e.accept.map((e=>e.toUpperCase()));if(2===l.length)return l.join(" or ");if(l.length>2){const e=l.pop();return`${l.join(", ")} or ${e}`}return l.join(", ")})),d=(e,l)=>{const t=Math.round(100*l.loaded/l.total);100===t&&s.value?a.value[e].status.progress=98:s.value||(a.value[e].status.progress=t)};return{files:a,requestAbortControllers:t,fileList:r,isEmptyFiles:i,acceptedFileTypes:c,handleChangeFile:async(i=null)=>{if(e.singleUpload&&(a.value={},i=[i[0]]),i){const c=[];for(let l of i){const s=window.crypto.randomUUID();c.push({id:s,file:l}),a.value[s]={file:l,status:{progress:e.offline?100:10,error:!1}}}l("change",r.value),e.offline?l("completed",r.value):await(async(i=[])=>{l("uploading",!0),s.value=!0;const c=[];for(let l of i){const s=new FormData;s.append(e.config.field,l.file);const r=new AbortController;t.value.set(l.id,r),c.push($(n(o({},e.config),{data:s,onUploadProgress:e=>d(l.id,e),signal:r.signal})).then((()=>{t.value.delete(l.id)})).catch((()=>{var e;e=l.id,a.value[e].status.error=!0,t.value.delete(l.id)})))}await Promise.allSettled(c),s.value=!1,l("uploading",!1);const u=r.value.filter((e=>{e.status.progress=100,e.status.error}));u.length>0?l("error",u):l("completed",r.value)})(c)}},handleRemoveFile:e=>{if(!e)return;if(!a.value.hasOwnProperty(e))return;a.value[e].status.progress>0&&a.value[e].status.progress<100&&(e=>{e&&t.value.has(e)&&(t.value.get(e).abort(),t.value.delete(e))})(e),l("remove",n(o({},a.value[e]),{id:e})),delete a.value[e],l("change",r.value)}}}}),B={class:"file-uploader"},R={class:"file-picker"},q=["onClick"],M={class:"text-teal-02"},G={key:0,class:"px-4 py-4"},H={class:"relative w-full"},K={class:"flex items-center"},Q={class:"file-list__file-name"},J={class:"file-list__file-size"},N={class:"file-list__file-remove pl-6"},V=["onClick"],W={class:"block mt-4"};var X=L(S,[["render",function(e,l,a,s,t,r){const i=d("FilePicker");return p(),f("div",B,[m("div",R,[D(i,{onChange:e.handleChangeFile,accept:e.accept},{default:g((({openDialog:a})=>[b(e.$slots,"default",C(k({isEmptyFiles:e.isEmptyFiles,openDialog:a,acceptedFileTypes:e.acceptedFileTypes,fileList:e.fileList})),(()=>[e.isEmptyFiles?(p(),f("div",{key:0,onClick:a,class:"py-6 px-4 text-center"},[m("span",M,[m("a",{class:"font-semibold",onClick:l[0]||(l[0]=O((()=>{}),["prevent"]))},"Choose a file"),l[1]||(l[1]=h(" or drag it here "))])],8,q)):F("",!0)])),b(e.$slots,"file-list",C(k({files:e.fileList,removeFile:e.handleRemoveFile,isEmptyFiles:e.isEmptyFiles})),(()=>[e.isEmptyFiles?F("",!0):(p(),f("div",G,[(p(!0),f(j,null,x(e.fileList,(a=>(p(),f("div",{key:a.name,class:_(["file-list__item",a.status.progress<100?"file-list__item--onprogress":""])},[l[3]||(l[3]=m("div",{class:"file-list__file-icon pr-6"},[m("i",{class:"material-icons"},"insert_drive_file")],-1)),m("div",H,[m("div",K,[m("div",Q,y(a.name),1),m("div",J,y(a.size),1)]),D(A,{name:"fade"},{default:g((()=>[a.status.progress<100?(p(),f("div",{key:0,class:"file-list__progress-bar",style:P({width:`${a.status.progress}%`})},null,4)):F("",!0)])),_:2},1024)]),m("div",N,[m("a",{onClick:O((l=>e.handleRemoveFile(a.id)),["prevent"])},l[2]||(l[2]=[m("i",{class:"material-icons"},"cancel",-1)]),8,V)])],2)))),128))]))]))])),_:3},8,["onChange","accept"])]),m("div",null,[b(e.$slots,"types",C(k({acceptedFileTypes:e.acceptedFileTypes})),(()=>[m("small",W,[l[4]||(l[4]=m("span",{class:"font-semibold"},"File:",-1)),h(" "+y(e.acceptedFileTypes),1)])]))])])}]]);export{X as F};
