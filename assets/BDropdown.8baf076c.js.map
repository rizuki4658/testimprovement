{"version":3,"file":"BDropdown.8baf076c.js","sources":["../../src/components/BDropdown/BDropdown.vue"],"sourcesContent":["<template>\n  <div\n    ref=\"refDropdown\"\n    :class=\"['b-dropdown', block && 'b-dropdown--block']\"\n    tabindex=\"0\"\n  >\n    <div\n      @click=\"!expandOnHover && toggleExpand()\"\n      @mouseenter=\"triggerMouseEnter\"\n      @mouseleave=\"triggerMouseLeave\"\n      @focus=\"isExpanded = true\"\n      tabindex=\"0\"\n      class=\"b-dropdown__trigger\"\n    >\n      <slot v-bind=\"{ isExpanded }\"></slot>\n    </div>\n    <teleport to=\"body\">\n      <transition name=\"fade\">\n        <div\n          v-loading=\"loading\"\n          v-show=\"isExpanded && !noDropdown\"\n          ref=\"refDropdownContent\"\n          class=\"b-dropdown__content\"\n          @mouseenter=\"clearCollapseTimeout\"\n          @mouseleave=\"triggerMouseLeave\"\n        >\n          <div :style=\"{ maxHeight, minHeight }\">\n            <slot\n              v-bind=\"{ collapse, addChild, removeChild }\"\n              name=\"dropdown\"\n            ></slot>\n          </div>\n        </div>\n      </transition>\n    </teleport>\n  </div>\n</template>\n\n<script>\nimport {\n  computed,\n  defineComponent,\n  getCurrentInstance,\n  nextTick,\n  onMounted,\n  onUnmounted,\n  ref,\n  watch\n} from 'vue'\nimport debounce from 'utils/debounce'\n\nexport default defineComponent({\n  name: 'BDropdown',\n  props: {\n    top: {\n      type: Boolean,\n      default: false\n    },\n    bottom: {\n      type: Boolean,\n      default: true\n    },\n    left: {\n      type: Boolean,\n      default: false\n    },\n    right: {\n      type: Boolean,\n      default: false\n    },\n    center: {\n      type: Boolean,\n      default: true\n    },\n    expandOnHover: {\n      type: Boolean,\n      default: false\n    },\n    offset: {\n      type: Number,\n      default: 8\n    },\n    block: {\n      type: Boolean,\n      default: false\n    },\n    minWidth: {\n      type: [Number, String],\n      default: 'auto'\n    },\n    maxHeight: {\n      type: [Number, String],\n      default: 'auto'\n    },\n    minHeight: {\n      type: [Number, String],\n      default: 'auto'\n    },\n    disabled: {\n      type: Boolean,\n      default: false\n    },\n    loading: {\n      type: Boolean,\n      default: false\n    },\n    preventToggle: {\n      type: Boolean,\n      default: false\n    },\n    noDropdown: {\n      type: Boolean,\n      default: false\n    }\n  },\n  emits: ['mounted', 'unmounted', 'collapse'],\n  setup(props, { emit }) {\n    const refDropdown = ref(null)\n    const refDropdownContent = ref(null)\n    const isExpanded = ref(false)\n    const children = ref([])\n    let collapseTimeout = null\n\n    const maxHeight = computed(() => {\n      if (typeof props.maxHeight === 'number') return `${props.maxHeight}px`\n      return props.maxHeight\n    })\n    const minHeight = computed(() => {\n      if (typeof props.minHeight === 'number') return `${props.minHeight}px`\n      return props.minHeight\n    })\n\n    const calculateContentPosition = () => {\n      if (!isExpanded.value) return\n      if (!refDropdown.value || !refDropdownContent.value) return\n      const {\n        width: dropdownWidth,\n        height: dropdownHeight,\n        x: dropdownX,\n        y: dropdownY\n      } = refDropdown.value.getBoundingClientRect()\n\n      const minWidth = parseInt(`${props.minWidth}`)\n      const isNumberMinWidth = !isNaN(minWidth)\n      if (isNumberMinWidth) {\n        refDropdownContent.value.style.minWidth = `${minWidth}px`\n      } else {\n        refDropdownContent.value.style.minWidth = `${dropdownWidth}px`\n      }\n\n      const { width: dropdownContentWidth, height: dropdownContentHeight } =\n        refDropdownContent.value.getBoundingClientRect()\n\n      let left = dropdownX\n      let top = dropdownY + dropdownHeight + props.offset\n\n      if (props.center) {\n        left += (dropdownWidth - dropdownContentWidth) / 2\n      }\n\n      if (props.right) {\n        left = dropdownX + dropdownWidth + props.offset\n        top = dropdownY\n        if (props.top) {\n          top = dropdownY + dropdownHeight - dropdownContentHeight\n        }\n      } else if (props.left) {\n        left = dropdownX - dropdownContentWidth - props.offset\n        top = dropdownY\n        if (props.top) {\n          top = dropdownY + dropdownHeight - dropdownContentHeight\n        }\n      } else if (props.top) {\n        top = dropdownY - dropdownContentHeight - props.offset\n      }\n\n      const viewportWidth = window.innerWidth\n      const viewportHeight = window.innerHeight\n\n      if (left + dropdownContentWidth > viewportWidth) {\n        left = viewportWidth - dropdownContentWidth - props.offset\n      } else if (left < 0) {\n        left = props.offset\n      }\n\n      if (top + dropdownContentHeight > viewportHeight) {\n        top = viewportHeight - dropdownContentHeight - props.offset\n      } else if (top < 0) {\n        top = props.offset\n      }\n\n      refDropdownContent.value.style.left = `${left}px`\n      refDropdownContent.value.style.top = `${top}px`\n    }\n\n    const expand = () => {\n      if (props.disabled) return collapse()\n      isExpanded.value = true\n      nextTick(calculateContentPosition)\n    }\n\n    const collapse = () => {\n      isExpanded.value = false\n    }\n\n    const toggleExpand = () => {\n      if (props.disabled) return collapse()\n      isExpanded.value ? !props.preventToggle && collapse() : expand()\n    }\n\n    const triggerMouseEnter = () => {\n      if (!props.expandOnHover) return\n      clearCollapseTimeout()\n      expand()\n    }\n\n    const triggerMouseLeave = () => {\n      if (!props.expandOnHover) return\n      collapseTimeout = setTimeout(collapse, 100)\n    }\n\n    const clearCollapseTimeout = () => {\n      if (collapseTimeout) {\n        clearTimeout(collapseTimeout)\n        collapseTimeout = null\n      }\n    }\n    const isOutsideEvent = (event) => {\n      if (!refDropdown.value || !refDropdownContent.value) return\n      return (\n        !refDropdown.value.contains(event.target) &&\n        !refDropdownContent.value.contains(event.target) &&\n        children.value.filter(\n          (child) =>\n            child.refs.refDropdownContent.contains(event.target) ||\n            child.refs.refDropdown.contains(event.target)\n        ).length === 0\n      )\n    }\n    const onOutsideClick = (event) => {\n      if (isOutsideEvent(event)) collapse()\n    }\n\n    const onScrollEvent = (event) => {\n      if (isOutsideEvent(event)) collapse()\n    }\n\n    const addChild = (child) => {\n      if (!(child?.refs?.refDropdownContent && child?.refs?.refDropdown)) return\n      children.value.push(child)\n    }\n    const removeChild = (child) => {\n      children.value = children.value.filter(\n        (currentChildren) => currentChildren.uid !== child?.uid\n      )\n    }\n\n    watch(\n      isExpanded,\n      (expanded) => {\n        const isCollapsed = !expanded\n        emit('collapse', !isCollapsed)\n      }\n    )\n\n    onMounted(() => {\n      window.addEventListener('scroll', debounce(onScrollEvent, 100), true)\n      window.addEventListener('click', onOutsideClick)\n      emit('mounted', getCurrentInstance())\n    })\n    onUnmounted(() => {\n      window.removeEventListener('scroll', debounce(onScrollEvent, 100), true)\n      window.addEventListener('click', onOutsideClick)\n      emit('unmounted', getCurrentInstance())\n    })\n\n    return {\n      refDropdown,\n      refDropdownContent,\n      isExpanded,\n      maxHeight,\n      minHeight,\n      toggleExpand,\n      expand,\n      collapse,\n      triggerMouseEnter,\n      triggerMouseLeave,\n      clearCollapseTimeout,\n      addChild,\n      removeChild,\n      children\n    }\n  }\n})\n</script>\n\n<style lang=\"scss\" scoped>\n.b-dropdown {\n  @apply relative inline-block;\n  &--block {\n    @apply block;\n  }\n\n  &__content {\n    @apply fixed bg-white w-max rounded-lg border border-grey-lighten box-content overflow-y-auto shadow;\n    z-index: 2002;\n  }\n}\n</style>\n"],"names":["defineComponent","name","props","top","type","Boolean","default","bottom","left","right","center","expandOnHover","offset","Number","block","minWidth","String","maxHeight","minHeight","disabled","loading","preventToggle","noDropdown","emits","[object Object]","emit","refDropdown","ref","refDropdownContent","isExpanded","children","collapseTimeout","computed","calculateContentPosition","value","width","dropdownWidth","height","dropdownHeight","x","dropdownX","y","dropdownY","getBoundingClientRect","parseInt","isNumberMinWidth","isNaN","style","dropdownContentWidth","dropdownContentHeight","viewportWidth","window","innerWidth","viewportHeight","innerHeight","expand","collapse","nextTick","clearCollapseTimeout","clearTimeout","isOutsideEvent","event","contains","target","filter","child","refs","length","onOutsideClick","onScrollEvent","watch","expanded","onMounted","addEventListener","debounce","getCurrentInstance","onUnmounted","removeEventListener","toggleExpand","triggerMouseEnter","triggerMouseLeave","setTimeout","addChild","_a","_b","push","removeChild","currentChildren","uid","_openBlock","_createElementBlock","class","_normalizeClass","_ctx","onClick","_cache","onMouseenter","args","onMouseleave","onFocus","$event","tabindex","_createBlock","_Teleport","to","_withDirectives","_directive_loading"],"mappings":"mQAmDkBA,EAAa,CAC7BC,KAAM,YACNC,MAAO,CACLC,IAAK,CACHC,KAAMC,QACNC,SAAS,GAEXC,OAAQ,CACNH,KAAMC,QACNC,SAAS,GAEXE,KAAM,CACJJ,KAAMC,QACNC,SAAS,GAEXG,MAAO,CACLL,KAAMC,QACNC,SAAS,GAEXI,OAAQ,CACNN,KAAMC,QACNC,SAAS,GAEXK,cAAe,CACbP,KAAMC,QACNC,SAAS,GAEXM,OAAQ,CACNR,KAAMS,OACNP,QAAS,GAEXQ,MAAO,CACLV,KAAMC,QACNC,SAAS,GAEXS,SAAU,CACRX,KAAM,CAACS,OAAQG,QACfV,QAAS,QAEXW,UAAW,CACTb,KAAM,CAACS,OAAQG,QACfV,QAAS,QAEXY,UAAW,CACTd,KAAM,CAACS,OAAQG,QACfV,QAAS,QAEXa,SAAU,CACRf,KAAMC,QACNC,SAAS,GAEXc,QAAS,CACPhB,KAAMC,QACNC,SAAS,GAEXe,cAAe,CACbjB,KAAMC,QACNC,SAAS,GAEXgB,WAAY,CACVlB,KAAMC,QACNC,SAAS,IAGbiB,MAAO,CAAC,UAAW,YAAa,YAChCC,MAAMtB,GAAOuB,KAAEA,IACb,MAAMC,EAAcC,EAAI,MAClBC,EAAqBD,EAAI,MACzBE,EAAaF,GAAI,GACjBG,EAAWH,EAAI,IACrB,IAAII,EAAkB,KAEhB,MAAAd,EAAYe,GAAS,IACM,iBAApB9B,EAAMe,UAA+B,GAAGf,EAAMe,cAClDf,EAAMe,YAETC,EAAYc,GAAS,IACM,iBAApB9B,EAAMgB,UAA+B,GAAGhB,EAAMgB,cAClDhB,EAAMgB,YAGTe,EAA2B,KAC/B,IAAKJ,EAAWK,MAAO,OACvB,IAAKR,EAAYQ,QAAUN,EAAmBM,MAAO,OAC/C,MACJC,MAAOC,EACPC,OAAQC,EACRC,EAAGC,EACHC,EAAGC,GACDhB,EAAYQ,MAAMS,wBAEhB5B,EAAW6B,SAAS,GAAG1C,EAAMa,YAC7B8B,GAAoBC,MAAM/B,GAEXa,EAAAM,MAAMa,MAAMhC,SAD7B8B,EACwC,GAAG9B,MAEH,GAAGqB,MAG/C,MAAQD,MAAOa,EAAsBX,OAAQY,GAC3CrB,EAAmBM,MAAMS,wBAE3B,IAAInC,EAAOgC,EACPrC,EAAMuC,EAAYJ,EAAiBpC,EAAMU,OAEzCV,EAAMQ,SACRF,MAAyBwC,GAAwB,GAG/C9C,EAAMO,OACDD,EAAAgC,EAAYJ,EAAgBlC,EAAMU,OACnCT,EAAAuC,EACFxC,EAAMC,MACRA,EAAMuC,EAAYJ,EAAiBW,IAE5B/C,EAAMM,MACRA,EAAAgC,EAAYQ,EAAuB9C,EAAMU,OAC1CT,EAAAuC,EACFxC,EAAMC,MACRA,EAAMuC,EAAYJ,EAAiBW,IAE5B/C,EAAMC,MACTA,EAAAuC,EAAYO,EAAwB/C,EAAMU,QAGlD,MAAMsC,EAAgBC,OAAOC,WACvBC,EAAiBF,OAAOG,YAE1B9C,EAAOwC,EAAuBE,EACzB1C,EAAA0C,EAAgBF,EAAuB9C,EAAMU,OAC3CJ,EAAO,IAChBA,EAAON,EAAMU,QAGXT,EAAM8C,EAAwBI,EAC1BlD,EAAAkD,EAAiBJ,EAAwB/C,EAAMU,OAC5CT,EAAM,IACfA,EAAMD,EAAMU,QAGKgB,EAAAM,MAAMa,MAAMvC,KAAO,GAAGA,MACtBoB,EAAAM,MAAMa,MAAM5C,IAAM,GAAGA,OAGpCoD,EAAS,KACb,GAAIrD,EAAMiB,SAAiB,OAAAqC,IAC3B3B,EAAWK,OAAQ,EACVuB,EAAAxB,IAGLuB,EAAW,KACf3B,EAAWK,OAAQ,GAmBfwB,EAAuB,KACvB3B,IACW4B,aAAA5B,GACKA,EAAA,OAGhB6B,EAAkBC,IACtB,GAAKnC,EAAYQ,OAAUN,EAAmBM,MAC9C,OACGR,EAAYQ,MAAM4B,SAASD,EAAME,UACjCnC,EAAmBM,MAAM4B,SAASD,EAAME,SAK5B,IAJbjC,EAASI,MAAM8B,QACZC,GACCA,EAAMC,KAAKtC,mBAAmBkC,SAASD,EAAME,SAC7CE,EAAMC,KAAKxC,YAAYoC,SAASD,EAAME,UACxCI,QAGAC,EAAkBP,IAClBD,EAAeC,IAAQL,KAGvBa,EAAiBR,IACjBD,EAAeC,IAAQL,KAgCtB,OAlBLc,EAAAzC,GACC0C,IAEC9C,EAAK,aADgB8C,MAKzBC,GAAU,KACRrB,OAAOsB,iBAAiB,SAAUC,EAASL,EAAe,MAAM,GAChElB,OAAOsB,iBAAiB,QAASL,GACjC3C,EAAK,UAAWkD,QAElBC,GAAY,KACVzB,OAAO0B,oBAAoB,SAAUH,EAASL,EAAe,MAAM,GACnElB,OAAOsB,iBAAiB,QAASL,GACjC3C,EAAK,YAAakD,QAGb,CACLjD,YAAAA,EACAE,mBAAAA,EACAC,WAAAA,EACAZ,UAAAA,EACAC,UAAAA,EACA4D,aA7EmB,KACnB,GAAI5E,EAAMiB,SAAiB,OAAAqC,IAC3B3B,EAAWK,OAAShC,EAAMmB,eAAiBmC,IAAaD,KA4ExDA,OAAAA,EACAC,SAAAA,EACAuB,kBA3EwB,KACnB7E,EAAMS,gBACX+C,IACAH,MAyEAyB,kBAtEwB,KACnB9E,EAAMS,gBACXoB,EAAkBkD,WAAWzB,EAAU,OAqEvCE,qBAAAA,EACAwB,SAzCgBjB,aACV,OAAOkB,EAAA,MAAAlB,OAAA,EAAAA,EAAAC,eAAMtC,sBAAsB,OAAAwD,EAAA,MAAAnB,OAAA,EAAAA,EAAOC,WAAM,EAAAkB,EAAA1D,cACtDI,EAASI,MAAMmD,KAAKpB,IAwCpBqB,YAtCmBrB,IACVnC,EAAAI,MAAQJ,EAASI,MAAM8B,QAC7BuB,GAAoBA,EAAgBC,OAAe,MAAAvB,OAAA,EAAAA,EAAAuB,QAqCtD1D,SAAAA,4DAhSe2D,OAAAA,IAAAC,EAAA,MAAA,CAChB/D,IAAK,cACNgE,MAAAC,EAAY,CAAA,aAAAC,EAAA/E,OAAA,oCAWN,GARE,MAAA,CACLgF,QAAAC,iCAA6BF,EAAAf,gBAC7BkB,iCAAYH,EAAiBd,mBAAAc,EAAAd,qBAAAkB,IAC7BC,iCAAiBL,EAAAb,mBAAAa,EAAAb,qBAAAiB,IAClBE,UAAY,OAAA,GAAAC,GAAAP,EAAAhE,YAAA,GACZwE,SAA2B,iCAE3B,uEAmBaC,IAAAA,EAAAC,EAhBU,CAAAC,GAAA,QAAA,KAef,CAAAvG,KAAA,QAAA,iBAXJwG,GAAwBf,IAAAA,EAAA,MAAA,CACxB/D,IAAK,qBACJgE,MAAA,sBACAK,iCAAYH,EAAiBnC,sBAAAmC,EAAAnC,wBAAAuC,sFAOxB,GALK,MAAA,yDACT,uHAPM,CAAAS,EAAAb"}