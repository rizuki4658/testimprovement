{"version":3,"file":"index.c10f8f14.js","sources":["../../src/views/setting/workflow/edit/index.vue","../../src/views/setting/workflow/edit/index.js"],"sourcesContent":["<template>\n\t<div>\n\t\t<Breadcrumb\n      class=\"mt-2 mb-8\"\n      pageTitle=\"Edit Workflow\"\n      :backTo=\"{ name: 'settingWorkflow' }\"\n      :items=\"breadcrumb\">\n      <template #right>\n        <Button\n          color=\"teal\"\n          :loading=\"loading\"\n          @click=\"updateWorkflow\">\n          Save Changes\n        </Button>\n      </template>\n    </Breadcrumb>\n\t\t<Card class=\"mb-24\">\n\t\t\t<WorkflowForm\n\t\t\t\t:data=\"data\"\n\t\t\t\tref=\"refForm\"\n\t\t\t\t:disable-status=\"\n\t\t\t\t\tspecialWorkflowIds.includes(parseInt(route.params.workflowId))\n\t\t\t\t\"\n\t\t\t\t:disbale-send-mail=\"false\"\n\t\t\t\t:is-parent=\"isParent\"\n\t\t\t\t:loading-theme=\"loadingEmailTheme\"\n\t\t\t\t:loading-preview-email=\"loadingPreviewEmailTemplate\"\n\t\t\t\t:loading-editor=\"isLoadingEditor\"\n\t\t\t\t@update-email-theme=\"handleUpdateEmailTheme\"\n\t\t\t\t@preview-email=\"handlePreviewEmailTemplate\"\n\t\t\t\t@reset-template=\"handleResetTemplate\"\n\t\t\t\treset-template />\n\t\t</Card>\n\t</div>\n\t<Modal v-model=\"modalWorkflow.reset_template\" hide-footer hide-header size=\"xs\">\n    <template #default>\n      <div class=\"py-10\">\n        <img\n          class=\"mb-10 mx-auto\"\n          src=\"@/assets/icon/warning.svg\"\n          alt=\"Warning icon\"\n        />\n        <div class=\"mt-8 mb-10\">\n          <h5 class=\"mb-4 text-center\">Reset Email Template</h5>\n          <p class=\"text-center mb-6\">\n            Are you sure you want to reset to the default email template?\n          </p>\n        </div>\n        <div class=\"text-center\">\n          <Button\n            @click=\"closeModalWorkflow('reset_template')\"\n            view=\"outlined\"\n            color=\"teal\"\n            class=\"bg-white\"\n            :disabled=\"loadingWorkflow.reset_template\"\n            >Cancel</Button\n          >\n          <Button\n\t\t\t\t\t\t@click=\"resetTemplate\"\n            view=\"smooth\"\n            color=\"orange\"\n            class=\"ml-3\"\n            :loading=\"loadingWorkflow.reset_template\"\n            >Yes, reset</Button\n          >\n        </div>\n      </div>\n    </template>\n  </Modal>\n\t<PreviewEmail v-model:show=\"isPreview\" :body=\"previewedTemplate\" />\n</template>\n\n<script>\nimport { computed, defineComponent, ref } from 'vue'\nimport { useRoute, useRouter } from 'vue-router'\nimport {\n\tuseWorkflowForm,\n\tuseWorkflowAll,\n\tusePreviewEmailTemplate\n} from 'composable/setting'\nimport { DISABLED_EDIT_WORKFLOW_IDS } from 'constants/workflow';\nimport { ElMessage } from 'element-plus'\n\nimport Button from 'bbUi/components/button/button.vue'\nimport Card from 'bbUi/components/card/card.vue'\nimport WorkflowForm from 'components/Workflow/Form.vue'\nimport Modal from 'bbUi/components/modal/modal.vue'\nimport Breadcrumb from 'components/Breadcrumb.vue'\nimport PreviewEmail from 'components/EmailTemplate/PreviewEmailTemplate.vue'\n\nexport default defineComponent({\n\tcomponents: {\n\t\tButton,\n\t\tCard,\n\t\tWorkflowForm,\n\t\tModal,\n\t\tBreadcrumb,\n\t\tPreviewEmail\n\t},\n\tasync setup() {\n    const route = useRoute()\n    const router = useRouter()\n    const buybackType = route.query.type || 'in-store'\n\t\tconst refForm = ref(null)\n\t\tconst {\n\t\t\tdata,\n\t\t\tloading,\n\t\t\tloadingEmailTheme,\n\t\t\tactionShow,\n\t\t\tactionUpdate,\n\t\t\tactionUpdateEmailTheme\n\t\t} = useWorkflowForm({\n      type: buybackType\n    })\n\t\tconst {\n\t\t\tmodal: modalWorkflow, \n\t\t\tloading: loadingWorkflow, \n\t\t\topenModal: openModalWorkflow, \n\t\t\tcloseModal: closeModalWorkflow, \n\t\t\tactionResetEmailTemplate,\n\t\t\tspecialWorkflowIds\n\t\t } = useWorkflowAll({\n      type: buybackType\n     })\n\t\tconst {\n\t\t\temailBody,\n\t\t\tisPreview,\n\t\t\tpreviewedTemplate,\n\t\t\tloading: loadingPreviewEmailTemplate,\n\t\t\tactionWorkflowEmail: actionPreviewEmailTemplate\n\t\t} = usePreviewEmailTemplate({\n      type: buybackType\n    })\n\n\t\tconst updateWorkflow = async () => {\n\t\t\tif (await refForm.value?.validate?.()) {\n\t\t\t\tawait actionUpdate(route.params.workflowId, async (res) => {\n\t\t\t\t\tres && res.status === 200 && await router.push({\n\t\t\t\t\t\tname: 'settingWorkflow'\n\t\t\t\t\t})\n\t\t\t\t})\n\t\t\t}\n\t\t}\n\n\t\tconst breadcrumb = [\n\t\t\t{\n\t\t\t\ttext: 'Settings',\n\t\t\t\tto: {\n\t\t\t\t\tname: 'setting'\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: 'Workflow',\n\t\t\t\tto: {\n\t\t\t\t\tname: 'settingWorkflow'\n\t\t\t\t}\n\t\t\t},\n\t\t\t{\n\t\t\t\ttext: 'Edit Workflow'\n\t\t\t}\n\t\t]\n\n\t\tconst isParent = computed(() => !data.parent_id && data.havechild == 1)\n\t\tconst isLoadingEditor = computed(() => loading.value)\n\n\t\tconst handleUpdateEmailTheme = async () =>\n\t\t\tawait actionUpdateEmailTheme(route.params.workflowId, () => {\n\t\t\t\tElMessage({\n\t\t\t\t\ttype: 'success',\n\t\t\t\t\tmessage: 'Workflow email theme updated'\n\t\t\t\t})\n\t\t\t})\n\t\tconst handlePreviewEmailTemplate = async () => {\n\t\t\temailBody.value = data.email_template\n\t\t\tif (data.id) await actionPreviewEmailTemplate(data.id)\n\t\t}\n\t\tconst handleResetTemplate = () => openModalWorkflow('reset_template')\n\t\tconst resetTemplate = async () => await actionResetEmailTemplate({\n\t\t\tid: route.params.workflowId\n\t\t}, async () => {\n\t\t\tcloseModalWorkflow('reset_template')\n\t\t\tawait actionShow(route.params.workflowId)\n\t\t})\n\n    if(DISABLED_EDIT_WORKFLOW_IDS.includes(parseInt(route.params.workflowId))) {\n      await router.push({\n        name: 'settingWorkflow'\n      })\n      return\n    }\n\n\t\tawait actionShow(route.params.workflowId)\n\n\t\t// if (data.status_name.toLowerCase() === 'active leads') router.go(-1)\n\n\t\treturn {\n\t\t\tdata,\n\t\t\tspecialWorkflowIds,\n\t\t\tloading,\n\t\t\tloadingEmailTheme,\n\t\t\tbreadcrumb,\n\t\t\trefForm,\n\t\t\troute,\n\t\t\tisParent,\n\t\t\tisPreview,\n\t\t\tisLoadingEditor,\n\t\t\tpreviewedTemplate,\n\t\t\tloadingPreviewEmailTemplate,\n\t\t\tmodalWorkflow,\n\t\t\tloadingWorkflow,\n\t\t\topenModalWorkflow,\n\t\t\tcloseModalWorkflow,\n\t\t\tupdateWorkflow,\n\t\t\thandleUpdateEmailTheme,\n\t\t\thandlePreviewEmailTemplate,\n\t\t\thandleResetTemplate,\n\t\t\tresetTemplate\n\t\t}\n\t}\n})\n</script>\n","import { defineComponent } from 'vue'\nimport { useSuspense } from 'composable/components'\nimport index from './index.vue'\n\nexport default defineComponent({\n  setup() {\n    const { genSuspense } = useSuspense()\n\n    return () => genSuspense(index)\n  }\n})"],"names":["_sfc_main","defineComponent","components","Button","Card","WorkflowForm","Modal","Breadcrumb","PreviewEmail","[object Object]","route","useRoute","router","useRouter","buybackType","query","type","refForm","ref","data","loading","loadingEmailTheme","actionShow","actionUpdate","actionUpdateEmailTheme","useWorkflowForm","modal","modalWorkflow","loadingWorkflow","openModal","openModalWorkflow","closeModal","closeModalWorkflow","actionResetEmailTemplate","specialWorkflowIds","useWorkflowAll","emailBody","isPreview","previewedTemplate","loadingPreviewEmailTemplate","actionWorkflowEmail","actionPreviewEmailTemplate","usePreviewEmailTemplate","isParent","computed","parent_id","havechild","isLoadingEditor","value","DISABLED_EDIT_WORKFLOW_IDS","includes","parseInt","params","workflowId","breadcrumb","text","to","name","updateWorkflow","async","_b","_a","validate","call","res","status","push","handleUpdateEmailTheme","_u","message","handlePreviewEmailTemplate","email_template","id","handleResetTemplate","resetTemplate","_hoisted_1","class","_openBlock","_createElementBlock","_Fragment","_createVNode","_component_Breadcrumb","pageTitle","backTo","_withCtx","_component_Button","color","_ctx","_cache","_component_WorkflowForm","disable-status","disbale-send-mail","is-parent","loading-theme","loading-preview-email","loading-editor","onUpdateEmailTheme","onPreviewEmail","onResetTemplate","_component_Modal","modelValue","reset_template","onUpdate:modelValue","$event","hide-footer","hide-header","default","_createElementVNode","src","_imports_0","_hoisted_2","onClick","view","_component_PreviewEmail","onUpdate:show","index","genSuspense","useSuspense"],"mappings":"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"}