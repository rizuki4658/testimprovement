var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,s=Object.prototype.propertyIsEnumerable,i=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,n=(e,a)=>{for(var l in a||(a={}))o.call(a,l)&&i(e,l,a[l]);if(t)for(var l of t(a))s.call(a,l)&&i(e,l,a[l]);return e},d=(e,t)=>a(e,l(t));import{f as c,N as r,r as u,g as m,k as p,m as h,o as g,t as f,B as v,a1 as b,a2 as y,F as L,K as _,D as k,y as w,W as S,q as x,U as P,Q as $,$ as U,A as C,G as j,H as N,w as I,n as V,S as O,I as A,L as D,T as q,a5 as B,z as G}from"./vendor.9695fe57.js";import{u as R}from"./dashboard.63b52545.js";import{v as F,_ as E,e as T,f as z,P as M,S as H,g as Z}from"./index.9c4dcead.js";import{c as J}from"./index.6b6f6369.js";import{r as K,e as Q}from"./index.54844a74.js";import{u as W}from"./index.f40e4a9e.js";import{_ as X}from"./fieldset.b90636af.js";const Y=c([]),ee=c({}),ae=()=>{const e=r(),a=c([]),l=u({location:{get:!1}}),i=u({page:1,limit:10,search:"",is_additional_info:1}),d=c({last_page:1,from:1,to:1,total:0}),p=m((()=>Y.value.map((e=>e.id)))),h=m((()=>ee.value.id)),g=m((()=>Y.value)),f=()=>{Y.value=[],ee.value={},Object.assign(d,{last_page:1,from:1,to:1,total:0}),Object.assign(i,{page:1,limit:10,search:""})};return{loading:l,locations:a,defaultLocations:g,filters:i,pagination:d,selectedLocations:p,selectedDefaultLocation:h,selectedDefaultLocationDetailed:ee,getLocations:async(c={},r={},u=(()=>{}))=>{const m=n(n({},i),c),{isPaginate:p}=r;try{l.location.get=!0;const i=await e.dispatch("setting/manageUser/getLocations",{params:m}),{data:n}=i,c=((e,a)=>{var l={};for(var i in e)o.call(e,i)&&a.indexOf(i)<0&&(l[i]=e[i]);if(null!=e&&t)for(var i of t(e))a.indexOf(i)<0&&s.call(e,i)&&(l[i]=e[i]);return l})(i,["data"]),{to:r,total:g,from:f,last_page:v,selected:b}=c;((e={})=>{d.value=e})({from:f||1,to:r||1,total:g||0,last_page:v||1}),p||(h=b,Y.value=h),((e=[])=>{a.value=e})(n),F(u)&&u(null)}catch(g){F(u)&&u(g)}finally{l.location.get=!1}var h},selectLocation:e=>!!e&&Y.value.push(e),unselectLocation:(e={})=>!!e&&(Y.value=Y.value.filter((a=>a.id!==e.id))),selectDefaultLocation:e=>{e&&(ee.value=e)},resetState:f,unsetSelectedLocations:()=>{f()}}};const le=p({name:"PermissionTreeItem",props:{nodes:{type:Array,default:()=>[]},checked:{type:String,required:!0},name:{type:String,required:!0},isChild:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1}},emits:["select-node"],setup:(e,{emit:a})=>({onSelectNode:e=>{a("select-node",e)}})}),te=["for"],oe={class:"checkbox__content"},se=["onClick","disabled","id","checked","indeterminate"];const ie=p({name:"PermissionTree",components:{PermissionTreeItem:E(le,[["render",function(e,a,l,t,o,s){const i=h("PermissionTreeItem",!0);return g(),f("div",null,[v("ul",{class:L(["tree",e.isChild?"tree--child":""])},[(g(!0),f(b,null,y(e.nodes,(l=>(g(),f("li",{key:l.key,class:"tree__item"},[v("label",{for:l.key,class:L(["checkbox","checkbox-default",l.indeterminate?"checkbox-indeterminate":"",l.checked?"checked":"",e.disabled?"checkbox-disabled":""])},[v("div",oe,_(e.name?l[e.name]:""),1),v("input",{type:"checkbox",class:"checkbox",onClick:a=>e.onSelectNode(l),disabled:e.disabled,id:l.key,checked:l.checked,indeterminate:l.indeterminate},null,8,se),a[0]||(a[0]=v("span",{class:"checkbox__mark"},null,-1))],10,te),k(i,{onSelectNode:e.onSelectNode,nodes:l.child,checked:e.checked,name:e.name,"is-child":!0,disabled:e.disabled},null,8,["onSelectNode","nodes","checked","name","disabled"])])))),128))],2)])}],["__scopeId","data-v-67d46e44"]])},props:{items:{type:Array,default:()=>[]},checked:{type:String,default:"status"},name:{type:String,default:"name"},disabled:{type:Boolean,default:!1},maxHeight:{type:[String,Number],default:"100"}},emits:["items-change"],setup(e,{emit:a}){const l=(a=[],t=null)=>a.map(((a,o)=>{const s=d(n({},a),{key:t?`${t}-${o}`:`${o}`,checked:!!e.checked&&1==a[e.checked],indeterminate:!1});return s.child=l(a.child,t?`${t}-${o}`:`${o}`),s})),t=(e=[],a=[],l=new Map)=>{for(let o of e){o.child.length>0&&t(o.child,[o,...a],l),l.set(o.key,{node:o,parents:a})}return l},o=(e,a=[])=>{for(let l of a){l.checked=e.checked;l.child&&o(e,l.child)}},s=c(l(e.items)),i=m((()=>t(s.value)));return w((()=>e.items),(e=>{s.value=l(e),a("items-change",s.value)})),S((()=>{a("items-change",s.value)})),{nodes:s,onSelectNode:e=>{const l=i.value.get(e.key).node,t=i.value.get(e.key).parents;l.checked=!e.checked,l.checked&&l.indeterminate&&(l.indeterminate=!1),o(l,l.child),((e=[])=>{for(let a of e){const e=a.child.filter((e=>e.checked)).length,l=void 0!==a.child.find((e=>e.indeterminate)),t=e>0&&e<a.child.length||l,o=0===e;a.checked=!!t||!o}})(t),a("items-change",s.value)}}}}),ne={key:0,class:"absolute -top-4 left-3 bg-white px-1.5"},de={class:"overflow-auto w-full px-8 py-10"};var ce=E(ie,[["render",function(e,a,l,t,o,s){const i=h("PermissionTreeItem");return g(),f("div",{class:L(["bg-white rounded-lg border border-grey-01 overflow-visible",e.$slots.label?"relative":""]),style:$({maxHeight:`${e.maxHeight}px`})},[e.$slots.label?(g(),f("div",ne,[x(e.$slots,"label")])):P("",!0),v("div",de,[k(i,{nodes:e.nodes,checked:e.checked,name:e.name,disabled:e.disabled,onSelectNode:e.onSelectNode},null,8,["nodes","checked","name","disabled","onSelectNode"])])],6)}]]);const re=p({name:"ManageUserLocation",components:{Checkbox:T,Input:z},props:{locations:{type:Array,default:()=>[]},selectedLocation:{type:[Array,String,Number],default:()=>[]},search:{type:String,default:""},multiple:{type:Boolean,default:!0},searchable:{type:Boolean,default:!0},loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},totalLocation:{type:Number,default:0}},emits:["update:selectedLocation","update:search","select-all"],setup(e,{emit:a}){const l=c(null),t=c(null),o=c(!1),s=c(e.selectedLocation),i=m((()=>{var a;const l=e.locations.filter((a=>e.selectedLocation===a.id));return 1===l.length&&(null==(a=l[0])?void 0:a.name)||""})),n=m((()=>Array.isArray(s.value)?s.value.length:0)),d=m((()=>0===n.value)),r=m((()=>{var a;return!!e.multiple&&(null==(a=e.selectedLocation)?void 0:a.length)>0})),u=m((()=>{var a;return!!e.multiple&&e.totalLocation===(null==(a=e.selectedLocation)?void 0:a.length)})),p=m((()=>!!e.multiple&&(r.value&&!u.value))),h=()=>{l.value&&t.value&&(t.value.style.width=getComputedStyle(l.value).width)};return w((()=>o.value),(e=>{e&&h()})),w((()=>e.selectedLocation),(e=>{s.value=e})),S((()=>{h()})),{refSelectButton:l,refSelectDropdown:t,isCollapse:o,isIndeterminate:p,hasSelectedLocations:r,selectedLocation:s,totalSelectedLocation:n,isEmptySelectedLocation:d,selectedLocationName:i,handleSelectLocation:l=>{e.multiple||(o.value=!1),a("update:selectedLocation",l)},handleSelectAll:e=>{a("select-all",e)},censorLocationName:e=>{if(!e)return e;let a=e;return a=a.replace(/(?:\d[\s.-]?){5,}/g,(e=>{const a=e.replace(/\D/g,"");return a.length<=4?"*".repeat(a.length):`${a.slice(0,4)}${"*".repeat(a.length-4)}`})),a=a.replace(/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g,(e=>`${e[0]}${"*".repeat(e.length-1)}`)),a=a.replace(/\b(call us|contact us|email us|text us)\b/gi,(e=>"*".repeat(e.length))),a}}}}),ue={class:"flex flex-wrap justify-between items-center"},me={key:0},pe={key:1},he={ref:"refSelectDropdown",class:"select-location__dropdown"},ge={key:0,class:"select-location__dropdown-search"},fe={class:"overflow-y-auto overflow-x-hidden"},ve=["onClick"];const be=p({components:{Input:z,Checkbox:T,Fieldset:X,Pagination:M,Select:H,PermissionTree:ce,SelectLocation:E(re,[["render",function(e,a,l,t,o,s){const i=h("Input"),n=h("Checkbox"),d=U("loading"),c=U("outside");return C((g(),f("div",{class:L(["select-location",e.disabled&&"select-location--disabled"])},[v("button",{onClick:a[0]||(a[0]=a=>e.isCollapse=!e.disabled&&!e.isCollapse),ref:"refSelectButton",class:"select-location__button",tabindex:"1"},[v("div",ue,[x(e.$slots,"placeholder",j(N({isEmptySelectedLocation:e.isEmptySelectedLocation,totalSelectedLocation:e.totalSelectedLocation,selectedLocationName:e.selectedLocationName})),(()=>[e.isEmptySelectedLocation?(g(),f("span",me," Set Permission Location ")):(g(),f("span",pe,_(e.totalSelectedLocation)+" Location selected",1))])),a[2]||(a[2]=v("i",{class:"material-icons ml-2"},"keyboard_arrow_down",-1))])],512),k(q,{name:"fade"},{default:I((()=>[C(v("div",he,[e.searchable?(g(),f("div",ge,[k(i,{modelValue:e.search,"onUpdate:modelValue":a[1]||(a[1]=a=>e.$emit("update:search",a)),placeholder:"Search location",block:"",icon:""},{icon:I((()=>a[3]||(a[3]=[v("i",{class:"material-icons"},"search",-1)]))),_:1},8,["modelValue"])])):P("",!0),C((g(),f("div",fe,[(g(!0),f(b,null,y(e.locations,(a=>(g(),f("div",{key:a.id,class:"select-location__dropdown-item"},[e.multiple?(g(),V(n,{key:0,onClick:O((l=>e.handleSelectLocation(a)),["prevent"]),modelValue:Array.isArray(e.selectedLocation)?e.selectedLocation.includes(a.id):e.selectedLocation===a.id,class:"w-full"},{default:I((()=>[A(_(e.censorLocationName(a.name)),1)])),_:2},1032,["onClick","modelValue"])):(g(),f("button",{key:1,onClick:l=>e.handleSelectLocation(a),class:L(["select-location__dropdown-item-button",(Array.isArray(e.selectedLocation)?e.selectedLocation.includes(a.id):e.selectedLocation===a.id)&&"select-location__dropdown-item-button--active"])},_(e.censorLocationName(a.name)),11,ve))])))),128))])),[[d,e.loading]]),v("div",null,[x(e.$slots,"default")])],512),[[D,e.isCollapse]])])),_:3})],2)),[[c,()=>e.isCollapse=!1]])}]])},props:{data:{type:Object,default:()=>({email:null,first_name:null,last_name:null,job_title:null,status:1,default_location_id:null,default_location_name:null,locations:null,location_permission_all:null,password:null,password_score:0,role_id:1,select_all:!0,menu_list:null,menus:[]})},edit:{type:Boolean,default:!1},checked:{type:Object,default:{view_confidential:!1}},readonly:{type:Boolean,default:!1},permissionReadonly:{type:Boolean,default:!1},permissionOnly:{type:Boolean,default:!1},permissionMaxHeight:{type:Number,default:300}},setup(e){const{stateFiltered:a,stateLocationPermission:l,loading:t,query:o,queryLocationPermission:s,locations:i,locationsPremission:p}=R(),{loading:h,locations:g,defaultLocations:f,filters:v,pagination:b,selectedLocations:y,selectedDefaultLocation:L,getLocations:_,selectLocation:k,unselectLocation:w,selectDefaultLocation:x,unsetSelectedLocations:P,resetState:$}=ae(),U=B(),C=r(),j=u({main_menu:1,setting:1}),N=u({score:0,strength:null,show:!1}),I=u(e.data),V=m({get:()=>({id:I.default_location_id,name:I.default_location_name}),set:e=>{I.default_location_id=e?e.id:null,I.default_location_name=e?e.name:null}}),O=m((()=>a.value.data&&a.value.data&&D.value&&D.value.length?a.value.data.map((e=>D.value.includes(e.id)?d(n({},e),{disabled:!1}):d(n({},e),{disabled:!0}))):a.value?a.value.data:[])),A=c(!1),D=c([]),q=c(!1),F={first_name:{required:K},last_name:{required:K},email:{required:K,email:Q},job_title:{required:K}},E={first_name:{required:K},last_name:{required:K},email:{required:K,email:Q},default_location_id:{required:K},locations:{required:K},location_permission_all:{required:K}};e.edit||(E.password={required:K,passwordValidation:J.withMessage("At least 6 characters and include capital letters",J.regex(/^(?=.*?[A-Z]).{6,}$/))});const T=W(E,I,{$lazy:!0}),z=W(F,I,{$lazy:!0}),M=m((()=>{const t=a.value.data?a.value.data:[],o=l.value.data?l.value.data:[];return t.length<=1&&!e.readonly||o.length<=1&&!e.readonly?z.value:T.value})),H=m((()=>e.readonly)),X=m((()=>e.permissionReadonly||H.value)),Y=()=>{if(D.value.length&&1==D.value.length){const e=[...a.value.data].find((e=>e.id===D.value[0]));if(e)return void(V.value={id:e.id,name:e.name})}V.value=null},ee=Z((async e=>{v.search=e,v.page=1,await _({admin_id:U.params.userId||null},{isPaginate:!0})}),800);return S((async()=>{await _({admin_id:U.params.userId})})),G((()=>{$()})),{userLocationLoading:h,userLocations:g,userSelectedLocations:y,userLocationPagination:b,userLocationFilters:v,userDefaultLocations:f,userSelectedDefaultLocation:L,data:I,getScore:e=>{Object.assign(N,e)},password:N,validationGlobal:M,stateLocation:a,defaultLocations:O,stateLocationPermission:l,loadingLocation:t,selectedLocation:V,isFocusLocationPermission:A,selectedLocationPermission:D,selectedAllLocationPermission:q,query:o,queryLocationPermission:s,validate:()=>(M.value.$validate(),!M.value.$invalid),permission:j,isPermissionReadonly:X,isReadonly:H,changeMenu:e=>{e.id?e.child.forEach((a=>{a.child.forEach((a=>{a.status=e.status}))})):e.child.forEach((a=>{a.status=e.status}))},store:C,route:U,rules:E,handleLocationPermission:e=>{D.value=e,I.locations=D.value,Y()},handleLocationPermissionAll:e=>{q.value=e,I.location_permission_all=q.value?1:0,Y()},handleItemsChange:(e=[])=>{I.menus=e},handleChangePageUserLocation:async e=>{v.page=e,await _({admin_id:U.params.userId||null},{isPaginate:!0})},handleChangeLimitUserLocation:async e=>{v.limit=e,v.page=1,await _({admin_id:U.params.userId||null},{isPaginate:!0})},handleSearchUserLocation:ee,handleSelectUserLocation:e=>{y.value.includes(e.id)?w(e):k(e)},handleSelectUserDefaultLocation:e=>{x(e)}}}}),ye={class:"grid grid-cols-6"},Le={class:"grid grid-cols-6"},_e={class:"grid grid-cols-2 gap-4 xl:col-span-3 lg:col-span-4 col-span-6"},ke={class:"xl:col-span-1 lg:col-span-1 md:col-span-1 col-span-2"},we={class:"xl:col-span-1 lg:col-span-1 md:col-span-1 col-span-2"},Se={class:"xl:col-span-1 lg:col-span-1 md:col-span-1 col-span-2"},xe={class:"xl:col-span-1 lg:col-span-1 md:col-span-1 col-span-2"},Pe={class:"grid grid-cols-2 mb-4"},$e={class:"md:col-span-1 col-span-2"},Ue={class:"p-4"},Ce={class:"grid grid-cols-2 mb-4"},je={class:"md:col-span-1 col-span-2"},Ne={key:1,class:"xl:col-span-2 lg:col-span-2 md:col-span-2 col-span-2"},Ie={class:"col-span-6 my-2"};var Ve=E(be,[["render",function(e,a,l,t,o,s){const i=h("Input"),n=h("Fieldset"),d=h("Pagination"),c=h("SelectLocation"),r=h("PermissionTree");return g(),f("div",ye,[e.permissionOnly?P("",!0):(g(),V(n,{key:0,class:"col-span-6 rounded-lg mb-6"},{label:I((()=>a[6]||(a[6]=[A("User")]))),default:I((()=>[v("div",Le,[v("div",_e,[v("div",ke,[k(i,{modelValue:e.data.first_name,"onUpdate:modelValue":a[0]||(a[0]=a=>e.data.first_name=a),disabled:e.isReadonly,type:"text",label:"First Name",class:"w-full",view:e.validationGlobal.first_name.$invalid?"danger":"default"},null,8,["modelValue","disabled","view"]),(g(!0),f(b,null,y(e.validationGlobal.first_name.$errors,((e,a)=>(g(),f("span",{key:a,class:"text-red-base mt-2 block"},_(e.$message)+". ",1)))),128))]),v("div",we,[k(i,{modelValue:e.data.last_name,"onUpdate:modelValue":a[1]||(a[1]=a=>e.data.last_name=a),disabled:e.isReadonly,type:"text",label:"Last Name",class:"w-full",view:e.validationGlobal.last_name.$invalid?"danger":"default"},null,8,["modelValue","disabled","view"]),(g(!0),f(b,null,y(e.validationGlobal.last_name.$errors,((e,a)=>(g(),f("span",{key:a,class:"text-red-base mt-2 block"},_(e.$message)+". ",1)))),128))]),v("div",Se,[k(i,{modelValue:e.data.email,"onUpdate:modelValue":a[2]||(a[2]=a=>e.data.email=a),disabled:e.isReadonly,type:"email",label:"Email",class:"w-full",view:e.validationGlobal.email.$invalid?"danger":"default"},null,8,["modelValue","disabled","view"]),(g(!0),f(b,null,y(e.validationGlobal.email.$errors,((e,a)=>(g(),f("span",{key:a,class:"text-red-base mt-2 block"},_(e.$message)+". ",1)))),128))]),v("div",xe,[k(i,{modelValue:e.data.job_title,"onUpdate:modelValue":a[3]||(a[3]=a=>e.data.job_title=a),disabled:e.isReadonly,type:"text",label:"Job Title",class:"w-full",view:e.validationGlobal.job_title.$invalid?"danger":"default"},null,8,["modelValue","disabled","view"]),(g(!0),f(b,null,y(e.validationGlobal.job_title.$errors,((e,a)=>(g(),f("span",{key:a,class:"text-red-base mt-2 block"},_(e.$message)+". ",1)))),128))])])])])),_:1})),k(n,{class:"col-span-6 rounded-lg mb-6"},{label:I((()=>a[7]||(a[7]=[A("Location")]))),default:I((()=>[v("div",null,[v("div",Pe,[v("div",$e,[a[8]||(a[8]=v("label",null,"Location Permission",-1)),k(c,{"onUpdate:search":e.handleSearchUserLocation,"onUpdate:selectedLocation":e.handleSelectUserLocation,"selected-location":e.userSelectedLocations,locations:e.userLocations,search:e.userLocationFilters.search,loading:e.userLocationLoading.location.get,disabled:e.isPermissionReadonly,"total-location":e.userLocationPagination.total},{default:I((()=>[v("div",Ue,[k(d,{"onUpdate:page":e.handleChangePageUserLocation,"onUpdate:limit":e.handleChangeLimitUserLocation,page:e.userLocationFilters.page,limit:e.userLocationFilters.limit,data:e.userLocationPagination},null,8,["onUpdate:page","onUpdate:limit","page","limit","data"])])])),_:1},8,["onUpdate:search","onUpdate:selectedLocation","selected-location","locations","search","loading","disabled","total-location"])])]),v("div",Ce,[v("div",je,[a[9]||(a[9]=v("label",null,"Default Location",-1)),k(c,{"onUpdate:selectedLocation":e.handleSelectUserDefaultLocation,"selected-location":e.userSelectedDefaultLocation,locations:e.userDefaultLocations,multiple:!1,searchable:!1,loading:e.userLocationLoading.location.get,disabled:e.isPermissionReadonly||e.userSelectedLocations.length<1},{placeholder:I((({selectedLocationName:e})=>[A(_(e||"Set Default Location"),1)])),_:1},8,["onUpdate:selectedLocation","selected-location","locations","loading","disabled"])])])])])),_:1}),e.$props.edit||e.permissionOnly?P("",!0):(g(),f("div",Ne,[k(i,{modelValue:e.data.password,"onUpdate:modelValue":a[5]||(a[5]=a=>e.data.password=a),type:e.password.show?"text":"password",autocomplete:"new-password",label:"Password",class:"w-full",view:e.validationGlobal.password.$invalid?"danger":"default",icon:"",right:""},{icon:I((()=>[v("span",{class:"material-icons block cursor-pointer text-grey-03",onClick:a[4]||(a[4]=a=>e.password.show=!e.password.show)},_(e.password.show?"visibility_off":"visibility"),1)])),_:1},8,["modelValue","type","view"]),(g(!0),f(b,null,y(e.validationGlobal.password.$errors,((e,a)=>(g(),f("span",{class:"text-red-base mt-2 block",key:a},_(e.$message)+". ",1)))),128))])),v("div",Ie,[k(r,{items:e.data.menu_list.menus,onItemsChange:e.handleItemsChange,name:"name",disabled:e.isPermissionReadonly||e.permissionOnly,"max-height":"800"},{label:I((()=>a[10]||(a[10]=[v("label",{class:"font-medium"},"Permissions",-1)]))),_:1},8,["items","onItemsChange","disabled"])])])}],["__scopeId","data-v-0d45597c"]]);export{Ve as M,ce as P,ae as u};
