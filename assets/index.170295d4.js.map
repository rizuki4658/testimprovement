{"version":3,"file":"index.170295d4.js","sources":["../../src/views/invoice/create/Breadcrumb.vue","../../src/views/invoice/create/index.js"],"sourcesContent":["<template>\n  <Breadcrumb\n    class=\"mb-8 mt-4\"\n    pageTitle=\"Add Invoice\"\n    :backTo=\"{ name: 'invoice' }\"\n    :items=\"breadcrumb\">\n    <template v-if=\"$slots.buttonStep\" #right>\n      <slot name=\"buttonStep\" />\n    </template>\n  </Breadcrumb>\n</template>\n\n<script>\nimport { defineComponent } from 'vue'\nimport Breadcrumb from 'components/Breadcrumb.vue'\n\nexport default defineComponent({\n  components: {\n    Breadcrumb\n  },\n  setup() {\n    const breadcrumb = [{\n      text: 'Invoice',\n      to: {\n        name: 'invoice'\n      }\n    }, {\n      text: 'Add Invoice'\n    }]\n\n    return {\n      breadcrumb\n    }\n  }\n})\n</script>","import { defineComponent, defineAsyncComponent, h, ref, resolveDynamicComponent } from 'vue'\nimport { useRouter } from 'vue-router'\nimport { useSuspense } from 'composable/components'\nimport { useCreate } from 'composable/invoice'\nimport { useCreate as useCreateCustomer } from 'composable/customer'\nimport { useUser } from 'composable/user'\nimport Button from 'bbUi/components/button/button.vue'\nimport Card from 'bbUi/components/card/card.vue'\nimport Stepper from 'bbUi/components/stepper/stepper.vue'\nimport InvoiceDetail from 'components/Invoice/Detail.vue'\n// import InvoiceDevice from 'components/Invoice/Device.vue'\nimport InvoiceDeviceSearch from 'components/Invoice/Device/Search.vue'\nimport Breadcrumb from './Breadcrumb.vue'\n\nimport Customer from 'components/Customer'\nconst CustomerTable = defineAsyncComponent(() => import('components/Customer/Table.vue'))\n\n\nexport default defineComponent({\n  components: {\n    CustomerTable,\n    InvoiceDetail,\n    // InvoiceDevice\n    InvoiceDeviceSearch\n  },\n  setup() {\n    const router = useRouter()\n    const { me } = useUser()\n    const { genSuspense } = useSuspense()\n    const step = ref(1)\n    const { dataCustomer, dataInvoice, dataDevice, loading, action } = useCreate('invoice')\n    const { data: newCustomerData, action: actionCreateCustomer, loading: loadingCustomer } = useCreateCustomer()\n    const refCustomer = ref(false)\n\n    const selectCustomer = async (customer) => {\n      dataCustomer.customer_id = customer.customer_id || customer.id\n      dataCustomer.customer_email = customer.email\n      dataCustomer.customer_firstname = customer.first_name\n      dataCustomer.customer_lastname = customer.last_name\n      step.value = 2\n    }\n    const setNewCustomer = (data) => {\n      Object.assign(newCustomerData, data)\n    }\n    const registerNewCustomer = async () => {\n      const isValid = refCustomer.value.refChildComponent.validate()\n      if(isValid) {\n        await actionCreateCustomer(async (newCustomer) => {\n          await selectCustomer(newCustomer)\n        })\n      }\n    }\n    const genCustomerButton = () => {\n      return h(Button, {\n        color: 'teal',\n        // class: ['mt-4'],\n        loading: loadingCustomer.value,\n        onClick: () => registerNewCustomer()\n        },{\n          default: () => 'Continue'\n      })\n    }\n    const isNewCustomer = ref(false)\n    const genStepComponent = () => {\n      if(step.value === 1) return [h(Customer, {\n        onData: setNewCustomer,\n        onChoose: selectCustomer,\n        ref: refCustomer,\n        choose: true,\n        onChange: (tab) => isNewCustomer.value = tab === 'CustomerForm'\n      }), h('div', {\n        class: ['flex', 'items-center', 'justify-end']\n      })]\n      else {\n        let genChild\n        if(step.value === 2) genChild = h(InvoiceDetail, {\n          data: dataInvoice\n        })\n        else if(step.value === 3) genChild = genSuspense({\n          component: InvoiceDeviceSearch,\n          props: {\n            selected: dataDevice.value,\n            onChoose: data => {\n              const index = dataDevice.value.findIndex(item => item.id === data.id)\n              if(index === -1) dataDevice.value.push(data)\n              else dataDevice.value.splice(index, 1)\n            }\n          }\n        })\n\n        return [\n          h(Card, {\n            class: 'mb-4'\n          }, {\n            default: () => genChild\n          })\n        ]\n      }\n    }\n    const genButtonPrevButton = () => {\n      return h(Button, {\n        view: 'outlined',\n        color: 'teal',\n        onClick: () => step.value--\n      }, {\n        default: () => 'Previous'\n      })\n    }\n    const genButtonStepBread = () => {\n      if (step.value === 1) {\n        return isNewCustomer.value && genCustomerButton() || ''\n      }\n      if (step.value === 2) {\n        return [\n          h('div', {\n            class: 'flex items-center justify-between gap-x-2',\n          }, {\n            default: () => [\n              genButtonPrevButton(),\n              h(Button, {\n                color: 'teal',\n                loading: loading.value,\n                onClick: async (e) => {\n                  await action(response => {\n                    router.push({\n                      name: 'invoiceDetail',\n                      params: {\n                        buybackId: response.data.box_id\n                      },\n                      query: {\n                        new: true\n                      }\n                    })\n                  })\n                }\n              }, {\n                default: () => 'Continue'\n              })\n            ]\n          })\n        ]\n      }\n\n      return [\n        h('div', {\n          class: 'flex items-center justify-between gap-x-2'\n        }, {\n          default: () => [\n            genButtonPrevButton(),\n            h(Button, {\n              color: 'teal',\n              loading: loading.value,\n              onClick: () => step.value++\n            }, {\n              default: () => 'Next'\n            })\n          ]\n        })\n      ]\n    }\n\n    return () => [\n      h(Breadcrumb, {}, {\n        buttonStep: () => genButtonStepBread()\n      }),\n      h(Card, {}, {\n        default: () => [\n          h(Stepper, {\n            activeStep: step.value,\n            steps: ['Customer', 'Invoice Details'],\n            class: 'mb-16',\n            color: 'teal'\n          }),\n          genStepComponent()\n        ]\n      })\n    ]\n  }\n})"],"names":["defineComponent","components","Breadcrumb","setup","breadcrumb","text","to","name","_createBlock","_component_Breadcrumb","class","pageTitle","backTo","_createSlots","_","_withCtx","index","CustomerTable","defineAsyncComponent","__vitePreload","import","InvoiceDetail","InvoiceDeviceSearch","[object Object]","router","useRouter","useUser","genSuspense","useSuspense","step","ref","dataCustomer","dataInvoice","dataDevice","loading","action","useCreate","data","newCustomerData","actionCreateCustomer","loadingCustomer","useCreateCustomer","refCustomer","selectCustomer","async","customer","customer_id","id","customer_email","email","customer_firstname","first_name","customer_lastname","last_name","value","setNewCustomer","Object","assign","genCustomerButton","h","Button","color","onClick","refChildComponent","validate","newCustomer","registerNewCustomer","default","isNewCustomer","genStepComponent","Customer","onData","onChoose","choose","onChange","tab","genChild","component","props","selected","index2","findIndex","item","push","splice","Card","genButtonPrevButton","view","buttonStep","e","response","params","buybackId","box_id","query","new","Stepper","activeStep","steps"],"mappings":"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"}