{"version":3,"file":"BuybackImages.f97cd95f.js","sources":["../../src/store/pinia/buyback/images.js","../../src/components/Features/Buyback/BuybackImages/BuybackImages.vue"],"sourcesContent":["import { defineStore } from 'pinia'\nimport request from 'utils/request'\nimport { ElMessage } from 'element-plus'\n\nexport const useBuybackImages = defineStore('buybackImages', {\n  state: () => ({\n    routeParams: null,\n    isLoading: false,\n    images: []\n  }),\n  getters: {},\n  actions: {\n    setRoute(payload = {}) {\n      this.routeParams = payload\n    },\n    async $getImages(payload) {\n      this.isLoading = true\n      this.images = []\n      try {\n        const response = await request({\n          url: `/v1/pos/order/picture/${this.routeParams?.params?.buybackId}`,\n          method: 'get',\n          params: payload\n        })\n\n        const keys = Object.keys(response)\n        keys.forEach(key => {\n          this.images = [...this.images, ...response[key]]\n        })\n      } catch (error) {\n        console.error('Failed to fetch pictures', error)\n      } finally {\n        this.isLoading = false\n      }\n    },\n    async $uploadImage(files) {\n      this.isLoading = true\n      try {\n        await request({\n          url: `/v1/pos/order/picture/${this.routeParams.params.buybackId}`,\n          method: 'post',\n          data: files,\n          headers: {\n            'Content-Type': 'multipart/form-data'\n          }\n        })\n\n        ElMessage({\n          message: 'Picture uploaded!',\n          type: 'success'\n        })\n      } catch (error) {\n        console.error('Failed to upload pictures', error)\n      } finally {\n        this.isLoading = false\n      }\n    },\n    async $deleteImage(id) {\n      this.isLoading = true\n      try {\n        await request({\n          url: `/v1/pos/order/picture/${id}`,\n          method: 'post',\n          data: {\n            _method: 'DELETE'\n          }\n        })\n\n        ElMessage({\n          message: 'Picture deleted!',\n          type: 'success'\n        })\n      } catch (error) {\n        console.error('Failed to upload pictures', error)\n      } finally {\n        this.isLoading = false\n      }\n    }\n  }\n})\n","<script setup>\nimport { onMounted } from 'vue'\nimport { useRoute } from 'vue-router'\nimport { useBuybackImages } from '@/store/pinia/buyback/images'\n\nimport Card from 'bbUi/components/card/card.vue'\nimport LoadingCard from 'components/LoadingCard.vue'\nimport MultipleInputFile from 'components/MultipleInputFile.vue'\n\nconst route = useRoute()\nconst store  = useBuybackImages()\n\nstore.setRoute(route)\n\nconst onUpload = async (files) => {\n  if (!files?.length) return\n\n  const data = new FormData()\n  for( let [index, file] of Object.entries(files) ){\n    data.append(`picture_files[${index}]`, file)\n  }\n\n  await store.$uploadImage(data)\n  await store.$getImages()\n}\n\nconst onDelete = async (fileId) => {\n  await store.$deleteImage(fileId)\n  await store.$getImages()\n}\n\nconst onImageClick = (filePicture) => {\n  if(!!filePicture) window.open(filePicture, '_blank')\n}\n\nonMounted(async () => {\n  await store.$getImages()\n})\n\n</script>\n\n<template>\n  <Suspense>\n    <template #default>\n      <Card v-loading=\"store.isLoading\">\n        <template #header>\n          <h6 class=\"font-medium\">Image</h6>\n        </template>\n        <template #default>\n          <MultipleInputFile preview @input=\"onUpload\">\n            <template #preview>\n              <div class=\"w-full flex flex-wrap justify-center\">\n                <div\n                  v-for=\"(file, n) of store.images\"\n                  :class=\"[\n                    'm-4 relative transition duration-200',\n                    'transform hover:scale-105 cursor-pointer'\n                  ]\"\n                  :key=\"n\">\n                  <div\n                    :class=\"[\n                      'absolute top-0 right-0',\n                      'bg-teal-04 w-1 h-1 p-4',\n                      'box-content flex items-center',\n                      'justify-center transform -translate-x-2',\n                      '-translate-y-1/2 rounded-full font-semibold',\n                      'text-white hover:bg-white hover:text-teal-04',\n                      'transition duration-200 cursor-pointer'\n                    ]\"\n                    @click=\"onDelete(file.id)\">\n                    <i class=\"material-icons text-lg\">close</i>\n                  </div>\n                  <img\n                    :alt=\"`picture-${n}`\"\n                    :src=\"file.picture\"\n                    class=\"rounded-md\"\n                    @click=\"onImageClick(file.picture)\">\n                </div>\n              </div>\n            </template>\n          </MultipleInputFile>\n        </template>\n      </Card>\n    </template>\n    <template #fallback>\n      <LoadingCard />\n    </template>\n  </Suspense>\n</template>\n"],"names":["useBuybackImages","defineStore","state","routeParams","isLoading","images","getters","actions","[object Object]","payload","this","response","request","url","_b","_a","params","buybackId","method","Object","keys","forEach","key","error","console","files","data","headers","Content-Type","_u","message","type","id","_method","route","useRoute","store","setRoute","onUpload","async","length","FormData","index","file","entries","append","$uploadImage","$getImages","onMounted","fileId","$deleteImage","filePicture","window","open"],"mappings":"gVAIO,MAAMA,EAAmBC,EAAY,gBAAiB,CAC3DC,MAAO,KAAO,CACZC,YAAa,KACbC,WAAW,EACXC,OAAQ,KAEVC,QAAS,GACTC,QAAS,CACPC,SAASC,EAAU,IACjBC,KAAKP,YAAcM,GAAAD,iBAEJC,WACfC,KAAKN,WAAY,EACjBM,KAAKL,OAAS,GACV,IACI,MAAAM,QAAiBC,EAAQ,CAC7BC,IAAK,yBAAyB,OAAAC,EAAA,OAAAC,EAAAL,KAAKP,kBAAL,EAAAY,EAAkBC,aAAQ,EAAAF,EAAAG,YACxDC,OAAQ,MACRF,OAAQP,IAGGU,OAAOC,KAAKT,GACpBU,SAAeC,IAClBZ,KAAKL,OAAS,IAAIK,KAAKL,UAAWM,EAASW,OAAA,MAEtCC,GACPC,QAAQD,MAAM,2BAA4BA,GAClC,QACRb,KAAKN,WAAY,IAAAI,mBAGFiB,GACjBf,KAAKN,WAAY,EACb,UACIQ,EAAQ,CACZC,IAAK,yBAAyBH,KAAKP,YAAYa,OAAOC,YACtDC,OAAQ,OACRQ,KAAMD,EACNE,QAAS,CACPC,eAAgB,yBAIVC,EAAA,CACRC,QAAS,oBACTC,KAAM,YAAA,MAEDR,GACPC,QAAQD,MAAM,4BAA6BA,GACnC,QACRb,KAAKN,WAAY,IAAAI,mBAGFwB,GACjBtB,KAAKN,WAAY,EACb,UACIQ,EAAQ,CACZC,IAAK,yBAAyBmB,IAC9Bd,OAAQ,OACRQ,KAAM,CACJO,QAAS,YAIHJ,EAAA,CACRC,QAAS,mBACTC,KAAM,YAAA,MAEDR,GACPC,QAAQD,MAAM,4BAA6BA,GACnC,QACRb,KAAKN,WAAY,mIClEzB,MAAM8B,EAAQC,IACRC,EAASpC,IAEfoC,EAAMC,SAASH,GAET,MAAAI,EAAWC,MAAOd,IACtB,KAAY,MAAAA,OAAA,EAAAA,EAAAe,QAAQ,OAEpB,MAAMd,EAAO,IAAIe,SACjB,IAAA,IAAUC,EAAOC,KAASxB,OAAOyB,QAAQnB,GAClCC,EAAAmB,OAAO,iBAAiBH,KAAUC,SAGnCP,EAAMU,aAAapB,SACnBU,EAAMW,qBAYdC,GAAUT,gBACFH,EAAMW,4qBAVGR,OAAOU,UAChBb,EAAMc,aAAaD,SACnBb,EAAMW,sKAGO,IAACI,GAAAA,cACFC,OAAOC,KAAKF,EAAa"}