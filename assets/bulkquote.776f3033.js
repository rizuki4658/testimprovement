var e=Object.defineProperty,t=Object.defineProperties,o=Object.getOwnPropertyDescriptors,i=Object.getOwnPropertySymbols,a=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,c=(t,o,i)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[o]=i,s=(e,t)=>{for(var o in t||(t={}))a.call(t,o)&&c(e,o,t[o]);if(i)for(var o of i(t))n.call(t,o)&&c(e,o,t[o]);return e},r=(e,i)=>t(e,o(i));import{u,s as l}from"./index.ec266ec1.js";import{f as d,a5 as m,g as p,r as _,h as y}from"./vendor.f1efedad.js";const g=d(!1),f=e=>r(s({},e),{conditions:e.conditions.data.map((e=>({name:e.name,price:e.price,rule:e.rule,original_price:e.original_price,is_manually_priced:e.is_manually_priced})))}),v=e=>e.map((e=>null==e?void 0:e.items)).flat().map((e=>f(e))),I=e=>{const t="string"==typeof e?parseFloat(e):e;return isNaN(t)?0:t},h=(e,t=100)=>e.map((e=>r(s({},e),{price:I(e.price)*(t/100),original_price:I(e.price),is_manually_priced:!1}))),b=e=>{const t=[...e||[]];for(const o of t){const e=o.items;for(const t of e){const{conditions:e={}}=t,{data:o=[]}=e;for(const t of o)if(t.is_manually_priced)return!0}}return!1},Q=(e={},t=100)=>{var o;return r(s({},e),{conditions:r(s({},e.conditions?e.conditions:{}),{data:[...(null==(o=e.conditions)?void 0:o.data)?e.conditions.data:[]].map((e=>((e,t=100)=>e.is_manually_priced?r(s({},e),{price:I(e.original_price)*(t/100),is_manually_priced:!1}):e)(e,t)))})})},q=(e=[],t=100)=>[...Array.isArray(e)?e:[]].map((e=>r(s({},e),{items:[...Array.isArray(e.items)?e.items:[]].map((e=>Q(e,t)))}))),w=()=>{const e=m(),t=d("active_item");return{isBulkQuote:p((()=>["bulkQuoteDetail"].includes(e.name))),tabBulkQuote:p((()=>[{name:"Active",value:"active_item"},{name:"Reconciled",value:"reconciled_item"}])),selectedTab:t}},k=()=>{const e=d([]),t=_({getBulkQuoteItems:!1,getBulkQuoteItemInfo:!1,updateQuotePercentage:!1,deleteQuoteItem:!1}),o=d(100),i=d(0),a=_({updateQuoteItem:null,updateQuotePercentage:null}),n=p((()=>b(e.value)));return{items:e,loading:t,quotePercentage:o,totalItems:i,confirmManuallyPricedModal:g,hasManuallyPricedItems:n,resetManuallyPricedItems:()=>{const t=q(e.value);e.value=t},getBulkQuoteItems:async o=>{const{quoteId:i=null}=o||{};if(i)try{t.getBulkQuoteItems=!0;const o=await l.dispatch("bulkQuote/getBulkQuoteItems",{id:i});e.value=((e=[])=>{const t={};return Object.entries(e).forEach((([e,o])=>{o.forEach((o=>{t.hasOwnProperty(e)?t[e].items.push(r(s({},o),{conditions:{data:o.condition||[]}})):t[e]={id:o.top_category_id,name:o.group_name,is_mac:o.is_mac,items:[r(s({},o),{conditions:{data:o.condition||[]}})]}}))})),Object.entries(t).map((([e,t])=>t)).flat()})(o)}catch(a){console.error(a)}finally{t.getBulkQuoteItems=!1}},getBulkQuoteItemInfo:async e=>{const{quoteId:a=null}=e||{};if(a)try{t.getBulkQuoteItemInfo=!0;const e=await l.dispatch("bulkQuote/getBulkQuoteItemInfo",{id:a}),{quote_price:n,total_item:c}=e;o.value=n,i.value=c}catch(n){console.error(n)}finally{t.getBulkQuoteItemInfo=!1}},updateQuotePercentage:async(e={quoteId:""})=>{const{quoteId:i=""}=e||{};a.updateQuotePercentage&&a.updateQuotePercentage.abort(),a.updateQuotePercentage=new AbortController;try{return t.updateQuotePercentage=!0,await l.dispatch("bulkQuote/updateQuotePercentage",{id:i,data:{quote_price:o.value},signal:a.updateQuotePercentage.signal}),t.updateQuotePercentage=!1,!0}catch(n){return"cancelled"===n.message||(console.error(n),t.updateQuotePercentage=!1),!1}finally{t.updateQuotePercentage=!1}},updateQuoteItem:async(e={quoteId:"",item:{}})=>{const{quoteId:o="",item:i={}}=e||{};a.updateQuoteItem&&a.updateQuoteItem.abort(),a.updateQuoteItem=new AbortController;try{return t.updateQuotePercentage=!0,await l.dispatch("bulkQuote/updateQuoteItem",{id:o,data:f(i),signal:a.updateQuoteItem.signal}),t.updateQuotePercentage=!1,!0}catch(n){return"cancelled"===n.message||(console.error(n),t.updateQuotePercentage=!1),!1}},deleteQuoteItem:async(e={quoteId:"",itemId:""})=>{const{quoteId:o="",itemId:i=""}=e||{};try{return t.deleteQuoteItem=!0,await l.dispatch("bulkQuote/deleteQuoteItem",{id:o,data:{id:i}}),!0}catch(a){return!1}finally{t.deleteQuoteItem=!1}}}},P=()=>{const e=d(),t=d([]),o=d([]),c=d(!1),r=d(!1),u=d(null),m=()=>{t.value=[],o.value=[]};return{querySearch:e,products:t,categories:o,loading:c,isProductActiveButNoPrice:r,searchItems:async(d="")=>{m();const p=d||e.value;if(p){u.value&&u.value.abort(),u.value=new AbortController;try{c.value=!0;const e=await l.dispatch("bulkQuote/searchItems",{params:{search:p},signal:u.value.signal}),d=e.data,{product:m={}}=d,_=((e,t)=>{var o={};for(var c in e)a.call(e,c)&&t.indexOf(c)<0&&(o[c]=e[c]);if(null!=e&&i)for(var c of i(e))t.indexOf(c)<0&&n.call(e,c)&&(o[c]=e[c]);return o})(d,["product"]);r.value=1==(null==e?void 0:e.product_active_but_no_price);const y=Object.entries(m).map((([e,t])=>s({name:t.product_name},t)))||[],g=Object.entries(_).map((([e,t])=>({category_name:e,products:t})))||[];((e=[])=>{o.value=e})(y),((e=[])=>{t.value=e})(g),c.value=!1}catch(_){if("canceled"===_.message)return;console.error(_),c.value=!1}}},unsetItems:m}},O=(e={multiple:!1})=>{const t=d([]),o=d(!1),i=p((()=>{const{multiple:t=!1}=e;return!t}));return{selectedItems:t,loading:o,addItem:(e,o={})=>{i.value&&(t.value=[]);const{top_category_id:a,parent_category_name:n}=e;if(!(a&&n))return;const c=t.value.findIndex((t=>t.id===a&&t.is_mac===e.is_mac)),u=c>-1,l=o.quotePercentage||0,d=h(e.conditions&&e.conditions.data||[],l),m=r(s({},e.conditions),{data:d}),p=r(s({},e),{conditions:m,qty:1});if(!u)return void t.value.push({id:a,name:n,is_mac:p.is_mac,items:[p]});const _=t.value[c].items.findIndex((e=>0===p.is_custom?(null==e?void 0:e.product_id)===p.product_id:e.category_id===p.category_id&&e.is_mac===p.is_mac));_>-1?t.value[c].items[_].qty++:t.value[c].items.push(p)},createItem:async(e={quoteId:quoteId})=>{const{quoteId:a}=e||{};return!!a&&(i.value?await(async(e={items:[],quoteId:null})=>{try{const{quoteId:t,items:i}=e||{};o.value=!0;const a=v(i)[0];return await l.dispatch("bulkQuote/createQuoteItem",{id:t,data:a}),!0}catch(t){return console.error(t),!1}finally{o.value=!1}})({items:t.value,quoteId:a}):await(async(e={items:[],quoteId:null})=>{try{const{quoteId:t,items:i}=e||{};throw o.value=!0,new Error("not implemented yet")}catch(t){return console.error(t),!1}finally{o.value=!1}})({items:t.value,quoteId:a}))}}},S=()=>{const{me:e}=u(),t=d(!1),o=_({customer:{id:null,full_name:null,email:null,company:null,shipping_address1:null,shipping_address2:null,shipping_address_text:null,shipping_suite:null,shipping_city:null,shipping_phone:null,shipping_state:null,shipping_zip:null,shipping_country:null,shipping_expected_date_quote:null},sales_person:{name:[e.value.first_name||"",e.value.last_name||""].join(" "),email:e.value.email},additional_options:{memo:null,custom_fields:[]},is_use_memo:!1,is_use_custom_fields:!1,products:[],selected_products:[],quote_price_percentage:100}),i=p((()=>0===o.additional_options.custom_fields.length)),a=p((()=>o.additional_options.custom_fields.filter((e=>!e.value)).length>0)),n=p((()=>o.is_use_memo&&!o.additional_options.memo)),c=p((()=>o.is_use_custom_fields&&(a.value||i.value))),m=p((()=>0===o.selected_products.length)),f=p((()=>!o.sales_person.name||!o.sales_person)),I=p((()=>!(o.customer.full_name&&o.customer.email&&o.customer.company&&o.customer.shipping_address_text&&o.customer.shipping_expected_date_quote))),Q=p((()=>I.value||m.value||f.value||n.value||c.value)),w=p((()=>b(o.selected_products)));return{data:o,loading:t,isSubmitQuoteDisabled:Q,hasManuallyPricedItems:w,confirmManuallyPricedModal:g,addProduct:e=>{const{top_category_id:t,parent_category_name:i}=e;if(!(t&&i))return;const a=o.selected_products.findIndex((o=>o.id===t&&o.is_mac===e.is_mac)),n=a>-1,c=h(e.conditions&&e.conditions.data||[],o.quote_price_percentage),u=r(s({},e.conditions),{data:c}),l=r(s({},e),{conditions:u,qty:1});if(!n)return void o.selected_products.push({id:t,name:i,is_mac:l.is_mac,items:[l]});const d=o.selected_products[a].items.findIndex((e=>0===l.is_custom?(null==e?void 0:e.product_id)===l.product_id:e.category_id===l.category_id&&e.is_mac===l.is_mac&&e.is_custom===l.is_custom&&e.product_name===l.product_name));d>-1?o.selected_products[a].items[d].qty++:o.selected_products[a].items.push(l)},createBulkQuote:async()=>{try{t.value=!0;const e={};o.additional_options.custom_fields.forEach((t=>e[t.name]=t.value));const i={customer:r(s({},o.customer),{shipping_expected_date_quote:y(o.customer.shipping_expected_date_quote).format("DD/MM/YYYY")}),sales_person:o.sales_person,additional_options:{memo:o.additional_options.memo,custom_fields:e,add_shipping_label_number:o.additional_options.add_shipping_label_number},item_details:{quote_price:o.quote_price_percentage,item:v(o.selected_products)}};return await l.dispatch("bulkQuote/createBulkQuote",i)}catch(e){return null}finally{t.value=!1}},resetManuallyPricedItems:()=>{const e=[...o.selected_products];o.selected_products=q(e,o.quote_price_percentage)}}},j=()=>{const e=d(!1),t=d([]);return{loading:e,statuses:t,getQuoteStatuses:async()=>{try{e.value=!0,t.value=await l.dispatch("bulkQuote/getQuoteStatuses")}catch(o){console.error(o)}finally{e.value=!1}},updateQuoteStatus:async(t={quoteId:quoteId,status:status})=>{const{quoteId:o=null,status:i={}}=t||{},{id:a,step:n}=i;try{return e.value=!0,await l.dispatch("bulkQuote/updateQuoteStatus",{id:o,data:{status_id:a,new_step:n}}),!0}catch(c){return console.error(c),!1}finally{e.value=!1}}}},x=()=>{const e=_({id:null,category_id:null,top_category_id:null,is_custom:0,is_mac:0,product_id:null,product_name:null,qty:1,imei_required:0}),t=_({mac:{Processor:{id:null,name:null,options:[]},Memory:{id:null,name:null,options:[]},"Hard Drive":{id:null,name:null,options:[]},"Graphics Card":{id:null,name:null,options:[]}},color:{id:null,name:null,options:[]},condition:{id:null,name:null,price:0,rule:[],options:[]}}),o=_({qty:1,price:0,imeiNotes:[{imei:null,notes:null}]}),i=_({getSpecs:{Processor:!1,"Hard Drive":!1,Memory:!1,"Graphics Card":!1,color:!1,condition:!1},reconcile:!1}),a=p((()=>1==e.is_custom)),n=p((()=>1==e.is_mac)),c=p((()=>{const e=Number(o.qty)>0&&Number(o.price)>0,i=!!t.color.id,a=!!t.condition.id||!!t.condition.name,c=!n.value||0===Object.entries(t.mac).filter((([e,t])=>!t.id)).length;return e&&(i&&a&&c)})),u=p((()=>Object.entries(t.mac).filter((([e,t])=>"product_id"!==e&&!t.id)))),d=p((()=>{if(0===u.value.length)return null;const[e,t]=u.value[0];return{key:e,value:t}})),m=p((()=>Object.entries(t.mac).reduce(((e,[t,o])=>(e[t]=o.id||null,e)),{}))),y=()=>{Object.entries(t.mac).forEach((([e,o])=>{t.mac[e].id=null,t.mac[e].name=null,t.mac[e].options=[]})),t.color.id=null,t.color.name=null,t.color.options=[],Object.assign(e,{id:null,category_id:null,top_category_id:null,is_custom:0,is_mac:0,product_id:null,product_name:null,imei_required:0,qty:1}),t.condition.id=null,t.condition.name=null,t.condition.options=[]},g=(e=[])=>{t.condition.options=e},f=async()=>{let{product_id:o}=e;if(!o)return console.warn("Unable to get specs, missing product ID");o=String(o||"").split("-").length>0?String(o).split("-")[0]:o;const a=d.value?d.value.key:"condition",n=m.value;try{i.getSpecs[a]=!0;const e=await l.dispatch("bulkQuote/getSpecs",{params:r(s({product_id:o},n),{type:a,buyback_type:"mailin",is_editable:1,is_mac:1,condition:"condition"===a?1:0})});if("condition"===a)return void(t.condition.options=e);t.mac[a].options=e}catch(c){console.error(c)}finally{i.getSpecs[a]=!1}};return{selectedItem:e,specs:t,loading:i,isMacItem:n,isCustomItem:a,itemDetail:o,isValid:c,setSelectedItem:(t={})=>{t&&(y(),Object.entries(e).forEach((([o,i])=>{t.hasOwnProperty(o)?e[o]=t[o]:console.warn(`Property "${o}" does not exist in the selected item, it may cause an error`)})))},setSpecMac:async(e={key:null,item:{}})=>{const{key:o=null,item:i={}}=e;if(!o)return console.warn("Unable to set spec with null key");if(!Object.keys(t.mac).includes(o))return console.warn(`${o} is invalid spec key`);const{id:a=null,name:n=null}=i;t.mac[o].id=a,t.mac[o].name=n;const c=Object.keys(t.mac).indexOf(o);Object.keys(t.mac).forEach(((e,o)=>{o>c&&(t.mac[e].id=null,t.mac[e].name=null,t.mac[e].options=[])})),await f()},getConditions:async(t={quoteId:null})=>{const{product_id:o=null,category_id:n=null}=e||{},{quoteId:c=null}=t||{};if(!c)return console.warn("Unable to get condition, missing quote ID");if(a.value){return n?void(await(async(t={})=>{const{categoryId:o,quoteId:a}=t||{};try{i.getSpecs.condition=!0;const t=await l.dispatch("bulkQuote/getConditionsByCategoryId",{params:{category_id:o,is_mac:e.is_mac,box_id:a}});g(t)}catch(n){console.error(n)}finally{i.getSpecs.condition=!1}})({categoryId:n,quoteId:c})):console.warn("Unable to get condition, missing category ID")}if(!o)return console.warn("Unable to get condition, missing product ID");await(async(t={})=>{const{productId:o,quoteId:a}=t||{};try{i.getSpecs.condition=!0;const t=await l.dispatch("bulkQuote/getConditionsByProductId",{params:{product_id:o,is_mac:e.is_mac,buyback_type:"mailin",is_editable:0,condition:1,box_id:a}});g(t)}catch(n){console.error(n)}finally{i.getSpecs.condition=!1}})({productId:o,quoteId:c})},getSpecsByProductId:async()=>{const{product_id:o}=e;if(!(e=>e?!(!n.value||a.value)||(console.warn("No specs available for non-mac item or custom item"),!1):(console.warn("Unable to get specs, missing product ID"),!1))(o))return;const[i,c,s,r,u]=String(o||"").split("-");await f(),t.mac.Processor.id=c,await f(),t.mac.Memory.id=s,await f(),t.mac["Hard Drive"].id=r,await f(),t.mac["Graphics Card"].id=u,await f(),Object.keys(t.mac).forEach((e=>{const o=t.mac[e].options.find((o=>o.id==t.mac[e].id));o&&(t.mac[e].name=o.name)}))},getColors:async()=>{try{i.getSpecs.color=!0;((e=[])=>{t.color.options=e})(await l.dispatch("bulkQuote/getItemColors"))}catch(e){console.error(e)}finally{i.getSpecs.color=!1}},reconcileQuoteItem:async(a={quoteId:""})=>{const{quoteId:n=""}=a||{};if(!n)return console.warn("Unable to reconcile quote item, missing quote ID"),!1;try{i.reconcile=!0;const a=((e={items:{},specs:{},detail:{}})=>{const{item:t={},specs:o={},detail:i={}}=e||{},a={product_id:t.product_id,product_name:t.product_name,category_id:t.category_id,category_name:null,condition_id:o.condition.id,color_id:o.color.id,top_category_id:t.top_category_id,is_custom:t.is_custom,is_mac:t.is_mac,qty:Number(i.qty),price:i.price,imei_sn:null,buyback_type:"bulkquote",is_editable:0,notes:null,imei_required:t.imei_required,condition:o.condition.name,item_id:t.id};if(t.is_mac&&!t.is_custom&&5!==a.product_id.split("-").length){const e=[t.product_id,o.mac.Processor.id,o.mac.Memory.id,o.mac["Hard Drive"].id,o.mac["Graphics Card"]].join("-");a.product_id=e}const n=JSON.stringify(i.imeiNotes.map((e=>e.imei||""))),c=JSON.stringify(i.imeiNotes.map((e=>e.notes||"")));return a.imei_sn=n,a.notes=c,a})({item:e,specs:t,detail:o});return await l.dispatch("bulkQuote/reconcileItem",{id:n,data:a})}catch(c){return console.error(c),null}finally{i.reconcile=!1}}}};export{x as a,O as b,k as c,P as d,j as e,S as f,w as u};
