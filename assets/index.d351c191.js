var e=Object.defineProperty,l=Object.defineProperties,a=Object.getOwnPropertyDescriptors,o=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,i=Object.prototype.propertyIsEnumerable,s=(l,a,o)=>a in l?e(l,a,{enumerable:!0,configurable:!0,writable:!0,value:o}):l[a]=o,n=(e,l)=>{for(var a in l||(l={}))t.call(l,a)&&s(e,a,l[a]);if(o)for(var a of o(l))i.call(l,a)&&s(e,a,l[a]);return e},d=(e,o)=>l(e,a(o));import{u as r}from"./components.00bf6492.js";import{k as p,r as c,m,o as u,t as f,D as v,w as g,B as b,I as h,K as w,a1 as _,a2 as U,F as y,S,T as B,Q as C,U as I,f as k,g as F,n as V,y as D,h as N,$ as M,A as x,a5 as j,O as T}from"./vendor.9695fe57.js";import{ar as R,_ as P,d as E,b as q,j as z,ap as O,u as A,h as L}from"./index.c2f66179.js";import{p as Y}from"./setting.10b5d883.js";import{C as $}from"./card.f57f7ca5.js";import{B as H}from"./Breadcrumb.9ae3c470.js";import{F as K}from"./FileUpload.16a3bbc8.js";import"./LoadingCard.c138fa92.js";import"./breadcrumb.4b2ddf0a.js";const Q=p({name:"BookIsbnFileUpload",components:{FileUpload:K},props:{files:{type:Array,default:()=>[]},loading:{type:Boolean,default:!1}},emits:["completed","error","uploading","remove"],setup:(e,{emit:l})=>({fileUploadConfig:c({url:"/v1/pos/pricing/upload-pricing",method:"post",field:"csv"}),handleCompleteUpload:(e=[])=>{l("completed",e)},handleErrorUpload:(e=[])=>{l("error",e)},handleRemovedFile:(e=null)=>{l("remove",e)},fileSizeFormat:R})}),W={class:"block mt-4"},G={key:0},J={class:"relative w-full"},X={class:"flex items-center"},Z={class:"file-list__file-name"},ee={class:"file-list__file-size"},le={class:"file-list__file-remove pl-6"},ae={key:1,class:"px-4 py-4"},oe={class:"relative w-full"},te={class:"flex items-center"},ie={class:"file-list__file-name"},se={class:"file-list__file-size"},ne={class:"file-list__file-remove pl-6"},de=["onClick"];const re=p({name:"BookIsbnModalUpload",components:{Modal:E,Button:q,Alert:z,BookIsbnFileUpload:P(Q,[["render",function(e,l,a,o,t,i){const s=m("FileUpload");return u(),f("div",null,[v(s,{accept:["csv"],config:e.fileUploadConfig,files:e.files,"single-upload":"",onCompleted:e.handleCompleteUpload,onError:e.handleErrorUpload,onUploading:l[1]||(l[1]=l=>e.$emit("uploading",l)),onRemove:e.handleRemovedFile},{types:g((({acceptedFileTypes:e})=>[b("small",W,[l[2]||(l[2]=b("span",{class:"font-semibold"},"File:",-1)),h(" "+w(e)+" ",1),l[3]||(l[3]=b("span",{class:"font-semibold"},"Format:",-1)),l[4]||(l[4]=h(" ISBN, Title, Bid, Publisher "))])])),"file-list":g((({files:a,removeFile:o,isEmptyFiles:t})=>{var i;return[b("div",null,[t&&(null==(i=e.files)?void 0:i.length)>0?(u(),f("div",G,[(u(!0),f(_,null,U(e.files,(a=>(u(),f("div",{key:a.name,class:y(["file-list__item"])},[l[6]||(l[6]=b("div",{class:"file-list__file-icon pr-6"},[b("i",{class:"material-icons"},"insert_drive_file")],-1)),b("div",J,[b("div",X,[b("div",Z,w(a.name),1),b("div",ee,w(e.fileSizeFormat(a.size)),1)])]),b("div",le,[b("a",{onClick:l[0]||(l[0]=S((l=>e.handleRemovedFile(null)),["prevent"]))},l[5]||(l[5]=[b("i",{class:"material-icons"},"cancel",-1)]))])])))),128))])):t?I("",!0):(u(),f("div",ae,[(u(!0),f(_,null,U(a,(e=>(u(),f("div",{key:e.name,class:y(["file-list__item",e.status.progress<100?"file-list__item--onprogress":""])},[l[8]||(l[8]=b("div",{class:"file-list__file-icon pr-6"},[b("i",{class:"material-icons"},"insert_drive_file")],-1)),b("div",oe,[b("div",te,[b("div",ie,w(e.name),1),b("div",se,w(e.size),1)]),v(B,{name:"fade"},{default:g((()=>[e.status.progress<100?(u(),f("div",{key:0,class:"file-list__progress-bar",style:C({width:`${e.status.progress}%`})},null,4)):I("",!0)])),_:2},1024)]),b("div",ne,[b("a",{onClick:S((l=>o(e.id)),["prevent"])},l[7]||(l[7]=[b("i",{class:"material-icons"},"cancel",-1)]),8,de)])],2)))),128))]))])]})),_:1},8,["config","files","onCompleted","onError","onRemove"])])}]])},props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue","completed"],setup(e,{emit:l}){const{state:a,loading:o,getLatestUploadedFile:t,deleteUploadedFile:i,downloadTemplateFile:s,processUploadedFile:n}=O(),d=k(!1),r=k(!1),p=F({set:e=>l("update:modelValue",e),get:()=>e.modelValue}),c=F((()=>!a.latestUploadedFile.pricing_data_real_filename||d.value)),m=F((()=>a.latestUploadedFile.pricing_data_real_filename?[{name:a.latestUploadedFile.pricing_data_real_filename||"",size:a.latestUploadedFile.pricing_data_files_size||0}]:[]));return{state:a,loading:o,isShowModal:p,isDisabledCSVUpload:c,isUploading:r,latestISBNUploadedFile:m,handleDownloadCSVTemplate:async()=>await s(),handleUploadCompleted:async()=>{d.value=!1,await t()},handleUploadError:()=>{d.value=!0},handleUploading:(e=!1)=>{r.value=e},handleRemovedFile:async e=>{var l,o;const s=!!(null==e?void 0:e.status)&&(100===(null==(l=e.status)?void 0:l.progress)&&!1===(null==(o=e.status)?void 0:o.error));if(null===e||s)return a.latestUploadedFile.pricing_data_real_filename=null,await i(),void(await t());d.value=!1},handleProcessUploadedFile:async()=>{await n(),l("completed",!0)}}}}),pe={class:"flex justify-between items-center"};var ce=P(re,[["render",function(e,l,a,o,t,i){const s=m("Button"),n=m("Alert"),d=m("BookIsbnFileUpload"),r=m("Modal");return u(),V(r,{title:"Upload ISBN",modelValue:e.isShowModal,"onUpdate:modelValue":l[0]||(l[0]=l=>e.isShowModal=l)},{header:g((()=>[b("div",pe,[l[2]||(l[2]=b("div",null,[b("h2",{class:"text-xl font-semibold"},"Upload ISBN")],-1)),b("div",null,[v(s,{onClick:e.handleDownloadCSVTemplate,loading:e.loading.downloadTemplateFile,color:"teal",dense:""},{default:g((()=>l[1]||(l[1]=[b("span",null,[b("i",{class:"material-icons mr-2"},"download"),h("Template CSV")],-1)]))),_:1},8,["onClick","loading"])])])])),default:g((()=>[b("div",null,[v(n,{color:"blue",view:"smooth",class:"mb-5",dense:""},{left:g((()=>l[3]||(l[3]=[b("span",{class:"material-icons text-4xl"},"info",-1)]))),default:g((()=>[l[4]||(l[4]=h(" In the template, items priced at $0 wonâ€™t appear in the Widget after upload, and any blank price cells or formatting issues will trigger a validation error. Your upload will continue, and you will see a validation report listing any errors once it is complete. "))])),_:1}),v(d,{files:e.latestISBNUploadedFile,onCompleted:e.handleUploadCompleted,onError:e.handleUploadError,onUploading:e.handleUploading,onRemove:e.handleRemovedFile},null,8,["files","onCompleted","onError","onUploading","onRemove"])])])),footer:g((()=>[v(s,{onClick:e.handleProcessUploadedFile,disabled:e.isDisabledCSVUpload,loading:e.loading.processUploadedFile||e.isUploading,color:"teal"},{default:g((()=>l[5]||(l[5]=[b("span",null,[b("i",{class:"material-icons mr-2"},"upload"),h(" Update Existing ISBNs")],-1)]))),_:1},8,["onClick","disabled","loading"])])),_:1},8,["modelValue"])}]]);const me=p({name:"BookIsbnModalUpload",components:{Modal:E,Button:q,Alert:z},props:{modelValue:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(e,{emit:l}){const{state:a,loading:o,getInvalidData:t}=O(),{me:i}=A(),s=F({set:e=>l("update:modelValue",e),get:()=>e.modelValue});return D((()=>s.value),(async e=>{e&&await t()})),{state:a,loading:o,isShowModal:s,me:i,moment:N,handleDownloadInvalidCSV:()=>{window.open(a.invalidData.fileUrl,"_blank","noreferrer noopener")}}}}),ue={class:"flex justify-between items-center"},fe={class:"my-4"},ve={class:"text-right my-6"},ge={key:0,class:"p-4 border border-grey-01 rounded-lg mb-4"};const be=p({components:{Card:$,Button:q,Breadcrumb:H,BookISBNModal:ce,BookISBNInvalidModal:P(me,[["render",function(e,l,a,o,t,i){const s=m("Button"),n=m("Alert"),d=m("TableColumn"),r=m("Table"),p=m("Modal"),c=M("loading");return u(),V(p,{title:"Upload ISBN",modelValue:e.isShowModal,"onUpdate:modelValue":l[0]||(l[0]=l=>e.isShowModal=l),"hide-footer":"",size:"md"},{header:g((()=>[b("div",ue,[l[2]||(l[2]=b("div",null,[b("h2",{class:"text-xl font-semibold"},"Invalid Format Data")],-1)),b("div",null,[v(s,{onClick:e.handleDownloadInvalidCSV,loading:e.loading.getInvalidData,color:"teal",dense:""},{default:g((()=>l[1]||(l[1]=[b("span",null,[b("i",{class:"material-icons mr-2"},"download"),h("CSV")],-1)]))),_:1},8,["onClick","loading"])])])])),default:g((()=>[x((u(),f("div",null,[v(n,{class:"mb-4",color:"red",view:"smooth",dense:""},{default:g((()=>[b("p",fe,[l[3]||(l[3]=h(" We identified ")),b("b",null,w(e.state.invalidData.total),1),l[4]||(l[4]=h(" rows of data that don't meet the specified format requirements. "))]),e.state.invalidData.total>99?(u(),f(_,{key:0},[l[6]||(l[6]=b("p",{class:"my-4"}," To assist you, you can download a CSV file containing only the data that does not meet the required format. This file will help you identify and correct the formatting issues. ",-1)),v(s,{onClick:e.handleDownloadInvalidCSV,class:"mb-4",color:"teal",view:"outlined",dense:""},{default:g((()=>l[5]||(l[5]=[b("i",{class:"material-icons"},"download",-1),h(" CSV")]))),_:1},8,["onClick"])],64)):I("",!0)])),left:g((()=>l[7]||(l[7]=[b("span",{class:"material-icons mt-3"},"warning",-1)]))),_:1}),b("div",ve,[b("p",null,[l[8]||(l[8]=h(" Last Update: ")),b("b",null,w(e.state.invalidData.lastUpdatedAt?e.moment(e.state.invalidData.lastUpdatedAt,"YYYY-MM-DD HH:mm:ss").format(e.me.datetime_format):""),1)])]),e.state.invalidData.total<99||e.state.invalidData.rows.length>0?(u(),f("div",ge,[v(r,{data:e.state.invalidData.rows,height:"500"},{default:g((()=>[v(d,{prop:"ISBN",label:"ISBN"}),v(d,{prop:"Title",label:"Title",width:"250"}),v(d,{prop:"Bid",label:"Bid"}),v(d,{prop:"PUBLISHER",label:"Publisher"}),v(d,{prop:"Reason",label:"Reason"})])),_:1},8,["data"])])):I("",!0)])),[[c,e.loading.getInvalidData]])])),_:1},8,["modelValue"])}]])},async setup(){const e=j(),l=T(),{actionCategories:a}=Y(),{state:o,getLatestUploadedFile:t}=O(),{openNotification:i}=L(),s=F({get:()=>{var l,a,o;return"books"===(null==(o=null==(a=null==(l=e.params)?void 0:l.category)?void 0:a.toLowerCase)?void 0:o.call(a))&&"update"===e.query.isbn},set:a=>{!1===a&&l.push(d(n({},e),{query:{}}))}}),r=F({get:()=>{var l,a,o;return"books"===(null==(o=null==(a=null==(l=e.params)?void 0:l.category)?void 0:a.toLowerCase)?void 0:o.call(a))&&"invalid"===e.query.isbn},set:a=>{!1===a&&l.push(d(n({},e),{query:{}}))}});return await t(),{stateISBN:o,isShowISBNUpdateModal:s,isShowISBNInvalidModal:r,breadcrumb:[{text:"Settings",to:{name:"setting"}},{text:"Catalog"}],handleRequestDevice:()=>{window.open("https://forms.clickup.com/8427959/f/816dq-50276/FKAAVUJSUQ7G44BNOD","_blank","noreferrer noopener")},handleISBNProcessing:async()=>{await l.push({name:"settingBuybackDeviceTab",params:{category:"books"},query:{}}),await a(),i("NotificationPricingBooks")}}}}),he={class:"flex justify-between items-center mb-8"};var we=P(be,[["render",function(e,l,a,o,t,i){const s=m("Breadcrumb"),n=m("router-view"),d=m("BookISBNModal"),r=m("BookISBNInvalidModal"),p=m("Card"),c=m("Button");return u(),f("div",null,[b("div",he,[v(s,{pageTitle:"Catalog",backTo:{name:"setting"},items:e.breadcrumb},null,8,["items"])]),v(p,null,{default:g((()=>[v(n),v(d,{modelValue:e.isShowISBNUpdateModal,"onUpdate:modelValue":l[0]||(l[0]=l=>e.isShowISBNUpdateModal=l),onCompleted:e.handleISBNProcessing,style:{"z-index":"2000"}},null,8,["modelValue","onCompleted"]),v(r,{modelValue:e.isShowISBNInvalidModal,"onUpdate:modelValue":l[1]||(l[1]=l=>e.isShowISBNInvalidModal=l),style:{"z-index":"2000"}},null,8,["modelValue"])])),_:1}),v(p,{class:"mt-4",whitelabel:"remove"},{default:g((()=>[l[3]||(l[3]=h(" Can't find an item? Let us know and we will add it to our catalog. ")),v(c,{class:"ml-2",color:"teal",onClick:e.handleRequestDevice,dense:""},{default:g((()=>l[2]||(l[2]=[h("Request Item")]))),_:1},8,["onClick"])])),_:1})])}]]),_e=p({setup(){const{genSuspense:e}=r();return()=>e(we)}});export{_e as default};
