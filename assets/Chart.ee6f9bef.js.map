{"version":3,"file":"Chart.ee6f9bef.js","sources":["../../src/components/ChartDashboard.vue","../../src/views/dashboard/Chart.vue"],"sourcesContent":["<template>\n  <div>\n    <!-- <Button class=\"mt-3\" color=\"teal\" view=\"smooth\" dense @click=\"togglePoints\">Toggle</Button> -->\n    <canvas ref=\"chartRef\" height=\"105\" id=\"charts\"></canvas>\n  </div>\n</template>\n\n<script>\nimport Chart from \"chart.js/auto\";\nimport zoomPlugin from 'chartjs-plugin-zoom'\nimport { onMounted, ref, watch } from \"vue\";\nimport { useUser } from 'composable/user'\nimport { currency } from 'utils/number'\nimport Button from 'bbUi/components/button/button.vue'\n\nexport default {\n  components: {\n    Button\n  },\n  props: {\n    labels: Array,\n    data: Array,\n    dataLeads: Array,\n    type: {\n      default: \"line\",\n      type: String,\n    },\n  },\n  setup(props) {\n    const chartRef = ref(null);\n    const { me } = useUser()\n\n    const showPoints = ref(false)\n    const chartState = {\n      chart: null,\n      props: { ...props },\n    };\n    const roundUpToNiceNumber = (value) => {\n      if (!value || value <= 0) return 10;\n      const digits = Math.pow(10, Math.floor(Math.log10(value))); // basis 10 terdekat\n      return Math.ceil(value / digits) * digits;\n    }\n\n    const legendSpacing = {\n      id: 'extraLegendSpacing',\n      beforeInit(chart) {\n        const fitValue = chart.legend.fit\n        chart.legend.fit = function () {\n          fitValue.bind(chart.legend)()\n          this.height += 20; // px space between chart and legend\n        }\n      }\n    }\n    const togglePoints = () => {\n      showPoints.value = !showPoints.value;\n\n      if (chartState.chart) {\n        chartState.chart.data.datasets.forEach((dataset) => {\n          dataset.pointRadius = showPoints.value ? 3 : 0;\n          dataset.pointHoverRadius = showPoints.value ? 5 : 6;\n        });\n\n        chartState.chart.update();\n      }\n    }\n\n    const render = (labels, data, dataLeads) => {\n      if (chartState.chart) {\n        chartState.chart.destroy();\n        chartState.chart = null;\n      }\n\n      const allValues = [...data, ...dataLeads].filter(v => typeof v === 'number' && !isNaN(v));\n      const maxLabelY = roundUpToNiceNumber(Math.max(...allValues));\n      const maxTick = Math.max(\n        data.filter(i => i > 0).length,\n        dataLeads.filter(i => i > 0).length,\n        1\n      );\n      const stepSize = Math.ceil(maxLabelY / maxTick);\n\n      const ctx = chartRef.value.getContext(\"2d\");\n      const gradient = ctx.createLinearGradient(0, 0, 0, 400);\n      gradient.addColorStop(0, \"#4ED3BB\");\n      gradient.addColorStop(0.5, \"#4ED3BB\");\n      gradient.addColorStop(1, \"#FFFFFF\");\n\n      Chart.register(zoomPlugin, legendSpacing)\n      Chart.defaults.font.family = \"'Poppins'\"\n\n      chartState.chart = new Chart(ctx, {\n        type: chartState.props.type,\n        responsive: false,\n        maintainAspectRatio: false,\n        options: {\n          plugins: {\n            legend: {\n              display: true,\n              labels: {\n                usePointStyle: true,\n                pointStyle: 'circle',\n                color: '#a8a8a890'\n              }\n            },\n            tooltip: {\n              callbacks: {\n                label: function(context) {\n                  let label = context.dataset.label || '';\n\n                  if (label) {\n                    label += ': ';\n                  }\n                  if (context.parsed.y !== null) {\n                    label += currency(me.value, context.parsed.y)\n                  }\n                  return label;\n                }\n              }\n            }\n          },\n          scales: {\n            y: {\n              max: maxLabelY + stepSize,\n              ticks: {\n                stepSize: stepSize,\n                beginAtZero: true,\n                color: '#a8a8a890',\n                callback: (value) => {\n                  return currency(me.value, value)\n                },\n                autoSkip: true,\n                font: {\n                  size: 12\n                }\n              }\n            },\n            x: {\n              ticks: {\n                callback: function(value) {\n                  const label = this.getLabelForValue(value);\n                  return window.innerWidth <= 1028 ? label.slice(0, 3) : label;\n                },\n                color: '#a8a8a890',\n                autoSkip: false,\n                maxRotation: 0,\n                minRotation: 0,\n                font: {\n                  size: 12\n                }\n              }\n            }\n          }\n        },\n        data: {\n          labels: labels,\n          datasets: [\n            {\n              label: \"Paid\",\n              data: data,\n              fill: false,\n              backgroundColor: \"#424242\",\n              borderColor: \"#424242\",\n              tension: 0.4,\n              borderWidth: 1.5,\n              pointRadius: showPoints.value ? 3 : 0,\n              pointHoverRadius: 5,\n              pointHitRadius: 20\n            },\n            {\n              label: \"Leads\",\n              data: dataLeads,\n              fill: false,\n              backgroundColor: \"#1672ec\",\n              borderColor: \"#1672ec\",\n              tension: 0.4,\n              borderWidth: 1.5,\n              pointRadius: showPoints.value ? 3 : 0,\n              pointHoverRadius: 5,\n              pointHitRadius: 20\n            },\n          ],\n        },\n      });\n    };\n\n    watch(\n      [() => props.labels, () => props.data, () => props.dataLeads],\n      () => {\n        render(props.labels, props.data, props.dataLeads);\n      },\n      {\n        deep: true,\n      }\n    );\n\n    onMounted(() => render(props.labels, props.data, props.dataLeads));\n\n    return {\n      chartRef,\n      togglePoints\n    };\n  },\n};\n</script>","<template>\n  <Card class=\"shadow-lg h-full\">\n    <!--    <template #header>-->\n    <!--      <p class=\"font-semibold\">Monthly Buyback</p>-->\n    <!--    </template>-->\n    <div class=\"sm:flex\">\n      <div class=\"w-1/2 space-y-3\">\n        <p class=\"text-teal-02\">\n          Total Buybacks:\n          <span class=\"text-teal-04 font-bold\">{{ state.total_count }}</span>\n        </p>\n        <p class=\"text-teal-02\">\n          Total Payouts:\n          <span class=\"text-teal-04 font-bold\">\n            <Currency :value=\"state.total\" />\n          </span>\n        </p>\n        <p class=\"text-teal-02\">\n          Total Item Quantity:\n          <span class=\"text-teal-04 font-bold\">{{\n            state.total_device_quantity\n          }}</span>\n        </p>\n      </div>\n      <div class=\"w-1/2 flex\">\n        <GroupContainer class=\"filter-container\">\n          <Select\n            placeholder=\"Status\"\n            class=\"w-full\"\n            :items=\"localBuyback\"\n            by=\"id\"\n            name=\"name\"\n            v-model=\"data.local\"\n          />\n          <Select\n            placeholder=\"Month\"\n            class=\"w-full\"\n            :items=\"months\"\n            by=\"id\"\n            name=\"name\"\n            v-model=\"data.month\"\n          />\n          <Select class=\"w-full\" :items=\"years\" v-model=\"data.year\" />\n        </GroupContainer>\n      </div>\n    </div>\n    <ChartDashboard\n      :labels=\"state.labels\"\n      :data=\"state.data\"\n      :data-leads=\"state.data_leads\"\n    />\n  </Card>\n</template>\n\n<script>\nimport { defineComponent, watch } from 'vue'\nimport { useChart } from 'composable/dashboard'\nimport Card from 'bbUi/components/card/card.vue'\nimport CardHeader from 'components/dashboard/CardHeader.vue'\nimport ChartDashboard from 'components/ChartDashboard.vue'\nimport Select from 'bbUi/components/select/select.vue'\nimport Currency from 'components/Currency.vue'\nimport GroupContainer from 'bbUi/components/group-container/group-container.vue'\n\nexport default defineComponent({\n  components: {\n    Card,\n    CardHeader,\n    ChartDashboard,\n    Select,\n    Currency,\n    GroupContainer\n  },\n  async setup() {\n    const { data, state, chart } = useChart()\n\n    const generateArrayOfYears = () => {\n      var max = new Date().getFullYear()\n      var min = max - 9\n      var years = []\n\n      for (var i = max; i >= min; i--) {\n        years.push(i)\n      }\n      return years\n    }\n\n    const months = [\n      {\n        id: 'all',\n        name: 'All'\n      },\n      {\n        id: 1,\n        name: 'January'\n      },\n      {\n        id: 2,\n        name: 'February'\n      },\n      {\n        id: 3,\n        name: 'March'\n      },\n      {\n        id: 4,\n        name: 'April'\n      },\n      {\n        id: 5,\n        name: 'May'\n      },\n      {\n        id: 6,\n        name: 'June'\n      },\n      {\n        id: 7,\n        name: 'July'\n      },\n      {\n        id: 8,\n        name: 'August'\n      },\n      {\n        id: 9,\n        name: 'September'\n      },\n      {\n        id: 10,\n        name: 'October'\n      },\n      {\n        id: 11,\n        name: 'November'\n      },\n      {\n        id: 12,\n        name: 'December'\n      }\n    ]\n\n    const years = generateArrayOfYears()\n\n    const localBuyback = [\n      {\n        id: '',\n        name: 'All'\n      },\n      {\n        id: 'leads',\n        name: 'Leads'\n      },\n      {\n        id: 'paid',\n        name: 'Paid'\n      }\n    ]\n\n    await chart()\n\n    watch(\n      () => data,\n      async () => {\n        await chart()\n      },\n      {\n        deep: true\n      }\n    )\n\n    return {\n      data,\n      state,\n      months,\n      years,\n      localBuyback\n    }\n  }\n})\n</script>\n\n<style lang=\"scss\" scoped>\n.filter-container{\n  @apply justify-end #{!important}\n}\n</style>"],"names":["ref","height","_sfc_main","defineComponent","components","Card","CardHeader","ChartDashboard","Button","props","labels","Array","data","dataLeads","type","default","String","[object Object]","chartRef","me","useUser","showPoints","chartState","chart","__spreadValues","legendSpacing","id","fitValue","legend","fit","bind","this","render","destroy","allValues","filter","v","isNaN","maxLabelY","value","digits","Math","pow","floor","log10","ceil","roundUpToNiceNumber","max","maxTick","i","length","stepSize","ctx","getContext","gradient","createLinearGradient","addColorStop","Chart","register","zoomPlugin","Chart$1","defaults","font","family","responsive","maintainAspectRatio","options","plugins","display","usePointStyle","pointStyle","color","tooltip","callbacks","label","context","dataset","parsed","y","currency","scales","ticks","beginAtZero","callback","autoSkip","size","x","getLabelForValue","window","innerWidth","slice","maxRotation","minRotation","datasets","fill","backgroundColor","borderColor","tension","borderWidth","pointRadius","pointHoverRadius","pointHitRadius","watch","deep","onMounted","togglePoints","forEach","update","_cache","$props","$setup","$data","$options","_openBlock","_createElementBlock","Select","Currency","GroupContainer","state","useChart","years","Date","getFullYear","min","years2","push","generateArrayOfYears","async","months","name","localBuyback","_hoisted_1","class","_hoisted_2","_hoisted_3","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_createBlock","_component_Card","_withCtx","_createElementVNode","_createTextVNode","_component_Currency","_hoisted_9","_createVNode","_component_Select","placeholder","items","_ctx","by","modelValue","local","month","year","_component_ChartDashboard"],"mappings":"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"}