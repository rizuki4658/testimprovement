var e=Object.defineProperty,a=Object.defineProperties,t=Object.getOwnPropertyDescriptors,l=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,r=(a,t,l)=>t in a?e(a,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):a[t]=l;import{u as i}from"./components.d5e25037.js";import{k as d,a5 as n,f as m,g as c,r as p,W as u,y as f,m as v,$ as b,o as y,t as g,B as w,D as h,w as _,I as x,A as k,F as C,K as O,n as T,U as R,a1 as P,_ as j}from"./vendor.9695fe57.js";import{T as E,c as M}from"./TextEditor.472081d3.js";import{R as L,u as I}from"./RevisedOfferPreview.0b72022f.js";import{_ as V,d as S,b as U,f as B,u as D,R as H}from"./index.dcc9fc55.js";import{B as $}from"./Breadcrumb.5b80dabd.js";import{C as W}from"./card.323f324c.js";import"./LoadingCard.d443bc39.js";import"./CollapsibleCard.52f5aa2a.js";import"./IframeRender.46e71567.js";import"./breadcrumb.82cee0bd.js";const A=d({components:{RevisedOfferPreview:L,Modal:S,Button:U,Breadcrumb:$,Card:W,TextEditor:E,Input:B},async setup(){const{state:e,data:i,loading:d,modal:v,openModal:b,closeModal:y,actionShow:g,actionPreviewRevisedOffer:w,actionResetTemplate:h,isPreviewRevisedOffer:_,previewedRevisedOffer:x,actionUpdate:k}=I(),{me:C}=D(),O=n(),T=m(null),R=m({paragraphs:0,words:0,chars:0}),P=m(!1),E=m([{text:"Settings",to:{name:"setting"}},{text:"Customer Portal",to:{name:"settingCustomerPortal"}},{text:"Edit Template Revised Offer"}]),L=c((()=>{var e;return((null==(e=null==i?void 0:i.email_template)?void 0:e.sort_code)||[]).map((e=>{return i=((e,a)=>{for(var t in a||(a={}))s.call(a,t)&&r(e,t,a[t]);if(l)for(var t of l(a))o.call(a,t)&&r(e,t,a[t]);return e})({},e),d={description:e.description.replace(/\\/g,""),tooltip:e.tooltip?e.tooltip.replace(/\\n/g,"<br/>"):null},a(i,t(d));var i,d}))})),V=p({editor:M.exports.Editor,config:{htmlSupport:{allow:[{styles:!0,classes:!0}]},link:{decorators:{test:{mode:"automatic",callback:e=>"{:verify-link}"===e,classes:"btn btn-blue btn-filled my-4"}}},simpleUpload:{uploadUrl:`https://api-us.buybackcloud.com/api/v1/pos/settings/email-template/upload-image/${O.params.templateId}?buyback_company_token=${C.value.buyback_company_token}`}}}),S=e=>{if(!e)return void(R.value={paragraphs:0,words:0,chars:0});const a=(e=>{const a=document.createElement("textarea");return a.innerHTML=e,a.value})(e.replace(/<[^>]*>/g,""));R.value.chars=a.length;const t=(e.match(/<p[^>]*>/g)||[]).length;R.value.paragraphs=t||1;const l=a.trim().split(/\s+/).filter((e=>/^[\p{L}\p{N}]+$/u.test(e)));R.value.words=l.length,P.value=R.value.chars>500};return u((()=>{setTimeout((()=>{i.email_template&&i.email_template.body&&S(i.email_template.body)}),300)})),await g({id:O.params.templateId,type:O.params.type}),f((()=>{var e;return null==(e=i.email_template)?void 0:e.body}),(e=>{e&&S(e)}),{immediate:!0}),{state:e,data:i,modal:v,ckeditor:V,breadcrumb:E,refTextEditor:T,isPreviewRevisedOffer:_,previewedRevisedOffer:x,shortCodes:L,loading:d,stats:R,isOverLimit:P,openModal:b,closeModal:y,handlePreviewRevisedOffer:async()=>{i.type=i.email_template.name,await w()},handleResetTemplate:async()=>{await h((async()=>{y("reset_template"),await g({id:O.params.templateId,type:O.params.type}),i.email_template&&i.email_template.body&&S(i.email_template.body)}))},updateTemplate:async()=>{d.update=!0;if(!T.value.isEditorReady)return;if(await T.value.forceSave()){if(P.value)return j({type:"error",message:"Character limit exceeded! Please reduce the content to maximum 500 characters."}),void(d.update=!1);await k({id:O.params.templateId,type:O.params.type},(()=>{j({type:"success",message:"Email template change"})})),d.update=!1}},copyText:e=>{navigator.clipboard.writeText(e).then((()=>{j({type:"success",message:"Text copied to clipboard"})}))},updateStats:S}}}),F={class:"flex justify-between items-center mb-8"},z={class:"mb-4 w-full md:w-1/2"},K={class:"col-span-2"},N={class:"flex justify-between items-center mt-2"},Y={key:0,class:"text-blue-03"},q={key:1,class:"text-red-04"},G={class:"mr-2"},J=["onClick"],Q={class:"w-96"},X=["innerHTML"],Z={class:"flex justify-end"},ee={class:"py-10"},ae={class:"text-center"};var te=V(A,[["render",function(e,a,t,l,s,o){const r=v("Breadcrumb"),i=v("Input"),d=v("Button"),n=v("TextEditor"),m=v("Tooltip"),c=v("TableColumn"),p=v("Table"),u=v("Card"),f=v("Modal"),j=v("RevisedOfferPreview"),E=b("loading");return y(),g(P,null,[w("div",null,[w("div",F,[h(r,{"back-to":{name:"settingCustomerPortal"},items:e.breadcrumb,"page-title":"Edit Template Revised Offer"},null,8,["items"])]),h(u,null,{footer:_((()=>[w("div",Z,[h(d,{color:"teal",onClick:e.updateTemplate,loading:e.loading.update},{default:_((()=>a[10]||(a[10]=[x("Save")]))),_:1},8,["onClick","loading"])])])),default:_((()=>[w("div",z,[a[6]||(a[6]=w("label",{class:"mb-2"},"Title",-1)),h(i,{modelValue:e.data.email_template.name,"onUpdate:modelValue":a[0]||(a[0]=a=>e.data.email_template.name=a),class:"w-full",disabled:""},null,8,["modelValue"])]),k((y(),g("div",K,[h(n,{modelValue:e.data.email_template.body,"onUpdate:modelValue":[a[2]||(a[2]=a=>e.data.email_template.body=a),e.updateStats],ref:"refTextEditor",options:e.ckeditor,"with-image-upload":""},{toolbar:_((()=>[h(d,{class:"ml-2",onClick:e.handlePreviewRevisedOffer,loading:e.loading.preview_email,color:"teal",dense:""},{default:_((()=>a[7]||(a[7]=[w("i",{class:"material-icons mr-1"},"visibility",-1),x(" Preview Email ")]))),_:1},8,["onClick","loading"]),h(d,{onClick:a[1]||(a[1]=a=>e.openModal("reset_template")),loading:e.loading.reset_template,class:"ml-auto",color:"orange",view:"smooth",dense:""},{default:_((()=>a[8]||(a[8]=[w("i",{class:"material-icons"},"restart_alt",-1),x(" Reset to Default ")]))),_:1},8,["loading"])])),_:1},8,["modelValue","options","onUpdate:modelValue"]),w("div",N,[e.isOverLimit?(y(),g("p",q,"Character limit exceeded! Maximum is 500 characters.")):(y(),g("p",Y,"Revised Offer info can be atmost 500 characters")),w("div",{class:C(["text-gray-600 p-2 rounded bg-gray-100",{"text-red-500":e.isOverLimit}])}," Paragraphs: "+O(e.stats.paragraphs)+", Words: "+O(e.stats.words)+", Characters (with HTML): "+O(e.stats.chars)+"/500 ",3)]),e.shortCodes.length>0?(y(),T(p,{key:0,class:"mt-6",data:e.shortCodes},{default:_((()=>[h(c,{label:"Code"},{default:_((t=>[w("div",{class:C(["short-code",t.row.is_disabled?"short-code--disabled":""])},[w("span",G,O(t.row.code),1),!t.row.is_disabled||t.row.disabled?(y(),g("i",{key:0,class:"material-symbols-outlined text-lg text-teal-04",style:{"font-variation-settings":"'FILL' 0"},onClick:a=>e.copyText(t.row.code)}," content_copy ",8,J)):R("",!0),t.row.tooltip?(y(),T(m,{key:1,placement:"top"},{content:_((()=>[w("div",Q,[w("span",{innerHTML:t.row.tooltip},null,8,X)])])),default:_((()=>a[9]||(a[9]=[w("i",{class:"material-icons text-lg text-teal-04"},"info",-1)]))),_:2},1024)):R("",!0)],2)])),_:1}),h(c,{label:"Description"},{default:_((e=>[w("div",{class:C(["inline-block","short-code",e.row.is_disabled?"short-code--disabled":""])},O(e.row.description),3)])),_:1})])),_:1},8,["data"])):R("",!0)])),[[E,e.loading.show]])])),_:1})]),h(f,{modelValue:e.modal.reset_template,"onUpdate:modelValue":a[4]||(a[4]=a=>e.modal.reset_template=a),"hide-footer":"","hide-header":"",size:"xs"},{default:_((()=>[w("div",ee,[a[13]||(a[13]=w("img",{class:"mb-10 mx-auto",src:H,alt:"Warning icon"},null,-1)),a[14]||(a[14]=w("div",{class:"mt-8 mb-10"},[w("h5",{class:"mb-4 text-center"},"Reset Email Template"),w("p",{class:"text-center mb-6"}," Are you sure you want to reset to the default email template? ")],-1)),w("div",ae,[h(d,{onClick:a[3]||(a[3]=a=>e.closeModal("reset_template")),view:"outlined",color:"teal",class:"bg-white",disabled:e.loading.reset_template},{default:_((()=>a[11]||(a[11]=[x(" Cancel ")]))),_:1},8,["disabled"]),h(d,{onClick:e.handleResetTemplate,view:"smooth",color:"orange",class:"ml-3",loading:e.loading.reset_template},{default:_((()=>a[12]||(a[12]=[x(" Yes, reset ")]))),_:1},8,["onClick","loading"])])])])),_:1},8,["modelValue"]),h(j,{show:e.isPreviewRevisedOffer,"onUpdate:show":a[5]||(a[5]=a=>e.isPreviewRevisedOffer=a),body:e.previewedRevisedOffer,type:e.data.type,title:"Preview Text","render-type":"direct"},null,8,["show","body","type"])],64)}]]),le=d({setup(){const{genSuspense:e}=i();return()=>e(te)}});export{le as default};
