import{k as e,r as a,f as l,y as i,W as t,o as s,t as n,B as o,a2 as u,a3 as d,F as r,K as m,A as p,aF as c,Q as v,U as y,_ as f}from"./vendor.f1efedad.js";import{r as g,_ as h,g as k}from"./index.9aa6481b.js";import{u as E}from"./index.32689823.js";import{d as b,e as w}from"./index.05b14cb2.js";import{k as x}from"./setting.2daa7691.js";const A=e({name:"MultipleEmailInput",emits:["email-change"],props:{emails:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},suggestion:{type:Boolean,default:!1},autofocus:{type:Boolean,default:!1},sticky:{type:Boolean,default:!1}},setup(e,{emit:s}){const{actionAll:n,state:o,data:u}=x(),d=a({email:""}),r=l(g(e.emails)),m=l(null),p=l(5),c=l(-1),v=k((()=>{s("email-change",r.value)}),300),y=k((async()=>{e.suggestion&&(u.page=1,u.limit=3,u.search=d.email,await n())}),300);i((()=>d.email),(()=>{var e,a;"string"==typeof d.email&&(d.email=d.email.trim()),p.value=9*(null==(e=d.email)?void 0:e.length),0!==(null==(a=d.email)?void 0:a.length)||(p.value=9)})),e.suggestion&&i((()=>e.emails),(()=>{r.value=g(e.emails),s("email-change",r.value)}));const h={email:{required:b((()=>!!d.email)),email:w}},A=E(h,d,{$lazy:!0}),C=()=>(A.value.$validate(),!A.value.$invalid),$=e=>{let a=!0;return r.value.map((l=>{l===e&&(f({message:"Email already added",type:"warning"}),a=!1)})),a},B=()=>{c.value>=0&&c.value<=o.value.data.length-1&&$(o.value.data[c.value].email)&&(r.value.push(o.value.data[c.value].email),setTimeout((()=>d.email=""),1),v())};return t((()=>{e.autofocus&&m.value&&m.value.focus()})),{state:o,data:d,emails:r,size:p,keyArrow:e=>{if(!(d.email.split("").length&&o.value.data&&o.value.data.length&&o.value&&Array(o.value)&&o.value.length))return;const a=e.keyCode?e.keyCode:e.which;38===a&&c.value>0&&(c.value-=1),40===a&&c.value<o.value.data.length-1&&(c.value+=1),40!==a&&39!==a&&38!==a&&37!==a&&13!==a&&(c.value=-1)},emailFocused:c,focusInput:()=>{e.disabled||m.value.focus()},emailOver:e=>{c.value=e},inputEmail:e=>{var a;if(!d.email.split("").length)return;const l=e.keyCode?e.keyCode:e.which;if(((null==(a=d.email)?void 0:a.length)>=60||32===l&&!d.email)&&e.preventDefault(),(13===l||32===l)&&d.email.trim().length>0){if(B(),!C())return void(32===l&&e.preventDefault());$(d.email)&&(r.value.push(d.email),setTimeout((()=>d.email=""),1),v())}},searchEmail:y,validation:A,validate:C,inputEmailRef:m,removeEmail:e=>{r.value.splice(e,1),v()},selectEmail:B,editEmail:e=>{const a=r.value.splice(e,1);d.email=a[0]},handleAddEmail:()=>{if(d.email){if(B(),!C())return null;$(d.email)&&(r.value.push(d.email),setTimeout((()=>d.email=""),1),v())}}}}}),C=["onClick"],$=["onClick"],B={key:0,class:"relative my-auto"},I=["readonly"],j=["tabindex","onMouseover"],z={class:"text-lg text-grey-darken font-semibold"},K={key:1,class:"relative my-auto"},F=["readonly"];var M=h(A,[["render",function(e,a,l,i,t,f){return s(),n(u,null,[o("div",{class:r(["cursor-text p-4 border border-grey-01 rounded-lg flex flex-wrap gap-3 transition-all",{"opacity-50 cursor-not-allowed":e.disabled}]),onClick:a[11]||(a[11]=(...a)=>e.focusInput&&e.focusInput(...a))},[(s(!0),n(u,null,d(e.emails,((a,l)=>(s(),n("span",{class:r({"px-4 py-1 bg-teal-01 hover:bg-teal-04 hover:text-white transition-all border border-teal-04 rounded-3xl cursor-pointer flex items-center space-x-1":e.emails.length>0}),onClick:a=>e.editEmail(l),key:l},[o("span",null,m(a),1),o("i",{class:"material-icons mt-1",onClick:a=>e.removeEmail(l)},"close",8,$)],10,C)))),128)),e.suggestion?(s(),n("div",B,[p(o("input",{ref:"inputEmailRef","onUpdate:modelValue":a[0]||(a[0]=a=>e.data.email=a),class:r({"w-full":e.emails.length<=0,"cursor-not-allowed":e.disabled}),style:v({width:`${e.size}px`}),readonly:e.disabled,onKeydown:a[1]||(a[1]=(...a)=>e.keyArrow&&e.keyArrow(...a)),onKeypress:a[2]||(a[2]=(...a)=>e.inputEmail&&e.inputEmail(...a)),onInput:a[3]||(a[3]=(...a)=>e.searchEmail&&e.searchEmail(...a)),onBlur:a[4]||(a[4]=(...a)=>e.handleAddEmail&&e.handleAddEmail(...a))},null,46,I),[[c,e.data.email]]),e.state.data&&e.state.data.length>0&&e.data.email&&e.suggestion?(s(),n("div",{key:0,class:r([e.sticky?"absolute top-full":"fixed top-full","bg-white py-4 rounded space-y-3 shadow"]),style:{"z-index":"2001"}},[(s(!0),n(u,null,d(e.state.data,((l,i)=>(s(),n("div",{tabindex:i,key:l,class:r(["px-4 py-4 cursor-pointer",{"bg-grey-01":i===e.emailFocused}]),onMouseover:a=>e.emailOver(i),onClick:a[5]||(a[5]=(...a)=>e.selectEmail&&e.selectEmail(...a))},[o("div",z,m(`${l.first_name} ${l.last_name}`),1),o("div",null,m(l.email),1)],42,j)))),128))],2)):y("",!0)])):(s(),n("div",K,[p(o("input",{ref:"inputEmailRef","onUpdate:modelValue":a[6]||(a[6]=a=>e.data.email=a),class:r({"w-full":e.emails.length<=0,"cursor-not-allowed":e.disabled}),style:v({width:`${e.size}px`}),readonly:e.disabled,onKeydown:a[7]||(a[7]=(...a)=>e.keyArrow&&e.keyArrow(...a)),onKeypress:a[8]||(a[8]=(...a)=>e.inputEmail&&e.inputEmail(...a)),onInput:a[9]||(a[9]=(...a)=>e.searchEmail&&e.searchEmail(...a)),onBlur:a[10]||(a[10]=(...a)=>e.handleAddEmail&&e.handleAddEmail(...a))},null,46,F),[[c,e.data.email]])]))],2),""!==e.data.email?(s(!0),n(u,{key:0},d(e.validation.email.$errors,(e=>(s(),n("span",{class:"text-red-base mt-2 block",key:e},m(e.$message)+". ",1)))),128)):y("",!0)],64)}]]);export{M};
