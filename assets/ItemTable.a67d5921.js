var e=Object.defineProperty,a=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,l=(a,o,t)=>o in a?e(a,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[o]=t;import{k as i,a5 as d,f as r,W as n,g as c,y as s,s as u,m,a0 as p,o as v,t as y,B as b,U as _,A as w,n as f,w as h,D as g,a2 as k,I as C,K as I,a1 as S,S as D}from"./vendor.f1efedad.js";import{f as U,b as j,d as O,u as T,a5 as V,_ as P}from"./index.9aa6481b.js";import{l as q}from"./dymo.fbcd861f.js";import{e as x,c as L}from"./buyback.8c173696.js";import{C as M}from"./card.dfb8e6f7.js";import{_ as B}from"./badge.b59865a3.js";import{D as F}from"./Form.52df5181.js";import{P as $}from"./PrintLabel.d570b4e8.js";import{C as A}from"./Currency.ae08941b.js";const N=i({components:{Input:U,Button:j,Modal:O,Card:M,DeviceForm:F,PrintLabel:$,Currency:A,Badge:B},props:{showPrintLabel:{type:Boolean,default:!0},showTableSummary:{type:Boolean,default:!0},selectedItems:{type:Array,default:()=>[]},selectable:{type:Boolean,default:!1},scanIn:{type:Boolean,default:!1},widthColumn:{type:Object,default:()=>({id:"80",product_name:"300",condition:"100",qty:"50",price:"100",total:"100",action:""})},buybackType:{type:String,default:"mailin"}},emits:["selected-items"],setup(e,{emit:i}){const{state:m,device:p,loading:v,modal:y,selected:b,unsetData:_,openModal:w,actionAll:f,actionCreate:h,actionUpdate:g,actionDelete:k}=x("mailin"===e.buybackType?"online":"local"),{data:C,isSelectedAllItems:I}=L("mailin"===e.buybackType?"online":"local"),S=d(),D=r(null),U=r([]),j=r(null),{me:O}=T(),P=()=>{if(!j.value)return;const e=B.value;((e=[])=>{const a=e.map((e=>e.id));C.ids=C.ids.filter((e=>a.includes(e)))})(e);if(1===e.length)return j.value.clearSelection(),void j.value.toggleRowSelection(e[0]);const a=e.filter((e=>C.ids.includes(e.id)));j.value.clearSelection();for(const o of a)j.value.toggleRowSelection(o)};n((async()=>{await f(S.params.buybackId,e.scanIn),(()=>{if(j.value&&!(B.value.length<1)){j.value.clearSelection();for(const e of B.value)j.value.toggleRowSelection(e)}})()}));const M=c((()=>m.value.items?JSON.parse(JSON.stringify(m.value.items)):[])),B=c((()=>M.value?M.value.map((e=>e.child.length>0?[...e.child]:[e])).flat():[])),F=c((()=>C.ids.length||0)),$=c((()=>I.value?`You have selected <b>All items (${F.value})</b>`:`You have selected <b>${F.value} items.</b> Please be aware that selected item will be processed as a separate buyback.`)),A=c((()=>M.value.length>1&&F.value>0));return s((()=>M.value),(()=>{P()}),{immediate:!0}),{device:p,state:m,items:M,loading:v,modal:y,selectedItemStatusInfo:$,isShowSelectedItemStatusInfo:A,printLabelData:U,unsetData:_,rowKey:e=>{const a=e.child?"_parent":"_child";return e.id+a},isParent:(e,a)=>!(e.child&&e.child.length>0),refDeviceForm:D,refTable:j,openModalSelected:(e,a)=>w(e,(()=>{"update"===e&&(p.id=a.id,Object.assign(p.data,{category_id:a.category_id,category_name:a.category_name,product_name:a.product_name,product_id:a.product_id,condition:a.condition,condition_id:a.condition_id,is_mac:a.is_mac,imei_sn:a.imei_sn,imei_required:a.imei_required,price:a.price,qty:a.qty,is_custom:a.is_custom,color:a.color,color_id:a.color_id,custom_color:a.custom_color,is_custom_color:null!==a.custom_color,notes:a.notes}),Object.assign(p.original,{is_mac:a.is_mac||0,product_name:a.ori_product_name||"",processor:a.ori_processor_speed||"",hard_drive:a.ori_hard_drive||"",memory:a.ori_memory||"",graphics:a.ori_graphics||"",network:a.ori_network||"",created_at:a.created_at})),b.value=a.id})),deviceTableUpdate:async e=>{await g(S.params.buybackId,e.id,{imei_sn:e.imei_sn,notes:e.notes})},addDevice:async()=>{await u((()=>D.value.validate()))&&await h(S.params.buybackId)},deleteDevice:async(e,a)=>{await k(S.params.buybackId)},updateDevice:async()=>{var i,d,r,n,c,s,m,v,y,b,_,w;if(await u((()=>D.value.validate()))){const u=((e,i)=>{for(var d in i||(i={}))o.call(i,d)&&l(e,d,i[d]);if(a)for(var d of a(i))t.call(i,d)&&l(e,d,i[d]);return e})({},p.data);Object.assign(u,{product_id:p.data.product_id+(p.computer.processor?`-${p.computer.processor.id}-${p.computer.memory.id}-${p.computer.hardDrive.id}-${p.computer.graphicsCard.id}`:""),processor:(null==(i=p.computer.processor)?void 0:i.name)||null,hard_drive:(null==(d=p.computer.hardDrive)?void 0:d.name)||null,memory:(null==(r=p.computer.memory)?void 0:r.name)||null,graphics:(null==(n=p.computer.graphicsCard)?void 0:n.name)||null,device:(null==(s=null==(c=p.device)?void 0:c.detail)?void 0:s.device)||null,model:(null==(v=null==(m=p.device)?void 0:m.detail)?void 0:v.model)||null,network:(null==(b=null==(y=p.device)?void 0:y.detail)?void 0:b.network)||null,size:(null==(w=null==(_=p.device)?void 0:_.detail)?void 0:w.size)||null,is_custom:p.data.is_custom||0,color_id:p.data.color_id,notes:p.data.notes}),await g(S.params.buybackId,p.id,u,(async()=>{await f(S.params.buybackId,e.scanIn)}))}},currency:V,openModal:w,tableSummary:({columns:e})=>e.map((e=>"total"===e.property?`${V(O.value,m.value.total)}`:"price"===e.property?"Total":"")),tableOnSelect:e=>{i("selected-items",e)},printLabel:e=>{const a=q({id:e.id,productName:e.product_name,isMac:e.is_mac,detail:e.detail,condition:e.condition,buybackId:S.params.buybackId,imei:e.imei_sn});U.value=[a],y.print_qr=!0}}}}),K={key:0,class:"p-4 bg-orange-01 text-orange-04 flex items-start rounded-lg mb-4"},R=["innerHTML"],z={class:"font-bold mb-0 inline-block mr-2"},E={class:"whitespace-nowrap"},H={key:1},J={key:1,class:"block"},Y={key:0,class:"flex flex-row items-center justify-center lg:opacity-0 group-hover:opacity-100 transition-opacity"};var Q=P(N,[["render",function(e,a,o,t,l,i){const d=m("TableColumn"),r=m("Badge"),n=m("Input"),c=m("Currency"),s=m("Button"),u=m("Table"),U=m("Modal"),j=m("DeviceForm"),O=m("PrintLabel"),T=p("loading");return v(),y(k,null,[b("div",null,[e.isShowSelectedItemStatusInfo?(v(),y("div",K,[a[10]||(a[10]=b("i",{class:"material-icons mr-4"},"info",-1)),b("p",{innerHTML:e.selectedItemStatusInfo,class:"my-1"},null,8,R)])):_("",!0)]),w((v(),f(u,{ref:"refTable","row-key":e.rowKey,data:e.items,"tree-props":{children:"child"},onSelectionChange:e.tableOnSelect,"show-summary":e.showTableSummary,"summary-method":e.tableSummary,"default-expand-all":""},{default:h((()=>[e.selectable?(v(),f(d,{key:0,type:"selection","reserve-selection":!0,selectable:e.isParent},null,8,["selectable"])):_("",!0),g(d,{prop:"id",label:"Item #",width:e.widthColumn.id},{default:h((e=>[!e.row.child||e.row.child&&0===e.row.child.length?(v(),y(k,{key:0},[C(I(e.row.id),1)],64)):_("",!0)])),_:1},8,["width"]),g(d,{prop:"product_name",label:"Item",width:e.widthColumn.product_name},{default:h((o=>[o.row.child?(v(),y(k,{key:0},[b("p",z,I(o.row.product_name),1),o.row.custom_color||o.row.color?(v(),f(r,{key:0,color:"grey"},{default:h((()=>[b("span",E,I(o.row.custom_color||o.row.color.name),1)])),_:2},1024)):_("",!0),0!==o.row.is_mac?(v(),y("small",H,I(o.row.detail),1)):_("",!0)],64)):_("",!0),o.row.child&&0!==o.row.child.length?_("",!0):(v(),y("div",J,[o.row.imei_required?(v(),f(n,{key:0,type:"text",placeholder:"IMEI/SN",class:"mb-2 mt-4 w-full",modelValue:o.row.imei_sn,"onUpdate:modelValue":e=>o.row.imei_sn=e,onFocusOut:a=>e.deviceTableUpdate(o.row),onKeypress:a[0]||(a[0]=S(D((()=>{}),["prevent"]),["space"])),dense:""},null,8,["modelValue","onUpdate:modelValue","onFocusOut"])):_("",!0),g(n,{type:"textarea",placeholder:"Notes...",class:"w-full",modelValue:o.row.notes,"onUpdate:modelValue":e=>o.row.notes=e,onFocusOut:a=>e.deviceTableUpdate(o.row),dense:""},null,8,["modelValue","onUpdate:modelValue","onFocusOut"])]))])),_:1},8,["width"]),g(d,{prop:"condition",label:"Condition",width:e.widthColumn.condition},null,8,["width"]),g(d,{prop:"qty",label:"Qty",width:e.widthColumn.qty},null,8,["width"]),g(d,{prop:"price",label:"Payout",width:e.widthColumn.price},{default:h((e=>[g(c,{value:e.row.price},null,8,["value"])])),_:1},8,["width"]),g(d,{prop:"total",label:"Total Payout",width:e.widthColumn.total},{default:h((e=>[g(c,{value:e.row.total},null,8,["value"])])),_:1},8,["width"]),g(d,{prop:"action",label:"",width:e.widthColumn.action},{default:h((o=>[o.row.child&&0!==o.row.child.length?_("",!0):(v(),y("div",Y,[e.showPrintLabel?(v(),f(s,{key:0,color:"teal",class:"mr-2",dense:"",onClick:a=>e.printLabel(o.row)},{default:h((()=>a[11]||(a[11]=[b("i",{class:"material-icons text-lg"},"print",-1)]))),_:2},1032,["onClick"])):_("",!0),g(s,{color:"teal",class:"mr-2",onClick:a=>e.openModalSelected("update",o.row),dense:""},{default:h((()=>a[12]||(a[12]=[b("i",{class:"material-icons text-lg"},"edit",-1)]))),_:2},1032,["onClick"]),g(s,{color:"red",onClick:a=>e.openModalSelected("delete",o.row),dense:""},{default:h((()=>a[13]||(a[13]=[b("i",{class:"material-icons text-lg"},"delete",-1)]))),_:2},1032,["onClick"])]))])),_:1},8,["width"])])),_:1},8,["row-key","data","onSelectionChange","show-summary","summary-method"])),[[T,e.loading.all]]),g(U,{modelValue:e.modal.delete,"onUpdate:modelValue":a[1]||(a[1]=a=>e.modal.delete=a),title:"Delete Item",onClose:e.unsetData},{footer:h((()=>[g(s,{color:"teal",loading:e.loading.delete,onClick:e.deleteDevice},{default:h((()=>a[14]||(a[14]=[C("Delete Item")]))),_:1},8,["loading","onClick"])])),default:h((()=>[a[15]||(a[15]=b("p",null,"Are you sure want to delete this item?",-1))])),_:1},8,["modelValue","onClose"]),g(U,{modelValue:e.modal.update,"onUpdate:modelValue":a[7]||(a[7]=a=>e.modal.update=a),style:{paddingTop:"3rem"},title:"Update Item",onClose:e.unsetData},{default:h((()=>[g(j,{ref:"refDeviceForm","auto-fill":"",data:e.device.data,"onUpdate:data":a[2]||(a[2]=a=>e.device.data=a),device:e.device.device,"onUpdate:device":a[3]||(a[3]=a=>e.device.device=a),dataComputer:e.device.computer,"onUpdate:dataComputer":a[4]||(a[4]=a=>e.device.computer=a),"is-custom-color":e.device.data.is_custom_color,"onUpdate:isCustomColor":a[5]||(a[5]=a=>e.device.data.is_custom_color=a),"custom-color":e.device.data.custom_color,"onUpdate:customColor":a[6]||(a[6]=a=>e.device.data.custom_color=a),"original-specs":e.device.original,hide:{qty:!0},"buyback-type":"mailin","is-editable":""},null,8,["data","device","dataComputer","is-custom-color","custom-color","original-specs"])])),footer:h((()=>[g(s,{color:"teal",loading:e.loading.update,onClick:e.updateDevice},{default:h((()=>a[16]||(a[16]=[C("Update")]))),_:1},8,["loading","onClick"])])),_:1},8,["modelValue","onClose"]),g(U,{modelValue:e.modal.print_qr,"onUpdate:modelValue":a[9]||(a[9]=a=>e.modal.print_qr=a),title:"Print Label"},{footer:h((()=>a[17]||(a[17]=[]))),default:h((()=>[g(O,{data:e.printLabelData,onCloseModal:a[8]||(a[8]=a=>e.modal.print_qr=!1)},null,8,["data"])])),_:1},8,["modelValue"])],64)}]]);export{Q as I};
