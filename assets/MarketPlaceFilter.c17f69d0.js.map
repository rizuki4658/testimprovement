{"version":3,"file":"MarketPlaceFilter.c17f69d0.js","sources":["../../src/components/Buyback/MarketPlaceFilter.vue","../../src/composable/marketplace.js"],"sourcesContent":["<template>\n  <div v-outside=\"clickOutside\" whitelabel=\"remove\" class=\"marketplace-filter\">\n    <span class=\"font-semibold whitespace-nowrap\"> {{ label }}: </span>\n    <div class=\"relative\">\n      <div class=\"trigger\" @click=\"toggleVisible\">\n        <input\n          v-if=\"data.selected\"\n          v-model=\"data.selected.name\"\n          type=\"text\"\n          readonly\n          placeholder=\"My Offer\"\n        />\n        <input v-else type=\"text\" readonly placeholder=\"My Offer\" />\n        <button>\n          <span class=\"material-icons text-grey-base\">\n            {{ data.visible ? 'arrow_drop_up' : 'arrow_drop_down' }}\n          </span>\n        </button>\n      </div>\n      <div v-show=\"data.visible\" class=\"dropdown\">\n        <div class=\"dropdown-container\">\n          <div class=\"px-4 mb-4\">\n            <Input\n              v-model=\"data.search\"\n              placeholder=\"Search Locations\"\n              class=\"w-full\"\n              tabindex=\"0\"\n              icon\n              @input=\"searching\"\n            >\n              <template #icon>\n                <span class=\"material-icons icon-sm text-grey-02\">\n                  search\n                </span>\n              </template>\n            </Input>\n          </div>\n          <ul v-loading=\"data.loading\" class=\"dropdown-menu\">\n            <li\n              v-for=\"(option, n) in data.options\"\n              :key=\"n\"\n              :class=\"[\n                'dropdown-item',\n                data.selected &&\n                  data.selected.id === option.id &&\n                  'dropdown-item--active',\n                option.linking_status == 'unlink' ||\n                option.linking_status === 'deleted'\n                  ? 'opacity-50 cursor-not-allowed'\n                  : ''\n              ]\"\n              @click=\"selectOption(option)\"\n            >\n              <div class=\"w-full flex items-center justify-between gap-x-2\">\n                <div class=\"flex items-center gap-x-2\">\n                  <div\n                    class=\"text-base max-w-xs overflow-hidden whitespace-nowrap overflow-ellipsis\"\n                  >\n                    {{ option.name }}\n                  </div>\n                  <div class=\"flex items-center gap-x-1\">\n                    <Tooltip\n                      v-if=\"\n                        (option.linking_status == 'unlink' ||\n                          option.linking_status === 'deleted') &&\n                        data.selected.id === option.id\n                      \"\n                      placement=\"top\"\n                    >\n                      <span class=\"material-icons text-xs w-5\">locked</span>\n                      <template #content>\n                        <div class=\"w-72 text-sm\">\n                          Your account with this marketplace has been removed,\n                          but you can still view the offer's details in\n                          read-only mode\n                        </div>\n                      </template>\n                    </Tooltip>\n                    <span\n                      v-else-if=\"\n                        option.linking_status == 'unlink' ||\n                        option.linking_status === 'deleted'\n                      \"\n                      class=\"material-icons text-xs w-5\"\n                      >locked</span\n                    >\n                    <template v-if=\"data.selected\">\n                      <span\n                        v-if=\"data.selected.id === option.id\"\n                        class=\"material-icons text-xs\"\n                      >\n                        check_circle\n                      </span>\n                    </template>\n                  </div>\n                </div>\n                <div\n                  class=\"bg-teal-04 h-6 px-2.5 overflow-hidden text-xs flex items-center justify-center rounded-full text-white\"\n                >\n                  {{ option.total_buybacks }}\n                </div>\n              </div>\n            </li>\n          </ul>\n          <div v-if=\"data.state && data.state.last_page > 1\">\n            <Pagination\n              v-model:page=\"data.page\"\n              v-model:limit=\"data.limit\"\n              :data=\"data.state\"\n              hide-show-entries\n              small\n            />\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nimport { watch } from 'vue'\nimport { useStore } from 'vuex'\nimport debounce from 'utils/debounce'\nimport { useMarketplace } from 'composable/marketplace'\n\nimport Input from 'bbUi/components/input/input.vue'\nimport Pagination from 'components/Pagination.vue'\n\nexport default {\n  name: 'MarketPlaceFilter',\n  components: {\n    Input,\n    Pagination\n  },\n  props: {\n    modelValue: {\n      type: Object,\n      default: undefined\n    },\n    label: {\n      type: String,\n      default: 'View Marketplace'\n    },\n    type: {\n      type: String,\n      default: 'online' // 'online' | 'local'\n    }\n  },\n  emits: ['update:modelValue', 'input'],\n  async setup(props, { emit }) {\n    const store = useStore()\n    const { data, getFilter } = useMarketplace(props.type)\n\n    const toggleVisible = () => {\n      data.visible = !data.visible\n    }\n    const clickOutside = () => {\n      data.visible = false\n    }\n    const selectOption = (item, options = {}) => {\n      const { emitEvent } = options\n      const isEmitEvent = emitEvent !== false\n      // if (item.linking_status == 'unlink') return\n      data.selected = item\n      data.visible = false\n\n      store.commit('setting/marketplace/SET_MARKETPLACE_FILTER', data.selected)\n      if(isEmitEvent){\n        emit('update:modelValue', data.selected)\n        emit('input', data.selected)\n      }\n    }\n    const searching = debounce(async () => {\n      await getFilter()\n    }, 300)\n\n    watch(\n      () => props.modelValue,\n      () => {\n        data.selected = props.modelValue\n      }\n    )\n\n    await getFilter().then(() => {\n      const selected = [...data.options].find((item) => item.selected)\n      selectOption(selected, {\n        emitEvent: false\n      })\n    })\n\n    return {\n      data,\n      getFilter,\n      searching,\n      clickOutside,\n      selectOption,\n      toggleVisible\n    }\n  }\n}\n</script>\n\n<style lang=\"scss\" scoped>\n.marketplace-filter {\n  @apply flex flex-wrap items-center gap-x-8;\n\n  .trigger {\n    @apply h-full w-full border border-grey-01 rounded-lg text-center flex items-center justify-center relative select-none;\n\n    input {\n      @apply border-0 rounded-md px-5 py-2.5 cursor-pointer overflow-hidden overflow-ellipsis;\n    }\n    button {\n      @apply bg-grey-01 py-2.5 px-3 bg-opacity-50;\n    }\n  }\n\n  .dropdown {\n    @apply absolute top-full bg-white right-0;\n\n    .dropdown-container {\n      @apply shadow rounded-lg border border-grey-01 border-opacity-50 py-4 mt-2 rounded-lg;\n\n      .dropdown-menu {\n        min-width: 240px;\n\n        .dropdown-item {\n          @apply cursor-pointer text-grey-03 px-4 h-12 flex items-center;\n\n          &:hover {\n            @apply bg-grey-01 bg-opacity-30 text-grey-base;\n          }\n          &--active {\n            @apply bg-grey-01 bg-opacity-0 text-teal-04 hover:text-teal-04;\n          }\n          &--disabled {\n            @apply opacity-50;\n          }\n        }\n      }\n    }\n  }\n}\n</style>\n<style lang=\"scss\">\n.marketplace-filter {\n  .pagination__summary {\n    display: none;\n  }\n}\n</style>","import axios from 'axios'\nimport store from 'store'\nimport { reactive } from 'vue'\nimport { isFunction } from 'utils/is'\n\nexport const useMarketplace = (type = 'online') => {\n  const data = reactive({\n    selected: null,\n    options: [],\n    loading: false,\n    visible: false,\n    page: 1,\n    limit: 10,\n    state: undefined,\n    search: '',\n    cancelToken: undefined\n  })\n\n  const getFilter = async (callback = () => {}) => {\n    data.loading = true    \n    try {\n      if (data.cancelToken) data.cancelToken.cancel()\n  \n      data.cancelToken = axios.CancelToken.source()\n      const response = await store.dispatch('setting/marketplace/getFilterMarketers', {\n        type: type === 'online' ? 'order' : 'local-order',\n        page: data.page,\n        ...(data.search && { search: data.search }),\n        ...(data.cancelToken && { cancelToken: data.cancelToken.token })\n      })\n      data.state = response\n      data.options = response.data\n      data.limit = response.per_page\n      data.page = response.current_page\n      isFunction(callback) && callback(response)\n    } catch (error) {\n      isFunction(callback) && callback(error)\n      data.options = []\n      data.visible = false,\n      data.page = 1\n      data.limit = 10\n      data.state = undefined\n      data.loading = false\n      return error\n    } finally {\n     data.loading = false\n    }\n  }\n\n  return {\n    data,\n    getFilter\n  }\n}"],"names":["_hoisted_1","whitelabel","_hoisted_2","class","key","type","readonly","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","name","components","Input","Pagination","props","modelValue","Object","default","label","String","emits","[object Object]","emit","store2","useStore","data","getFilter","reactive","selected","options","loading","visible","page","limit","state","search","cancelToken","async","callback","cancel","axios","CancelToken","source","response","store","dispatch","__spreadValues","token","per_page","current_page","isFunction","error","useMarketplace","selectOption","item","emitEvent","isEmitEvent","commit","searching","debounce","watch","then","find","clickOutside","toggleVisible","_withDirectives","_openBlock","_createElementBlock","_createElementVNode","_toDisplayString","$props","_hoisted_3","onUpdate:modelValue","_cache","$event","$setup","_hoisted_4","_createVNode","_component_Input","placeholder","tabindex","icon","_withCtx","_Fragment","_renderList","option","n","linking_status","_createCommentVNode","content","id","last_page","_hoisted_18","_component_Pagination","onUpdate:page","onUpdate:limit","hide-show-entries"],"mappings":"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"}