import{N as a,r as e,g as t,k as i,m as l,o,t as n,B as s,D as d,a2 as r,a3 as u,K as c,w as v,I as y,O as p,a5 as m,n as _}from"./vendor.f1efedad.js";import{u as k}from"./index.32689823.js";import{r as g}from"./index.a87b789d.js";import{v as f,f as C,b as h,e as E,_ as b,d as D}from"./index.9aa6481b.js";import"./index.05b14cb2.js";const T=i({name:"integrationKlayvioForm",components:{Input:C,Button:h,Checkbox:E},props:{modelValue:{type:Object,default:()=>({klaviyo_private_api_key:null})},validation:{type:Object,default:()=>({})},loading:{type:Object,default:()=>({})}},emits:["update:modelValue","update:resetValue"],setup:(a,{emit:e})=>({formData:t({get:()=>a.modelValue,set:a=>e("update:modelValue",a)}),handleReset:()=>e("update:resetValue")})}),V={class:"grid grid-cols-1 mb-8"},w={class:"col-span-1"},I={class:"border border-grey-02 border-opacity-50 rounded-lg p-4 space-y-4"};const N=i({name:"integrationKlaviyo",components:{Button:h,Modal:D,KlaviyoForm:b(T,[["render",function(a,e,t,i,p,m){const _=l("Input"),k=l("Checkbox");return o(),n(r,null,[s("div",V,[s("div",w,[d(_,{modelValue:a.formData.klaviyo_private_api_key,"onUpdate:modelValue":e[0]||(e[0]=e=>a.formData.klaviyo_private_api_key=e),placeholder:"Private API key",label:"Private API Key",block:"",view:a.validation.klaviyo_private_api_key.$invalid?"danger":"default"},null,8,["modelValue","view"]),(o(!0),n(r,null,u(a.validation.klaviyo_private_api_key.$errors,((a,e)=>(o(),n("small",{class:"text-red-base block",key:e},c(a.$message)+". ",1)))),128))])]),s("div",I,[d(k,{modelValue:a.formData.klaviyo_sms_disclosure,"onUpdate:modelValue":e[1]||(e[1]=e=>a.formData.klaviyo_sms_disclosure=e),loading:a.loading.update,type:"toggle",value:"1","value-off":"0",class:"font-semibold"},{default:v((()=>e[2]||(e[2]=[y(" SMS Disclosure ")]))),_:1},8,["modelValue","loading"]),e[3]||(e[3]=s("p",{class:"text-sm"}," Enabling this feature allows users to receive update offers via SMS at their convenience. You can activate this option if you are utilizing SMS marketing from Klaviyo. ",-1))])],64)}]])},async setup(){const i=p(),l=m(),{state:o,loading:n,validationRules:s,resetCredential:d,fetchMesssage:r,fetchCredential:u,updateMessage:c,updateCredential:v,connectCredential:y}=(()=>{const i=a(),l=e({klaviyo_private_api_key:"",klaviyo_sms_disclosure:"0"}),o=t((()=>i.state.integration.klaviyo.loading.credentials)),n=t((()=>({klaviyo_private_api_key:{required:g},klaviyo_sms_disclosure:{}})));return{state:l,validationRules:n,loading:o,resetCredential:async(a,e)=>{},connectCredential:async(a=(()=>{}))=>{try{i.commit("integration/klaviyo/SET_LOADING_CREDENTIAL_CONNECT",!0),await i.dispatch("integration/klaviyo/connectCredential",{klaviyo_private_api_key:l.klaviyo_private_api_key}),f(a)&&a(null)}catch(e){f(a)&&a(e)}finally{i.commit("integration/klaviyo/SET_LOADING_CREDENTIAL_CONNECT",!1)}},fetchCredential:async(a=(()=>{}))=>{try{await i.commit("integration/klaviyo/SET_LOADING_CREDENTIAL_FETCH",!0),await i.dispatch("integration/klaviyo/fetchCredential").then((a=>{Object.keys(l).forEach((e=>{a[e]&&(l[e]=a[e])}))})),f(a)&&a(null)}catch(e){f(a)&&a(e)}finally{await i.commit("integration/klaviyo/SET_LOADING_CREDENTIAL_FETCH",!1)}},fetchMesssage:async(a=(()=>{}))=>{},updateMessage:async(a=(()=>{}))=>{},updateCredential:async(a=(()=>{}))=>{try{await i.commit("integration/klaviyo/SET_LOADING_CREDENTIAL_UPDATE",!0),await i.dispatch("integration/klaviyo/updateCredential",{klaviyo_private_api_key:l.klaviyo_private_api_key,klaviyo_sms_disclosure:l.klaviyo_sms_disclosure}),f(a)&&a(null)}catch(e){f(a)&&a(e)}finally{await i.commit("integration/klaviyo/SET_LOADING_CREDENTIAL_UPDATE",!1)}}}})(),_=k(s,o,{$lazy:!0});return await u(),{state:o,loading:n,validation:_,handleReset:async a=>{},handleCloseForm:()=>{i.push({name:"integration",query:{reload:1}})},handleUpdateCredential:async()=>{_.value.$validate(),!_.value.$invalid&&await y((async a=>{a||await v((a=>{var e;a||i.push({name:"integration",query:{enable:(null==(e=l.query)?void 0:e.id)||""}})}))}))}}}}),A={class:"w-max ml-auto"};var O=b(N,[["render",function(a,e,t,i,n,r){const u=l("KlaviyoForm"),c=l("Button"),p=l("Modal");return o(),_(p,{size:"sm",modelValue:!0,onClickClose:a.handleCloseForm,"without-transition":""},{header:v((()=>e[1]||(e[1]=[s("div",{class:"flex justify-between"},[s("span",null,"Klaviyo Config")],-1)]))),default:v((()=>[d(u,{modelValue:a.state,"onUpdate:modelValue":e[0]||(e[0]=e=>a.state=e),loading:a.loading,validation:a.validation,"onUpdate:resetValue":a.handleReset},null,8,["modelValue","loading","validation","onUpdate:resetValue"])])),footer:v((()=>[s("div",A,[d(c,{color:"teal",loading:a.loading.connect||a.loading.update,onClick:a.handleUpdateCredential},{default:v((()=>e[2]||(e[2]=[y("Save Changes")]))),_:1},8,["loading","onClick"])])])),_:1},8,["onClickClose"])}]]);export{O as default};
