import{k as e,r as a,f as l,y as i,W as t,o as s,t as n,B as o,a1 as u,a2 as r,F as d,K as m,A as c,aF as p,Q as v,U as y,_ as f}from"./vendor.9695fe57.js";import{r as g,_ as h,g as k}from"./index.9c4dcead.js";import{u as E}from"./index.f40e4a9e.js";import{d as b,e as w}from"./index.6b6f6369.js";import{k as x}from"./setting.ec7e7a35.js";const A=e({name:"MultipleEmailInput",emits:["email-change"],props:{emails:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1},suggestion:{type:Boolean,default:!1},autofocus:{type:Boolean,default:!1},sticky:{type:Boolean,default:!1}},setup(e,{emit:s}){const{actionAll:n,state:o,data:u}=x(),r=a({email:""}),d=l(g(e.emails)),m=l(null),c=l(5),p=l(-1),v=k((()=>{s("email-change",d.value)}),300),y=k((async()=>{e.suggestion&&(u.page=1,u.limit=3,u.search=r.email,await n())}),300);i((()=>r.email),(()=>{var e,a;"string"==typeof r.email&&(r.email=r.email.trim()),c.value=9*(null==(e=r.email)?void 0:e.length),0!==(null==(a=r.email)?void 0:a.length)||(c.value=9)})),e.suggestion&&i((()=>e.emails),(()=>{d.value=g(e.emails),s("email-change",d.value)}));const h={email:{required:b((()=>!!r.email)),email:w}},A=E(h,r,{$lazy:!0}),C=()=>(A.value.$validate(),!A.value.$invalid),$=e=>{let a=!0;return d.value.map((l=>{l===e&&(f({message:"Email already added",type:"warning"}),a=!1)})),a},B=()=>{p.value>=0&&p.value<=o.value.data.length-1&&$(o.value.data[p.value].email)&&(d.value.push(o.value.data[p.value].email),setTimeout((()=>r.email=""),1),v())};return t((()=>{e.autofocus&&m.value&&m.value.focus()})),{state:o,data:r,emails:d,size:c,keyArrow:e=>{if(!(r.email.split("").length&&o.value.data&&o.value.data.length&&o.value&&Array(o.value)&&o.value.length))return;const a=e.keyCode?e.keyCode:e.which;38===a&&p.value>0&&(p.value-=1),40===a&&p.value<o.value.data.length-1&&(p.value+=1),40!==a&&39!==a&&38!==a&&37!==a&&13!==a&&(p.value=-1)},emailFocused:p,focusInput:()=>{e.disabled||m.value.focus()},emailOver:e=>{p.value=e},inputEmail:e=>{var a;if(!r.email.split("").length)return;const l=e.keyCode?e.keyCode:e.which;if(((null==(a=r.email)?void 0:a.length)>=60||32===l&&!r.email)&&e.preventDefault(),(13===l||32===l)&&r.email.trim().length>0){if(B(),!C())return void(32===l&&e.preventDefault());$(r.email)&&(d.value.push(r.email),setTimeout((()=>r.email=""),1),v())}},searchEmail:y,validation:A,validate:C,inputEmailRef:m,removeEmail:e=>{d.value.splice(e,1),v()},selectEmail:B,editEmail:e=>{const a=d.value.splice(e,1);r.email=a[0]},handleAddEmail:()=>{if(r.email){if(B(),!C())return null;$(r.email)&&(d.value.push(r.email),setTimeout((()=>r.email=""),1),v())}}}}}),C=["onClick"],$=["onClick"],B={key:0,class:"relative my-auto"},I=["readonly"],j=["tabindex","onMouseover"],z={class:"text-lg text-grey-darken font-semibold"},K={key:1,class:"relative my-auto"},F=["readonly"];var M=h(A,[["render",function(e,a,l,i,t,f){return s(),n(u,null,[o("div",{class:d(["cursor-text p-4 border border-grey-01 rounded-lg flex flex-wrap gap-3 transition-all",{"opacity-50 cursor-not-allowed":e.disabled}]),onClick:a[11]||(a[11]=(...a)=>e.focusInput&&e.focusInput(...a))},[(s(!0),n(u,null,r(e.emails,((a,l)=>(s(),n("span",{class:d({"px-4 py-1 bg-teal-01 hover:bg-teal-04 hover:text-white transition-all border border-teal-04 rounded-3xl cursor-pointer flex items-center space-x-1":e.emails.length>0}),onClick:a=>e.editEmail(l),key:l},[o("span",null,m(a),1),o("i",{class:"material-icons mt-1",onClick:a=>e.removeEmail(l)},"close",8,$)],10,C)))),128)),e.suggestion?(s(),n("div",B,[c(o("input",{ref:"inputEmailRef","onUpdate:modelValue":a[0]||(a[0]=a=>e.data.email=a),class:d({"w-full":e.emails.length<=0,"cursor-not-allowed":e.disabled}),style:v({width:`${e.size}px`}),readonly:e.disabled,onKeydown:a[1]||(a[1]=(...a)=>e.keyArrow&&e.keyArrow(...a)),onKeypress:a[2]||(a[2]=(...a)=>e.inputEmail&&e.inputEmail(...a)),onInput:a[3]||(a[3]=(...a)=>e.searchEmail&&e.searchEmail(...a)),onBlur:a[4]||(a[4]=(...a)=>e.handleAddEmail&&e.handleAddEmail(...a))},null,46,I),[[p,e.data.email]]),e.state.data&&e.state.data.length>0&&e.data.email&&e.suggestion?(s(),n("div",{key:0,class:d([e.sticky?"absolute top-full":"fixed top-full","bg-white py-4 rounded space-y-3 shadow"]),style:{"z-index":"3001"}},[(s(!0),n(u,null,r(e.state.data,((l,i)=>(s(),n("div",{tabindex:i,key:l,class:d(["px-4 py-4 cursor-pointer",{"bg-grey-01":i===e.emailFocused}]),onMouseover:a=>e.emailOver(i),onClick:a[5]||(a[5]=(...a)=>e.selectEmail&&e.selectEmail(...a))},[o("div",z,m(`${l.first_name} ${l.last_name}`),1),o("div",null,m(l.email),1)],42,j)))),128))],2)):y("",!0)])):(s(),n("div",K,[c(o("input",{ref:"inputEmailRef","onUpdate:modelValue":a[6]||(a[6]=a=>e.data.email=a),class:d({"w-full":e.emails.length<=0,"cursor-not-allowed":e.disabled}),style:v({width:`${e.size}px`}),readonly:e.disabled,onKeydown:a[7]||(a[7]=(...a)=>e.keyArrow&&e.keyArrow(...a)),onKeypress:a[8]||(a[8]=(...a)=>e.inputEmail&&e.inputEmail(...a)),onInput:a[9]||(a[9]=(...a)=>e.searchEmail&&e.searchEmail(...a)),onBlur:a[10]||(a[10]=(...a)=>e.handleAddEmail&&e.handleAddEmail(...a))},null,46,F),[[p,e.data.email]])]))],2),""!==e.data.email?(s(!0),n(u,{key:0},r(e.validation.email.$errors,(e=>(s(),n("span",{class:"text-red-base mt-2 block",key:e},m(e.$message)+". ",1)))),128)):y("",!0)],64)}]]);export{M};
