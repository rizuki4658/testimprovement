var e=Object.defineProperty,t=Object.defineProperties,o=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,i=Object.prototype.hasOwnProperty,r=Object.prototype.propertyIsEnumerable,c=(t,o,a)=>o in t?e(t,o,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[o]=a,s=(e,t)=>{for(var o in t||(t={}))i.call(t,o)&&c(e,o,t[o]);if(a)for(var o of a(t))r.call(t,o)&&c(e,o,t[o]);return e};import{k as d,m as n,o as l,n as u,aO as m,w as p,q as b,O as v,f,x as _,_ as j}from"./vendor.f1efedad.js";import{u as y}from"./components.bc8fc588.js";import{u as g}from"./buyback.73ce447d.js";import{u as C,a as w}from"./customer.417aaf8e.js";import{_ as h,b as k}from"./index.161fb295.js";import{C as x}from"./card.6a96327d.js";import{S}from"./stepper.0d7bb04f.js";import{P as B}from"./PaymentMethod.b6acc00f.js";import{D as q}from"./Device.06e6a48a.js";import{C as D}from"./Customer.d1b9683d.js";import{B as O}from"./Breadcrumb.5c6bcf4b.js";import"./LoadingCard.105ff0f2.js";import"./date.f86face7.js";import"./format.f845777a.js";import"./tab.1390e648.js";import"./Custom.a750bec1.js";import"./InputPhone.1335d16b.js";import"./SelectCountry.415793bd.js";import"./setting.a9fe6242.js";import"./index.32689823.js";import"./index.05b14cb2.js";import"./index.a87b789d.js";import"./payment.18192fe7.js";import"./select.fad79672.js";import"./TremendousCard.5e4d8354.js";import"./Form.c6b5ec72.js";import"./device.d49d5028.js";import"./badge.b78bf7eb.js";import"./auto-complete.23fc498e.js";import"./Currency.009127db.js";import"./Accordion.4d003188.js";import"./BBTable.6179d6f5.js";import"./DeviceSearch.b8fd87bd.js";import"./BDropdown.3c24c256.js";import"./DeviceGolfSpec.d4c90a90.js";import"./BSelect.f2eeebf2.js";import"./fieldset.dc1b9649.js";import"./CancelAdd.12c06c74.js";import"./Info.d3b28fa4.js";import"./DeviceGolfSpecBadge.e64cb124.js";import"./Form.4c0f5360.js";import"./breadcrumb.2d36d495.js";var P=h(d({components:{Breadcrumb:O},setup:e=>({breadcrumb:[{text:"In-Store Buyback",to:{name:"buybackLocal"}},{text:"Create Buyback"}]})}),[["render",function(e,t,o,a,i,r){const c=n("Breadcrumb",!0);return l(),u(c,{class:"mt-4 mb-8",pageTitle:"Create Buyback",backTo:{name:"buybackLocal"},items:e.breadcrumb},m({_:2},[e.$slots.buttonStep?{name:"right",fn:p((()=>[b(e.$slots,"buttonStep")])),key:"0"}:void 0]),1032,["items"])}]]),T=d({components:{PaymentMethod:B,Device:q},setup(){const e=v(),{genSuspense:a}=y(),i=f(1),{dataCustomer:r,dataPaymentMethod:c,dataDevice:d,loading:n,action:l}=g("local"),{state:u,action:m}=C(),{data:p,action:b,loading:h}=w(),O=f(!1),T=f(!1),I=f(!1),$=f(!1),L=async e=>{r.customer_id=e.customer_id||e.id,r.customer_email=e.email,r.customer_firstname=e.first_name,r.customer_lastname=e.last_name,await m(e.customer_id),i.value=2},F=e=>{Object.assign(p,e)},M=()=>_(k,{color:"teal",loading:h.value,onClick:()=>(async()=>{$.value.refChildComponent.validate&&$.value.refChildComponent.validate()&&await b((async e=>{await L(e)}))})()},{default:()=>"Continue"}),A=()=>{if(1===i.value)return[_(D,{onData:F,onChoose:L,ref:$,choose:!0,onChange:e=>O.value="CustomerForm"===e}),_("div",{class:["flex","items-center","justify-end"]})];{let e;return 2===i.value?e=_(B,{data:c.value,items:u.value,ref:I,autoSelect:T.value,showTip:!0,"onUpdate:data":e=>{c.value=e}}):3===i.value&&(e=a({component:q,props:{data:d.value,"onUpdate:data":e=>{d.value=e}},buybackType:"instore"})),[_(x,{class:"mb-4"},{default:()=>e})]}},E=()=>_(k,{view:"outlined",color:"teal",onClick:()=>{2===i.value&&(c.value=null),i.value--}},{default:()=>"Back"}),G=()=>1===i.value?O.value&&M()||"":2===i.value?_("div",{class:"flex items-center justify-between gap-x-2"},{default:()=>[E(),_(k,{color:"teal",loading:n.value,onClick:()=>{var e,t,o,a;T.value=!0;null!=(a=(null==(t=null==(e=null==I?void 0:I.value)?void 0:e.refChildComponent)?void 0:t.validate)&&(null==(o=null==I?void 0:I.value.refChildComponent)?void 0:o.validate()))&&a&&i.value++}},{default:()=>"Continue"})]}):3===i.value?_("div",{class:"flex items-center justify-between gap-x-2"},{default:()=>[E(),_(k,{color:"teal",loading:n.value,onClick:async()=>{if(!d.value)return j({message:"Please add at least one item first",type:"warning"}),!1;d.value=d.value.map((e=>{var a,i;return 1==e.device.is_custom?s(s({category:e.device.category_name,category_id:e.device.category_id,product_name:e.product.name,condition:e.device.condition.name,condition_id:e.device.condition.id,price:e.device.price,qty:e.device.qty,is_mac:e.device.is_mac,imei_sn:e.device.imei_sn,is_custom:1,notes:e.device.notes},e.device&&e.device.bbb_diagnostic_result&&{bbb_diagnostic_result:e.device.bbb_diagnostic_result}),e.device.custom_color?{custom_color:e.device.custom_color,color_id:null}:{color_id:(null==(a=e.device.color)?void 0:a.id)||null}):(r=s(s(s({unique_id:`${(new Date).getTime()}_${e.product.id}_${e.device.condition.id}`,brand:e.product.brand?e.product.brand:e.product.name,category:e.product.category?e.product.category:e.product.name,product_id:e.product.id,condition_id:e.device.condition.id,price:e.device.price,qty:e.device.qty,is_mac:e.device.is_mac,imei_sn:e.device.imei_sn,is_custom:0,notes:e.device.notes},e.device&&e.device.bbb_diagnostic_result&&{bbb_diagnostic_result:e.device.bbb_diagnostic_result}),e.device.golf_specs),e.device.custom_color?{custom_color:e.device.custom_color,color_id:null}:{color_id:(null==(i=e.device.color)?void 0:i.id)||null}),c={questions:e.device.questions.reduce(((e,t)=>("object"==typeof t.answer_id?t.answer.forEach((o=>e.push({question_id:t.question_id,answer_id:o.id}))):t.answer_id&&e.push({question_id:t.question_id,answer_id:t.answer.id}),e)),[])},t(r,o(c)));var r,c})),await l((t=>{e.push({name:"buybackLocalDetail",params:{buybackId:t.data.box_id}})}))}},{default:()=>"Continue"})]}):[_("span")];return()=>[_(P,{},{buttonStep:()=>G()}),_(x,{},{default:()=>[_(S,{activeStep:i.value,steps:["Customer","Payout","Item"],class:"mb-16",color:"teal"}),A()]})]}});export{T as default};
