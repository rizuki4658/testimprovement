{"version":3,"file":"dashboard.61bc16cf.js","sources":["../../src/store/pinia/dashboard.js"],"sourcesContent":["import { defineStore } from 'pinia'\nimport request, { shouldFetch } from 'utils/request'\nimport store from 'store'\n\nexport const useDashboard = defineStore('dashboard', {\n  state: () => ({\n    getCard: {\n      isLoading: false,\n      result: {},\n      isLoadingItem: false,\n      resultItem: []\n    },\n    getPersonalize: {\n      abortController: null,\n      result: undefined\n    },\n    lastFetched: new Map()\n  }),\n  getters: {\n    buybackType() {\n      return store.state.user.me.is_location_mail_in === 1 ? 'mailin' : 'instore'\n    }\n  },\n  actions: {\n    async resetAll () {\n      this.lastFetched = new Map()\n    },\n    async $getPersonalize() {\n      const key = `dashboard_card_pesonalize`\n      const { now, should } = shouldFetch(this.lastFetched, key)\n\n      if (!should) return this.getPersonalize.result\n\n      const response = await request({\n        url: '/v1/pos/order-status/dashboard/setting',\n        method: 'get',\n        params: {\n          buyback_type: this.buybackType\n        }\n      })\n\n      response?.data?.forEach(item => {\n        this.getCard.result = {\n          ...this.getCard.result,\n          [`dashboard_card_${item.id}`]: undefined\n        }\n      })\n      this.lastFetched.set(key, now)\n      this.getPersonalize.result = response\n\n      return response\n    },\n    async $updatePersonalize(payload) {\n      if (this.getPersonalize.abortController) {\n        this.getPersonalize.abortController.abort()\n      }\n\n      const controller = new AbortController()\n      this.getPersonalize.abortController = controller\n\n      try {\n        await request({\n          url: '/v1/pos/order-status/dashboard/setting',\n          method: 'put',\n          data: {\n            ...payload,\n            buyback_type: this.buybackType\n          },\n          signal: controller.signal\n        })\n\n        this.getPersonalize.abortController = null\n      } catch (error) {\n        if (error.name === 'AbortError') console.log('Request Canceled!')\n          else throw error\n      }\n    },\n    async $getItem(id, limit) {\n      const response = await request({\n        url: `/v1/pos/dashboard/order/${id}`,\n        method: 'get',\n        params: {\n          month: 'all',\n          year: 'all',\n          limit: limit,\n          buyback_type: this.buybackType === 'mailin' ? 1 : 2\n        }\n      })\n\n      return response\n    }\n  }\n})\n"],"names":["useDashboard","defineStore","state","getCard","isLoading","result","isLoadingItem","resultItem","getPersonalize","abortController","lastFetched","Map","getters","buybackType","store","user","me","is_location_mail_in","actions","[object Object]","this","key","now","should","shouldFetch","response","request","url","method","params","buyback_type","_a","data","forEach","item","__spreadProps","__spreadValues","id","set","payload","abort","controller","AbortController","signal","error","name","console","log","limit","month","year"],"mappings":"6fAIY,MAACA,EAAeC,EAAY,YAAa,CACnDC,MAAO,KAAO,CACZC,QAAS,CACPC,WAAW,EACXC,OAAQ,GACRC,eAAe,EACfC,WAAY,IAEdC,eAAgB,CACdC,gBAAiB,KACjBJ,YAAQ,GAEVK,YAAa,IAAIC,MAEnBC,QAAS,CACPC,YAAc,IACuC,IAA5CC,EAAMZ,MAAMa,KAAKC,GAAGC,oBAA4B,SAAW,WAGtEC,QAAS,CAAAC,iBAELC,KAAKV,YAAc,IAAIC,KAAAQ,8BAGvB,MAAME,EAAM,6BACNC,IAAEA,EAAAC,OAAKA,GAAWC,EAAYJ,KAAKV,YAAaW,GAEtD,IAAKE,EAAQ,OAAOH,KAAKZ,eAAeH,OAElC,MAAAoB,QAAiBC,EAAQ,CAC7BC,IAAK,yCACLC,OAAQ,MACRC,OAAQ,CACNC,aAAcV,KAAKP,eAahB,OATP,OAAUkB,EAAA,MAAAN,OAAA,EAAAA,EAAAO,OAAMD,EAAAE,SAAgBC,IAC9Bd,KAAKjB,QAAQE,OAAS8B,EACjBC,EAAA,GAAAhB,KAAKjB,QAAQE,QADI,CAEnBc,CAAA,kBAAkBe,EAAKG,WAAO,OAG9BjB,KAAAV,YAAY4B,IAAIjB,EAAKC,GAC1BF,KAAKZ,eAAeH,OAASoB,EAEtBA,GAAAN,yBAEgBoB,GACnBnB,KAAKZ,eAAeC,iBACtBW,KAAKZ,eAAeC,gBAAgB+B,QAGtC,MAAMC,EAAa,IAAIC,gBACvBtB,KAAKZ,eAAeC,gBAAkBgC,EAElC,UACIf,EAAQ,CACZC,IAAK,yCACLC,OAAQ,MACRI,KAAMG,OACDI,GADC,CAEJT,aAAcV,KAAKP,cAErB8B,OAAQF,EAAWE,SAGrBvB,KAAKZ,eAAeC,gBAAkB,KAAA,MAC/BmC,GACP,GAAmB,eAAfA,EAAMC,KACG,MAAAD,EADoBE,QAAQC,IAAI,uBAI3C5B,eAASkB,EAAIW,GAYV,aAXgBtB,EAAQ,CAC7BC,IAAK,2BAA2BU,IAChCT,OAAQ,MACRC,OAAQ,CACNoB,MAAO,MACPC,KAAM,MACNF,MAAAA,EACAlB,aAAmC,WAArBV,KAAKP,YAA2B,EAAI"}