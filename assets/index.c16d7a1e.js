var e=Object.defineProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,d=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t;import{h as i,a as n}from"./integration.19f1b956.js";import{f as o,b as r,_ as s,j as u,d as c,P as g,an as p,u as y,h as b,r as f,g as m,v,am as h}from"./index.e231b017.js";import{k,r as w,g as L,m as U,o as C,t as _,B as D,D as x,w as R,U as F,T as W,F as P,O as S,f as A,y as M,a0 as I,n as E,A as T,a2 as j,I as O,K as X,a3 as z,_ as $}from"./vendor.f1efedad.js";import{c as B}from"./copy.ef53d68d.js";const N=k({inheritAttrs:!0,name:"DatafeedWidgetUrl",components:{Input:o,Button:r},props:{url:{type:String},originalUrl:{type:String,default:""},error:{type:Boolean,default:!1},inlineEdit:{type:Boolean,default:!1},loading:{type:Boolean,default:!1}},emits:["change","click","save"],setup(e,{emit:a}){const l=w({url:"",original_url:""}),t=L({get:()=>e.url?e.url:l.url,set:e=>{l.url=e,a("change",e)}}),d=L({get:()=>e.originalUrl?e.originalUrl:l.original_url,set:e=>{l.original_url=e,a("update:originalUrl",e)}}),i=L((()=>!!e.inlineEdit&&t.value!==d.value));return{widgetUrl:t,isEditing:i,handleChange:e=>{t.value=e},handleSaveEdit:()=>{l.original_url=l.original_url,a("save",t.value)},handleCancelEdit:()=>{t.value=d.value}}}}),Z={key:0,class:"space-y-2 mb-4"},V={key:1,class:"text-base font-semibold mr-4 mb-2"},K={class:"flex items-center gap-2"},q={key:0,class:"flex inline-flex gap-2"},G={key:2,class:"text-red-base block mt-2"};const H=k({components:{Button:r,Alert:u,Input:o,Modal:c,Pagination:g,DatafeedWidgetUrl:s(N,[["render",function(e,a,l,t,d,i){const n=U("Input"),o=U("Button");return C(),_("div",{class:P(["inline-block",e.inlineEdit&&"bg-grey-01 bg-opacity-30 rounded-lg px-4 py-4"])},[e.inlineEdit?(C(),_("div",Z,a[1]||(a[1]=[D("p",{class:"text-lg font-medium mr-4"}," Add the URL your widget is hosted on ",-1),D("p",{class:"text-sm text-grey-03"}," Add the URL where your widget is hosted. This is required if you plan to use your data feed on a comparison website like SellCell or Swappa, as they rely on deep links. If you are using our API and don't have the widget hosted on a website or don't use deep links, you can enter any random URL. ",-1)]))):(C(),_("p",V," Add the URL your widget is hosted on ")),D("div",K,[x(n,{"model-value":e.widgetUrl,"onUpdate:modelValue":e.handleChange,onClick:a[0]||(a[0]=a=>e.$emit("click",a)),view:e.error?"danger":"default",disabled:e.loading,placeholder:"ex. app.reusely.com",block:""},{prepend:R((()=>a[2]||(a[2]=[D("span",null," https://",-1)]))),_:1},8,["model-value","onUpdate:modelValue","view","disabled"]),x(W,{name:"slide-fade"},{default:R((()=>[e.isEditing?(C(),_("div",q,[x(o,{onClick:e.handleSaveEdit,loading:e.loading,dense:"",color:"teal"},{default:R((()=>a[3]||(a[3]=[D("span",{class:"block py-1"},[D("i",{class:"material-icons"},"check")],-1)]))),_:1},8,["onClick","loading"]),x(o,{onClick:e.handleCancelEdit,loading:e.loading,dense:"",color:"red"},{default:R((()=>a[4]||(a[4]=[D("span",{class:"block py-1"},[D("i",{class:"material-icons"},"close")],-1)]))),_:1},8,["onClick","loading"])])):F("",!0)])),_:1})]),e.error?(C(),_("small",G," URL is not valid! ")):F("",!0)],2)}]]),NotificationDatafeed:p},async setup(){const e=S(),{state:o,loading:r,actionGET:s,actionPOST:u}=i(),{datafeed:c,stateAllDataFeed:g,actionAllDataFeed:p,loading:k,refreshDatafeed:w,resetAllDataFeed:U,stateShowDataFeed:C,actionShowDataFeed:_}=n(),{open:D}=h(),{isProPlan:x,hasDataFeedAccess:R,isCurrentlyProcessingDatafeed:F}=y(),{openNotification:W}=b(),P=A(!1),I=L((()=>{var e,a,l,t;return{copy:null!=(a=null==(e=C.value)?void 0:e.datafeed_share_link)?a:null,download:null!=(t=null==(l=C.value)?void 0:l.datafeed_download_link)?t:null}})),E=L((()=>{var e,a,l,t;return{copy:null!=(a=null==(e=C.value)?void 0:e.datafeed_share_link_xml)?a:null,download:null!=(t=null==(l=C.value)?void 0:l.datafeed_download_link_xml)?t:null}})),T=L((()=>null!==I.value)),j=A([]),O=A(""),X=A(""),z=()=>{D({title:"Data Feed",description:"Seamlessly share, download, and integrate your buyback catalog, buyback pricing, and buyback widget deep links into your websites or app via an API or CSV.",image_url:"/images/paywall/paywall-data-feed.svg"})},N=async()=>{O.value&&O.value.length?(await p(),j.value=f(g.value.data)):j.value=[]},Z=async()=>{await s()},V=L((()=>!x.value&&0==R.value)),K=L((()=>!o.value||F.value)),q=m((async(e,a=(()=>{}))=>{if(V.value)return O.value=o.value,void z();P.value=!1;if(!/^[a-zA-Z0-9][a-zA-Z0-9-]{1,61}[a-zA-Z0-9](?:\.[a-zA-Z]{2,})+/.test(e))return P.value=!0,void(O.value=e);const l=e;O.value=l,await u(l),await Z(),await N(),v(a)&&a()}),300);return Z(),await _(),M((()=>((e,i)=>{for(var n in i||(i={}))l.call(i,n)&&d(e,n,i[n]);if(a)for(var n of a(i))t.call(i,n)&&d(e,n,i[n]);return e})({},c)),m((async()=>{N()}),300),{immediate:!0,deep:!0}),M((()=>w.value),(e=>{e&&(async()=>{O.value&&O.value.length?(await U(),j.value=f(g.value.data)):j.value=[]})()}),{immediate:!0}),M((()=>o.value),(e=>{O.value=e,X.value=e}),{immediate:!0}),{loading:k,actionAllDataFeed:p,table:g,tableData:j,datafeed:c,isRestrictedDataFeed:V,isNotInitializedDatafeed:K,errorWidgetUrl:P,columnWidth:e=>["Manufacturer","manufacturer"].includes(e)||["Model","model"].includes(e)?"150":["Combined","combined"].includes(e)?"200":["Deeplink","deeplink"].includes(e)?"450":"100",copyDeeplink:e=>{navigator.clipboard.writeText(e).then((()=>{$({type:"success",message:"Deeplink copied to clipbord"})}))},doActionAll:N,dataFeedLink:I,dataFeedLinkXML:E,isAvailableDatafeedLink:T,copyText:B,stateWidgetURL:o,widgetURL:O,originalWidgetUrl:X,loadingWidget:r,doShowWidgetURL:Z,doUpdateWidgetURL:q,handleDownload:(e,a)=>{if(V.value)return void z();if(!C.value.has_data_feed_exists)return $({type:"warning",message:"Data Feed not found."});const l=document.createElement("a"),t=new Date(Date.now()),d=()=>({year:t.getFullYear(),month:t.getMonth()+1,date:t.getDate(),hours:t.getHours(),minutes:t.getMinutes(),seconds:t.getSeconds()});l.download=`datafeed__${d().year}-${d().month<=9&&"0"+d().month||d().month}-${d().date<=9&&"0"+d().date||d().date}-${d().hours<=9&&"0"+d().hours||d().hours}:${d().minutes<=9&&"0"+d().minutes||d().minutes}:${d().seconds<=9&&"0"+d().seconds||d().seconds}${a}`,l.href=e,l.target="_blank",document.body.appendChild(l),l.click(),document.body.removeChild(l)},handleShareDatafeedLink:e=>{V.value?z():B(e)},handlePaginationChange:()=>{V.value&&z()},handleClickWidgetUrl:e=>{if(V.value)return e.preventDefault(),void z()},handleChangeWidgetUrl:e=>{O.value=e},handleSaveWidgetUrl:async()=>{await q(O.value,(async()=>{X.value=O.value,W("NotificationDatafeed")}))},handleClose:()=>{e.push({name:"integration"})}}}}),Y={key:0,class:"grid gap-4"},J={class:"border border-grey-01 rounded-lg p-2 mb-4"},Q={key:1},ee={class:"block mb-4"},ae={class:"grid md:grid-cols-3 gap-8 mb-4"},le=["disabled"],te=["disabled"],de=["disabled"],ie=["disabled"],ne={key:0,class:"block my-12 border border-grey-01 rounded-lg px-8 py-6"},oe={class:"grid grid-cols-2 gap-4 mb-4"},re={class:"float-right"},se={key:0,class:"flex"},ue={class:"deeplink w-11/12"},ce={class:"w-1/12"},ge=["onClick"],pe={key:1},ye={key:1,class:"flex flex-col justify-center my-6 h-96 border border-grey-01 rounded-lg"},be={class:"h-10"},fe={key:1,class:"bg-grey-01 bg-opacity-50 border-1 border-grey-01 rounded-lg h-96 flex items-center justify-center"};var me=s(H,[["render",function(e,a,l,t,d,i){const n=U("DatafeedWidgetUrl"),o=U("NotificationDatafeed"),r=U("Input"),s=U("Tooltip"),u=U("TableColumn"),c=U("Table"),g=U("Pagination"),p=U("Modal"),y=I("loading");return C(),E(p,{"model-value":!0,onClickClose:e.handleClose,title:"Data Feed",size:e.isNotInitializedDatafeed?"sm":"lg","hide-footer":""},{default:R((()=>[e.isNotInitializedDatafeed?(C(),_("div",Y,[x(n,{onChange:e.handleChangeWidgetUrl,onClick:e.handleClickWidgetUrl,onSave:e.handleSaveWidgetUrl,"original-url":e.originalWidgetUrl,"onUpdate:originalUrl":a[0]||(a[0]=a=>e.originalWidgetUrl=a),url:e.widgetURL,error:e.errorWidgetUrl,loading:e.loadingWidget,"inline-edit":""},null,8,["onChange","onClick","onSave","original-url","url","error","loading"]),D("div",J,[x(o,{status:e.stateWidgetURL?"Preparing data":"Waiting for URL","show-percentage":!1},null,8,["status"])])])):(C(),_("div",Q,[T((C(),_("div",null,[D("div",ee,[D("div",ae,[D("div",null,[x(n,{url:e.widgetURL,error:e.errorWidgetUrl,onChange:e.doUpdateWidgetURL,onClick:e.handleClickWidgetUrl},null,8,["url","error","onChange","onClick"])]),D("div",null,[a[10]||(a[10]=D("p",{class:"text-base font-semibold mr-4 my-2"},"Share your .csv data feed",-1)),x(s,{placement:"top",disabled:!!e.widgetURL||!!e.widgetURL.length},{content:R((()=>a[7]||(a[7]=[D("p",null,"Please fill out your URL first before your access your data feed.",-1)]))),default:R((()=>[x(r,{value:e.dataFeedLink.copy,class:"input-datafeed w-full",disabled:"","append-flex":""},{append:R((()=>[D("div",{class:P(["flex h-full",e.widgetURL&&e.dataFeedLink.copy&&"bg-white"])},[D("button",{title:"Copy",type:"button",disabled:!e.widgetURL||!e.dataFeedLink.copy,class:P([(!e.widgetURL||!e.dataFeedLink.copy)&&"disabled","input-button-act border flex items-center border-l-0 border-grey-01"]),onClick:a[1]||(a[1]=a=>e.handleShareDatafeedLink(e.dataFeedLink.copy))},a[8]||(a[8]=[D("i",{class:"copy material-symbols-outlined mx-auto"},"content_copy",-1)]),10,le),D("button",{title:"Download",type:"button",disabled:!e.widgetURL||!e.dataFeedLink.download,class:P([(!e.widgetURL||!e.dataFeedLink.download)&&"disabled","input-button-act border flex items-center border-l-0 border-grey-01 rounded-r-md"]),onClick:a[2]||(a[2]=a=>e.handleDownload(e.dataFeedLink.copy,".csv"))},a[9]||(a[9]=[D("i",{class:"copy material-symbols-outlined mx-auto"},"download",-1)]),10,te)],2)])),_:1},8,["value"])])),_:1},8,["disabled"])]),D("div",null,[a[14]||(a[14]=D("p",{class:"text-base font-semibold mr-4 my-2"},"Share your .XML data feed",-1)),x(s,{placement:"top",disabled:!!e.widgetURL||!!e.widgetURL.length},{content:R((()=>a[11]||(a[11]=[D("p",null,"Please fill out your URL first before your access your data feed.",-1)]))),default:R((()=>[x(r,{value:e.dataFeedLinkXML.copy,class:"input-datafeed w-full",disabled:"","append-flex":""},{append:R((()=>[D("div",{class:P(["flex h-full",e.widgetURL&&e.dataFeedLinkXML.copy&&"bg-white"])},[D("button",{title:"Copy",type:"button",disabled:!e.widgetURL||!e.dataFeedLinkXML.download,class:P([(!e.widgetURL||!e.dataFeedLinkXML.copy)&&"disabled","input-button-act border flex items-center border-l-0 border-grey-01"]),onClick:a[3]||(a[3]=a=>e.handleShareDatafeedLink(e.dataFeedLinkXML.copy))},a[12]||(a[12]=[D("i",{class:"copy material-symbols-outlined mx-auto"},"content_copy",-1)]),10,de),D("button",{title:"Download",type:"button",disabled:!e.widgetURL||!e.dataFeedLinkXML.download,class:P([(!e.widgetURL||!e.dataFeedLinkXML.download)&&"disabled","input-button-act border flex items-center border-l-0 border-grey-01 rounded-r-md"]),onClick:a[4]||(a[4]=a=>e.handleDownload(e.dataFeedLinkXML.download,".xml"))},a[13]||(a[13]=[D("i",{class:"copy material-symbols-outlined mx-auto"},"download",-1)]),10,ie)],2)])),_:1},8,["value"])])),_:1},8,["disabled"])])])]),e.widgetURL&&e.widgetURL.length?(C(),_(j,{key:0},[e.loading.data_feed?F("",!0):(C(),_("div",ne,[D("div",oe,[D("div",null,[D("div",null,[a[15]||(a[15]=O(" Total SKU: ")),D("strong",null,X(e.table.total_sku),1)]),D("div",null,[a[16]||(a[16]=O(" Total Manufacturer: ")),D("strong",null,X(e.table.total_manufacturer),1)]),D("div",null,[a[17]||(a[17]=O(" Total Model: ")),D("strong",null,X(e.table.total_model),1)])]),D("div",null,[D("div",re,[a[18]||(a[18]=O(" Last Update : ")),D("strong",null,X(e.table.last_update),1)])])]),D("div",null,[T((C(),E(c,{class:"mb-6",data:e.tableData,"max-height":"500"},{default:R((()=>[(C(!0),_(j,null,z(e.table.columns,((a,l)=>(C(),E(u,{key:l,prop:a.key,label:a.label,width:e.columnWidth(a.key)},{default:R((l=>[["Deeplink","deeplink"].includes(a.key)?(C(),_("div",se,[D("div",ue,X(l.row[a.key]),1),D("div",ce,[D("i",{class:"material-symbols-outlined text-lg text-teal-04 float-right",onClick:t=>e.copyDeeplink(l.row[a.key])},"content_copy",8,ge)])])):(C(),_("div",pe,[D("span",null,X(l.row[a.key]),1)]))])),_:2},1032,["prop","label","width"])))),128))])),_:1},8,["data"])),[[y,e.loading.data_feed]]),x(g,{page:e.datafeed.page,"onUpdate:page":a[5]||(a[5]=a=>e.datafeed.page=a),limit:e.datafeed.limit,"onUpdate:limit":a[6]||(a[6]=a=>e.datafeed.limit=a),onClickPage:e.handlePaginationChange,onClickPageInput:e.handlePaginationChange,onClickLimitOption:e.handlePaginationChange,disabled:e.isRestrictedDataFeed,data:e.table},null,8,["page","limit","onClickPage","onClickPageInput","onClickLimitOption","disabled","data"])])])),e.loading.data_feed?(C(),_("div",ye,[T(D("div",be,null,512),[[y,!0]]),a[19]||(a[19]=D("br",null,null,-1)),a[20]||(a[20]=O()),a[21]||(a[21]=D("br",null,null,-1)),a[22]||(a[22]=D("div",{class:"items-center text-center"},[D("h6",null,"Please wait, we are updating your data. It may take several minutes to complete.")],-1))])):F("",!0)],64)):F("",!0),e.widgetURL&&e.widgetURL.length?F("",!0):(C(),_("div",fe,a[23]||(a[23]=[D("p",{class:"text-grey-02"},"Please fill out your URL first before your access your data feed.",-1)])))])),[[y,e.loadingWidget]])]))])),_:1},8,["onClickClose","size"])}],["__scopeId","data-v-f727447a"]]);export{me as default};
