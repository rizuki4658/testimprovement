var a=Object.defineProperty,e=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,l=(e,t,o)=>t in e?a(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;import{u as i}from"./components.0003aa88.js";import{k as n,a0 as s,A as c,o as d,t as r,B as u,K as p,N as m,O as g,a5 as f,f as h,g as b,y,m as _,D as v,w,n as L,U as x,I as M,S,a6 as k,ar as C,_ as P}from"./vendor.f1efedad.js";import{u as j,c as I,a as A}from"./location.4fdb725a.js";import{u as D}from"./dashboard.b0a370a4.js";import{_ as V,b as q,e as T,d as U,f as B,S as F,P as N,u as E,ao as O,a9 as $,g as z}from"./index.9aa6481b.js";import{C as R}from"./card.dfb8e6f7.js";import{_ as Z}from"./badge.b59865a3.js";import{_ as H}from"./fieldset.49a14fc7.js";import{c as K}from"./status.6f59bf91.js";import{_ as W}from"./attention.c511405b.js";import{_ as Y}from"./unlock.29bb9197.js";import"./LoadingCard.be59eb97.js";import"./date.f86face7.js";import"./setting.2daa7691.js";const G=n({name:"ManageLocationTotalBilledLocation",props:{total:{type:Number,default:0},loading:{type:Boolean,default:!1}},setup:()=>({})}),J={class:"billed-location"},Q={class:"billed-location__total"};const X=n({components:{Card:R,Button:q,Checkbox:T,Modal:U,Input:B,Select:F,Pagination:N,Badge:Z,Fieldset:H,TotalBilledLocation:V(G,[["render",function(a,e,t,o,l,i){const n=s("loading");return c((d(),r("div",J,[e[1]||(e[1]=u("div",null,[u("img",{class:"billed-location__icon",src:"/assets/location-billed.440f486b.svg",draggable:"false"})],-1)),u("div",null,[e[0]||(e[0]=u("p",{class:"billed-location__description"}," Total Number of Billed Locations ",-1)),u("p",Q,p(a.total),1)])])),[[n,a.loading]])}],["__scopeId","data-v-cc1d670a"]])},async setup(a,{emit:i}){const n=m(),s=g(),c=f(),{data:d,dataLocation:r,state:u,loading:p,modal:_,isShowSwitchLocationModal:v,isShowEnableMailinModal:w,selected:L,locationList:x,unsetData:M,openModal:S,actionAll:k,actionDelete:C,actionMailLocation:V}=j(),{stateFiltered:q,locations:T,loading:U,query:B}=D(),{linkedStatuses:F,loading:N,actionRequestFranchisee:R,actionCancelFranchisee:Z,actionUnlinkFranchisee:H}=I(),{me:W,action:Y}=E(),{loading:G,billingCycleType:J,refundedProrateAmount:Q,getRefundedProrateAmount:X}=A(),aa=h(!1),ea=b((()=>q.value.data?q.value.data.filter((a=>a.id!==parseInt(L.value))):[])),ta=b((()=>u.value.franchisor_code||null)),oa=b((()=>{var a;return(null==(a=u.value)?void 0:a.mailin_location)||null})),la=b((()=>{var a;return null==(a=q.value)?void 0:a.is_mailin_available})),ia=b((()=>null===oa.value?"":oa.value.address_text)),na=b({set:a=>{r.new_store_id=a},get:()=>r.new_store_id}),sa=b((()=>1==c.query["switch-mailin"])),ca=b((()=>sa.value)),da=b((()=>aa.value?"Confirm Delete Location":"This location will be permanently deleted")),ra=b((()=>aa.value?"By deleting your Mail-in location, you will lose access to all your Mail-in buybacks data and all the Mail-in features. We recommend exporting the data before proceeding. Are you sure you want to lose access to the Mail-in buybacks data?":" However, to proceed, you must transfer its data to another location. Please select the destination for the data transfer from the options below."));y((()=>({limit:d.limit,search:d.search})),(()=>{d.page=1}),{deep:!0}),y((()=>((a,i)=>{for(var n in i||(i={}))t.call(i,n)&&l(a,n,i[n]);if(e)for(var n of e(i))o.call(i,n)&&l(a,n,i[n]);return a})({},d)),z((async()=>{await k(n.state.user.me.id)}),500),{deep:!0}),y((()=>({search:B.search})),(()=>{B.page=1})),y((()=>({search:B.search,page:B.page})),z((async()=>{await T((()=>{}),n.state.user.me.id)}),500));const ua=(a,e)=>S(a,(()=>{L.value=e.id})),pa=async()=>{var a;await V({is_enable:sa.value?1:1==(null==(a=oa.value)?void 0:a.is_enable_mailin)?0:1},(async()=>{P({type:"success",message:"Mail-In location status updated"}),await Promise.all([Y(),k(n.state.user.me.id),T((()=>{}),n.state.user.me.id)])})),w.value=!1,s.push({name:"settingManageLocationStoreLocations",query:{}})};return await Promise.all([k(n.state.user.me.id),T((()=>{}),n.state.user.me.id)]),{data:d,me:W,dataLocation:r,store:n,state:u,stateLocation:q,listLocation:ea,selectedLocation:na,loading:p,modal:_,isShowSwitchLocationModal:v,isShowEnableMailinModal:w,isShowSwitchMailinModal:ca,unsetData:M,loadingFranchisee:N,loadingLocations:U,loadingAdditionalPrice:G,color:K,lowerCase:O,linkedStatuses:F,query:B,isMailAvailable:la,currentMailInLocation:oa,currentMailInLocationAddress:ia,phoneNumber:$,locationList:x,refundedProrateAmount:Q,isMailinCurrentSelectedLocation:aa,popupTitleDeleteLocation:da,popupDescriptionDeleteLocation:ra,billingCycleType:J,deleteLocation:async()=>{aa.value?await V({is_enable:0},(async a=>{var e,t;if(a)return console.warn("Error deleting mail-in location: ",a);_.delete=!1,M(),await Promise.allSettled([k(null==(e=n.state.user.me)?void 0:e.id),T((()=>{}),null==(t=n.state.user.me)?void 0:t.id)])})):(await C(),await T((()=>{}),n.state.user.me.id))},openModalSelected:ua,handleRequestFranchisee:async a=>{if(a.franchisor_code===ta.value)return P({type:"error",message:"You won't be able to enter your own access code"});const e={location_id:a.id,franchisor_code:a.franchisor_code?a.franchisor_code:""};await R(e,(async()=>{await Promise.all([k(n.state.user.me.id),T((()=>{}),n.state.user.me.id)])}))},handleCancelFranchisee:async a=>await Z(a,(async()=>{P({type:"success",message:"Request canceled"}),await k(n.state.user.me.id)})),handleUnlinkFranchisee:async a=>await H(a,(async()=>{P({type:"success",message:"Location unlinked"}),await k(n.state.user.me.id)})),handleUpdateLocationStatus:async()=>{if(!la.value)return;const a=!!u.value.is_popup_switch_location_type&&1==oa.value.is_enable_mailin,e=u.value.package_detail.is_popup_paid_location&&0==oa.value.is_enable_mailin;a?v.value=!0:e?s.push({name:"settingManageLocationEdit",params:{locationId:oa.value.id},query:{"switch-mailin":0}}):await pa()},handleSwitchLocationType:()=>{const a=1==oa.value.is_enable_mailin?oa.value.id:u.value.data[0].id;v.value=!1,s.push({name:"settingManageLocationSwitchLocation",params:{locationId:a}})},handleUpdateMailInLocationStatus:pa,handleDeleteLocation:async a=>{var e;const t=a.id===(null==(e=oa.value)?void 0:e.id);aa.value=t,await X();!u.value.is_popup_switch_location_type?ua("delete",a):v.value=!0},censorLocationName:a=>{if(!a)return a;let e=a;return e=e.replace(/(?:\d[\s.-]?){5,}/g,(a=>{const e=a.replace(/\D/g,"");return e.length<=4?"*".repeat(e.length):`${e.slice(0,4)}${"*".repeat(e.length-4)}`})),e=e.replace(/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g,(a=>`${a[0]}${"*".repeat(a.length-1)}`)),e=e.replace(/\b(call us|contact us|email us|text us)\b/gi,(a=>"*".repeat(a.length))),e}}}}),aa={class:"grid grid-cols-4 mb-6"},ea={class:"col-span-4"},ta={class:"flex"},oa={class:"text-teal-04 font-semibold"},la={class:"lg:opacity-0 group-hover:opacity-100 transition-opacity"},ia={class:"text-center py-6"},na={class:"mt-8 mb-10"},sa={class:"mb-2 text-2xl"},ca={class:"text-grey-03 mb-8"},da={class:"mb-4"},ra={key:0,class:"flex gap-4 py-2 px-4 rounded-lg text-left",style:{"background-color":"rgba(0, 0, 0, 0.03)"}},ua={class:"mt-1"},pa={class:"font-semibold"},ma={class:"px-4 py-4 w-full"},ga={class:"px-4 py-4 w-full flex flex-col"},fa={class:"flex flex-col items-center justify-center my-4"},ha={class:"text-center text-grey-04"},ba={class:"flex items-center justify-center my-6"},ya={class:"flex flex-col items-center justify-center my-4"},_a={class:"text-center text-grey-04"},va={class:"flex items-center justify-center my-6"};var wa=V(X,[["render",function(a,e,t,o,l,i){const n=_("TotalBilledLocation"),m=_("Input"),g=_("TableColumn"),f=_("Button"),h=_("Table"),b=_("Pagination"),y=_("Select"),P=_("Modal"),j=_("RouterView"),I=s("loading");return d(),r("div",null,[u("div",aa,[u("div",ea,[v(n,{loading:a.loading.all,total:a.state.total_location},null,8,["loading","total"])])]),u("div",ta,[v(m,{modelValue:a.data.search,"onUpdate:modelValue":e[0]||(e[0]=e=>a.data.search=e),placeholder:"Search",class:"w-full mb-5",icon:""},{icon:w((()=>e[12]||(e[12]=[u("span",{class:"material-icons"},"search",-1)]))),_:1},8,["modelValue"])]),c((d(),r("div",null,[v(h,{data:a.locationList},{default:w((()=>[v(g,{label:"Location Name",width:"300"},{default:w((({row:e})=>[u("p",oa,[u("span",null,p(a.censorLocationName(e.name)),1)])])),_:1}),v(g,{label:"Email",prop:"email"}),v(g,{label:"Address",prop:"address_text"}),v(g,{label:"Phone Number",width:"150"},{default:w((({row:e})=>[u("p",null,p(a.phoneNumber(e.phone)),1)])),_:1}),v(g,{label:"Purchasing Method",width:"150"},{default:w((({row:e})=>{var t;return[u("p",null,p((null==(t=a.currentMailInLocation)?void 0:t.id)===(null==e?void 0:e.id)?"Mail-In":"In-Store"),1)]})),_:1}),v(g,{label:"",width:"450"},{default:w((({row:t})=>[u("div",la,[v(f,{class:"mr-4",color:"teal",to:{name:"settingManageLocationEdit",params:{locationId:t.id}},link:"",dense:""},{default:w((()=>e[13]||(e[13]=[u("span",{class:"material-icons"},"edit",-1)]))),_:2},1032,["to"]),a.state.total_location>1?(d(),L(f,{key:0,onClick:e=>a.handleDeleteLocation(t),loading:a.loadingAdditionalPrice,color:"red",dense:""},{default:w((()=>e[14]||(e[14]=[u("span",{class:"material-icons text-xl"},"delete",-1)]))),_:2},1032,["onClick","loading"])):x("",!0)])])),_:1})])),_:1},8,["data"]),v(b,{page:a.data.page,"onUpdate:page":e[1]||(e[1]=e=>a.data.page=e),limit:a.data.limit,"onUpdate:limit":e[2]||(e[2]=e=>a.data.limit=e),data:a.state},null,8,["page","limit","data"])])),[[I,a.loading.all]]),v(P,{size:"sm",modelValue:a.modal.delete,"onUpdate:modelValue":e[7]||(e[7]=e=>a.modal.delete=e),title:"Delete Location",onClose:a.unsetData,"hide-header":"","hide-footer":""},{default:w((()=>[u("div",ia,[e[21]||(e[21]=u("img",{class:"mb-10 mx-auto",src:W,alt:"Icon"},null,-1)),u("div",na,[u("h6",sa,p(a.popupTitleDeleteLocation),1),u("div",ca,[u("p",da,p(a.popupDescriptionDeleteLocation),1),a.refundedProrateAmount?(d(),r("div",ra,[e[17]||(e[17]=u("i",{class:"material-icons"},"info",-1)),u("p",ua,[e[15]||(e[15]=M(" A prorated refund of ")),u("span",pa,p(a.refundedProrateAmount),1),e[16]||(e[16]=M(" will be credited to your account and applied to your next billing cycle. "))])])):x("",!0)]),a.isMailinCurrentSelectedLocation?x("",!0):(d(),L(y,{key:0,modelValue:a.dataLocation.new_store_id,"onUpdate:modelValue":e[5]||(e[5]=e=>a.dataLocation.new_store_id=e),placeholder:"Choose location",by:"id",name:"name",items:a.listLocation,loading:a.loadingLocations.all,"max-height":"200px",block:""},{prepend:w((()=>[u("div",ma,[v(m,{modelValue:a.query.search,"onUpdate:modelValue":e[3]||(e[3]=e=>a.query.search=e),placeholder:"Search Location",class:"w-full",block:"",icon:""},{icon:w((()=>e[18]||(e[18]=[u("span",{class:"material-icons"},"search",-1)]))),_:1},8,["modelValue"])])])),item:w((({item:a})=>[M(p(a.name),1)])),append:w((()=>[u("div",ga,[v(b,{page:a.query.page,"onUpdate:page":e[4]||(e[4]=e=>a.query.page=e),"hide-show-entries":"",small:"",data:a.stateLocation},null,8,["page","data"])])])),_:1},8,["modelValue","items","loading"]))]),v(f,{color:"red",class:"mr-5",loading:a.loading.delete||a.loading.mailin_location,disabled:(a.loading.delete||null===a.dataLocation.new_store_id)&&!a.isMailinCurrentSelectedLocation,onClick:a.deleteLocation},{default:w((()=>e[19]||(e[19]=[M(" Delete Location ")]))),_:1},8,["loading","disabled","onClick"]),v(f,{color:"white",disabled:a.loading.delete,onClick:e[6]||(e[6]=e=>a.modal.delete=!1)},{default:w((()=>e[20]||(e[20]=[M(" Cancel ")]))),_:1},8,["disabled"])])])),_:1},8,["modelValue","onClose"]),v(P,{modelValue:a.isShowSwitchLocationModal,"onUpdate:modelValue":e[9]||(e[9]=e=>a.isShowSwitchLocationModal=e),size:"xs","hide-footer":""},{default:w((()=>[u("div",fa,[e[23]||(e[23]=u("img",{class:"mb-4 w-28",src:Y,alt:"unlock icon"},null,-1)),e[24]||(e[24]=u("h2",{class:"text-3xl font-bold my-4"},"Turned off Location",-1)),u("p",ha,p(1==a.currentMailInLocation.is_enable_mailin?"Mail-in locations would change into In-store locations after you\n          turned off.":" In-store locations would change into Mail-in locations after you\n          turned off."),1),u("div",ba,[u("a",{class:"px-8 py-4 mr-4",onClick:e[8]||(e[8]=S((e=>a.isShowSwitchLocationModal=!1),["prevent"]))},"Cancel"),v(f,{color:"orange",onClick:a.handleSwitchLocationType},{default:w((()=>e[22]||(e[22]=[M(" Proceed ")]))),_:1},8,["onClick"])])])])),_:1},8,["modelValue"]),v(P,{"model-value":a.isShowSwitchMailinModal,onClose:e[11]||(e[11]=e=>a.$router.push({name:"settingManageLocationStoreLocations",query:{}})),size:"xs","hide-footer":""},{default:w((()=>[u("div",ya,[e[28]||(e[28]=u("img",{class:"mb-4 w-28",src:Y,alt:"unlock icon"},null,-1)),e[29]||(e[29]=u("h2",{class:"text-center text-3xl font-bold my-4"}," Pay to Enable Location ",-1)),u("p",_a,[e[25]||(e[25]=M(" Pay ")),u("b",null,"$"+p(a.state.package_detail.additional_location_price)+" per month",1),e[26]||(e[26]=M(" to enable mail-in location on your account "))]),u("div",va,[u("a",{class:"px-8 py-4 mr-4",onClick:e[10]||(e[10]=S((e=>a.$router.push({name:"settingManageLocationStoreLocations",query:{}})),["prevent"]))},"Cancel"),v(f,{loading:a.loading.mailin_location,color:"orange",onClick:a.handleUpdateMailInLocationStatus},{default:w((()=>e[27]||(e[27]=[M("Proceed")]))),_:1},8,["loading","onClick"])])])])),_:1},8,["model-value"]),v(j,null,{default:w((({Component:a})=>[a?(d(),L(C,{key:0},{default:w((()=>[(d(),L(k(a)))])),_:2},1024)):x("",!0)])),_:1})])}]]),La=n({setup(){const{genSuspense:a}=i();return()=>a(wa)}});export{La as default};
